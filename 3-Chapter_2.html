<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>『カテゴリカルデータのための連関モデル』 - 2&nbsp; 第2章</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./4-Chapter_3.html" rel="next">
<link href="./2-Chapter_1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">第2章</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">『カテゴリカルデータのための連関モデル』</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">はじめに</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-Introduction.html" class="sidebar-item-text sidebar-link">シリーズ編者による序文</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-Chapter_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">第1章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-Chapter_2.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">第2章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4-Chapter_3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">第3章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5-Chapter_4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">第4章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6-Chapter_5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">第5章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7-Chapter_6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">第6章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8-Note.html" class="sidebar-item-text sidebar-link">補足のノート</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9-R.html" class="sidebar-item-text sidebar-link">RとRStudioのインストールと基本的な操作方法</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#対比について" id="toc-対比について" class="nav-link active" data-scroll-target="#対比について"><span class="toc-section-number">2.1</span>  対比について</a></li>
  <li><a href="#表2.1-p.8" id="toc-表2.1-p.8" class="nav-link" data-scroll-target="#表2.1-p.8"><span class="toc-section-number">2.2</span>  表2.1 (p.8)</a></li>
  <li><a href="#表2.3a-p.32" id="toc-表2.3a-p.32" class="nav-link" data-scroll-target="#表2.3a-p.32"><span class="toc-section-number">2.3</span>  表2.3A (p.32)</a>
  <ul class="collapse">
  <li><a href="#独立モデル" id="toc-独立モデル" class="nav-link" data-scroll-target="#独立モデル"><span class="toc-section-number">2.3.1</span>  独立モデル</a></li>
  <li><a href="#一様連関モデル" id="toc-一様連関モデル" class="nav-link" data-scroll-target="#一様連関モデル"><span class="toc-section-number">2.3.2</span>  一様連関モデル</a></li>
  <li><a href="#行効果モデル" id="toc-行効果モデル" class="nav-link" data-scroll-target="#行効果モデル"><span class="toc-section-number">2.3.3</span>  行効果モデル</a></li>
  </ul></li>
  <li><a href="#列効果モデル" id="toc-列効果モデル" class="nav-link" data-scroll-target="#列効果モデル"><span class="toc-section-number">2.4</span>  列効果モデル</a></li>
  <li><a href="#行列効果モデルrc" id="toc-行列効果モデルrc" class="nav-link" data-scroll-target="#行列効果モデルrc"><span class="toc-section-number">2.5</span>  行・列効果モデル（<span class="math inline">\(R+C\)</span>）</a></li>
  <li><a href="#行列効果モデルrc1" id="toc-行列効果モデルrc1" class="nav-link" data-scroll-target="#行列効果モデルrc1"><span class="toc-section-number">2.6</span>  行・列効果モデル（<span class="math inline">\(RC(1)\)</span>）</a></li>
  <li><a href="#周辺重みづけ" id="toc-周辺重みづけ" class="nav-link" data-scroll-target="#周辺重みづけ"><span class="toc-section-number">2.7</span>  周辺重みづけ</a></li>
  <li><a href="#表2.4a" id="toc-表2.4a" class="nav-link" data-scroll-target="#表2.4a"><span class="toc-section-number">2.8</span>  表2.4A</a></li>
  <li><a href="#表2.4b" id="toc-表2.4b" class="nav-link" data-scroll-target="#表2.4b"><span class="toc-section-number">2.9</span>  表2.4B</a></li>
  <li><a href="#表2.5a" id="toc-表2.5a" class="nav-link" data-scroll-target="#表2.5a"><span class="toc-section-number">2.10</span>  表2.5A</a></li>
  <li><a href="#表2.5b" id="toc-表2.5b" class="nav-link" data-scroll-target="#表2.5b"><span class="toc-section-number">2.11</span>  表2.5B</a></li>
  <li><a href="#表2.5b他の正規化" id="toc-表2.5b他の正規化" class="nav-link" data-scroll-target="#表2.5b他の正規化"><span class="toc-section-number">2.12</span>  表2.5B（他の正規化）</a></li>
  <li><a href="#表2.5c" id="toc-表2.5c" class="nav-link" data-scroll-target="#表2.5c"><span class="toc-section-number">2.13</span>  表2.5C</a></li>
  <li><a href="#表2.5c他の正規化" id="toc-表2.5c他の正規化" class="nav-link" data-scroll-target="#表2.5c他の正規化"><span class="toc-section-number">2.14</span>  表2.5C（他の正規化）</a></li>
  <li><a href="#表2.5d" id="toc-表2.5d" class="nav-link" data-scroll-target="#表2.5d"><span class="toc-section-number">2.15</span>  表2.5D</a></li>
  <li><a href="#表2.5d他の正規化" id="toc-表2.5d他の正規化" class="nav-link" data-scroll-target="#表2.5d他の正規化"><span class="toc-section-number">2.16</span>  表2.5D（他の正規化）</a></li>
  <li><a href="#表2.5e" id="toc-表2.5e" class="nav-link" data-scroll-target="#表2.5e"><span class="toc-section-number">2.17</span>  表2.5E</a></li>
  <li><a href="#logmultパッケージの利用" id="toc-logmultパッケージの利用" class="nav-link" data-scroll-target="#logmultパッケージの利用"><span class="toc-section-number">2.18</span>  logmultパッケージの利用</a></li>
  <li><a href="#表2.3b" id="toc-表2.3b" class="nav-link" data-scroll-target="#表2.3b"><span class="toc-section-number">2.19</span>  表2.3B</a></li>
  <li><a href="#表2.6a" id="toc-表2.6a" class="nav-link" data-scroll-target="#表2.6a"><span class="toc-section-number">2.20</span>  表2.6A</a></li>
  <li><a href="#表2.6b" id="toc-表2.6b" class="nav-link" data-scroll-target="#表2.6b"><span class="toc-section-number">2.21</span>  表2.6B</a></li>
  <li><a href="#表2.6c" id="toc-表2.6c" class="nav-link" data-scroll-target="#表2.6c"><span class="toc-section-number">2.22</span>  表2.6C</a></li>
  <li><a href="#表2.7a" id="toc-表2.7a" class="nav-link" data-scroll-target="#表2.7a"><span class="toc-section-number">2.23</span>  表2.7A</a></li>
  <li><a href="#表2.7b" id="toc-表2.7b" class="nav-link" data-scroll-target="#表2.7b"><span class="toc-section-number">2.24</span>  表2.7B</a></li>
  <li><a href="#表2.7c" id="toc-表2.7c" class="nav-link" data-scroll-target="#表2.7c"><span class="toc-section-number">2.25</span>  表2.7C</a></li>
  <li><a href="#表2.7d" id="toc-表2.7d" class="nav-link" data-scroll-target="#表2.7d"><span class="toc-section-number">2.26</span>  表2.7D</a></li>
  <li><a href="#表2.7e" id="toc-表2.7e" class="nav-link" data-scroll-target="#表2.7e"><span class="toc-section-number">2.27</span>  表2.7E</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">第2章</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>第2章では2元表の連関モデルが紹介されている．制約のかけかたは少し複雑なのでプログラムとテキストをみながら手順を確認して欲しい．</p>
<p>パッケージは<code>tidyverse</code>（データセットの処理のため），<code>magrittr</code>（パイプ演算子），<code>DescTools</code>（記述統計を求めるため），<code>vcd</code>パッケージ（カテゴリカルデータの分析のため），<code>broom</code>（回帰係数の整理），<code>gnm</code>（連関分析の処理のため），<code>logmult</code>（連関モデルのため）を使用する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="対比について" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="対比について"><span class="header-section-number">2.1</span> 対比について</h2>
<p>回帰モデルにおけるカテゴリカル変数の係数を解釈する上では対比 （contrasts）が重要である．まず，デフォルトでの<code>contrasts</code>を確認したい．<code>factor</code>変数については<code>contr.treatment</code>，<code>ordered</code>変数については<code>contr.poly</code>という対比が用いられている．<code>contr.treatment</code>は基準となっている水準とそれぞれの水準を対比する．これはダミーコーディングと呼ばれる． <code>contr.poly</code>は直交多項式（orthogonal polynomials）に基づいた対比を行う（気にしなくてよい）．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトのcontrastsを確認</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$contrasts
        unordered           ordered 
"contr.treatment"      "contr.poly" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># defaultのcontrastsの設定（ここでは特に意味はない．constrastをいじった後にデフォルトに戻す）</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>具体的に何をしているのかを以下のプログラムで確認する． ダミーコーディングの<code>contr.treatment</code>以外にも効果コーディングの<code>contr.sum</code>がある．両者を比較してみたい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"E"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A" "B" "C" "D" "E"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 基準カテゴリが0となるような対比</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contr.treatment</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  B C D E
A 0 0 0 0
B 1 0 0 0
C 0 1 0 0
D 0 0 1 0
E 0 0 0 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 合計が0となるような対比</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contr.sum</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [,1] [,2] [,3] [,4]
A    1    0    0    0
B    0    1    0    0
C    0    0    1    0
D    0    0    0    1
E   -1   -1   -1   -1</code></pre>
</div>
</div>
<p>実際に回帰分析を例に<code>contr.treatment</code>と<code>contr.sum</code>の違いを確認する．データは<code>mpg</code>（Fuel economy data from 1999 to 2008 for 38 popular models of cars）である．従属変数は<code>hwy</code>（highway miles per gallon）であり，独立変数は<code>class</code>（“type” of car）とする．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">count</span>(class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  class          n
  &lt;chr&gt;      &lt;int&gt;
1 2seater        5
2 compact       47
3 midsize       41
4 minivan       11
5 pickup        33
6 subcompact    35
7 suv           62</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Mean =</span> <span class="fu">mean</span>(hwy, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  class          n  Mean
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt;
1 2seater        5  24.8
2 compact       47  28.3
3 midsize       41  27.3
4 minivan       11  22.4
5 pickup        33  16.9
6 subcompact    35  28.1
7 suv           62  18.1</code></pre>
</div>
</div>
<p>まずダミーコーディング（dummy coding）の結果を確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の例（contr.treatmentを使用）</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>fit_ct <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_ct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hwy ~ class, data = mpg)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.1429 -1.8788 -0.2927  1.1803 15.8571 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       24.800      1.507  16.454  &lt; 2e-16 ***
classcompact       3.498      1.585   2.206   0.0284 *  
classmidsize       2.493      1.596   1.561   0.1198    
classminivan      -2.436      1.818  -1.340   0.1815    
classpickup       -7.921      1.617  -4.898 1.84e-06 ***
classsubcompact    3.343      1.611   2.075   0.0391 *  
classsuv          -6.671      1.567  -4.258 3.03e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.37 on 227 degrees of freedom
Multiple R-squared:  0.6879,    Adjusted R-squared:  0.6797 
F-statistic: 83.39 on 6 and 227 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(fit_ct) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) classcompact classmidsize classminivan classpickup
1            1            1            0            0           0
16           1            0            1            0           0
19           1            0            0            0           0
24           1            0            0            0           0
38           1            0            0            1           0
49           1            0            0            0           1
91           1            0            0            0           0
   classsubcompact classsuv
1                0        0
16               0        0
19               0        1
24               0        0
38               0        0
49               0        0
91               1        0</code></pre>
</div>
</div>
<p>出力される係数は6つである．<code>class</code>は<code>factor</code>によって水準が設定されているわけではないので，<code>2seater</code>が基準カテゴリとなっており，出力からは省略されている．つまり，<code>2seater</code>の係数は0であり，<code>(Intercept)</code>の値は<code>2seater</code>の平均値を示している．</p>
<p>次に効果コーディングの結果を確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の例（contr.sumを使用）</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.sum"</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>fit_cs <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hwy ~ class, data = mpg)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.1429 -1.8788 -0.2927  1.1803 15.8571 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  23.7007     0.3089  76.730  &lt; 2e-16 ***
class1        1.0993     1.3108   0.839    0.403    
class2        4.5972     0.5177   8.880  &lt; 2e-16 ***
class3        3.5920     0.5416   6.633 2.39e-10 ***
class4       -1.3371     0.9127  -1.465    0.144    
class5       -6.8219     0.5842 -11.678  &lt; 2e-16 ***
class6        4.4422     0.5720   7.766 2.77e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.37 on 227 degrees of freedom
Multiple R-squared:  0.6879,    Adjusted R-squared:  0.6797 
F-statistic: 83.39 on 6 and 227 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(fit_cs) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) class1 class2 class3 class4 class5 class6
1            1      0      1      0      0      0      0
16           1      0      0      1      0      0      0
19           1     -1     -1     -1     -1     -1     -1
24           1      1      0      0      0      0      0
38           1      0      0      0      1      0      0
49           1      0      0      0      0      1      0
91           1      0      0      0      0      0      1</code></pre>
</div>
</div>
<p>ここでも出力される係数は6つであるが，ここでは最後のカテゴリが省略されている．しかし，最後のカテゴリである<code>classsuv</code>の係数は0ではない．すべての係数の和が0になるという制約を与えているので，<code>classsuv</code>の係数は他の係数の値の和を0から引いたものとなる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># classという文字が含まれる係数を取り出し，係数の番号を調べる（2から7）</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(fit_cs, <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class1 class2 class3 class4 class5 class6 
     2      3      4      5      6      7 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 係数の2から7までを取り出し，その和を求める．</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fit_cs<span class="sc">$</span>coefficients[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.571663</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 和を0から引く</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="sc">-</span> (fit_cs<span class="sc">$</span>coefficients[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">%&gt;%</span> <span class="fu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -5.571663</code></pre>
</div>
</div>
<p>したがって，<code>classsuv</code>の係数は-5.571663となる．</p>
<p><code>contrasts</code>の設定を変更して分析を終えたら必ずもとに戻しておく．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトに戻す</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>lm</code>ではモデルの中で<code>contrasts</code>を指定することもできる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fit_cs2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cs2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hwy ~ class, data = mpg)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.1429 -1.8788 -0.2927  1.1803 15.8571 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       24.800      1.507  16.454  &lt; 2e-16 ***
classcompact       3.498      1.585   2.206   0.0284 *  
classmidsize       2.493      1.596   1.561   0.1198    
classminivan      -2.436      1.818  -1.340   0.1815    
classpickup       -7.921      1.617  -4.898 1.84e-06 ***
classsubcompact    3.343      1.611   2.075   0.0391 *  
classsuv          -6.671      1.567  -4.258 3.03e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.37 on 227 degrees of freedom
Multiple R-squared:  0.6879,    Adjusted R-squared:  0.6797 
F-statistic: 83.39 on 6 and 227 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fit_cs2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">contrasts =</span> <span class="fu">list</span>(<span class="at">class =</span> <span class="st">"contr.sum"</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cs2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hwy ~ class, data = mpg, contrasts = list(class = "contr.sum"))

Residuals:
    Min      1Q  Median      3Q     Max 
-8.1429 -1.8788 -0.2927  1.1803 15.8571 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  23.7007     0.3089  76.730  &lt; 2e-16 ***
class1        1.0993     1.3108   0.839    0.403    
class2        4.5972     0.5177   8.880  &lt; 2e-16 ***
class3        3.5920     0.5416   6.633 2.39e-10 ***
class4       -1.3371     0.9127  -1.465    0.144    
class5       -6.8219     0.5842 -11.678  &lt; 2e-16 ***
class6        4.4422     0.5720   7.766 2.77e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.37 on 227 degrees of freedom
Multiple R-squared:  0.6879,    Adjusted R-squared:  0.6797 
F-statistic: 83.39 on 6 and 227 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="表2.1-p.8" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="表2.1-p.8"><span class="header-section-number">2.2</span> 表2.1 (p.8)</h2>
<ul>
<li>p.8の表2.1を再現する．</li>
<li>クロス表に周辺度数を追加する場合は，<code>addmargins</code>を用いる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">40</span>, <span class="dv">250</span>,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">160</span>,<span class="dv">3000</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>Freq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   40  250  160 3000</code></pre>
</div>
</div>
<p>ベクトルを表にする．ここでは<code>as.table</code>でクラスを<code>table</code>としている．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行列を作成し，表とする．</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  Freq,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">c</span>(<span class="fu">list</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Member =</span> <span class="fu">c</span>(<span class="st">"Member"</span>, <span class="st">"Nonmember"</span>),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Position =</span> <span class="fu">c</span>(<span class="st">"Have subordinates"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"No subordinates"</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">as.table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>周辺分布とモザイクプロットも確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Margins</span>(tab_2<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Member
       level   freq   perc  cumfreq  cumperc
1     Member    290   8.4%      290     8.4%
2  Nonmember  3'160  91.6%    3'450   100.0%

$Position
               level   freq   perc  cumfreq  cumperc
1  Have subordinates    200   5.8%      200     5.8%
2    No subordinates  3'250  94.2%    3'450   100.0%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(tab_2<span class="fl">.1</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">keep_aspect_ratio =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="3-Chapter_2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A. 度数（周辺度数の追加）</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.1</span> <span class="sc">%&gt;%</span> <span class="fu">addmargins</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Position
Member      Have subordinates No subordinates  Sum
  Member                   40             250  290
  Nonmember               160            3000 3160
  Sum                     200            3250 3450</code></pre>
</div>
</div>
<p>表の数字を用いてオッズ比を計算する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># B. Odds </span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="dv">40</span><span class="sc">/</span><span class="dv">250</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="dv">160</span><span class="sc">/</span><span class="dv">3000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05333333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># C. Odds ratio</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">40</span> <span class="sc">*</span> <span class="dv">3000</span>) <span class="sc">/</span> (<span class="dv">250</span> <span class="sc">*</span> <span class="dv">160</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p><code>DescTools</code>パッケージの<code>OddsRatio</code>関数を用いてオッズ比を求める．<code>conf.level = 0.95</code>とすることで信頼区間を求めることもできる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(tab_2<span class="fl">.1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>odds ratio     lwr.ci     upr.ci 
  3.000000   2.072786   4.341982 </code></pre>
</div>
</div>
<p>さらに詳細な結果をみたければ<code>DescTools</code>パッケージの<code>Desc</code>を用いる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Desc</span>(tab_2<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------ 
tab_2.1 (table)

Summary: 
n: 3'450, rows: 2, columns: 2

Pearson's Chi-squared test (cont. adj):
  X-squared = 35.487, df = 1, p-value = 2.568e-09
Fisher's exact test p-value = 9.541e-08
McNemar's chi-squared = 19.32, df = 1, p-value = 1.106e-05

                    estimate lwr.ci upr.ci'
                                          
odds ratio             3.000  2.073  4.342
rel. risk (col1)       2.724  1.968  3.770
rel. risk (col2)       0.908  0.867  0.951


Contingency Coeff.     0.103
Cramer's V             0.104
Kendall Tau-b          0.104

                                                                 
            Position   Have subordinates   No subordinates    Sum
Member                                                           
                                                                 
Member      freq                      40               250    290
            perc                    1.2%              7.2%   8.4%
            p.row                  13.8%             86.2%      .
            p.col                  20.0%              7.7%      .
                                                                 
Nonmember   freq                     160             3'000  3'160
            perc                    4.6%             87.0%  91.6%
            p.row                   5.1%             94.9%      .
            p.col                  80.0%             92.3%      .
                                                                 
Sum         freq                     200             3'250  3'450
            perc                    5.8%             94.2% 100.0%
            p.row                      .                 .      .
            p.col                      .                 .      .
                                                                 

----------
' 95% conf. level</code></pre>
</div>
<div class="cell-output-display">
<p><img src="3-Chapter_2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>次にセルの組み合わせを単位とした集計データを作成し，<code>gnm</code>を適用することでオッズ比を求めてみたい．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数のベクトル</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>Freq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   40  250  160 3000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>COMM <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>COMM</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 2 2
Levels: 1 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 列変数</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>SUP  <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">4</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>SUP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 1 2
Levels: 1 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなるデータを作成</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, COMM, SUP)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># データの確認</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
   Freq COMM  SUP  
  &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
1    40 1     1    
2   250 1     2    
3   160 2     1    
4  3000 2     2    </code></pre>
</div>
</div>
<p>分析には通常は<code>glm</code>を用いるが，後の分析とあわせて<code>gnm</code>によって推定する．結果は異ならない．<code>family = poisson</code>という指定を忘れないようにすること．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gnmで推定</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.1</span> <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> COMM <span class="sc">+</span> SUP <span class="sc">+</span> COMM<span class="sc">*</span>SUP, <span class="at">data =</span> ., <span class="at">family =</span> poisson)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ COMM + SUP + COMM * SUP, family = poisson, 
    data = .)

Deviance Residuals: 
[1]  0  0  0  0

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   3.6889     0.1581  23.331  &lt; 2e-16 ***
COMM2         1.3863     0.1768   7.842  &lt; 2e-16 ***
SUP2          1.8326     0.1703  10.761  &lt; 2e-16 ***
COMM2:SUP2    1.0986     0.1886   5.824 5.75e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: -5.3113e-13 on 0 degrees of freedom
AIC: 37.649

Number of iterations: 2</code></pre>
</div>
</div>
<p><code>COMM2:SUP2</code>の係数は1.0986である．これは対数オッズなので，指数関数<code>exp</code>を適用してオッズ比を求める．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratios fit$coefficientsのCOMM2:SUP2の要素のみを取り出し，指数関数expを適用</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span>coefficients[<span class="st">"COMM2:SUP2"</span>] <span class="sc">%&gt;%</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>COMM2:SUP2 
         3 </code></pre>
</div>
</div>
</section>
<section id="表2.3a-p.32" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="表2.3a-p.32"><span class="header-section-number">2.3</span> 表2.3A (p.32)</h2>
<p>まずは表2.3Aを作成する．値をベクトルの形で入力する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">39</span>, <span class="dv">50</span>, <span class="dv">18</span>,  <span class="dv">4</span>,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>          <span class="dv">140</span>,<span class="dv">178</span>, <span class="dv">85</span>, <span class="dv">23</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">108</span>,<span class="dv">195</span>, <span class="dv">97</span>, <span class="dv">23</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>          <span class="dv">238</span>,<span class="dv">598</span>,<span class="dv">363</span>,<span class="dv">111</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>           <span class="dv">78</span>,<span class="dv">250</span>,<span class="dv">150</span>, <span class="dv">55</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>           <span class="dv">50</span>,<span class="dv">200</span>,<span class="dv">208</span>, <span class="dv">74</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>            <span class="dv">8</span>, <span class="dv">29</span>, <span class="dv">46</span>, <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ベクトルのデータを<code>matrix</code>で行列にし，最終的には<code>as.table</code>でtable形式にする．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  Freq,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">7</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">c</span>(<span class="fu">list</span>(</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">polviews =</span>  <span class="fu">c</span>(</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Strongly liberal"</span>,</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Liberal"</span>,</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Slightly liberal"</span>,</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Moderate"</span>,</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Slightly conservative"</span>,</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Conservative"</span>,</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Strongly conservative"</span>),</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fefam =</span> <span class="fu">c</span>(<span class="st">"Strongly Disagree"</span>,</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Disagree"</span>,</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Agree"</span>,</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Strongly agree"</span>)</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">%&gt;%</span> <span class="fu">as.table</span>()</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       fefam
polviews                Strongly Disagree Disagree Agree Strongly agree
  Strongly liberal                     39       50    18              4
  Liberal                             140      178    85             23
  Slightly liberal                    108      195    97             23
  Moderate                            238      598   363            111
  Slightly conservative                78      250   150             55
  Conservative                         50      200   208             74
  Strongly conservative                 8       29    46             21</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる集計データを作成</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>polviews <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>fefam <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">28</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, polviews, fefam)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 3
    Freq polviews fefam
   &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;
 1    39 1        1    
 2    50 1        2    
 3    18 1        3    
 4     4 1        4    
 5   140 2        1    
 6   178 2        2    
 7    85 2        3    
 8    23 2        4    
 9   108 3        1    
10   195 3        2    
# ℹ 18 more rows</code></pre>
</div>
</div>
<ul>
<li>なお<code>tab_2.3A</code>に対して，data.frameを適用しても集計データは作成される．tableの行変数と列変数が指定されていないと，行変数は<code>Var1</code>，列変数は<code>Var2</code>となるので，必要に応じて名前を<code>rename</code>で修正する ．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(tab_2<span class="fl">.3</span>A) <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 3
   polviews              fefam              Freq
   &lt;fct&gt;                 &lt;fct&gt;             &lt;dbl&gt;
 1 Strongly liberal      Strongly Disagree    39
 2 Liberal               Strongly Disagree   140
 3 Slightly liberal      Strongly Disagree   108
 4 Moderate              Strongly Disagree   238
 5 Slightly conservative Strongly Disagree    78
 6 Conservative          Strongly Disagree    50
 7 Strongly conservative Strongly Disagree     8
 8 Strongly liberal      Disagree             50
 9 Liberal               Disagree            178
10 Slightly liberal      Disagree            195
# ℹ 18 more rows</code></pre>
</div>
</div>
<p>以下では複数のモデルの適合度を比較する．そこで，モデル適合度を表示するための関数を作成する．モデルはすべて<code>gnm</code>によって推定されることを前提としている．<code>glm</code>の場合はエラーが出るので注意すること．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 引数となるobjはgnmの結果</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>model.summary <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, <span class="at">Model =</span> <span class="cn">NULL</span>){</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">class</span>(obj) <span class="sc">==</span> <span class="st">"gnm"</span>) <span class="sc">!=</span> <span class="dv">1</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"estimate with gnm"</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  aic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="dv">2</span> <span class="co"># AIC(L2)</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  bic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">sum</span>(obj<span class="sc">$</span>y)) <span class="co">#BIC(L2)</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">abs</span>(obj<span class="sc">$</span>y <span class="sc">-</span> obj<span class="sc">$</span>fitted.values)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(obj<span class="sc">$</span>y))</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(obj<span class="sc">$</span>deviance, obj<span class="sc">$</span>df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)     <span class="co">#p&lt;-ifelse(p&lt;0.001,"&lt;0.001",p)</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(Model)){ </span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  Model <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(obj))</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Model Description"</span> <span class="ot">=</span> Model,</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"df"</span> <span class="ot">=</span> obj<span class="sc">$</span>df,</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"L2"</span> <span class="ot">=</span> obj<span class="sc">$</span>deviance,</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"AIC(L2)" = aic,</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BIC"</span> <span class="ot">=</span> bic,</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Delta"</span> <span class="ot">=</span> delta,</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p"</span> <span class="ot">=</span> p</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>コントラストがデフォルトの<code>factor = "contr.treatment"</code>と<code>ordered = "contr.poly"</code>になっているのかを確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトのcontrasts</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$contrasts
           factor           ordered 
"contr.treatment"      "contr.poly" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># defaultのcontrastsの設定（ここでは特に意味はない．constrastをいじった後にデフォルトに戻す）</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>行スコアと列スコアを用いるので，まず<code>as.integer</code>を用いて行スコア（<code>Rscore</code>）と列スコア（<code>Cscore</code>）の変数を作成する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数と列変数の整数値を作成</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rscore =</span> <span class="fu">as.integer</span>(polviews),</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> <span class="fu">as.integer</span>(fefam))</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 5
    Freq polviews fefam Rscore Cscore
   &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;int&gt;  &lt;int&gt;
 1    39 1        1          1      1
 2    50 1        2          1      2
 3    18 1        3          1      3
 4     4 1        4          1      4
 5   140 2        1          2      1
 6   178 2        2          2      2
 7    85 2        3          2      3
 8    23 2        4          2      4
 9   108 3        1          3      1
10   195 3        2          3      2
# ℹ 18 more rows</code></pre>
</div>
</div>
<section id="独立モデル" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="独立モデル"><span class="header-section-number">2.3.1</span> 独立モデル</h3>
<p>独立モデルは次のようになる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  1. O: Independence/Null Association Model</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> .,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam, family = poisson, data = ., 
    tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-5.7415  -2.5344  -0.4283   1.5557   5.8265  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.06035    0.10115  30.256  &lt; 2e-16 ***
polviews2    1.34491    0.10657  12.620  &lt; 2e-16 ***
polviews3    1.33784    0.10664  12.545  &lt; 2e-16 ***
polviews4    2.46825    0.09886  24.968  &lt; 2e-16 ***
polviews5    1.56899    0.10433  15.038  &lt; 2e-16 ***
polviews6    1.56711    0.10435  15.018  &lt; 2e-16 ***
polviews7   -0.06514    0.13647  -0.477    0.633    
fefam2       0.81947    0.04669  17.553  &lt; 2e-16 ***
fefam3       0.38044    0.05047   7.538 4.76e-14 ***
fefam4      -0.75396    0.06876 -10.965  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 211.7 on 18 degrees of freedom
AIC: 403.05

Number of iterations: 5</code></pre>
</div>
</div>
<p>先ほど作成した適合度の関数を用いる．2つめの引数はモデルの名前の詳細を記述可能だが，これは省略してもよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(O, <span class="st">"O:Independent"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta        p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
1 O:Independent          18  212.  65.1  8.09 4.54e-35</code></pre>
</div>
</div>
<p>テキストの表2.4と同じ結果になっているのかを確認してみる．</p>
</section>
<section id="一様連関モデル" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="一様連関モデル"><span class="header-section-number">2.3.2</span> 一様連関モデル</h3>
<p>一様連関モデルでは先ほど作成した行変数と列変数の整数スコアの積である<code>Rscore:Cscore</code>を加える．<code>Rscore*Cscore</code>あるいは<code>I(Rscore*Cscore)</code>でもよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. U: Uniform Association Model</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(U)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Rscore:Cscore, family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.62563  -0.41050  -0.06989   0.53746   1.67998  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    3.47979    0.10109  34.422  &lt; 2e-16 ***
polviews2      0.95906    0.10934   8.771  &lt; 2e-16 ***
polviews3      0.53993    0.11884   4.543 5.54e-06 ***
polviews4      1.23013    0.12993   9.468  &lt; 2e-16 ***
polviews5     -0.13911    0.15936  -0.873 0.382733    
polviews6     -0.64184    0.19196  -3.344 0.000827 ***
polviews7     -2.80636    0.24740 -11.344  &lt; 2e-16 ***
fefam2         0.05148    0.07139   0.721 0.470857    
fefam3        -1.23188    0.12922  -9.533  &lt; 2e-16 ***
fefam4        -3.28436    0.20609 -15.936  &lt; 2e-16 ***
Rscore:Cscore  0.20211    0.01520  13.299  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 20.125 on 17 degrees of freedom
AIC: 213.48

Number of iterations: 4</code></pre>
</div>
</div>
<p>表2.4Aと同じ結果になっているのかを確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(U, <span class="st">"U:Uniform"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 U:Uniform              17  20.1 -118.  2.77 0.268</code></pre>
</div>
</div>
<p>モデル行列を確認するのもよいだろう．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model.matrixを適用し，ユニークな値だけを表示</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(U) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) polviews2 polviews3 polviews4 polviews5 polviews6 polviews7
1            1         0         0         0         0         0         0
2            1         0         0         0         0         0         0
3            1         0         0         0         0         0         0
4            1         0         0         0         0         0         0
5            1         1         0         0         0         0         0
6            1         1         0         0         0         0         0
7            1         1         0         0         0         0         0
8            1         1         0         0         0         0         0
9            1         0         1         0         0         0         0
10           1         0         1         0         0         0         0
11           1         0         1         0         0         0         0
12           1         0         1         0         0         0         0
13           1         0         0         1         0         0         0
14           1         0         0         1         0         0         0
15           1         0         0         1         0         0         0
16           1         0         0         1         0         0         0
17           1         0         0         0         1         0         0
18           1         0         0         0         1         0         0
19           1         0         0         0         1         0         0
20           1         0         0         0         1         0         0
21           1         0         0         0         0         1         0
22           1         0         0         0         0         1         0
23           1         0         0         0         0         1         0
24           1         0         0         0         0         1         0
25           1         0         0         0         0         0         1
26           1         0         0         0         0         0         1
27           1         0         0         0         0         0         1
28           1         0         0         0         0         0         1
   fefam2 fefam3 fefam4 Rscore:Cscore
1       0      0      0             1
2       1      0      0             2
3       0      1      0             3
4       0      0      1             4
5       0      0      0             2
6       1      0      0             4
7       0      1      0             6
8       0      0      1             8
9       0      0      0             3
10      1      0      0             6
11      0      1      0             9
12      0      0      1            12
13      0      0      0             4
14      1      0      0             8
15      0      1      0            12
16      0      0      1            16
17      0      0      0             5
18      1      0      0            10
19      0      1      0            15
20      0      0      1            20
21      0      0      0             6
22      1      0      0            12
23      0      1      0            18
24      0      0      1            24
25      0      0      0             7
26      1      0      0            14
27      0      1      0            21
28      0      0      1            28</code></pre>
</div>
</div>
</section>
<section id="行効果モデル" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="行効果モデル"><span class="header-section-number">2.3.3</span> 行効果モデル</h3>
<p>contrastを修正し，polviewsの係数のすべてを足すと0になるように効果コーディングを行ってる．なお行変数と列スコアの積については<code>Cscore*polviews</code>とし，<code>Cscore:polviews</code>としない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. R: Row Effect Model</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># contrastを修正している．</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.sum"</span>, </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.treatment"</span>))</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$contrasts
           factor           ordered 
      "contr.sum" "contr.treatment" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">*</span>polviews, </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Cscore * polviews, family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.5962  -0.4603   0.0477   0.3840   1.5700  

Coefficients:
                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       4.262045   0.029618 143.902  &lt; 2e-16 ***
polviews1         0.040378   0.222896   0.181   0.8562    
polviews2         1.088684   0.130977   8.312  &lt; 2e-16 ***
polviews3         0.763635   0.132427   5.766 8.09e-09 ***
polviews4         1.335170   0.096565  13.827  &lt; 2e-16 ***
polviews5         0.197587   0.127059   1.555   0.1199    
polviews6        -0.558409   0.134998  -4.136 3.53e-05 ***
fefam1           -0.112887   0.046238  -2.441   0.0146 *  
fefam2            0.758505   0.030086  25.211  &lt; 2e-16 ***
fefam3            0.295555   0.032630   9.058  &lt; 2e-16 ***
Cscore            0.000000         NA      NA       NA    
polviews1:Cscore -0.558727   0.107668  -5.189 2.11e-07 ***
polviews2:Cscore -0.405076   0.059149  -6.848 7.47e-12 ***
polviews3:Cscore -0.248459   0.057741  -4.303 1.69e-05 ***
polviews4:Cscore  0.008764   0.039709   0.221   0.8253    
polviews5:Cscore  0.112245   0.051284   2.189   0.0286 *  
polviews6:Cscore  0.419079   0.051434   8.148  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 15.906 on 12 degrees of freedom
AIC: 219.26

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(R, <span class="st">"R:Row effect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 R:Row effect           12  15.9 -81.8  2.47 0.196</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(R) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) polviews1 polviews2 polviews3 polviews4 polviews5 polviews6
1            1         1         0         0         0         0         0
2            1         1         0         0         0         0         0
3            1         1         0         0         0         0         0
4            1         1         0         0         0         0         0
5            1         0         1         0         0         0         0
6            1         0         1         0         0         0         0
7            1         0         1         0         0         0         0
8            1         0         1         0         0         0         0
9            1         0         0         1         0         0         0
10           1         0         0         1         0         0         0
11           1         0         0         1         0         0         0
12           1         0         0         1         0         0         0
13           1         0         0         0         1         0         0
14           1         0         0         0         1         0         0
15           1         0         0         0         1         0         0
16           1         0         0         0         1         0         0
17           1         0         0         0         0         1         0
18           1         0         0         0         0         1         0
19           1         0         0         0         0         1         0
20           1         0         0         0         0         1         0
21           1         0         0         0         0         0         1
22           1         0         0         0         0         0         1
23           1         0         0         0         0         0         1
24           1         0         0         0         0         0         1
25           1        -1        -1        -1        -1        -1        -1
26           1        -1        -1        -1        -1        -1        -1
27           1        -1        -1        -1        -1        -1        -1
28           1        -1        -1        -1        -1        -1        -1
   fefam1 fefam2 fefam3 Cscore polviews1:Cscore polviews2:Cscore
1       1      0      0      1                1                0
2       0      1      0      2                2                0
3       0      0      1      3                3                0
4      -1     -1     -1      4                4                0
5       1      0      0      1                0                1
6       0      1      0      2                0                2
7       0      0      1      3                0                3
8      -1     -1     -1      4                0                4
9       1      0      0      1                0                0
10      0      1      0      2                0                0
11      0      0      1      3                0                0
12     -1     -1     -1      4                0                0
13      1      0      0      1                0                0
14      0      1      0      2                0                0
15      0      0      1      3                0                0
16     -1     -1     -1      4                0                0
17      1      0      0      1                0                0
18      0      1      0      2                0                0
19      0      0      1      3                0                0
20     -1     -1     -1      4                0                0
21      1      0      0      1                0                0
22      0      1      0      2                0                0
23      0      0      1      3                0                0
24     -1     -1     -1      4                0                0
25      1      0      0      1               -1               -1
26      0      1      0      2               -2               -2
27      0      0      1      3               -3               -3
28     -1     -1     -1      4               -4               -4
   polviews3:Cscore polviews4:Cscore polviews5:Cscore polviews6:Cscore
1                 0                0                0                0
2                 0                0                0                0
3                 0                0                0                0
4                 0                0                0                0
5                 0                0                0                0
6                 0                0                0                0
7                 0                0                0                0
8                 0                0                0                0
9                 1                0                0                0
10                2                0                0                0
11                3                0                0                0
12                4                0                0                0
13                0                1                0                0
14                0                2                0                0
15                0                3                0                0
16                0                4                0                0
17                0                0                1                0
18                0                0                2                0
19                0                0                3                0
20                0                0                4                0
21                0                0                0                1
22                0                0                0                2
23                0                0                0                3
24                0                0                0                4
25               -1               -1               -1               -1
26               -2               -2               -2               -2
27               -3               -3               -3               -3
28               -4               -4               -4               -4</code></pre>
</div>
</div>
<p>表2.4の適合度を確認しよう．また，パラメータ推定値については，表2.5のBから確認する． Rの結果では，polviews1からpolviews6までの結果が表示されているが，polviews7は示されていない．パラメータのすべての値を足すと0となることから(<span class="math inline">\(\sum \tau_i^A=0\)</span>)，polviews7の係数は<code>0-(-0.6721737)=0.6721737</code>となる．これをRで計算するためには係数を取り出し，それらを足したものを0から引けばよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 取り出す係数を探す</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(R, <span class="st">":Cscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>polviews1:Cscore polviews2:Cscore polviews3:Cscore polviews4:Cscore 
              12               13               14               15 
polviews5:Cscore polviews6:Cscore 
              16               17 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 12から17番目の係数を取り出し，足す</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">$</span>coefficients[<span class="dv">12</span><span class="sc">:</span><span class="dv">17</span>] <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.6721737</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0から足したものを引く</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="sc">-</span> (R<span class="sc">$</span>coefficients[<span class="dv">12</span><span class="sc">:</span><span class="dv">17</span>] <span class="sc">%&gt;%</span> <span class="fu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6721737</code></pre>
</div>
</div>
<p>contrastsをもとに戻して同様の分析を行う． 今度は<code>polviews1:Cscore</code>の係数が省略されているが，この値は0である（<span class="math inline">\(\tau_1^A=0\)</span>）．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative (default)</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>Ralt <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">*</span>polviews, </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>結果は表2.5Bの「他の正規化」の行を確認して欲しい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Ralt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Cscore * polviews, family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.5962  -0.4603   0.0477   0.3840   1.5700  

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)        3.6308     0.1443  25.160  &lt; 2e-16 ***
polviews2          1.0483     0.2801   3.742 0.000182 ***
polviews3          0.7233     0.2818   2.567 0.010258 *  
polviews4          1.2948     0.2617   4.947 7.52e-07 ***
polviews5          0.1572     0.2798   0.562 0.574154    
polviews6         -0.5988     0.2859  -2.094 0.036244 *  
polviews7         -2.9074     0.4145  -7.015 2.30e-12 ***
fefam2             0.3127     0.1265   2.471 0.013455 *  
fefam3            -0.7090     0.2447  -2.897 0.003763 ** 
fefam4            -2.5045     0.3703  -6.763 1.36e-11 ***
Cscore             0.0000         NA      NA       NA    
polviews2:Cscore   0.1537     0.1362   1.128 0.259246    
polviews3:Cscore   0.3103     0.1357   2.287 0.022191 *  
polviews4:Cscore   0.5675     0.1268   4.477 7.58e-06 ***
polviews5:Cscore   0.6710     0.1326   5.059 4.21e-07 ***
polviews6:Cscore   0.9778     0.1331   7.346 2.04e-13 ***
polviews7:Cscore   1.2309     0.1678   7.335 2.22e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 15.906 on 12 degrees of freedom
AIC: 219.26

Number of iterations: 4</code></pre>
</div>
</div>
<p>モデルの適合度は全く同じであることがわかる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(R, <span class="st">"R: Row effect (effect coding)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`              df    L2   BIC Delta     p
  &lt;chr&gt;                         &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 R: Row effect (effect coding)    12  15.9 -81.8  2.47 0.196</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(Ralt, <span class="st">"R: Row effect (dummy coding)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`             df    L2   BIC Delta     p
  &lt;chr&gt;                        &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 R: Row effect (dummy coding)    12  15.9 -81.8  2.47 0.196</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(Ralt) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) polviews2 polviews3 polviews4 polviews5 polviews6 polviews7
1            1         0         0         0         0         0         0
2            1         0         0         0         0         0         0
3            1         0         0         0         0         0         0
4            1         0         0         0         0         0         0
5            1         1         0         0         0         0         0
6            1         1         0         0         0         0         0
7            1         1         0         0         0         0         0
8            1         1         0         0         0         0         0
9            1         0         1         0         0         0         0
10           1         0         1         0         0         0         0
11           1         0         1         0         0         0         0
12           1         0         1         0         0         0         0
13           1         0         0         1         0         0         0
14           1         0         0         1         0         0         0
15           1         0         0         1         0         0         0
16           1         0         0         1         0         0         0
17           1         0         0         0         1         0         0
18           1         0         0         0         1         0         0
19           1         0         0         0         1         0         0
20           1         0         0         0         1         0         0
21           1         0         0         0         0         1         0
22           1         0         0         0         0         1         0
23           1         0         0         0         0         1         0
24           1         0         0         0         0         1         0
25           1         0         0         0         0         0         1
26           1         0         0         0         0         0         1
27           1         0         0         0         0         0         1
28           1         0         0         0         0         0         1
   fefam2 fefam3 fefam4 Cscore polviews2:Cscore polviews3:Cscore
1       0      0      0      1                0                0
2       1      0      0      2                0                0
3       0      1      0      3                0                0
4       0      0      1      4                0                0
5       0      0      0      1                1                0
6       1      0      0      2                2                0
7       0      1      0      3                3                0
8       0      0      1      4                4                0
9       0      0      0      1                0                1
10      1      0      0      2                0                2
11      0      1      0      3                0                3
12      0      0      1      4                0                4
13      0      0      0      1                0                0
14      1      0      0      2                0                0
15      0      1      0      3                0                0
16      0      0      1      4                0                0
17      0      0      0      1                0                0
18      1      0      0      2                0                0
19      0      1      0      3                0                0
20      0      0      1      4                0                0
21      0      0      0      1                0                0
22      1      0      0      2                0                0
23      0      1      0      3                0                0
24      0      0      1      4                0                0
25      0      0      0      1                0                0
26      1      0      0      2                0                0
27      0      1      0      3                0                0
28      0      0      1      4                0                0
   polviews4:Cscore polviews5:Cscore polviews6:Cscore polviews7:Cscore
1                 0                0                0                0
2                 0                0                0                0
3                 0                0                0                0
4                 0                0                0                0
5                 0                0                0                0
6                 0                0                0                0
7                 0                0                0                0
8                 0                0                0                0
9                 0                0                0                0
10                0                0                0                0
11                0                0                0                0
12                0                0                0                0
13                1                0                0                0
14                2                0                0                0
15                3                0                0                0
16                4                0                0                0
17                0                1                0                0
18                0                2                0                0
19                0                3                0                0
20                0                4                0                0
21                0                0                1                0
22                0                0                2                0
23                0                0                3                0
24                0                0                4                0
25                0                0                0                1
26                0                0                0                2
27                0                0                0                3
28                0                0                0                4</code></pre>
</div>
</div>
</section>
</section>
<section id="列効果モデル" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="列効果モデル"><span class="header-section-number">2.4</span> 列効果モデル</h2>
<p>列効果モデルは行効果モデルと同様の方法で推定すればよい．まずは効果コーディングで推定し，その後にダミーコーディングで推定する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. C: Column Effect Model</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="co"># contrast</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.sum"</span>, </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.treatment"</span>))</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span> </span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">*</span>fefam, <span class="at">family =</span> poisson, </span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(C)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Rscore * fefam, family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7572  -0.4920   0.1628   0.4922   1.4247  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    4.26735    0.02842 150.161  &lt; 2e-16 ***
polviews1     -1.34764    0.08885 -15.167  &lt; 2e-16 ***
polviews2      0.10725    0.05058   2.120 0.033978 *  
polviews3      0.17817    0.04852   3.672 0.000241 ***
polviews4      1.35465    0.03449  39.280  &lt; 2e-16 ***
polviews5      0.47060    0.04547  10.349  &lt; 2e-16 ***
polviews6      0.45489    0.04714   9.650  &lt; 2e-16 ***
fefam1         1.16938    0.10545  11.089  &lt; 2e-16 ***
fefam2         1.01794    0.08835  11.521  &lt; 2e-16 ***
fefam3        -0.27421    0.10365  -2.646 0.008155 ** 
Rscore         0.00000         NA      NA       NA    
fefam1:Rscore -0.32183    0.02601 -12.373  &lt; 2e-16 ***
fefam2:Rscore -0.06518    0.02013  -3.238 0.001203 ** 
fefam3:Rscore  0.13740    0.02282   6.021 1.73e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 14.237 on 15 degrees of freedom
AIC: 211.59

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(C, <span class="st">"C:Column effect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 C:Column effect        15  14.2 -108.  2.32 0.508</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(C) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) polviews1 polviews2 polviews3 polviews4 polviews5 polviews6
1            1         1         0         0         0         0         0
2            1         1         0         0         0         0         0
3            1         1         0         0         0         0         0
4            1         1         0         0         0         0         0
5            1         0         1         0         0         0         0
6            1         0         1         0         0         0         0
7            1         0         1         0         0         0         0
8            1         0         1         0         0         0         0
9            1         0         0         1         0         0         0
10           1         0         0         1         0         0         0
11           1         0         0         1         0         0         0
12           1         0         0         1         0         0         0
13           1         0         0         0         1         0         0
14           1         0         0         0         1         0         0
15           1         0         0         0         1         0         0
16           1         0         0         0         1         0         0
17           1         0         0         0         0         1         0
18           1         0         0         0         0         1         0
19           1         0         0         0         0         1         0
20           1         0         0         0         0         1         0
21           1         0         0         0         0         0         1
22           1         0         0         0         0         0         1
23           1         0         0         0         0         0         1
24           1         0         0         0         0         0         1
25           1        -1        -1        -1        -1        -1        -1
26           1        -1        -1        -1        -1        -1        -1
27           1        -1        -1        -1        -1        -1        -1
28           1        -1        -1        -1        -1        -1        -1
   fefam1 fefam2 fefam3 Rscore fefam1:Rscore fefam2:Rscore fefam3:Rscore
1       1      0      0      1             1             0             0
2       0      1      0      1             0             1             0
3       0      0      1      1             0             0             1
4      -1     -1     -1      1            -1            -1            -1
5       1      0      0      2             2             0             0
6       0      1      0      2             0             2             0
7       0      0      1      2             0             0             2
8      -1     -1     -1      2            -2            -2            -2
9       1      0      0      3             3             0             0
10      0      1      0      3             0             3             0
11      0      0      1      3             0             0             3
12     -1     -1     -1      3            -3            -3            -3
13      1      0      0      4             4             0             0
14      0      1      0      4             0             4             0
15      0      0      1      4             0             0             4
16     -1     -1     -1      4            -4            -4            -4
17      1      0      0      5             5             0             0
18      0      1      0      5             0             5             0
19      0      0      1      5             0             0             5
20     -1     -1     -1      5            -5            -5            -5
21      1      0      0      6             6             0             0
22      0      1      0      6             0             6             0
23      0      0      1      6             0             0             6
24     -1     -1     -1      6            -6            -6            -6
25      1      0      0      7             7             0             0
26      0      1      0      7             0             7             0
27      0      0      1      7             0             0             7
28     -1     -1     -1      7            -7            -7            -7</code></pre>
</div>
</div>
<p>すべてを足すと0となることから(<span class="math inline">\(\sum \tau_j^B=0\)</span>)，polviews7の係数は<code>0-(-0.2496118)=0.2496118</code>となる</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(C, <span class="st">":Rscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fefam1:Rscore fefam2:Rscore fefam3:Rscore 
           12            13            14 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>C<span class="sc">$</span>coefficients[<span class="dv">12</span><span class="sc">:</span><span class="dv">14</span>] <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2496118</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="sc">-</span> (C<span class="sc">$</span>coefficients[<span class="dv">12</span><span class="sc">:</span><span class="dv">14</span>] <span class="sc">%&gt;%</span> <span class="fu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2496118</code></pre>
</div>
</div>
<p>以下はダミーコーディングを用いている．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative (default)</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>Calt <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span> </span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">*</span>fefam, </span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>推定値は表2.5Cを確認せよ．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Calt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Rscore * fefam, family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7572  -0.4920   0.1628   0.4922   1.4247  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    3.76726    0.11222  33.571  &lt; 2e-16 ***
polviews2      1.13306    0.10785  10.506  &lt; 2e-16 ***
polviews3      0.88215    0.11310   7.800  &lt; 2e-16 ***
polviews4      1.73680    0.11708  14.834  &lt; 2e-16 ***
polviews5      0.53092    0.13848   3.834 0.000126 ***
polviews6      0.19337    0.16048   1.205 0.228239    
polviews7     -1.80128    0.20632  -8.730  &lt; 2e-16 ***
fefam2        -0.15144    0.13618  -1.112 0.266095    
fefam3        -1.44359    0.15929  -9.063  &lt; 2e-16 ***
fefam4        -3.08249    0.23741 -12.984  &lt; 2e-16 ***
Rscore         0.00000         NA      NA       NA    
fefam2:Rscore  0.25665    0.03459   7.421 1.17e-13 ***
fefam3:Rscore  0.45924    0.03851  11.926  &lt; 2e-16 ***
fefam4:Rscore  0.57144    0.05297  10.788  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 14.237 on 15 degrees of freedom
AIC: 211.59

Number of iterations: 4</code></pre>
</div>
</div>
<p>適合度は効果コーディングとダミーコーディングで変化しない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(C, <span class="st">"C:Column effect (effect coding)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`                df    L2   BIC Delta     p
  &lt;chr&gt;                           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 C:Column effect (effect coding)    15  14.2 -108.  2.32 0.508</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(Calt, <span class="st">"C:Column effect (dummy coding)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`               df    L2   BIC Delta     p
  &lt;chr&gt;                          &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 C:Column effect (dummy coding)    15  14.2 -108.  2.32 0.508</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(Calt) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) polviews2 polviews3 polviews4 polviews5 polviews6 polviews7
1            1         0         0         0         0         0         0
2            1         0         0         0         0         0         0
3            1         0         0         0         0         0         0
4            1         0         0         0         0         0         0
5            1         1         0         0         0         0         0
6            1         1         0         0         0         0         0
7            1         1         0         0         0         0         0
8            1         1         0         0         0         0         0
9            1         0         1         0         0         0         0
10           1         0         1         0         0         0         0
11           1         0         1         0         0         0         0
12           1         0         1         0         0         0         0
13           1         0         0         1         0         0         0
14           1         0         0         1         0         0         0
15           1         0         0         1         0         0         0
16           1         0         0         1         0         0         0
17           1         0         0         0         1         0         0
18           1         0         0         0         1         0         0
19           1         0         0         0         1         0         0
20           1         0         0         0         1         0         0
21           1         0         0         0         0         1         0
22           1         0         0         0         0         1         0
23           1         0         0         0         0         1         0
24           1         0         0         0         0         1         0
25           1         0         0         0         0         0         1
26           1         0         0         0         0         0         1
27           1         0         0         0         0         0         1
28           1         0         0         0         0         0         1
   fefam2 fefam3 fefam4 Rscore fefam2:Rscore fefam3:Rscore fefam4:Rscore
1       0      0      0      1             0             0             0
2       1      0      0      1             1             0             0
3       0      1      0      1             0             1             0
4       0      0      1      1             0             0             1
5       0      0      0      2             0             0             0
6       1      0      0      2             2             0             0
7       0      1      0      2             0             2             0
8       0      0      1      2             0             0             2
9       0      0      0      3             0             0             0
10      1      0      0      3             3             0             0
11      0      1      0      3             0             3             0
12      0      0      1      3             0             0             3
13      0      0      0      4             0             0             0
14      1      0      0      4             4             0             0
15      0      1      0      4             0             4             0
16      0      0      1      4             0             0             4
17      0      0      0      5             0             0             0
18      1      0      0      5             5             0             0
19      0      1      0      5             0             5             0
20      0      0      1      5             0             0             5
21      0      0      0      6             0             0             0
22      1      0      0      6             6             0             0
23      0      1      0      6             0             6             0
24      0      0      1      6             0             0             6
25      0      0      0      7             0             0             0
26      1      0      0      7             7             0             0
27      0      1      0      7             0             7             0
28      0      0      1      7             0             0             7</code></pre>
</div>
</div>
</section>
<section id="行列効果モデルrc" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="行列効果モデルrc"><span class="header-section-number">2.5</span> 行・列効果モデル（<span class="math inline">\(R+C\)</span>）</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># コントラスト</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.treatment"</span>))</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. R+C: Row and Column Effect Model</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 収束しない</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>RplusCno <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span> </span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>係数を確認する．この場合，制約は3つ必要であるが2つしかNAとなっていない．テキストや表2.5Dを参照し，どのような制約を課すのかをきめる．ここでは表2.5Dのような制約を課す．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>RplusCno</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Cscore:polviews + Rscore:fefam, 
    family = poisson, data = ., tolerance = 1e-12)

Coefficients:
     (Intercept)         polviews2         polviews3         polviews4  
          4.5899            1.4543            1.5167            2.4534  
       polviews5         polviews6         polviews7            fefam2  
          1.6458            1.1561           -0.9443            0.6009  
          fefam3            fefam4  polviews1:Cscore  polviews2:Cscore  
          0.1389           -0.6167           -0.6101           -0.5942  
polviews3:Cscore  polviews4:Cscore  polviews5:Cscore  polviews6:Cscore  
         -0.5660           -0.4267           -0.4258           -0.1962  
polviews7:Cscore     fefam1:Rscore     fefam2:Rscore     fefam3:Rscore  
              NA           -0.2808           -0.1031                NA  
   fefam4:Rscore  
              NA  

Deviance:            7.678265 
Pearson chi-squared: 7.790921 
Residual df:         10 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCno, <span class="st">":Cscore"</span>)  <span class="co"># 行効果</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>polviews1:Cscore polviews2:Cscore polviews3:Cscore polviews4:Cscore 
              11               12               13               14 
polviews5:Cscore polviews6:Cscore polviews7:Cscore 
              15               16               17 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCno, <span class="st">":Rscore"</span>)  <span class="co"># 列効果</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fefam1:Rscore fefam2:Rscore fefam3:Rscore fefam4:Rscore 
           18            19            20            21 </code></pre>
</div>
</div>
<p>あるいは次のように一覧にしてもよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(RplusCno<span class="sc">$</span>coefficients),</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> RplusCno<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              var   estimate number
(Intercept)           (Intercept)  4.5899015      1
polviews2               polviews2  1.4543053      2
polviews3               polviews3  1.5166866      3
polviews4               polviews4  2.4534277      4
polviews5               polviews5  1.6457919      5
polviews6               polviews6  1.1561295      6
polviews7               polviews7 -0.9442830      7
fefam2                     fefam2  0.6009497      8
fefam3                     fefam3  0.1389105      9
fefam4                     fefam4 -0.6166671     10
polviews1:Cscore polviews1:Cscore -0.6101464     11
polviews2:Cscore polviews2:Cscore -0.5942374     12
polviews3:Cscore polviews3:Cscore -0.5659952     13
polviews4:Cscore polviews4:Cscore -0.4267150     14
polviews5:Cscore polviews5:Cscore -0.4258108     15
polviews6:Cscore polviews6:Cscore -0.1962125     16
polviews7:Cscore polviews7:Cscore         NA     17
fefam1:Rscore       fefam1:Rscore -0.2807905     18
fefam2:Rscore       fefam2:Rscore -0.1031243     19
fefam3:Rscore       fefam3:Rscore         NA     20
fefam4:Rscore       fefam4:Rscore         NA     21</code></pre>
</div>
</div>
<p>制約を課すのは11番目，17番目，18番目の係数であり，これらを0にする．対象となる係数は<code>constrain = c(11,17,18)</code>で指定し，制約は<code>constrainTo = c(0, 0, 0)</code>とする．あとは同じである．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># polviews1:Cscore(11) = polviews7:Cscore(17) = fefam1:Rscore(18) = 0</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>RplusC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span> </span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">17</span>, <span class="dv">18</span>), </span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Cscore:polviews + Rscore:fefam, 
    constrain = c(11, 17, 18), constrainTo = c(0, 0, 0), family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07536  -0.33353   0.01859   0.37548   1.05912  

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       3.69896    0.14301  25.866  &lt; 2e-16 ***
polviews2         1.27521    0.25278   5.045 4.54e-07 ***
polviews3         1.15849    0.24328   4.762 1.92e-06 ***
polviews4         1.91613    0.21048   9.104  &lt; 2e-16 ***
polviews5         0.92939    0.22891   4.060 4.91e-05 ***
polviews6         0.26063    0.24331   1.071   0.2841    
polviews7        -2.01888    0.30512  -6.617 3.67e-11 ***
fefam2           -0.11089    0.17635  -0.629   0.5295    
fefam3           -1.28476    0.28350  -4.532 5.85e-06 ***
fefam4           -2.75218    0.43313  -6.354 2.10e-10 ***
polviews1:Cscore  0.00000         NA      NA       NA    
polviews2:Cscore -0.08578    0.11437  -0.750   0.4532    
polviews3:Cscore -0.15923    0.10585  -1.504   0.1325    
polviews4:Cscore -0.12164    0.09246  -1.316   0.1883    
polviews5:Cscore -0.22243    0.10510  -2.116   0.0343 *  
polviews6:Cscore -0.09452    0.11454  -0.825   0.4092    
polviews7:Cscore  0.00000         NA      NA       NA    
fefam1:Rscore     0.00000         NA      NA       NA    
fefam2:Rscore     0.27936    0.04372   6.389 1.67e-10 ***
fefam3:Rscore     0.48417    0.06239   7.761  &lt; 2e-16 ***
fefam4:Rscore     0.58586    0.08655   6.769 1.30e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 7.6783 on 10 degrees of freedom
AIC: 215.03

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RplusC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RplusC                 10  7.68 -73.8  1.77 0.660</code></pre>
</div>
</div>
<p>11番目，18番目，21番目の係数を0にして推定する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># polviews1:Cscore(11) = polviews7:Cscore(17) = fefam1:Rscore(18) = 0</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>RplusC_2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span> </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">18</span>, <span class="dv">21</span>), </span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusC_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Cscore:polviews + Rscore:fefam, 
    constrain = c(11, 18, 21), constrainTo = c(0, 0, 0), family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07536  -0.33353   0.01859   0.37548   1.05912  

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       3.69896    0.14301  25.866  &lt; 2e-16 ***
polviews2         1.07992    0.26750   4.037 5.41e-05 ***
polviews3         0.76791    0.27072   2.837 0.004560 ** 
polviews4         1.33027    0.25273   5.264 1.41e-07 ***
polviews5         0.14824    0.27598   0.537 0.591164    
polviews6        -0.71581    0.29336  -2.440 0.014688 *  
polviews7        -3.19061    0.44608  -7.153 8.52e-13 ***
fefam2            0.08440    0.15987   0.528 0.597543    
fefam3           -0.89419    0.24903  -3.591 0.000330 ***
fefam4           -2.16632    0.36822  -5.883 4.03e-09 ***
polviews1:Cscore  0.00000         NA      NA       NA    
polviews2:Cscore  0.10951    0.12956   0.845 0.397978    
polviews3:Cscore  0.23134    0.13130   1.762 0.078073 .  
polviews4:Cscore  0.46422    0.12511   3.711 0.000207 ***
polviews5:Cscore  0.55872    0.13347   4.186 2.84e-05 ***
polviews6:Cscore  0.88192    0.13507   6.529 6.61e-11 ***
polviews7:Cscore  1.17173    0.17310   6.769 1.30e-11 ***
fefam1:Rscore     0.00000         NA      NA       NA    
fefam2:Rscore     0.08407    0.03224   2.607 0.009124 ** 
fefam3:Rscore     0.09360    0.03861   2.424 0.015346 *  
fefam4:Rscore     0.00000         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 7.6783 on 10 degrees of freedom
AIC: 215.03

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RplusC_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RplusC_2               10  7.68 -73.8  1.77 0.660</code></pre>
</div>
</div>
<p><code>Rscore:Cscore</code>を含めて推定すれば，制約は自動的に課されており（<code>polviews</code>の1番目と7番目，<code>fefam</code>の1 番目と4番目），特に指定する必要はない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. R+C: Row and Column Effect Model (Alternative)</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>RplusCalt <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span> </span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>RplusCalt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Rscore:Cscore + Cscore:polviews + 
    Rscore:fefam, family = poisson, data = ., tolerance = 1e-12)

Coefficients:
     (Intercept)         polviews2         polviews3         polviews4  
         3.50368           1.07992           0.76791           1.33027  
       polviews5         polviews6         polviews7            fefam2  
         0.14824          -0.71581          -3.19061          -0.11089  
          fefam3            fefam4     Rscore:Cscore  polviews2:Cscore  
        -1.28476          -2.75218           0.19529          -0.08578  
polviews3:Cscore  polviews4:Cscore  polviews5:Cscore  polviews6:Cscore  
        -0.15923          -0.12164          -0.22243          -0.09452  
polviews7:Cscore     fefam2:Rscore     fefam3:Rscore     fefam4:Rscore  
              NA           0.08407           0.09360                NA  

Deviance:            7.678265 
Pearson chi-squared: 7.790921 
Residual df:         10 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCalt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Rscore:Cscore + Cscore:polviews + 
    Rscore:fefam, family = poisson, data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07536  -0.33353   0.01859   0.37548   1.05912  

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       3.50368    0.13171  26.601  &lt; 2e-16 ***
polviews2         1.07992    0.26750   4.037 5.41e-05 ***
polviews3         0.76791    0.27072   2.837  0.00456 ** 
polviews4         1.33027    0.25273   5.264 1.41e-07 ***
polviews5         0.14824    0.27598   0.537  0.59116    
polviews6        -0.71581    0.29336  -2.440  0.01469 *  
polviews7        -3.19061    0.44608  -7.153 8.52e-13 ***
fefam2           -0.11089    0.17635  -0.629  0.52949    
fefam3           -1.28476    0.28350  -4.532 5.85e-06 ***
fefam4           -2.75218    0.43313  -6.354 2.10e-10 ***
Rscore:Cscore     0.19529    0.02885   6.769 1.30e-11 ***
polviews2:Cscore -0.08578    0.11437  -0.750  0.45321    
polviews3:Cscore -0.15923    0.10585  -1.504  0.13250    
polviews4:Cscore -0.12164    0.09246  -1.316  0.18831    
polviews5:Cscore -0.22243    0.10510  -2.116  0.03431 *  
polviews6:Cscore -0.09452    0.11454  -0.825  0.40923    
polviews7:Cscore  0.00000         NA      NA       NA    
fefam2:Rscore     0.08407    0.03224   2.607  0.00912 ** 
fefam3:Rscore     0.09360    0.03861   2.424  0.01535 *  
fefam4:Rscore     0.00000         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 7.6783 on 10 degrees of freedom
AIC: 215.03

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RplusCalt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RplusCalt              10  7.68 -73.8  1.77 0.660</code></pre>
</div>
</div>
</section>
<section id="行列効果モデルrc1" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="行列効果モデルrc1"><span class="header-section-number">2.6</span> 行・列効果モデル（<span class="math inline">\(RC(1)\)</span>）</h2>
<p>RC(1)については<code>Mult(1,polviews,fefam)</code>を含んだモデルで推定する．結果をみると係数は表示されているものの，標準誤差はNAとなっている．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. RC: RC(1) model</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>RC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>,polviews,fefam),</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam), 
    family = poisson, data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07428  -0.27239   0.03038   0.36792   1.03721  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                  2.91618         NA      NA       NA
polviews2                    1.39061         NA      NA       NA
polviews3                    1.42730         NA      NA       NA
polviews4                    2.58690         NA      NA       NA
polviews5                    1.68635         NA      NA       NA
polviews6                    1.62648         NA      NA       NA
polviews7                   -0.11342         NA      NA       NA
fefam2                       0.87734         NA      NA       NA
fefam3                       0.39316         NA      NA       NA
fefam4                      -0.79293         NA      NA       NA
Mult(., polviews, fefam).   -1.26079         NA      NA       NA
Mult(1, ., fefam).polviews1  1.23934         NA      NA       NA
Mult(1, ., fefam).polviews2  0.95242         NA      NA       NA
Mult(1, ., fefam).polviews3  0.56926         NA      NA       NA
Mult(1, ., fefam).polviews4 -0.02193         NA      NA       NA
Mult(1, ., fefam).polviews5 -0.27617         NA      NA       NA
Mult(1, ., fefam).polviews6 -1.10762         NA      NA       NA
Mult(1, ., fefam).polviews7 -1.81832         NA      NA       NA
Mult(1, polviews, .).fefam1 -0.48588         NA      NA       NA
Mult(1, polviews, .).fefam2 -0.06421         NA      NA       NA
Mult(1, polviews, .).fefam3  0.26448         NA      NA       NA
Mult(1, polviews, .).fefam4  0.42040         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 8.0718 on 10 degrees of freedom
AIC: 215.43

Number of iterations: 32</code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC.un                  10  8.07 -73.4  1.77 0.622</code></pre>
</div>
</div>
<p>まずは「重みづけのないまたは単位標準化した解」を求める．<code>scaleWeights = "unit"</code>とする．<code>RC.un</code>から<code>.polviews</code>のある変数を<code>pickCoef(RC.un, "[.]polviews")</code>によって取り出す．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mu[i], i = 1 to 7</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un,</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"[.]polviews"</span>),</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 合計が0，2乗和が1となっていること確認する．</span></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"和"</span> <span class="ot">=</span> <span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]), </span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>     <span class="st">"2乗和"</span> <span class="ot">=</span> <span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$和
[1] -1.110223e-16

$`2乗和`
[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nu[j], j = 1 to 4</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un, <span class="st">"[.]fefam"</span>), </span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 合計が0，2乗和が1となっていること確認する．</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"和"</span> <span class="ot">=</span> <span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]), </span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>     <span class="st">"2乗和"</span> <span class="ot">=</span> <span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$和
[1] 1.110223e-16

$`2乗和`
[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># muの1番目と7番目，nuの1番目と4番目の値を取り出し保存する．</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>)],</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co">#保存した値で制約を課した上で，再推定する．</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span> </span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>,polviews,fefam), </span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">22</span>),</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con, </span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations..........................
Done</code></pre>
</div>
</div>
<p><code>Deviance is not finite 警告メッセージ: Algorithm failed - no model could be estimated</code>と表示されたらもう一度推定する．<code>set.seed</code>の値をいくつか変えて実行するのがよい．</p>
<p>表2.5Eの値と一致しているのかを確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam), 
    constrain = c(12, 18, 19, 22), constrainTo = con, family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07428  -0.27239   0.03038   0.36792   1.03721  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  2.82020    0.14578  19.346  &lt; 2e-16 ***
polviews2                    1.40280    0.12442  11.275  &lt; 2e-16 ***
polviews3                    1.45577    0.12746  11.421  &lt; 2e-16 ***
polviews4                    2.64048    0.13143  20.090  &lt; 2e-16 ***
polviews5                    1.75073    0.14175  12.351  &lt; 2e-16 ***
polviews6                    1.72618    0.16727  10.320  &lt; 2e-16 ***
polviews7                    0.01648    0.21938   0.075 0.940107    
fefam2                       0.91251    0.12222   7.466 8.25e-14 ***
fefam3                       0.45574    0.20388   2.235 0.025396 *  
fefam4                      -0.71735    0.24913  -2.879 0.003985 ** 
Mult(., polviews, fefam).   -2.37331    0.34813  -6.817 9.27e-12 ***
Mult(1, ., fefam).polviews1  0.48165         NA      NA       NA    
Mult(1, ., fefam).polviews2  0.37580    0.10049   3.740 0.000184 ***
Mult(1, ., fefam).polviews3  0.23443    0.09461   2.478 0.013216 *  
Mult(1, ., fefam).polviews4  0.01632    0.08366   0.195 0.845376    
Mult(1, ., fefam).polviews5 -0.07749    0.09263  -0.837 0.402872    
Mult(1, ., fefam).polviews6 -0.38425    0.10926  -3.517 0.000437 ***
Mult(1, ., fefam).polviews7 -0.64646         NA      NA       NA    
Mult(1, polviews, .).fefam1 -0.74812         NA      NA       NA    
Mult(1, polviews, .).fefam2 -0.14098    0.07469  -1.888 0.059090 .  
Mult(1, polviews, .).fefam3  0.33229    0.09162   3.627 0.000287 ***
Mult(1, polviews, .).fefam4  0.55680         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 8.0718 on 10 degrees of freedom
AIC: 215.43

Number of iterations: 26</code></pre>
</div>
</div>
<p>先ほどの単位標準化した解と推定の結果が一致しているのかを確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 指定したmuとnuの値と結果が一致しているかを確認</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="at">mu =</span> mu, <span class="at">nu =</span> nu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$mu
                               Estimate Std. Error
Mult(1, ., fefam).polviews1  0.48165420 0.06776575
Mult(1, ., fefam).polviews2  0.37579722 0.05016783
Mult(1, ., fefam).polviews3  0.23443020 0.04842778
Mult(1, ., fefam).polviews4  0.01631519 0.03689088
Mult(1, ., fefam).polviews5 -0.07748893 0.04931050
Mult(1, ., fefam).polviews6 -0.38424697 0.06009815
Mult(1, ., fefam).polviews7 -0.64646091 0.06145462

$nu
                              Estimate Std. Error
Mult(1, polviews, .).fefam1 -0.7481178 0.02662158
Mult(1, polviews, .).fefam2 -0.1409760 0.04671343
Mult(1, polviews, .).fefam3  0.3322937 0.05164241
Mult(1, polviews, .).fefam4  0.5568002 0.04821776</code></pre>
</div>
</div>
<p>適合度は変化していない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC.un                  10  8.07 -73.4  1.77 0.622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC                     10  8.07 -73.4  1.77 0.622</code></pre>
</div>
</div>
</section>
<section id="周辺重みづけ" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="周辺重みづけ"><span class="header-section-number">2.7</span> 周辺重みづけ</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行の周辺確率</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="fu">apply</span>(tab_2<span class="fl">.3</span>A, <span class="dv">1</span>, sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>rp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Strongly liberal               Liberal      Slightly liberal 
           0.03227682            0.12387322            0.12300087 
             Moderate Slightly conservative          Conservative 
           0.38092469            0.15498691            0.15469613 
Strongly conservative 
           0.03024135 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(rp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 列の周辺確率</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>cp <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="fu">apply</span>(tab_2<span class="fl">.3</span>A, <span class="dv">2</span>, sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>cp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Strongly Disagree          Disagree             Agree    Strongly agree 
       0.19220704        0.43617331        0.28118639        0.09043327 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(cp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mu[i], i = 1 to 7</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un,</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"[.]polviews"</span>),</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> rp,</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> rp, </span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> rp)</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a><span class="co"># nu[j], j = 1 to 4</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un, <span class="st">"[.]fefam"</span>), </span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> cp,</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> cp,</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> cp)</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a><span class="co"># muの1番目と7番目，nuの1番目と4番目の値を取り出し保存する．</span></span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>)],</span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co">#保存した値で制約を課した上で，再推定する．</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>RC_mw <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span> </span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>,polviews,fefam), </span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">22</span>),</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con, </span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations........................
Done</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC_mw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam), 
    constrain = c(12, 18, 19, 22), constrainTo = con, family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07428  -0.27239   0.03038   0.36792   1.03721  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  2.90051    0.14144  20.507  &lt; 2e-16 ***
polviews2                    1.38735    0.11722  11.835  &lt; 2e-16 ***
polviews3                    1.41969    0.12024  11.807  &lt; 2e-16 ***
polviews4                    2.57257    0.12376  20.787  &lt; 2e-16 ***
polviews5                    1.66913    0.13414  12.443  &lt; 2e-16 ***
polviews6                    1.59981    0.16013   9.991  &lt; 2e-16 ***
polviews7                   -0.14816    0.21832  -0.679 0.497376    
fefam2                       0.90365    0.12173   7.423 1.14e-13 ***
fefam3                       0.43998    0.20350   2.162 0.030615 *  
fefam4                      -0.73638    0.24896  -2.958 0.003098 ** 
Mult(., polviews, fefam).   -0.25673    0.03766  -6.817 9.27e-12 ***
Mult(1, ., fefam).polviews1  1.82062         NA      NA       NA    
Mult(1, ., fefam).polviews2  1.41532    0.38476   3.678 0.000235 ***
Mult(1, ., fefam).polviews3  0.87405    0.36224   2.413 0.015825 *  
Mult(1, ., fefam).polviews4  0.03893    0.32031   0.122 0.903253    
Mult(1, ., fefam).polviews5 -0.32022    0.35468  -0.903 0.366604    
Mult(1, ., fefam).polviews6 -1.49474    0.41835  -3.573 0.000353 ***
Mult(1, ., fefam).polviews7 -2.49870         NA      NA       NA    
Mult(1, polviews, .).fefam1 -1.65778         NA      NA       NA    
Mult(1, polviews, .).fefam2 -0.19190    0.18033  -1.064 0.287244    
Mult(1, polviews, .).fefam3  0.95076    0.22120   4.298 1.72e-05 ***
Mult(1, polviews, .).fefam4  1.49281         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 8.0718 on 10 degrees of freedom
AIC: 215.43

Number of iterations: 24</code></pre>
</div>
</div>
<p>内在的連関パラメータが0.25673となっている．</p>
<p>適合度は変化していない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC.un                  10  8.07 -73.4  1.77 0.622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC                     10  8.07 -73.4  1.77 0.622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC_mw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC_mw                  10  8.07 -73.4  1.77 0.622</code></pre>
</div>
</div>
</section>
<section id="表2.4a" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="表2.4a"><span class="header-section-number">2.8</span> 表2.4A</h2>
<p>表2.4Aを再現する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(O)</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(U)</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(R)</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(C)</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusC)</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RC)</span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>models <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">digit =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">Model Description</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">L2</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">Delta</th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">O</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">211.695</td>
<td style="text-align: right;">65.122</td>
<td style="text-align: right;">8.092</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">U</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">20.125</td>
<td style="text-align: right;">-118.305</td>
<td style="text-align: right;">2.766</td>
<td style="text-align: right;">0.268</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">15.906</td>
<td style="text-align: right;">-81.809</td>
<td style="text-align: right;">2.466</td>
<td style="text-align: right;">0.196</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14.237</td>
<td style="text-align: right;">-107.907</td>
<td style="text-align: right;">2.321</td>
<td style="text-align: right;">0.508</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RplusC</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7.678</td>
<td style="text-align: right;">-73.751</td>
<td style="text-align: right;">1.772</td>
<td style="text-align: right;">0.660</td>
</tr>
<tr class="even">
<td style="text-align: left;">RC</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8.072</td>
<td style="text-align: right;">-73.358</td>
<td style="text-align: right;">1.767</td>
<td style="text-align: right;">0.622</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="表2.4b" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="表2.4b"><span class="header-section-number">2.9</span> 表2.4B</h2>
<p>モデルの比較のための関数を作成する．引数は2つであり，1つめのモデルと2つめのモデルの比較を行う．2つめが指定されていなければ比較ではなくそのモデルの適合度を示す．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>model_comparison <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">y =</span> <span class="dv">0</span>) {</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  models <span class="sc">%&gt;%</span> </span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Model Used</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">paste0</span>(x),</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">paste0</span>(x,<span class="st">"-"</span>,y)),</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">df =</span> <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>                          df[x], </span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>                          df[x] <span class="sc">-</span> df[y]),</span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">L2 =</span> <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>                          L2[x], </span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a>                          L2[x] <span class="sc">-</span> L2[y]))</span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>表2.4Bは次のように再現できる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel B</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">6</span>),</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">6</span>),</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  `Model Used`    df     L2
  &lt;chr&gt;        &lt;int&gt;  &lt;dbl&gt;
1 1-2              1 192.  
2 2-6              7  12.1 
3 6               10   8.07
4 1               18 212.  </code></pre>
</div>
</div>
<p>表2.4Cも再現できる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel C</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">4</span>),</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">4</span>,<span class="dv">6</span>),</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  `Model Used`    df    L2
  &lt;chr&gt;        &lt;int&gt; &lt;dbl&gt;
1 2-4              2  5.89
2 4-6              5  6.17
3 2-6              7 12.1 </code></pre>
</div>
</div>
</section>
<section id="表2.5a" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="表2.5a"><span class="header-section-number">2.10</span> 表2.5A</h2>
<p>係数を取り出して表2.5Aを再現する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(U)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore:Cscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Variable  Estimate Std..Error  z.value     Pr...z..
1 Rscore:Cscore 0.2021125 0.01519706 13.29945 2.331718e-40</code></pre>
</div>
</div>
</section>
<section id="表2.5b" class="level2" data-number="2.11">
<h2 data-number="2.11" class="anchored" data-anchor-id="表2.5b"><span class="header-section-number">2.11</span> 表2.5B</h2>
<p>省略された係数について，値を標準誤差を求める方法は次の通り．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel B </span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(R)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Cscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Variable     Estimate Std..Error    z.value     Pr...z..
1 polviews1:Cscore -0.558726563 0.10766840 -5.1893275 2.110549e-07
2 polviews2:Cscore -0.405075736 0.05914888 -6.8484091 7.467575e-12
3 polviews3:Cscore -0.248458921 0.05774110 -4.3029822 1.685144e-05
4 polviews4:Cscore  0.008763861 0.03970853  0.2207048 8.253223e-01
5 polviews5:Cscore  0.112245001 0.05128383  2.1887016 2.861853e-02
6 polviews6:Cscore  0.419078627 0.05143368  8.1479420 3.701697e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># polviews7:Cscoreを求める</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(<span class="fu">coef</span>(R)))</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(R,<span class="st">"[:]Cscore"</span>)</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>mycontrast[terms] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">6</span>)</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mycontrast)</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mycontrast) <span class="ot">&lt;-</span> <span class="st">"polviews7:Cscore"</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>gnm<span class="sc">::</span><span class="fu">se</span>(R, mycontrast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Estimate Std. Error
polviews7:Cscore 0.6721737  0.1003211</code></pre>
</div>
</div>
</section>
<section id="表2.5b他の正規化" class="level2" data-number="2.12">
<h2 data-number="2.12" class="anchored" data-anchor-id="表2.5b他の正規化"><span class="header-section-number">2.12</span> 表2.5B（他の正規化）</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel B Alternative</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Ralt)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Cscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Variable  Estimate Std..Error  z.value     Pr...z..
1 polviews2:Cscore 0.1536508  0.1361941 1.128176 2.592458e-01
2 polviews3:Cscore 0.3102676  0.1356609 2.287082 2.219102e-02
3 polviews4:Cscore 0.5674904  0.1267654 4.476699 7.580590e-06
4 polviews5:Cscore 0.6709716  0.1326215 5.059297 4.208051e-07
5 polviews6:Cscore 0.9778052  0.1331060 7.346062 2.041319e-13
6 polviews7:Cscore 1.2309003  0.1678130 7.334954 2.217982e-13</code></pre>
</div>
</div>
</section>
<section id="表2.5c" class="level2" data-number="2.13">
<h2 data-number="2.13" class="anchored" data-anchor-id="表2.5c"><span class="header-section-number">2.13</span> 表2.5C</h2>
<p>同様に列効果の最後のカテゴリの推定値と標準誤差を求める．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel C</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(C)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Rscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Variable    Estimate Std..Error    z.value     Pr...z..
1 fefam1:Rscore -0.32183233 0.02601065 -12.373099 3.654449e-35
2 fefam2:Rscore -0.06518238 0.02012977  -3.238109 1.203247e-03
3 fefam3:Rscore  0.13740293 0.02281996   6.021174 1.731567e-09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fefam4:Rscoreを求める</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(<span class="fu">coef</span>(C)))</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(C,<span class="st">"[:]Rscore"</span>)</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>mycontrast[terms] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">3</span>)</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mycontrast)</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mycontrast) <span class="ot">&lt;-</span> <span class="st">"fefam4:Rscore"</span></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>gnm<span class="sc">::</span><span class="fu">se</span>(C, mycontrast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Estimate Std. Error
fefam4:Rscore 0.2496118 0.03429697</code></pre>
</div>
</div>
</section>
<section id="表2.5c他の正規化" class="level2" data-number="2.14">
<h2 data-number="2.14" class="anchored" data-anchor-id="表2.5c他の正規化"><span class="header-section-number">2.14</span> 表2.5C（他の正規化）</h2>
<p>1つ目のカテゴリの値を0とした正規化の場合は次のようになる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel C Alternative</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Calt)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Rscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Variable  Estimate Std..Error   z.value     Pr...z..
1 fefam2:Rscore 0.2566499 0.03458604  7.420624 1.165702e-13
2 fefam3:Rscore 0.4592353 0.03850703 11.926012 8.662502e-33
3 fefam4:Rscore 0.5714441 0.05297192 10.787680 3.935998e-27</code></pre>
</div>
</div>
</section>
<section id="表2.5d" class="level2" data-number="2.15">
<h2 data-number="2.15" class="anchored" data-anchor-id="表2.5d"><span class="header-section-number">2.15</span> 表2.5D</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel D</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusC)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Variable    Estimate Std..Error    z.value     Pr...z..
1  polviews1:Cscore  0.00000000         NA         NA           NA
2  polviews2:Cscore -0.08578207 0.11436513 -0.7500719 4.532114e-01
3  polviews3:Cscore -0.15923097 0.10584890 -1.5043233 1.324981e-01
4  polviews4:Cscore -0.12164181 0.09246130 -1.3155970 1.883093e-01
5  polviews5:Cscore -0.22242867 0.10509647 -2.1164238 3.430878e-02
6  polviews6:Cscore -0.09452143 0.11453734 -0.8252455 4.092322e-01
7  polviews7:Cscore  0.00000000         NA         NA           NA
8     fefam1:Rscore  0.00000000         NA         NA           NA
9     fefam2:Rscore  0.27935717 0.04372418  6.3890770 1.668900e-10
10    fefam3:Rscore  0.48417258 0.06238681  7.7608170 8.438398e-15
11    fefam4:Rscore  0.58586364 0.08654948  6.7691179 1.295700e-11</code></pre>
</div>
</div>
</section>
<section id="表2.5d他の正規化" class="level2" data-number="2.16">
<h2 data-number="2.16" class="anchored" data-anchor-id="表2.5d他の正規化"><span class="header-section-number">2.16</span> 表2.5D（他の正規化）</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCalt)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Variable    Estimate Std..Error    z.value     Pr...z..
1     Rscore:Cscore  0.19528788 0.02884983  6.7691179 1.295700e-11
2  polviews2:Cscore -0.08578207 0.11436513 -0.7500719 4.532114e-01
3  polviews3:Cscore -0.15923097 0.10584890 -1.5043233 1.324981e-01
4  polviews4:Cscore -0.12164181 0.09246130 -1.3155970 1.883093e-01
5  polviews5:Cscore -0.22242867 0.10509647 -2.1164238 3.430878e-02
6  polviews6:Cscore -0.09452143 0.11453734 -0.8252455 4.092322e-01
7  polviews7:Cscore  0.00000000         NA         NA           NA
8     fefam2:Rscore  0.08406929 0.03224287  2.6073757 9.123918e-03
9     fefam3:Rscore  0.09359682 0.03861067  2.4241178 1.534563e-02
10    fefam4:Rscore  0.00000000         NA         NA           NA</code></pre>
</div>
</div>
</section>
<section id="表2.5e" class="level2" data-number="2.17">
<h2 data-number="2.17" class="anchored" data-anchor-id="表2.5e"><span class="header-section-number">2.17</span> 表2.5E</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Mult"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Variable    Estimate Std..Error    z.value     Pr...z..
1    Mult(., polviews, fefam). -2.37330693 0.34812532 -6.8173924 9.270782e-12
2  Mult(1, ., fefam).polviews1  0.48165420         NA         NA           NA
3  Mult(1, ., fefam).polviews2  0.37579722 0.10049018  3.7396411 1.842832e-04
4  Mult(1, ., fefam).polviews3  0.23443020 0.09460850  2.4778980 1.321589e-02
5  Mult(1, ., fefam).polviews4  0.01631519 0.08365831  0.1950217 8.453760e-01
6  Mult(1, ., fefam).polviews5 -0.07748893 0.09263438 -0.8365030 4.028720e-01
7  Mult(1, ., fefam).polviews6 -0.38424697 0.10926427 -3.5166753 4.369880e-04
8  Mult(1, ., fefam).polviews7 -0.64646091         NA         NA           NA
9  Mult(1, polviews, .).fefam1 -0.74811781         NA         NA           NA
10 Mult(1, polviews, .).fefam2 -0.14097601 0.07468829 -1.8875250 5.908974e-02
11 Mult(1, polviews, .).fefam3  0.33229365 0.09161751  3.6269668 2.867702e-04
12 Mult(1, polviews, .).fefam4  0.55680017         NA         NA           NA</code></pre>
</div>
</div>
</section>
<section id="logmultパッケージの利用" class="level2" data-number="2.18">
<h2 data-number="2.18" class="anchored" data-anchor-id="logmultパッケージの利用"><span class="header-section-number">2.18</span> logmultパッケージの利用</h2>
<p><code>logmult</code>は<code>gnm</code>をベースとしてRCモデルを簡単に実行できる関数である．</p>
<p>まずは<code>logmult</code>パッケージの<code>anoas</code>で連関分析を行う．データはtableなので<code>tab_2.3A</code>を使用する．</p>
<p><code>anoas</code>は独立モデル，RC(1)，RC(2)，RC(3)，…と次元が<code>min(nrow(tab) - 1, ncol(tab) - 1)</code>までのRCモデルを推定する．RC(1)の結果は表2.4Aと一致している．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anoas</span>(tab_2<span class="fl">.3</span>A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting independence model...
Fitting model with 1 dimension...
Initialising
Running start-up iterations..
Running main iterations...................
Done
Fitting model with 2 dimensions...
Initialising
Running start-up iterations..
Running main iterations..........................
Done
Fitting model with 3 dimensions...
Initialising
Running start-up iterations..
Running main iterations...
Done</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       Res. Df           Res. Dev     Dev./Indep. (%)   Dissim. (%)
Indep.      18 211.69508974175693 100.000000000000000 8.09171028965
RC(1)       10   8.07181892815000   3.812945750417107 1.76730792765
RC(2)        4   1.36909098846095   0.646727796157711 0.49639212377
RC(3)        0  -0.00000000000001  -0.000000000000005 0.00000000004
                      BIC                AIC Dev. Df
Indep.  65.12224155397615 175.69508974175693   NA NA
RC(1)  -73.35754117617265 -11.92818107185000 -204 -8
RC(2)  -31.20265305326811  -6.63090901153905   -7 -6
RC(3)   -0.00000000000001  -0.00000000000001   -1 -4</code></pre>
</div>
</div>
<p>表2.5Eの推定値（RC(1)）は<code>rc</code>を用いて次のように再現できる．<code>nd = 1</code>で次元を1としている．標準誤差を求める上で，ブートストラップ法を用いている．結果には<span class="math inline">\(\gamma=\delta=1/2\)</span>の場合の係数（Adjusted）が示されている．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>rc_fit <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, </span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">nd =</span> <span class="dv">1</span>, </span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">se =</span> <span class="st">"bootstrap"</span>, </span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">weighting =</span> <span class="st">"none"</span>,</span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">nreplicates =</span> <span class="dv">100</span>, </span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncpus =</span> <span class="fu">getOption</span>(<span class="st">"boot.ncpus"</span>)</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>             )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........
Done
Computing bootstrap standard errors...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: parallel</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rc_fit, <span class="at">weighting =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab_2.3A, nd = 1, weighting = "none", se = "bootstrap", 
    nreplicates = 100, ncpus = getOption("boot.ncpus"))

Deviance Residuals:
    Min       1Q   Median       3Q      Max  
-1.0743  -0.2724   0.0304   0.3679   1.0372  

Association coefficients:
                                    Normalized   Adjusted  Std. error
Dim1                                  2.373307         NA      0.2735
Dim1:polviewsStrongly liberal         0.481654   0.742014      0.0732
Dim1:polviewsLiberal                  0.375797   0.578936      0.0505
Dim1:polviewsSlightly liberal         0.234430   0.361152      0.0544
Dim1:polviewsModerate                 0.016315   0.025134      0.0326
Dim1:polviewsSlightly conservative   -0.077489  -0.119376      0.0492
Dim1:polviewsConservative            -0.384247  -0.591953      0.0596
Dim1:polviewsStrongly conservative   -0.646461  -0.995908      0.0621
Dim1:fefamStrongly Disagree           0.748118   1.152516      0.0252
Dim1:fefamDisagree                    0.140976   0.217181      0.0470
Dim1:fefamAgree                      -0.332294  -0.511916      0.0583
Dim1:fefamStrongly agree             -0.556800  -0.857781      0.0489
                                     Pr(&gt;|z|)     
Dim1                                &lt; 2.2e-16  ***
Dim1:polviewsStrongly liberal       4.834e-11  ***
Dim1:polviewsLiberal                1.003e-13  ***
Dim1:polviewsSlightly liberal       1.609e-05  ***
Dim1:polviewsModerate                0.616651     
Dim1:polviewsSlightly conservative   0.114925     
Dim1:polviewsConservative           1.121e-10  ***
Dim1:polviewsStrongly conservative  &lt; 2.2e-16  ***
Dim1:fefamStrongly Disagree         &lt; 2.2e-16  ***
Dim1:fefamDisagree                   0.002683  ** 
Dim1:fefamAgree                     1.214e-08  ***
Dim1:fefamStrongly agree            &lt; 2.2e-16  ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Normalization weights: none
Deviance:              8.071819
Pearson chi-squared:   8.168769
Dissimilarity index:   1.767308%
Residual df:           10
BIC:                   -73.35754
AIC:                   -11.92818</code></pre>
</div>
</div>
<p>周辺重みづけを用いたい場合は`weighting = “marginal”とする．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>rc_fit_wm <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, </span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">nd =</span> <span class="dv">1</span>, </span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">se =</span> <span class="st">"bootstrap"</span>, </span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">weighting =</span> <span class="st">"marginal"</span>,</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">nreplicates =</span> <span class="dv">100</span>, </span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncpus =</span> <span class="fu">getOption</span>(<span class="st">"boot.ncpus"</span>)</span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>             )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.............
Done
Computing bootstrap standard errors...
.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rc_fit_wm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab_2.3A, nd = 1, weighting = "marginal", se = "bootstrap", 
    nreplicates = 100, ncpus = getOption("boot.ncpus"))

Deviance Residuals:
    Min       1Q   Median       3Q      Max  
-1.0743  -0.2724   0.0304   0.3679   1.0372  

Association coefficients:
                                    Normalized   Adjusted  Std. error
Dim1                                  0.256734         NA      0.0185
Dim1:polviewsStrongly liberal         1.820624   0.922490      0.3333
Dim1:polviewsLiberal                  1.415319   0.717126      0.1601
Dim1:polviewsSlightly liberal         0.874053   0.442873      0.1882
Dim1:polviewsModerate                 0.038935   0.019728      0.0944
Dim1:polviewsSlightly conservative   -0.320222  -0.162253      0.1777
Dim1:polviewsConservative            -1.494737  -0.757366      0.1303
Dim1:polviewsStrongly conservative   -2.498701  -1.266064      0.4518
Dim1:fefamStrongly Disagree           1.657784   0.839980      0.0847
Dim1:fefamDisagree                    0.191902   0.097234      0.0811
Dim1:fefamAgree                      -0.950760  -0.481739      0.0891
Dim1:fefamStrongly agree             -1.492808  -0.756389      0.1960
                                     Pr(&gt;|z|)     
Dim1                                &lt; 2.2e-16  ***
Dim1:polviewsStrongly liberal       4.701e-08  ***
Dim1:polviewsLiberal                &lt; 2.2e-16  ***
Dim1:polviewsSlightly liberal       3.393e-06  ***
Dim1:polviewsModerate                 0.67992     
Dim1:polviewsSlightly conservative    0.07150  .  
Dim1:polviewsConservative           &lt; 2.2e-16  ***
Dim1:polviewsStrongly conservative  3.197e-08  ***
Dim1:fefamStrongly Disagree         &lt; 2.2e-16  ***
Dim1:fefamDisagree                    0.01798  *  
Dim1:fefamAgree                     &lt; 2.2e-16  ***
Dim1:fefamStrongly agree            2.616e-14  ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Normalization weights: marginal
Deviance:              8.071819
Pearson chi-squared:   8.168769
Dissimilarity index:   1.767308%
Residual df:           10
BIC:                   -73.35754
AIC:                   -11.92818</code></pre>
</div>
</div>
<p>これは先ほど求めた周辺重みづけの結果（内在的連関パラメータが0.25673）と一致する．</p>
</section>
<section id="表2.3b" class="level2" data-number="2.19">
<h2 data-number="2.19" class="anchored" data-anchor-id="表2.3b"><span class="header-section-number">2.19</span> 表2.3B</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># コントラストを確認</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$contrasts
           factor           ordered 
"contr.treatment" "contr.treatment" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># default</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>anoas</code>を用いるときにはのエラーを無くすために行列はラベルを用いない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">518</span>,  <span class="dv">95</span>, <span class="dv">6</span>, <span class="dv">35</span>, <span class="dv">5</span>,</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>         　 <span class="dv">81</span>,  <span class="dv">67</span>, <span class="dv">4</span>, <span class="dv">49</span>, <span class="dv">2</span>,</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">452</span>,<span class="dv">1003</span>,<span class="dv">67</span>,<span class="dv">630</span>, <span class="dv">5</span>,</span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>           <span class="dv">71</span>, <span class="dv">157</span>,<span class="dv">37</span>,<span class="dv">562</span>,<span class="dv">12</span>)</span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq, </span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">5</span>,</span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">as.table</span>()</span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     A    B    C    D    E
A  518   95    6   35    5
B   81   67    4   49    2
C  452 1003   67  630    5
D   71  157   37  562   12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる集計データを作成</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>Educ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>Occ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">20</span>)</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Educ, Occ)</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
    Freq Educ  Occ  
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
 1   518 1     1    
 2    95 1     2    
 3     6 1     3    
 4    35 1     4    
 5     5 1     5    
 6    81 2     1    
 7    67 2     2    
 8     4 2     3    
 9    49 2     4    
10     2 2     5    
11   452 3     1    
12  1003 3     2    
13    67 3     3    
14   630 3     4    
15     5 3     5    
16    71 4     1    
17   157 4     2    
18    37 4     3    
19   562 4     4    
20    12 4     5    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数と列変数の整数値を作成</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rscore =</span> <span class="fu">as.numeric</span>(Educ),</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> <span class="fu">as.numeric</span>(Occ))</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 5
    Freq Educ  Occ   Rscore Cscore
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1   518 1     1          1      1
 2    95 1     2          1      2
 3     6 1     3          1      3
 4    35 1     4          1      4
 5     5 1     5          1      5
 6    81 2     1          2      1
 7    67 2     2          2      2
 8     4 2     3          2      3
 9    49 2     4          2      4
10     2 2     5          2      5
11   452 3     1          3      1
12  1003 3     2          3      2
13    67 3     3          3      3
14   630 3     4          3      4
15     5 3     5          3      5
16    71 4     1          4      1
17   157 4     2          4      2
18    37 4     3          4      3
19   562 4     4          4      4
20    12 4     5          4      5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span> </span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ, </span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore, </span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-14"><a href="#cb243-14" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb243-15"><a href="#cb243-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb243-16"><a href="#cb243-16" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb243-17"><a href="#cb243-17" aria-hidden="true" tabindex="-1"></a>        Educ<span class="sc">:</span>Cscore, </span>
<span id="cb243-18"><a href="#cb243-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb243-19"><a href="#cb243-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb243-20"><a href="#cb243-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb243-21"><a href="#cb243-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-22"><a href="#cb243-22" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb243-23"><a href="#cb243-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb243-24"><a href="#cb243-24" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb243-25"><a href="#cb243-25" aria-hidden="true" tabindex="-1"></a>        Occ<span class="sc">:</span>Rscore, </span>
<span id="cb243-26"><a href="#cb243-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb243-27"><a href="#cb243-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb243-28"><a href="#cb243-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb243-29"><a href="#cb243-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-30"><a href="#cb243-30" aria-hidden="true" tabindex="-1"></a>RplusC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb243-31"><a href="#cb243-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb243-32"><a href="#cb243-32" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb243-33"><a href="#cb243-33" aria-hidden="true" tabindex="-1"></a>        Educ<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb243-34"><a href="#cb243-34" aria-hidden="true" tabindex="-1"></a>        Occ<span class="sc">:</span>Rscore,</span>
<span id="cb243-35"><a href="#cb243-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">16</span>), </span>
<span id="cb243-36"><a href="#cb243-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb243-37"><a href="#cb243-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb243-38"><a href="#cb243-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb243-39"><a href="#cb243-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb243-40"><a href="#cb243-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-41"><a href="#cb243-41" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb243-42"><a href="#cb243-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb243-43"><a href="#cb243-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb243-44"><a href="#cb243-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb243-45"><a href="#cb243-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb243-46"><a href="#cb243-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
.............................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
.
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>),</span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.......................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations......................................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),<span class="dv">2</span>),</span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.....................
Done</code></pre>
</div>
</div>
</section>
<section id="表2.6a" class="level2" data-number="2.20">
<h2 data-number="2.20" class="anchored" data-anchor-id="表2.6a"><span class="header-section-number">2.20</span> 表2.6A</h2>
<p>表2.6Aを再現する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(O)</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(U)</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(R)</span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(C)</span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusC)</span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RC)</span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">7</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(UplusRC)</span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">8</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusRC)</span>
<span id="cb255-10"><a href="#cb255-10" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">9</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(CplusRC)</span>
<span id="cb255-11"><a href="#cb255-11" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">10</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusCplusRC)</span>
<span id="cb255-12"><a href="#cb255-12" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">11</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RC2)</span>
<span id="cb255-13"><a href="#cb255-13" aria-hidden="true" tabindex="-1"></a>models <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 6
   `Model Description`    df       L2    BIC   Delta         p
   &lt;chr&gt;               &lt;int&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1 O                      12 1373.    1274.  23.9    8.44e-287
 2 U                      11  244.     153.   8.54   4.99e- 46
 3 R                       9  206.     132.   7.38   1.85e- 39
 4 C                       8  155.      89.3  7.47   1.48e- 29
 5 RplusC                  6   91.6     42.1  4.63   1.40e- 17
 6 RC                      6  125.      75.5  6.44   1.41e- 24
 7 UplusRC                 5   17.6    -23.7  1.52   3.49e-  3
 8 RplusRC                 4    6.94   -26.1  0.832  1.39e-  1
 9 CplusRC                 3   11.4    -13.4  1.01   9.72e-  3
10 RplusCplusRC            2    0.278  -16.2  0.0538 8.70e-  1
11 RC2                     2    0.600  -15.9  0.0935 7.41e-  1</code></pre>
</div>
</div>
</section>
<section id="表2.6b" class="level2" data-number="2.21">
<h2 data-number="2.21" class="anchored" data-anchor-id="表2.6b"><span class="header-section-number">2.21</span> 表2.6B</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel B</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">1</span>,<span class="dv">6</span>),</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">6</span>,<span class="dv">11</span>),</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">11</span>),</span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  `Model Used`    df       L2
  &lt;chr&gt;        &lt;int&gt;    &lt;dbl&gt;
1 1-6              6 1248.   
2 6-11             4  124.   
3 11               2    0.600
4 1               12 1373.   </code></pre>
</div>
</div>
</section>
<section id="表2.6c" class="level2" data-number="2.22">
<h2 data-number="2.22" class="anchored" data-anchor-id="表2.6c"><span class="header-section-number">2.22</span> 表2.6C</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel C</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">6</span>),</span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">6</span>,<span class="dv">10</span>),</span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">10</span>),</span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  `Model Used`    df       L2
  &lt;chr&gt;        &lt;int&gt;    &lt;dbl&gt;
1 1-2              1 1129.   
2 2-6              5  119.   
3 6-10             4  125.   
4 10               2    0.278
5 1               12 1373.   </code></pre>
</div>
</div>
</section>
<section id="表2.7a" class="level2" data-number="2.23">
<h2 data-number="2.23" class="anchored" data-anchor-id="表2.7a"><span class="header-section-number">2.23</span> 表2.7A</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
..............
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(UplusRC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Rscore:Cscore + Mult(1, Educ, 
    Occ), family = poisson, data = ., tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0893  -0.5631   0.1321   0.7372   1.9761  

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)             5.49123         NA      NA       NA    
Educ2                  -2.07045         NA      NA       NA    
Educ3                  -1.00877         NA      NA       NA    
Educ4                  -3.55473         NA      NA       NA    
Occ2                   -1.06909         NA      NA       NA    
Occ3                   -5.17113         NA      NA       NA    
Occ4                   -4.53939         NA      NA       NA    
Occ5                  -10.91018         NA      NA       NA    
Rscore:Cscore           0.55212    0.03429    16.1   &lt;2e-16 ***
Mult(., Educ, Occ).     0.05379         NA      NA       NA    
Mult(1, ., Occ).Educ1  57.38879         NA      NA       NA    
Mult(1, ., Occ).Educ2  28.47707         NA      NA       NA    
Mult(1, ., Occ).Educ3 -10.70009         NA      NA       NA    
Mult(1, ., Occ).Educ4   9.22301         NA      NA       NA    
Mult(1, Educ, .).Occ1   0.06067         NA      NA       NA    
Mult(1, Educ, .).Occ2  -0.31188         NA      NA       NA    
Mult(1, Educ, .).Occ3   0.01526         NA      NA       NA    
Mult(1, Educ, .).Occ4   0.19408         NA      NA       NA    
Mult(1, Educ, .).Occ5   1.34889         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 17.602 on 5 degrees of freedom
AIC: 163.98

Number of iterations: 71</code></pre>
</div>
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Educ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ3 
                   11                    12                    13 
Mult(1, ., Occ).Educ4 
                   14 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Occ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ3 
                   15                    16                    17 
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ5 
                   18                    19 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(UplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> UplusRC<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        var     estimate number
(Intercept)                     (Intercept)   5.49123206      1
Educ2                                 Educ2  -2.07045034      2
Educ3                                 Educ3  -1.00877122      3
Educ4                                 Educ4  -3.55472593      4
Occ2                                   Occ2  -1.06909237      5
Occ3                                   Occ3  -5.17112951      6
Occ4                                   Occ4  -4.53939355      7
Occ5                                   Occ5 -10.91018443      8
Rscore:Cscore                 Rscore:Cscore   0.55211791      9
Mult(., Educ, Occ).     Mult(., Educ, Occ).   0.05378691     10
Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ1  57.38878762     11
Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ2  28.47707090     12
Mult(1, ., Occ).Educ3 Mult(1, ., Occ).Educ3 -10.70009235     13
Mult(1, ., Occ).Educ4 Mult(1, ., Occ).Educ4   9.22300628     14
Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ1   0.06066883     15
Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ2  -0.31187524     16
Mult(1, Educ, .).Occ3 Mult(1, Educ, .).Occ3   0.01525644     17
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ4   0.19407628     18
Mult(1, Educ, .).Occ5 Mult(1, Educ, .).Occ5   1.34889132     19</code></pre>
</div>
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(UplusRC, </span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Educ"</span>), </span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(UplusRC, </span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Occ"</span>), </span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb271-10"><a href="#cb271-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb271-11"><a href="#cb271-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-12"><a href="#cb271-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心化制約と尺度化制約の確認</span></span>
<span id="cb271-13"><a href="#cb271-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2.775558e-17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行スコアと列スコアの両端の値を固定する</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">19</span>),</span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb279-13"><a href="#cb279-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
.........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(UplusRC)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>,</span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>                      Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Variable    Estimate Std..Error   z.value     Pr...z..
1          Rscore:Cscore  0.55211791 0.03429436 16.099379 2.576758e-58
2    Mult(., Educ, Occ).  3.43558976 0.61932837  5.547283 2.901428e-08
3  Mult(1, ., Occ).Educ1  0.72242916         NA        NA           NA
4  Mult(1, ., Occ).Educ2  0.14690561 0.13431003  1.093780 2.740515e-01
5  Mult(1, ., Occ).Educ3 -0.63296437 0.13149187 -4.813715 1.481501e-06
6  Mult(1, ., Occ).Educ4 -0.23637040         NA        NA           NA
7  Mult(1, Educ, .).Occ1 -0.15787324         NA        NA           NA
8  Mult(1, Educ, .).Occ2 -0.45087063 0.05888770 -7.656448 1.911463e-14
9  Mult(1, Educ, .).Occ3 -0.19358905 0.08174718 -2.368143 1.787760e-02
10 Mult(1, Educ, .).Occ4 -0.05295134 0.05110102 -1.036209 3.001047e-01
11 Mult(1, Educ, .).Occ5  0.85528425         NA        NA           NA</code></pre>
</div>
</div>
</section>
<section id="表2.7b" class="level2" data-number="2.24">
<h2 data-number="2.24" class="anchored" data-anchor-id="表2.7b"><span class="header-section-number">2.24</span> 表2.7B</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>RplusRC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.............................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusRC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Cscore:Educ + Mult(1, Educ, 
    Occ), family = poisson, data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.96462  -0.24301  -0.05231   0.31330   1.21311  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)             7.8043         NA      NA       NA
Educ2                  -2.5496         NA      NA       NA
Educ3                  -1.0924         NA      NA       NA
Educ4                  -3.6305         NA      NA       NA
Occ2                    1.0437         NA      NA       NA
Occ3                   -0.7855         NA      NA       NA
Occ4                    2.0809         NA      NA       NA
Occ5                   -1.8534         NA      NA       NA
Educ1:Cscore           -1.7432         NA      NA       NA
Educ2:Cscore           -0.9182         NA      NA       NA
Educ3:Cscore           -0.5398         NA      NA       NA
Educ4:Cscore            0.0000         NA      NA       NA
Mult(., Educ, Occ).    -0.4213         NA      NA       NA
Mult(1, ., Occ).Educ1  -2.0586         NA      NA       NA
Mult(1, ., Occ).Educ2  -0.7258         NA      NA       NA
Mult(1, ., Occ).Educ3   0.5605         NA      NA       NA
Mult(1, ., Occ).Educ4  -0.2104         NA      NA       NA
Mult(1, Educ, .).Occ1   0.2200         NA      NA       NA
Mult(1, Educ, .).Occ2  -0.9616         NA      NA       NA
Mult(1, Educ, .).Occ3   0.1953         NA      NA       NA
Mult(1, Educ, .).Occ4   0.7768         NA      NA       NA
Mult(1, Educ, .).Occ5   4.8551         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 6.9359 on 4 degrees of freedom
AIC: 155.31

Number of iterations: 29</code></pre>
</div>
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusRC.un, <span class="st">"[:]Cscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Educ1:Cscore Educ2:Cscore Educ3:Cscore Educ4:Cscore 
           9           10           11           12 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>),</span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations........................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusRC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Cscore:Educ + Mult(1, Educ, 
    Occ), constrain = c(9, 12), constrainTo = c(0, 0), family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.96462  -0.24301  -0.05231   0.31330   1.21311  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)             5.0338         NA      NA       NA    
Educ2                  -0.4417         NA      NA       NA    
Educ3                   3.0501         NA      NA       NA    
Educ4                  -0.7074         NA      NA       NA    
Occ2                    0.6767         NA      NA       NA    
Occ3                   -1.1329         NA      NA       NA    
Occ4                    1.6580         NA      NA       NA    
Occ5                   -1.7737         NA      NA       NA    
Educ1:Cscore            0.0000         NA      NA       NA    
Educ2:Cscore           -0.4321     0.2210  -1.955   0.0506 .  
Educ3:Cscore           -1.2670     0.1931  -6.562 5.31e-11 ***
Educ4:Cscore            0.0000         NA      NA       NA    
Mult(., Educ, Occ).    -1.5191         NA      NA       NA    
Mult(1, ., Occ).Educ1   4.6510         NA      NA       NA    
Mult(1, ., Occ).Educ2   0.9307         NA      NA       NA    
Mult(1, ., Occ).Educ3  -2.6602         NA      NA       NA    
Mult(1, ., Occ).Educ4  -0.5081         NA      NA       NA    
Mult(1, Educ, .).Occ1  -0.1724         NA      NA       NA    
Mult(1, Educ, .).Occ2   0.1674         NA      NA       NA    
Mult(1, Educ, .).Occ3   0.2749         NA      NA       NA    
Mult(1, Educ, .).Occ4   0.4395         NA      NA       NA    
Mult(1, Educ, .).Occ5   0.2568         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 6.9359 on 4 degrees of freedom
AIC: 155.31

Number of iterations: 40</code></pre>
</div>
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusRC.un, <span class="st">"[.]Educ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ3 
                   14                    15                    16 
Mult(1, ., Occ).Educ4 
                   17 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusRC.un, <span class="st">"[.]Occ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ3 
                   18                    19                    20 
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ5 
                   21                    22 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(RplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> RplusRC<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        var   estimate number
(Intercept)                     (Intercept)  5.0338134      1
Educ2                                 Educ2 -0.4416984      2
Educ3                                 Educ3  3.0500999      3
Educ4                                 Educ4 -0.7074330      4
Occ2                                   Occ2  0.6766646      5
Occ3                                   Occ3 -1.1329222      6
Occ4                                   Occ4  1.6579720      7
Occ5                                   Occ5 -1.7736652      8
Educ1:Cscore                   Educ1:Cscore         NA      9
Educ2:Cscore                   Educ2:Cscore -0.4320760     10
Educ3:Cscore                   Educ3:Cscore -1.2669500     11
Educ4:Cscore                   Educ4:Cscore         NA     12
Mult(., Educ, Occ).     Mult(., Educ, Occ). -1.5191478     13
Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ1  4.6509709     14
Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ2  0.9307366     15
Mult(1, ., Occ).Educ3 Mult(1, ., Occ).Educ3 -2.6601848     16
Mult(1, ., Occ).Educ4 Mult(1, ., Occ).Educ4 -0.5080538     17
Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ1 -0.1724067     18
Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ2  0.1674123     19
Mult(1, Educ, .).Occ3 Mult(1, Educ, .).Occ3  0.2748827     20
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ4  0.4395333     21
Mult(1, Educ, .).Occ5 Mult(1, Educ, .).Occ5  0.2567545     22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusRC, </span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusRC, <span class="st">"[.]Educ"</span>), </span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusRC, </span>
<span id="cb299-7"><a href="#cb299-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusRC, <span class="st">"[.]Occ"</span>), </span>
<span id="cb299-8"><a href="#cb299-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb299-9"><a href="#cb299-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb299-10"><a href="#cb299-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb299-11"><a href="#cb299-11" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb299-12"><a href="#cb299-12" aria-hidden="true" tabindex="-1"></a>         mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],</span>
<span id="cb299-13"><a href="#cb299-13" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb299-14"><a href="#cb299-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-15"><a href="#cb299-15" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb299-16"><a href="#cb299-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb299-17"><a href="#cb299-17" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb299-18"><a href="#cb299-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb299-19"><a href="#cb299-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">22</span>),</span>
<span id="cb299-20"><a href="#cb299-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb299-21"><a href="#cb299-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb299-22"><a href="#cb299-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb299-23"><a href="#cb299-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.....................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusRC)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Variable    Estimate Std..Error    z.value     Pr...z..
1           Educ1:Cscore  0.00000000         NA         NA           NA
2           Educ2:Cscore -0.43207600  0.2209849 -1.9552282 5.055614e-02
3           Educ3:Cscore -1.26695003  0.1930731 -6.5620238 5.308234e-11
4           Educ4:Cscore  0.00000000         NA         NA           NA
5    Mult(., Educ, Occ). -3.67046405  0.5474332 -6.7048620 2.015968e-11
6  Mult(1, ., Occ).Educ1  0.75983648         NA         NA           NA
7  Mult(1, ., Occ).Educ2  0.06145542  0.1367987  0.4492399 6.532586e-01
8  Mult(1, ., Occ).Educ3 -0.61265036  0.1325427 -4.6222852 3.795357e-06
9  Mult(1, ., Occ).Educ4 -0.20864153         NA         NA           NA
10 Mult(1, Educ, .).Occ1 -0.80614447         NA         NA           NA
11 Mult(1, Educ, .).Occ2 -0.05693272  0.1225191 -0.4646846 6.421573e-01
12 Mult(1, Educ, .).Occ3  0.18001127  0.1630841  1.1037941 2.696825e-01
13 Mult(1, Educ, .).Occ4  0.54302264  0.2004941  2.7084221 6.760398e-03
14 Mult(1, Educ, .).Occ5  0.14004328         NA         NA           NA</code></pre>
</div>
</div>
</section>
<section id="表2.7c" class="level2" data-number="2.25">
<h2 data-number="2.25" class="anchored" data-anchor-id="表2.7c"><span class="header-section-number">2.25</span> 表2.7C</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>CplusRC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb303-7"><a href="#cb303-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
...........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Rscore:Occ + Mult(1, Educ, 
    Occ), family = poisson, data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.98938  -0.14103  -0.01486   0.18280   2.20453  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)            7.27665         NA      NA       NA
Educ2                 -0.42020         NA      NA       NA
Educ3                  2.28710         NA      NA       NA
Educ4                  1.48088         NA      NA       NA
Occ2                  -1.68636         NA      NA       NA
Occ3                  -5.70983         NA      NA       NA
Occ4                  -4.19924         NA      NA       NA
Occ5                  -7.11952         NA      NA       NA
Occ1:Rscore           -1.14020         NA      NA       NA
Occ2:Rscore           -0.42134         NA      NA       NA
Occ3:Rscore            0.12982         NA      NA       NA
Occ4:Rscore            0.40748         NA      NA       NA
Occ5:Rscore            0.00000         NA      NA       NA
Mult(., Educ, Occ).   -3.12869         NA      NA       NA
Mult(1, ., Occ).Educ1  0.69396         NA      NA       NA
Mult(1, ., Occ).Educ2  0.23360         NA      NA       NA
Mult(1, ., Occ).Educ3 -0.35305         NA      NA       NA
Mult(1, ., Occ).Educ4  0.38680         NA      NA       NA
Mult(1, Educ, .).Occ1 -0.04321         NA      NA       NA
Mult(1, Educ, .).Occ2  0.27107         NA      NA       NA
Mult(1, Educ, .).Occ3 -0.03610         NA      NA       NA
Mult(1, Educ, .).Occ4 -0.11942         NA      NA       NA
Mult(1, Educ, .).Occ5 -0.70227         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 11.405 on 3 degrees of freedom
AIC: 161.78

Number of iterations: 68</code></pre>
</div>
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(CplusRC.un, <span class="st">"[:]Rscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Occ1:Rscore Occ2:Rscore Occ3:Rscore Occ4:Rscore Occ5:Rscore 
          9          10          11          12          13 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">13</span>),</span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations..............................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Rscore:Occ + Mult(1, Educ, 
    Occ), constrain = c(9, 13), constrainTo = c(0, 0), family = poisson, 
    data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.98938  -0.14103  -0.01486   0.18280   2.20453  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)            6.20454         NA      NA       NA    
Educ2                 -1.63681         NA      NA       NA    
Educ3                 -0.14388         NA      NA       NA    
Educ4                 -2.18819         NA      NA       NA    
Occ2                  -2.74715         NA      NA       NA    
Occ3                  -5.73384         NA      NA       NA    
Occ4                  -3.94201         NA      NA       NA    
Occ5                  -4.89503         NA      NA       NA    
Occ1:Rscore            0.00000         NA      NA       NA    
Occ2:Rscore            1.26259    0.16970   7.440 1.00e-13 ***
Occ3:Rscore            1.28232    0.20937   6.125 9.08e-10 ***
Occ4:Rscore            1.41583    0.09054  15.638  &lt; 2e-16 ***
Occ5:Rscore            0.00000         NA      NA       NA    
Mult(., Educ, Occ).   -0.17540         NA      NA       NA    
Mult(1, ., Occ).Educ1 -0.72102         NA      NA       NA    
Mult(1, ., Occ).Educ2 -1.11818         NA      NA       NA    
Mult(1, ., Occ).Educ3 -0.97365         NA      NA       NA    
Mult(1, ., Occ).Educ4 -6.51841         NA      NA       NA    
Mult(1, Educ, .).Occ1  0.20351         NA      NA       NA    
Mult(1, Educ, .).Occ2 -1.10357         NA      NA       NA    
Mult(1, Educ, .).Occ3  0.17394         NA      NA       NA    
Mult(1, Educ, .).Occ4  0.52047         NA      NA       NA    
Mult(1, Educ, .).Occ5  2.94447         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 11.405 on 3 degrees of freedom
AIC: 161.78

Number of iterations: 46</code></pre>
</div>
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Variable   Estimate Std..Error   z.value     Pr...z..
1            Occ1:Rscore  0.0000000         NA        NA           NA
2            Occ2:Rscore  1.2625901  0.1696974  7.440245 1.004990e-13
3            Occ3:Rscore  1.2823194  0.2093667  6.124752 9.082487e-10
4            Occ4:Rscore  1.4158283  0.0905404 15.637531 4.040916e-55
5            Occ5:Rscore  0.0000000         NA        NA           NA
6    Mult(., Educ, Occ). -0.1754033         NA        NA           NA
7  Mult(1, ., Occ).Educ1 -0.7210218         NA        NA           NA
8  Mult(1, ., Occ).Educ2 -1.1181754         NA        NA           NA
9  Mult(1, ., Occ).Educ3 -0.9736536         NA        NA           NA
10 Mult(1, ., Occ).Educ4 -6.5184053         NA        NA           NA
11 Mult(1, Educ, .).Occ1  0.2035117         NA        NA           NA
12 Mult(1, Educ, .).Occ2 -1.1035705         NA        NA           NA
13 Mult(1, Educ, .).Occ3  0.1739351         NA        NA           NA
14 Mult(1, Educ, .).Occ4  0.5204683         NA        NA           NA
15 Mult(1, Educ, .).Occ5  2.9444684         NA        NA           NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(CplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> CplusRC<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        var   estimate number
(Intercept)                     (Intercept)  6.2045374      1
Educ2                                 Educ2 -1.6368135      2
Educ3                                 Educ3 -0.1438756      3
Educ4                                 Educ4 -2.1881854      4
Occ2                                   Occ2 -2.7471517      5
Occ3                                   Occ3 -5.7338368      6
Occ4                                   Occ4 -3.9420090      7
Occ5                                   Occ5 -4.8950260      8
Occ1:Rscore                     Occ1:Rscore         NA      9
Occ2:Rscore                     Occ2:Rscore  1.2625901     10
Occ3:Rscore                     Occ3:Rscore  1.2823194     11
Occ4:Rscore                     Occ4:Rscore  1.4158283     12
Occ5:Rscore                     Occ5:Rscore         NA     13
Mult(., Educ, Occ).     Mult(., Educ, Occ). -0.1754033     14
Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ1 -0.7210218     15
Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ2 -1.1181754     16
Mult(1, ., Occ).Educ3 Mult(1, ., Occ).Educ3 -0.9736536     17
Mult(1, ., Occ).Educ4 Mult(1, ., Occ).Educ4 -6.5184053     18
Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ1  0.2035117     19
Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ2 -1.1035705     20
Mult(1, Educ, .).Occ3 Mult(1, Educ, .).Occ3  0.1739351     21
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ4  0.5204683     22
Mult(1, Educ, .).Occ5 Mult(1, Educ, .).Occ5  2.9444684     23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(CplusRC, </span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(CplusRC, <span class="st">"[.]Educ"</span>),</span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(CplusRC, </span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(CplusRC, <span class="st">"[.]Occ"</span>),</span>
<span id="cb317-8"><a href="#cb317-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb317-9"><a href="#cb317-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb317-10"><a href="#cb317-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb317-11"><a href="#cb317-11" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb317-12"><a href="#cb317-12" aria-hidden="true" tabindex="-1"></a>         mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],</span>
<span id="cb317-13"><a href="#cb317-13" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb317-14"><a href="#cb317-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-15"><a href="#cb317-15" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb317-16"><a href="#cb317-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb317-17"><a href="#cb317-17" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb317-18"><a href="#cb317-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb317-19"><a href="#cb317-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">13</span>,<span class="dv">15</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">23</span>),</span>
<span id="cb317-20"><a href="#cb317-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb317-21"><a href="#cb317-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb317-22"><a href="#cb317-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb317-23"><a href="#cb317-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
...........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Variable     Estimate Std..Error   z.value     Pr...z..
1            Occ1:Rscore  0.000000000         NA        NA           NA
2            Occ2:Rscore  1.262590058 0.16969738  7.440245 1.004990e-13
3            Occ3:Rscore  1.282319390 0.20936674  6.124752 9.082487e-10
4            Occ4:Rscore  1.415828283 0.09054040 15.637531 4.040916e-55
5            Occ5:Rscore  0.000000000         NA        NA           NA
6    Mult(., Educ, Occ). -2.509132039 0.47337666 -5.300498 1.154873e-07
7  Mult(1, ., Occ).Educ1  0.332914652         NA        NA           NA
8  Mult(1, ., Occ).Educ2  0.250882838 0.17043562  1.472009 1.410183e-01
9  Mult(1, ., Occ).Educ3  0.280733721 0.25875316  1.084948 2.779447e-01
10 Mult(1, ., Occ).Educ4 -0.864531211         NA        NA           NA
11 Mult(1, Educ, .).Occ1 -0.116510615         NA        NA           NA
12 Mult(1, Educ, .).Occ2 -0.558888360 0.15090381 -3.703607 2.125557e-04
13 Mult(1, Educ, .).Occ3 -0.126520705 0.12280113 -1.030289 3.028742e-01
14 Mult(1, Educ, .).Occ4 -0.009237675 0.06533009 -0.141400 8.875539e-01
15 Mult(1, Educ, .).Occ5  0.811157355         NA        NA           NA</code></pre>
</div>
</div>
</section>
<section id="表2.7d" class="level2" data-number="2.26">
<h2 data-number="2.26" class="anchored" data-anchor-id="表2.7d"><span class="header-section-number">2.26</span> 表2.7D</h2>
<p>まずは行効果と列効果のパラメータに対して0という制約を課し，その上で推定した行スコアと列スコアを正規化し，再度推定する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>RplusCplusRC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCplusRC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Cscore:Educ + Rscore:Occ + 
    Mult(1, Educ, Occ), family = poisson, data = ., tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.46856  -0.01129  -0.00160   0.02313   0.20690  

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)             7.74293         NA      NA       NA
Educ2                   3.14029         NA      NA       NA
Educ3                  10.24787         NA      NA       NA
Educ4                  12.41837         NA      NA       NA
Occ2                   -5.57138         NA      NA       NA
Occ3                  -12.20149         NA      NA       NA
Occ4                  -13.84551         NA      NA       NA
Occ5                  -18.60224         NA      NA       NA
Educ1:Cscore            2.41445         NA      NA       NA
Educ2:Cscore            1.71183         NA      NA       NA
Educ3:Cscore            0.57802         NA      NA       NA
Educ4:Cscore            0.00000         NA      NA       NA
Occ1:Rscore            -4.06530         NA      NA       NA
Occ2:Rscore            -2.30050         NA      NA       NA
Occ3:Rscore            -1.09826         NA      NA       NA
Occ4:Rscore             0.00000         NA      NA       NA
Occ5:Rscore             0.00000         NA      NA       NA
Mult(., Educ, Occ).    -5.48724         NA      NA       NA
Mult(1, ., Occ).Educ1  -0.10945         NA      NA       NA
Mult(1, ., Occ).Educ2   0.04996         NA      NA       NA
Mult(1, ., Occ).Educ3   0.17934         NA      NA       NA
Mult(1, ., Occ).Educ4  -0.25103         NA      NA       NA
Mult(1, Educ, .).Occ1   0.26319         NA      NA       NA
Mult(1, Educ, .).Occ2  -0.24080         NA      NA       NA
Mult(1, Educ, .).Occ3   0.03257         NA      NA       NA
Mult(1, Educ, .).Occ4   0.01140         NA      NA       NA
Mult(1, Educ, .).Occ5   0.67203         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 0.27843 on 2 degrees of freedom
AIC: 152.66

Number of iterations: 16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCplusRC.un, <span class="st">"[:]Cscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Educ1:Cscore Educ2:Cscore Educ3:Cscore Educ4:Cscore 
           9           10           11           12 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCplusRC.un, <span class="st">"[:]Rscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Occ1:Rscore Occ2:Rscore Occ3:Rscore Occ4:Rscore Occ5:Rscore 
         13          14          15          16          17 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">17</span>), </span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb329-8"><a href="#cb329-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb329-9"><a href="#cb329-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb329-10"><a href="#cb329-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.............................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(CplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> CplusRC<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        var     estimate number
(Intercept)                     (Intercept)  6.132951036      1
Educ2                                 Educ2 -1.598655285      2
Educ3                                 Educ3 -0.119602932      3
Educ4                                 Educ4 -1.631176445      4
Occ2                                   Occ2 -3.281987830      5
Occ3                                   Occ3 -5.745938986      6
Occ4                                   Occ4 -3.812315688      7
Occ5                                   Occ5 -3.773472310      8
Occ1:Rscore                     Occ1:Rscore           NA      9
Occ2:Rscore                     Occ2:Rscore  1.262590058     10
Occ3:Rscore                     Occ3:Rscore  1.282319390     11
Occ4:Rscore                     Occ4:Rscore  1.415828283     12
Occ5:Rscore                     Occ5:Rscore           NA     13
Mult(., Educ, Occ).     Mult(., Educ, Occ). -2.509132039     14
Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ1           NA     15
Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ2  0.250882838     16
Mult(1, ., Occ).Educ3 Mult(1, ., Occ).Educ3  0.280733721     17
Mult(1, ., Occ).Educ4 Mult(1, ., Occ).Educ4           NA     18
Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ1           NA     19
Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ2 -0.558888360     20
Mult(1, Educ, .).Occ3 Mult(1, Educ, .).Occ3 -0.126520705     21
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ4 -0.009237675     22
Mult(1, Educ, .).Occ5 Mult(1, Educ, .).Occ5           NA     23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusCplusRC, </span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusCplusRC, <span class="st">"[.]Educ"</span>), </span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusCplusRC,</span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusCplusRC, <span class="st">"[.]Occ"</span>), </span>
<span id="cb333-8"><a href="#cb333-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb333-9"><a href="#cb333-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb333-10"><a href="#cb333-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb333-11"><a href="#cb333-11" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb333-12"><a href="#cb333-12" aria-hidden="true" tabindex="-1"></a>         mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],</span>
<span id="cb333-13"><a href="#cb333-13" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb333-14"><a href="#cb333-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-15"><a href="#cb333-15" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb333-16"><a href="#cb333-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb333-17"><a href="#cb333-17" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb333-18"><a href="#cb333-18" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb333-19"><a href="#cb333-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb333-20"><a href="#cb333-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">19</span>,<span class="dv">22</span>,<span class="dv">23</span>,<span class="dv">27</span>), </span>
<span id="cb333-21"><a href="#cb333-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb333-22"><a href="#cb333-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb333-23"><a href="#cb333-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ., </span>
<span id="cb333-24"><a href="#cb333-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.......................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>mu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Estimate Std. Error
Mult(1, ., Occ).Educ1  0.76639941 0.03714637
Mult(1, ., Occ).Educ2  0.05505913 0.08952794
Mult(1, ., Occ).Educ3 -0.60073372 0.04744381
Mult(1, ., Occ).Educ4 -0.22072481 0.06764890</code></pre>
</div>
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>nu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Estimate Std. Error
Mult(1, Educ, .).Occ1  0.83832072 0.02535129
Mult(1, Educ, .).Occ2 -0.04397713 0.08855421
Mult(1, Educ, .).Occ3 -0.11946443 0.09158773
Mult(1, Educ, .).Occ4 -0.50065982 0.06550415
Mult(1, Educ, .).Occ5 -0.17421935 0.12622465</code></pre>
</div>
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCplusRC)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span></span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb339-4"><a href="#cb339-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Variable    Estimate Std..Error    z.value     Pr...z..
1           Educ1:Cscore  0.00000000         NA         NA           NA
2           Educ2:Cscore -0.29016794  0.1835938 -1.5804884 1.139951e-01
3           Educ3:Cscore -0.95452353  0.2168230 -4.4023158 1.071015e-05
4           Educ4:Cscore  0.00000000         NA         NA           NA
5            Occ1:Rscore  0.00000000         NA         NA           NA
6            Occ2:Rscore  0.00000000         NA         NA           NA
7            Occ3:Rscore  0.39725281  0.1673266  2.3741161 1.759102e-02
8            Occ4:Rscore  0.32684292  0.1614939  2.0238715 4.298337e-02
9            Occ5:Rscore  0.00000000         NA         NA           NA
10   Mult(., Educ, Occ).  2.85715993  0.5343817  5.3466654 8.958940e-08
11 Mult(1, ., Occ).Educ1  0.76639941         NA         NA           NA
12 Mult(1, ., Occ).Educ2  0.05505913  0.1291228  0.4264091 6.698098e-01
13 Mult(1, ., Occ).Educ3 -0.60073372  0.1297703 -4.6292078 3.670672e-06
14 Mult(1, ., Occ).Educ4 -0.22072481         NA         NA           NA
15 Mult(1, Educ, .).Occ1  0.83832072         NA         NA           NA
16 Mult(1, Educ, .).Occ2 -0.04397713  0.1677272 -0.2621944 7.931715e-01
17 Mult(1, Educ, .).Occ3 -0.11946443  0.1842187 -0.6484923 5.166666e-01
18 Mult(1, Educ, .).Occ4 -0.50065982  0.2149854 -2.3288081 1.986923e-02
19 Mult(1, Educ, .).Occ5 -0.17421935         NA         NA           NA</code></pre>
</div>
</div>
</section>
<section id="表2.7e" class="level2" data-number="2.27">
<h2 data-number="2.27" class="anchored" data-anchor-id="表2.7e"><span class="header-section-number">2.27</span> 表2.7E</h2>
<p>Wongのサポートページにあるように，<code>gnm</code>を用いてRC(2)の係数を推定することは難しい．ここではKateri, Maria. 2014. {¥it Contingency Table Analysis: Methods and Implementation Using R}. New York: Birkhäuser. のsupportページにあるプログラムを使用して係数を求める．</p>
<p><span class="math inline">\(M &gt; 1\)</span>のRC(M)を推定するためには<code>gnm</code>の<code>instances</code>を用いる． 今は<code>instances = 2</code>としており，RC(2)を用いている． なお，式(2.35)のように<span class="math inline">\(\phi\)</span>は推定されない． これらスコアは求まるものの，直交という次元間制約が課されてない． そこで，特異値分解（SVD: singular value decomposition）によって行スコアと列スコアのそれぞれが次元間で直行するような変換を行う．</p>
<p>まず次元間制約が課されてない行スコアの行列（<span class="math inline">\(I\times m\)</span>）と列スコアの行列（<span class="math inline">\(J\times m\)</span>）の積を求め，モデル化での2元交互作用パラメータを求める．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">instances</span>(<span class="fu">Mult</span>(Educ, Occ), <span class="at">instances =</span> <span class="dv">2</span>),</span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, <span class="at">data =</span> ., </span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations......................................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + instances(Mult(Educ, Occ), 
    instances = 2), family = poisson, data = ., tolerance = 1e-12)

Deviance Residuals: 
      Min         1Q     Median         3Q        Max  
-0.631356  -0.030234  -0.004363   0.050323   0.320666  

Coefficients:
                             Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                   5.08405         NA      NA       NA
Educ2                        -0.88326         NA      NA       NA
Educ3                         1.08707         NA      NA       NA
Educ4                         0.33875         NA      NA       NA
Occ2                          0.40057         NA      NA       NA
Occ3                         -2.18119         NA      NA       NA
Occ4                          0.06672         NA      NA       NA
Occ5                         -4.15751         NA      NA       NA
Mult(., Occ, inst = 1).Educ1 -3.75327         NA      NA       NA
Mult(., Occ, inst = 1).Educ2 -0.37421         NA      NA       NA
Mult(., Occ, inst = 1).Educ3 -0.12043         NA      NA       NA
Mult(., Occ, inst = 1).Educ4  5.50294         NA      NA       NA
Mult(Educ, ., inst = 1).Occ1 -0.23246         NA      NA       NA
Mult(Educ, ., inst = 1).Occ2 -0.05608         NA      NA       NA
Mult(Educ, ., inst = 1).Occ3  0.12089         NA      NA       NA
Mult(Educ, ., inst = 1).Occ4  0.21134         NA      NA       NA
Mult(Educ, ., inst = 1).Occ5  0.13393         NA      NA       NA
Mult(., Occ, inst = 2).Educ1 -1.38606         NA      NA       NA
Mult(., Occ, inst = 2).Educ2 -0.52797         NA      NA       NA
Mult(., Occ, inst = 2).Educ3  0.40562         NA      NA       NA
Mult(., Occ, inst = 2).Educ4 -0.55732         NA      NA       NA
Mult(Educ, ., inst = 2).Occ1 -0.21148         NA      NA       NA
Mult(Educ, ., inst = 2).Occ2  0.82021         NA      NA       NA
Mult(Educ, ., inst = 2).Occ3  0.54578         NA      NA       NA
Mult(Educ, ., inst = 2).Occ4  0.57577         NA      NA       NA
Mult(Educ, ., inst = 2).Occ5 -0.87947         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 0.6001 on 2 degrees of freedom
AIC: 152.98

Number of iterations: 54</code></pre>
</div>
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>RCmodel_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(RCmodel, row, col, m, data){</span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>  NI <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>xlevels[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a>  NJ <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>xlevels[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a>  iflag <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">length</span>(RCmodel<span class="sc">$</span>y)</span>
<span id="cb345-6"><a href="#cb345-6" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">gl</span>(NI,NJ,<span class="at">length =</span> y)</span>
<span id="cb345-7"><a href="#cb345-7" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">gl</span>(NJ,<span class="dv">1</span>,<span class="at">length =</span> y)</span>
<span id="cb345-8"><a href="#cb345-8" aria-hidden="true" tabindex="-1"></a>  IX <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(RCmodel, </span>
<span id="cb345-9"><a href="#cb345-9" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">"[.]"</span>,<span class="fu">deparse</span>(<span class="fu">substitute</span>(row))))</span>
<span id="cb345-10"><a href="#cb345-10" aria-hidden="true" tabindex="-1"></a>  IY <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(RCmodel,</span>
<span id="cb345-11"><a href="#cb345-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">"[.]"</span>,<span class="fu">deparse</span>(<span class="fu">substitute</span>(col))))</span>
<span id="cb345-12"><a href="#cb345-12" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>coefficients[IX]</span>
<span id="cb345-13"><a href="#cb345-13" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>coefficients[IY]</span>
<span id="cb345-14"><a href="#cb345-14" aria-hidden="true" tabindex="-1"></a>  mu0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(X,<span class="at">nrow =</span> NI,<span class="at">ncol =</span> m)</span>
<span id="cb345-15"><a href="#cb345-15" aria-hidden="true" tabindex="-1"></a>  nu0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Y,<span class="at">nrow =</span> NJ,<span class="at">ncol =</span> m)</span>
<span id="cb345-16"><a href="#cb345-16" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> mu0</span>
<span id="cb345-17"><a href="#cb345-17" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> nu0</span>
<span id="cb345-18"><a href="#cb345-18" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> mu <span class="sc">%*%</span> <span class="fu">t</span>(nu) <span class="co"># [NI, M] [M. NJ]</span></span>
<span id="cb345-19"><a href="#cb345-19" aria-hidden="true" tabindex="-1"></a>  R1 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>,NI)</span>
<span id="cb345-20"><a href="#cb345-20" aria-hidden="true" tabindex="-1"></a>  C1 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>,NJ)</span>
<span id="cb345-21"><a href="#cb345-21" aria-hidden="true" tabindex="-1"></a>  Rone <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NI<span class="sc">^</span><span class="dv">2</span>),<span class="at">nrow =</span> NI)</span>
<span id="cb345-22"><a href="#cb345-22" aria-hidden="true" tabindex="-1"></a>  Cone <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NJ<span class="sc">^</span><span class="dv">2</span>),<span class="at">nrow =</span> NJ)</span>
<span id="cb345-23"><a href="#cb345-23" aria-hidden="true" tabindex="-1"></a>  rowP <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NI))</span>
<span id="cb345-24"><a href="#cb345-24" aria-hidden="true" tabindex="-1"></a>  colP <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NJ));</span>
<span id="cb345-25"><a href="#cb345-25" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> RC2<span class="sc">$</span>model</span>
<span id="cb345-26"><a href="#cb345-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(y,X,Y,IX,IY,data)</span>
<span id="cb345-27"><a href="#cb345-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (iflag <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb345-28"><a href="#cb345-28" aria-hidden="true" tabindex="-1"></a>    rowP <span class="ot">&lt;-</span> <span class="fu">with</span>(data, <span class="fu">tapply</span>(freq,row,sum)<span class="sc">/</span><span class="fu">sum</span>(freq))</span>
<span id="cb345-29"><a href="#cb345-29" aria-hidden="true" tabindex="-1"></a>    colP <span class="ot">&lt;-</span> <span class="fu">with</span>(data, <span class="fu">tapply</span>(freq,col,sum)<span class="sc">/</span><span class="fu">sum</span>(freq))}</span>
<span id="cb345-30"><a href="#cb345-30" aria-hidden="true" tabindex="-1"></a>  DR <span class="ot">&lt;-</span> <span class="fu">diag</span>(rowP<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NI)</span>
<span id="cb345-31"><a href="#cb345-31" aria-hidden="true" tabindex="-1"></a>  DC <span class="ot">&lt;-</span> <span class="fu">diag</span>(colP<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NJ)</span>
<span id="cb345-32"><a href="#cb345-32" aria-hidden="true" tabindex="-1"></a>  RWsqr <span class="ot">&lt;-</span> <span class="fu">diag</span>(rowP<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NI)</span>
<span id="cb345-33"><a href="#cb345-33" aria-hidden="true" tabindex="-1"></a>  CWsqr <span class="ot">&lt;-</span> <span class="fu">diag</span>(colP<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NJ)</span>
<span id="cb345-34"><a href="#cb345-34" aria-hidden="true" tabindex="-1"></a>  RW <span class="ot">&lt;-</span> RWsqr<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb345-35"><a href="#cb345-35" aria-hidden="true" tabindex="-1"></a>  CW <span class="ot">&lt;-</span> CWsqr<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb345-36"><a href="#cb345-36" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> (R1 <span class="sc">-</span> (Rone <span class="sc">%*%</span> RW)<span class="sc">/</span><span class="fu">sum</span>(RW)) <span class="sc">%*%</span> A <span class="sc">%*%</span> <span class="fu">t</span>(C1 <span class="sc">-</span> (Cone <span class="sc">%*%</span> CW)<span class="sc">/</span><span class="fu">sum</span>(CW))</span>
<span id="cb345-37"><a href="#cb345-37" aria-hidden="true" tabindex="-1"></a>  phiv <span class="ot">&lt;-</span> <span class="fu">svd</span>(RWsqr <span class="sc">%*%</span> L <span class="sc">%*%</span> CWsqr)<span class="sc">$</span>d[<span class="dv">1</span><span class="sc">:</span>m]</span>
<span id="cb345-38"><a href="#cb345-38" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">svd</span>(RWsqr <span class="sc">%*%</span> L <span class="sc">%*%</span> CWsqr)<span class="sc">$</span>u[,<span class="dv">1</span><span class="sc">:</span>m]</span>
<span id="cb345-39"><a href="#cb345-39" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> <span class="fu">svd</span>(RWsqr <span class="sc">%*%</span> L <span class="sc">%*%</span> CWsqr)<span class="sc">$</span>v[,<span class="dv">1</span><span class="sc">:</span>m]</span>
<span id="cb345-40"><a href="#cb345-40" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> DR <span class="sc">%*%</span> mu</span>
<span id="cb345-41"><a href="#cb345-41" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> DC <span class="sc">%*%</span> nu</span>
<span id="cb345-42"><a href="#cb345-42" aria-hidden="true" tabindex="-1"></a>  phi <span class="ot">&lt;-</span> <span class="fu">diag</span>(phiv, m)</span>
<span id="cb345-43"><a href="#cb345-43" aria-hidden="true" tabindex="-1"></a>  L2 <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>deviance</span>
<span id="cb345-44"><a href="#cb345-44" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>df.residual</span>
<span id="cb345-45"><a href="#cb345-45" aria-hidden="true" tabindex="-1"></a>  p.value <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(L2,df)</span>
<span id="cb345-46"><a href="#cb345-46" aria-hidden="true" tabindex="-1"></a>  fit.freq <span class="ot">&lt;-</span> <span class="fu">predict</span>(RCmodel, </span>
<span id="cb345-47"><a href="#cb345-47" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="st">"response"</span>, </span>
<span id="cb345-48"><a href="#cb345-48" aria-hidden="true" tabindex="-1"></a>                      <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb345-49"><a href="#cb345-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb345-50"><a href="#cb345-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">list</span>(<span class="at">model =</span> RCmodel, </span>
<span id="cb345-51"><a href="#cb345-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">L2 =</span> L2, </span>
<span id="cb345-52"><a href="#cb345-52" aria-hidden="true" tabindex="-1"></a>     <span class="at">df =</span> df,</span>
<span id="cb345-53"><a href="#cb345-53" aria-hidden="true" tabindex="-1"></a>     <span class="at">p.value =</span> p.value,</span>
<span id="cb345-54"><a href="#cb345-54" aria-hidden="true" tabindex="-1"></a>     <span class="at">obs_freq =</span> <span class="fu">summary</span>(RC2)<span class="sc">$</span>y, </span>
<span id="cb345-55"><a href="#cb345-55" aria-hidden="true" tabindex="-1"></a>     <span class="at">fit.freq =</span> fit.freq,</span>
<span id="cb345-56"><a href="#cb345-56" aria-hidden="true" tabindex="-1"></a>     <span class="at">phi =</span> phi, </span>
<span id="cb345-57"><a href="#cb345-57" aria-hidden="true" tabindex="-1"></a>     <span class="at">mu =</span> mu, </span>
<span id="cb345-58"><a href="#cb345-58" aria-hidden="true" tabindex="-1"></a>     <span class="at">nu =</span> nu,</span>
<span id="cb345-59"><a href="#cb345-59" aria-hidden="true" tabindex="-1"></a>     <span class="fu">cor</span>(mu) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>),</span>
<span id="cb345-60"><a href="#cb345-60" aria-hidden="true" tabindex="-1"></a>     <span class="fu">cor</span>(nu) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)))</span>
<span id="cb345-61"><a href="#cb345-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb345-62"><a href="#cb345-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-63"><a href="#cb345-63" aria-hidden="true" tabindex="-1"></a><span class="fu">RCmodel_coef</span>(RC2, <span class="at">row =</span> Educ, <span class="at">col =</span> Occ, <span class="at">m =</span>  <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$model

Call:
gnm(formula = Freq ~ Educ + Occ + instances(Mult(Educ, Occ), 
    instances = 2), family = poisson, data = ., tolerance = 1e-12)

Coefficients:
                 (Intercept)                         Educ2  
                     5.08405                      -0.88326  
                       Educ3                         Educ4  
                     1.08707                       0.33875  
                        Occ2                          Occ3  
                     0.40057                      -2.18119  
                        Occ4                          Occ5  
                     0.06672                      -4.15751  
Mult(., Occ, inst = 1).Educ1  Mult(., Occ, inst = 1).Educ2  
                    -3.75327                      -0.37421  
Mult(., Occ, inst = 1).Educ3  Mult(., Occ, inst = 1).Educ4  
                    -0.12043                       5.50294  
Mult(Educ, ., inst = 1).Occ1  Mult(Educ, ., inst = 1).Occ2  
                    -0.23246                      -0.05608  
Mult(Educ, ., inst = 1).Occ3  Mult(Educ, ., inst = 1).Occ4  
                     0.12089                       0.21134  
Mult(Educ, ., inst = 1).Occ5  Mult(., Occ, inst = 2).Educ1  
                     0.13393                      -1.38606  
Mult(., Occ, inst = 2).Educ2  Mult(., Occ, inst = 2).Educ3  
                    -0.52797                       0.40562  
Mult(., Occ, inst = 2).Educ4  Mult(Educ, ., inst = 2).Occ1  
                    -0.55732                      -0.21148  
Mult(Educ, ., inst = 2).Occ2  Mult(Educ, ., inst = 2).Occ3  
                     0.82021                       0.54578  
Mult(Educ, ., inst = 2).Occ4  Mult(Educ, ., inst = 2).Occ5  
                     0.57577                      -0.87947  

Deviance:            0.6001022 
Pearson chi-squared: 0.5746549 
Residual df:         2 

$L2
[1] 0.6001022

$df
[1] 2

$p.value
[1] 0.7407804

$obs_freq
NULL

$fit.freq
$fit.freq$fit
          1           2           3           4           5           6 
 517.836063   95.414391    5.433736   35.145848    5.169961   81.405000 
          7           8           9          10          11          12 
  65.976261    5.398934   48.639687    1.580117  451.846566 1003.387842 
         13          14          15          16          17          18 
  66.470016  630.136504    5.159072   70.912370  157.221505   36.697314 
         19          20 
 562.077961   12.090850 

$fit.freq$se.fit
        1         2         3         4         5         6         7         8 
22.748933  9.732333  2.174395  5.860792  2.230227  8.912865  7.856714  1.044826 
        9        10        11        12        13        14        15        16 
 6.616317  0.619348 21.250045 31.666672  8.114913 25.088611  2.233235  8.415482 
       17        18        19        20 
12.530867  6.041164 23.703381  3.469126 

$fit.freq$residual.scale
[1] 1


$phi
         [,1]     [,2]
[1,] 2.600861 0.000000
[2,] 0.000000 1.521971

$mu
            [,1]        [,2]
[1,]  0.74345129  0.27619989
[2,]  0.08846472 -0.06103682
[3,] -0.19984223 -0.77722344
[4,] -0.63207378  0.56206037

$nu
            [,1]         [,2]
[1,]  0.76509960 -0.137064850
[2,]  0.01966104 -0.548959995
[3,] -0.32245067 -0.119769392
[4,] -0.55005650 -0.009934123
[5,]  0.08774653  0.815728360

[[10]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

[[11]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1</code></pre>
</div>
</div>
<p><code>logmult</code>パッケージの<code>rc</code>によってRC(2)を推定する．まずは<code>anoas</code>で連関分析を行う．表2.6Aと同じ結果になっていることを確認する．正規化だけではなく，次元間制約が課されており，表2.7の結果と一致する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anoas</span>(tab_2<span class="fl">.3</span>B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting independence model...
Fitting model with 1 dimension...
Initialising
Running start-up iterations..
Running main iterations......................................................
Done
Fitting model with 2 dimensions...
Initialising
Running start-up iterations..
Running main iterations........
Done
Fitting model with 3 dimensions...
Initialising
Running start-up iterations..
Running main iterations....
Done</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       Res. Df           Res. Dev    Dev./Indep. (%)  Dissim. (%)
Indep.      12 1373.1757656522454 100.00000000000000 23.861575295
RC(1)        6  125.0597485501468   9.10733728910112  6.436039098
RC(2)        2    0.6001022352681   0.04370177877288  0.093516580
RC(3)        0    0.0000000000002   0.00000000000002  0.000000004
                      BIC                AIC    Dev. Df
Indep. 1274.0809153306573 1349.1757656522454      NA NA
RC(1)    75.5123233893527  113.0597485501468 -1248.1 -6
RC(2)   -15.9157061516632   -3.3998977647319  -124.5 -4
RC(3)     0.0000000000002    0.0000000000002    -0.6 -2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab_2<span class="fl">.3</span>B, </span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">nd =</span> <span class="dv">2</span>, </span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weighting =</span> <span class="st">"none"</span>, </span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">se =</span> <span class="st">"bootstrap"</span>,</span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">nreplicates =</span> <span class="dv">1000</span>, </span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncpus =</span> <span class="fu">getOption</span>(<span class="st">"boot.ncpus"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.......
Done
Computing bootstrap standard errors...
.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in jackboot(se, ncpus, nreplicates, tab, model, assoc1 =
getS3method("assoc", : One model replicate failed and its results will be
skipped. Standard errors will not be completely accurate. Consider raising the
value of iterMax.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="sc">%&gt;%</span> </span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%$%</span> </span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a>  coefficients <span class="sc">%&gt;%</span></span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"Parameter"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Parameter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Parameter   Normalized    Adjusted Std..error      Pr...z..
1           Dim1  2.600861491          NA 1.89405291  1.696987e-01
2  Dim1:ColumnsA  0.765099600  1.23389040 0.04721223  4.608229e-59
3  Dim1:ColumnsB  0.019661041  0.03170773 0.04225439  6.417154e-01
4  Dim1:ColumnsC -0.322450671 -0.52002222 0.10273412  1.697042e-03
5  Dim1:ColumnsD -0.550056503 -0.88708639 0.07376957  8.890839e-14
6  Dim1:ColumnsE  0.087746534  0.14151047 0.10128541  3.863095e-01
7     Dim1:RowsA  0.743451285  1.19897776 0.01923574  0.000000e+00
8     Dim1:RowsB  0.088464723  0.14266871 0.04049269  2.891024e-02
9     Dim1:RowsC -0.199842228 -0.32228929 0.02871223  3.398435e-12
10    Dim1:RowsD -0.632073780 -1.01935718 0.02557586 7.623099e-135
11          Dim2  1.521970931          NA 4.42944364  7.311447e-01
12 Dim2:ColumnsA -0.137064849 -0.16909442 0.05000284  6.122613e-03
13 Dim2:ColumnsB -0.548959996 -0.67724199 0.08516177  1.147764e-10
14 Dim2:ColumnsC -0.119769391 -0.14775733 0.09574083  2.109436e-01
15 Dim2:ColumnsD -0.009934124 -0.01225555 0.07118509  8.890128e-01
16 Dim2:ColumnsE  0.815728359  1.00634928 0.05755149  1.329316e-45
17    Dim2:RowsA  0.276199889  0.34074279 0.09626414  4.115274e-03
18    Dim2:RowsB -0.061036818 -0.07530002 0.15411363  6.920676e-01
19    Dim2:RowsC -0.777223438 -0.95884646 0.06957607  5.664024e-29
20    Dim2:RowsD  0.562060367  0.69340368 0.06667337  3.454936e-17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="co"># getS3method("assoc","rc")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./2-Chapter_1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">第1章</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./4-Chapter_3.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">第3章</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>