<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>『カテゴリカルデータのための連関モデル』 - シリーズ編者による内容紹介</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./2-Chapter_1.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">シリーズ編者による内容紹介</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">『カテゴリカルデータのための連関モデル』</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">はじめに</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-Introduction.html" class="sidebar-item-text sidebar-link active">シリーズ編者による内容紹介</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-Chapter_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">第1章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-Chapter_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">第2章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4-Chapter_3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">第3章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5-Chapter_4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">第4章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6-Chapter_5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">第5章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7-Chapter_6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">第6章</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8-Note.html" class="sidebar-item-text sidebar-link">補足のノート</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9-R.html" class="sidebar-item-text sidebar-link">RとRStudioのインストールと基本的な操作方法</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#独立性の検定" id="toc-独立性の検定" class="nav-link active" data-scroll-target="#独立性の検定">独立性の検定</a></li>
  <li><a href="#一様連関モデル" id="toc-一様連関モデル" class="nav-link" data-scroll-target="#一様連関モデル">一様連関モデル</a></li>
  <li><a href="#度数行変数列変数のデータからクロス表を作成" id="toc-度数行変数列変数のデータからクロス表を作成" class="nav-link" data-scroll-target="#度数行変数列変数のデータからクロス表を作成">度数，行変数，列変数のデータからクロス表を作成</a></li>
  <li><a href="#個票データから集計データを作成" id="toc-個票データから集計データを作成" class="nav-link" data-scroll-target="#個票データから集計データを作成">個票データから集計データを作成</a></li>
  <li><a href="#集計データを個票データに変換" id="toc-集計データを個票データに変換" class="nav-link" data-scroll-target="#集計データを個票データに変換">集計データを個票データに変換</a></li>
  <li><a href="#元クロス分類表の入力" id="toc-元クロス分類表の入力" class="nav-link" data-scroll-target="#元クロス分類表の入力">3元クロス分類表の入力</a></li>
  <li><a href="#練習問題" id="toc-練習問題" class="nav-link" data-scroll-target="#練習問題">練習問題</a></li>
  <li><a href="#参考文献" id="toc-参考文献" class="nav-link" data-scroll-target="#参考文献">参考文献</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">シリーズ編者による内容紹介</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>「シリーズ編者による内容紹介」の分析は短いが，Rによるカテゴリカルデータ分析の方法の基礎を身につける上ではよい例である．少し長くなるが，基本的な操作方法の説明やクロス表の分析方法について説明したい．</p>
<p>パッケージは<code>tidyverse</code>（データセットの処理のため），<code>DescTools</code>（記述統計を求めるため），<code>vcd</code>パッケージ（カテゴリカルデータの分析のため），<code>gnm</code>（連関分析の処理のため）を使用する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># パッケージの読み込み</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="独立性の検定" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="独立性の検定">独立性の検定</h3>
<p>使用するデータは精神的健康と親の社会経済的地位（SES）に関するミッドタウン・マンハッタンデータ（the Midtown Manhattan data）である．元データについて，ここではクロス表（のようにみえる）形式で入力する．これを<code>Freq</code>とする．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 元データの入力（xページ）</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>,  <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>,  <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>           <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>           <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>           <span class="dv">21</span>,  <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>実際は横に長い一行のベクトルとなる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Freq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  64  94  58  46  57  94  54  40  57 105  65  60  72 141  77  94  36  97  54
[20]  78  21  71  54  71</code></pre>
</div>
</div>
<p>このベクトルを<code>matrix</code>関数を用いて，行列に変換する．これを<code>tab</code>とする（名前は何でもよい）．<code>nrow</code>は行カテゴリ数，<code>ncol</code>は列カテゴリ数である．<code>byrow = TRUE</code>を忘れないように注意すること．また<code>dimnames</code>で行と列のそれぞれの変数名とカテゴリ名を指定することも可能である．この指定は特に無くてもよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  Freq,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">6</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">SES =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">MHS =</span> <span class="fu">c</span>(<span class="st">"well"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mild"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"modelrate"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"impared"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これで表を再現することができた．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES well mild modelrate impared
  A   64   94        58      46
  B   57   94        54      40
  C   57  105        65      60
  D   72  141        77      94
  E   36   97        54      78
  F   21   71        54      71</code></pre>
</div>
</div>
<p>初歩的なクロス表の分析はここで作成された<code>tab</code>に対して行う． <code>as.table</code>によってクラスを<code>matrix</code>から<code>table</code>に変えることもできる．分析はどちらであっても問題ないが，周辺分布を<code>Margins</code>によって確認したいときはクラスを<code>table</code>に変換しておく必要がある．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># クラスを確認</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "matrix" "array" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:6, 1:4] 64 57 57 72 36 21 94 94 105 141 ...
 - attr(*, "dimnames")=List of 2
  ..$ SES: chr [1:6] "A" "B" "C" "D" ...
  ..$ MHS: chr [1:4] "well" "mild" "modelrate" "impared"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># クラスをmatrixからtableに変える</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">as.table</span>(tab)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># クラスを確認</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "table"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 'table' num [1:6, 1:4] 64 57 57 72 36 21 94 94 105 141 ...
 - attr(*, "dimnames")=List of 2
  ..$ SES: chr [1:6] "A" "B" "C" "D" ...
  ..$ MHS: chr [1:4] "well" "mild" "modelrate" "impared"</code></pre>
</div>
</div>
<p>クロス表の周辺分布を確認しておく．ここでは<code>DescTools</code>パッケージの<code>Margins</code>を用いる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 注：tabのクラスはtableに変換が必要</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>DescTools<span class="sc">::</span><span class="fu">Margins</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$SES
   level  freq   perc  cumfreq  cumperc
1      A   262  15.8%      262    15.8%
2      B   245  14.8%      507    30.5%
3      C   287  17.3%      794    47.8%
4      D   384  23.1%    1'178    71.0%
5      E   265  16.0%    1'443    86.9%
6      F   217  13.1%    1'660   100.0%

$MHS
       level  freq   perc  cumfreq  cumperc
1       well   307  18.5%      307    18.5%
2       mild   602  36.3%      909    54.8%
3  modelrate   362  21.8%    1'271    76.6%
4    impared   389  23.4%    1'660   100.0%</code></pre>
</div>
</div>
<p>次に<code>vcd</code>パッケージの<code>mosaic</code>を用いてモザイクプロットを確認する．SESとメンタルヘルスが関連しており，SESが高いほどメンタルヘルスが良好である傾向が確認できる．色のあるセルは，結果を解釈する際に参考にすると良い．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(tab, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">keep_aspect_ratio =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="1-Introduction_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><code>chisq.test</code>関数を用いて，<code>tab</code>に対してカイ2乗検定を行う．ピアソンのカイ2乗値<code>X-squared</code>，自由度<code>df</code>，p値<code>p-value</code>が得られる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 表に対してカイ2乗検定を行う</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  tab
X-squared = 45.985, df = 15, p-value = 5.346e-05</code></pre>
</div>
</div>
<p><code>vcd</code>パッケージの<code>assocstats</code>ではピアソンのカイ2乗統計量<span class="math inline">\(\chi^2\)</span>だけではなく尤度比統計量<span class="math inline">\(L^2\)</span>も出力される．本書と同じ結果になっているのかを確認してほしい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ピアソンのカイ2乗統計量と尤度比統計量</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">assocstats</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    X^2 df   P(&gt; X^2)
Likelihood Ratio 47.418 15 3.1554e-05
Pearson          45.985 15 5.3458e-05

Phi-Coefficient   : NA 
Contingency Coeff.: 0.164 
Cramer's V        : 0.096 </code></pre>
</div>
</div>
<p><code>chisq.test(tab)</code>からは他にもいろいろな情報が得られる．ヘルプ<code>?chisq.test</code>か<code>names</code>関数で確認してみよう．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ヘルプの方法</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>?chisq.test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>names</code>関数で確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chisq.test(tab)に含まれるオブジェクトの名前を確認</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab) <span class="sc">|&gt;</span> <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "statistic" "parameter" "p.value"   "method"    "data.name" "observed" 
[7] "expected"  "residuals" "stdres"   </code></pre>
</div>
</div>
<p>せっかくなので全部確認してみたい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># カイ2乗統計量</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>statistic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>X-squared 
 45.98526 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 自由度</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>parameter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>df 
15 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># p値</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>p.value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.345771e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 方法</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>method</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Pearson's Chi-squared test"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データ名</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>data.name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tab"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 観測度数</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>observed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES well mild modelrate impared
  A   64   94        58      46
  B   57   94        54      40
  C   57  105        65      60
  D   72  141        77      94
  E   36   97        54      78
  F   21   71        54      71</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 期待度数</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>expected</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES     well      mild modelrate  impared
  A 48.45422  95.01446  57.13494 61.39639
  B 45.31024  88.84940  53.42771 57.41265
  C 53.07771 104.08072  62.58675 67.25482
  D 71.01687 139.25783  83.73976 89.98554
  E 49.00904  96.10241  57.78916 62.09940
  F 40.13193  78.69518  47.32169 50.85120</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ピアソンの残差 (observed - expected) / sqrt(expected)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>residuals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES        well        mild   modelrate     impared
  A  2.23329871 -0.10407326  0.11444464 -1.96493132
  B  1.73663030  0.54642528  0.07829468 -2.29805854
  C  0.53837330  0.09010757  0.30504342 -0.88463658
  D  0.11666251  0.14763196 -0.73650978  0.42319500
  E -1.85826240  0.09156111 -0.49844745  2.01776175
  F -3.02004713 -0.86745061  0.97081545  2.82552047</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 標準化残差 (observed - expected) / sqrt(V)</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>stdres</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES        well        mild   modelrate     impared
  A  2.69558120 -0.14205313  0.14103036 -2.44697258
  B  2.08347524  0.74134065  0.09590136 -2.84458018
  C  0.65570340  0.12410557  0.37931249 -1.11164198
  D  0.14738903  0.21092123 -0.95000069  0.55163334
  E -2.24532455  0.12510918 -0.61489791  2.51546393
  F -3.58789516 -1.16540491  1.17753617  3.46338368</code></pre>
</div>
</div>
<p>期待度数は<code>chisq.test(tab)$expected</code>とすればよい．これを<code>tab_expected</code>というオブジェクトとする．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ixページの期待度数</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>tab_expected <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(tab)<span class="sc">$</span>expected <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>tab_expected</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES      well      mild modelrate   impared
  A  48.45422  95.01446  57.13494  61.39639
  B  45.31024  88.84940  53.42771  57.41265
  C  53.07771 104.08072  62.58675  67.25482
  D  71.01687 139.25783  83.73976  89.98554
  E  49.00904  96.10241  57.78916  62.09940
  F  40.13193  78.69518  47.32169  50.85120</code></pre>
</div>
</div>
<p>なお，<code>DescTools::ExpFreq(tab)</code>でも同様の期待度数を求めることができる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Margins</span>(tab_expected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$SES
   level  freq   perc  cumfreq  cumperc
1      A   262  15.8%      262    15.8%
2      B   245  14.8%      507    30.5%
3      C   287  17.3%      794    47.8%
4      D   384  23.1%    1'178    71.0%
5      E   265  16.0%    1'443    86.9%
6      F   217  13.1%    1'660   100.0%

$MHS
       level  freq   perc  cumfreq  cumperc
1       well   307  18.5%      307    18.5%
2       mild   602  36.3%      909    54.8%
3  modelrate   362  21.8%    1'271    76.6%
4    impared   389  23.4%    1'660   100.0%</code></pre>
</div>
</div>
<p>ixページの数式用いて，実際に計算することでピアソンの<span class="math inline">\(\chi^2\)</span>統計量と尤度比統計量<span class="math inline">\(L^2\)</span>を求める（英語版のテキストは式に間違いがあるので注意）． 自由度についても<code>nrow</code>と<code>ncol</code>を用いて計算（<code>prod(dim(tab) -1)</code>でもよい）． <code>list</code>関数は様々なもの（値，ベクトル，データ，リスト等）をまとめ，並べて表示するときに用いる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 適合度（X2とL2）</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(((tab <span class="sc">-</span> tab_expected)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> tab_expected))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>L2 <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sum</span>((tab <span class="sc">*</span> <span class="fu">log</span>(tab <span class="sc">/</span> tab_expected)))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 自由度</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(tab) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (<span class="fu">ncol</span>(tab) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># df &lt;- prod(dim(tab) -1)</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果をリストで表示</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"自由度"</span> <span class="ot">=</span> df,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>     <span class="st">"ピアソンのカイ2乗統計量"</span> <span class="ot">=</span> X2, </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>     <span class="st">"尤度比統計量"</span> <span class="ot">=</span> L2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$自由度
[1] 15

$ピアソンのカイ2乗統計量
[1] 45.98526

$尤度比統計量
[1] 47.41785</code></pre>
</div>
</div>
</section>
<section id="一様連関モデル" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="一様連関モデル">一様連関モデル</h3>
<ul>
<li>ページixの一様連関モデルを再現する．</li>
</ul>
<section id="データの準備" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="データの準備">データの準備</h4>
<ul>
<li>多元表の分析は表形式（table form）ではなく，度数，行変数，列変数からなる集計データを作成して行うことが多い．このデータの形式は度数形式（frequency form）と呼ばれる．</li>
<li>先程のデータについてもクロス表ではなく，次のような集計データを作成する．</li>
</ul>
<div class="cell">

</div>
<ul>
<li>データを表示して確認する．</li>
</ul>
<div class="cell">

</div>
<div class="cell">
<div class="cell-output-display">

<table style="width:30%; margin-left: auto; margin-right: auto;" class="table">
<caption>精神衛生と親の社会経済的地位（SES）に関するミッドタウン・マンハッタンデータ</caption>
 <thead>
  <tr>
   <th style="text-align:right;"> Freq </th>
   <th style="text-align:right;"> PSES </th>
   <th style="text-align:right;"> MHS </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 64 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 94 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 58 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 46 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 57 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 94 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 54 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 40 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 57 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 105 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 65 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 60 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 72 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 141 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 77 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 94 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 36 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 97 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 54 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 78 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 21 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 71 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 54 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 71 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 4 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ul>
<li>度数については先程作成した<code>Freq</code>を使う．</li>
<li><code>gl</code>（Generate Factor Levels）によって度数に対応するカテゴリを作成する．数値で作成してもよいが，その場合は最後に<code>factor</code>に変換しておく．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数のベクトル</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>Freq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  64  94  58  46  57  94  54  40  57 105  65  60  72 141  77  94  36  97  54
[20]  78  21  71  54  71</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>PSES <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>PSES</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 2 2 2 2 3 3 3 3 4 4 4 4 5 5 5 5 6 6 6 6
Levels: 1 2 3 4 5 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 列変数</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>MHS  <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">24</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>MHS</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4
Levels: 1 2 3 4</code></pre>
</div>
</div>
<ul>
<li>以上で作成した度数（<code>Freq</code>），行変数（<code>PSES</code>），列変数（<code>MHS</code>）のベクトルを用いてデータを作成する．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる度数形式データを作成</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, PSES, MHS)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># データの確認</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
    Freq PSES  MHS  
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
 1    64 1     1    
 2    94 1     2    
 3    58 1     3    
 4    46 1     4    
 5    57 2     1    
 6    94 2     2    
 7    54 2     3    
 8    40 2     4    
 9    57 3     1    
10   105 3     2    
# ℹ 14 more rows</code></pre>
</div>
</div>
<ul>
<li>このような形式のデータにすることで柔軟なモデリングを行うことができる．</li>
<li>なお<code>gnm</code>パッケージには<code>mentalHealth</code>というデータがそもそも存在するのでそれを用いてもよい．</li>
<li>表形式データからこのような度数形式データを作成する場合は<code>data.frame</code>を用いれば簡単である．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   SES       MHS Freq
1    A      well   64
2    B      well   57
3    C      well   57
4    D      well   72
5    E      well   36
6    F      well   21
7    A      mild   94
8    B      mild   94
9    C      mild  105
10   D      mild  141
11   E      mild   97
12   F      mild   71
13   A modelrate   58
14   B modelrate   54
15   C modelrate   65
16   D modelrate   77
17   E modelrate   54
18   F modelrate   54
19   A   impared   46
20   B   impared   40
21   C   impared   60
22   D   impared   94
23   E   impared   78
24   F   impared   71</code></pre>
</div>
</div>
<ul>
<li>逆に度数形式データから表形式データを作成するためには<code>xtabs</code>を用いる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(Freq <span class="sc">~</span> SES <span class="sc">+</span> MHS, <span class="at">data =</span> <span class="fu">data.frame</span>(tab))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES well mild modelrate impared
  A   64   94        58      46
  B   57   94        54      40
  C   57  105        65      60
  D   72  141        77      94
  E   36   97        54      78
  F   21   71        54      71</code></pre>
</div>
</div>
</section>
<section id="独立モデル" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="独立モデル">独立モデル</h4>
<ul>
<li>この形式のデータ（<code>Freq</code>）に対して，独立モデルによる分析を行う．これは先程の独立性の検定と同じ結果となる．</li>
<li><code>|&gt;</code>はパイプ演算子であり，パイプ演算子を使うと<code>function(x)</code>を<code>x |&gt; function()</code>とすることができ，処理の流れが分かりやすくなる．引数（argument）が複数ある場合（例えば<code>function(x, y)</code>）はパイプ演算子の左辺は1つめの引数として用いられる．つまり，<code>function(x, y)</code>は<code>x |&gt; function(y)</code>とすればよい．では<code>y |&gt;</code>とする場合は，<code>y |&gt; function(x, _)</code>とすることで<code>function(x, y)</code>と同じ結果を得ることができる．<code>_</code>はプレースホルダーと呼ばれ，引数が適用される場所を示している．</li>
<li><code>d</code>というデータに対して，<code>gnm</code>を適用する．<code>度数 ~ 行変数 + 列変数</code>といった形で関連を指定する．<code>glm</code>を使ってもよいが，最終的には<code>gnm</code>を使うことになるので，ここでは<code>gnm</code>を用いる．</li>
<li>モデルの分布族（family）は<code>poisson</code>（ポワソン分布）とする．これを忘れると<code>gaussian</code>（正規分布）が適用され，異なる結果が出力されるので注意する ．<code>gnm</code>内で<code>data = _</code>となっているが<code>_</code>にはパイプ演算子の左辺にある<code>d</code>が入る．つまりこれは<code>data = d</code>とすることに等しい．</li>
<li>こうして得られた分析の結果を<code>O</code>としている．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 独立モデル</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> PSES <span class="sc">+</span> MHS, </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>結果は<code>O</code>（係数と最小限の適合度のみ）あるいは<code>summary(O)</code>（標準誤差やp値を含んだモデルの結果の要約）で確認できる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果の表示</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>O</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ PSES + MHS, family = poisson, data = d, 
    tolerance = 1e-12)

Coefficients:
(Intercept)        PSES2        PSES3        PSES4        PSES5        PSES6  
    3.88062     -0.06709      0.09114      0.38230      0.01139     -0.18845  
       MHS2         MHS3         MHS4  
    0.67341      0.16480      0.23673  

Deviance:            47.41785 
Pearson chi-squared: 45.98526 
Residual df:         15 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ PSES + MHS, family = poisson, data = d, 
    tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.3260  -0.7806   0.1028   0.5343   2.6643  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.88062    0.08045  48.238  &lt; 2e-16 ***
PSES2       -0.06709    0.08887  -0.755  0.45034    
PSES3        0.09114    0.08545   1.067  0.28615    
PSES4        0.38230    0.08013   4.771 1.83e-06 ***
PSES5        0.01139    0.08712   0.131  0.89603    
PSES6       -0.18845    0.09179  -2.053  0.04007 *  
MHS2         0.67341    0.07013   9.602  &lt; 2e-16 ***
MHS3         0.16480    0.07759   2.124  0.03367 *  
MHS4         0.23673    0.07634   3.101  0.00193 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 47.418 on 15 degrees of freedom
AIC: 209.59

Number of iterations: 5</code></pre>
</div>
</div>
<ul>
<li>他にもどのような情報があるのかをヘルプか<code>names</code>で確認する．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"          "formula"       "terms"         "data"         
 [5] "eliminate"     "ofInterest"    "na.action"     "xlevels"      
 [9] "offset"        "tolerance"     "iterStart"     "iterMax"      
[13] "coefficients"  "residuals"     "fitted.values" "rank"         
[17] "family"        "predictors"    "deviance"      "aic"          
[21] "iter"          "weights"       "prior.weights" "df.residual"  
[25] "y"             "converged"     "constrain"     "constrainTo"  
[29] "x"             "model"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">summary</span>(O))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"           "ofInterest"     "family"         "deviance"      
 [5] "aic"            "df.residual"    "iter"           "deviance.resid"
 [9] "coefficients"   "eliminated"     "dispersion"     "df"            
[13] "cov.scaled"    </code></pre>
</div>
</div>
<ul>
<li>結果には期待度数<code>fitted.values</code>があるので，これを用いて適合度を計算してみる．</li>
<li>観測度数については<code>Freq</code>の変わりに<code>O$y</code>を用いてもよい．これはモデル<code>O</code>で使用された従属変数<code>y</code>であり，<code>Freq</code>そのものである．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 期待度数をexpected_Oとする</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>observed <span class="ot">&lt;-</span> O<span class="sc">$</span>y</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>expected_O <span class="ot">&lt;-</span> O<span class="sc">$</span>fitted.values</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 行と列のカテゴリ数をユニークな値の数から求める</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> d<span class="sc">$</span>PSES <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">length</span>()</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>J <span class="ot">&lt;-</span> d<span class="sc">$</span>MHS <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">length</span>()</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 自由度</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>df_O <span class="ot">&lt;-</span> (I <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (J <span class="sc">-</span> <span class="dv">1</span>) </span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 適合度（X2とL2）</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>X2_O <span class="ot">&lt;-</span> ((observed <span class="sc">-</span> expected_O)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> expected_O) <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>L2_O <span class="ot">&lt;-</span> (observed <span class="sc">*</span> <span class="fu">log</span>(observed <span class="sc">/</span> expected_O)) <span class="sc">|&gt;</span> <span class="fu">sum</span>() <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="co"># リストでまとめて表示</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"自由度"</span> <span class="ot">=</span> df_O,</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>     <span class="st">"ピアソンのカイ2乗統計量"</span> <span class="ot">=</span> X2_O,</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>     <span class="st">"尤度比統計量"</span> <span class="ot">=</span> L2_O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$自由度
[1] 15

$ピアソンのカイ2乗統計量
[1] 45.98526

$尤度比統計量
[1] 47.41785</code></pre>
</div>
</div>
<ul>
<li><code>summary(O)</code>では<code>Residual deviance: 47.418 on 15 degrees of freedom</code>となっており，先程の分析と適合度は一致する．</li>
</ul>
</section>
<section id="一様連関モデル-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="一様連関モデル-1">一様連関モデル</h4>
<ul>
<li>次に一様連関モデル（Uniform association model）による分析を行う．</li>
<li><code>PSES</code>を<code>as.integer</code>関数で整数にしたものを<code>Rscore</code>，<code>MHS</code>を<code>as.integer</code>関数で整数にしたものを<code>Cscore</code>として，<code>mutate</code>関数でデータに新たに変数を作成している．更に平均値を引いて中心化している．<code>d &lt;- d |&gt;</code>は<code>mutate</code>変数を追加して元のデータに上書きをしている．</li>
<li>変数の追加された<code>d</code>データに対して，一様連関モデルによる分析を<code>gnm</code>パッケージで行う．</li>
<li>独立モデルとの違いは，作成した整数スコアの積<code>Rscore:Cscore</code>がモデルに追加されているだけである．<code>Rscore*Cscore</code>とすると<code>Rscore</code>と<code>Cscore</code>も表示されるが結果は変わらない．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数と列変数を連続した整数値とする</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rscore =</span> <span class="fu">as.integer</span>(PSES),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Rscore =</span> Rscore <span class="sc">-</span> <span class="fu">mean</span>(Rscore),</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> <span class="fu">as.integer</span>(MHS),</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> Cscore <span class="sc">-</span> <span class="fu">mean</span>(Cscore))</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 一様連関モデル</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> PSES <span class="sc">+</span> MHS <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore, </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>,</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果の表示</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(U)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ PSES + MHS + Rscore:Cscore, family = poisson, 
    data = d, tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.2663  -0.3285   0.2025   0.3912   1.0820  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    3.83878    0.07926  48.436  &lt; 2e-16 ***
PSES2         -0.04989    0.08908  -0.560  0.57542    
PSES3          0.11692    0.08599   1.360  0.17390    
PSES4          0.40787    0.08087   5.044 4.56e-07 ***
PSES5          0.02784    0.08778   0.317  0.75108    
PSES6         -0.19002    0.09251  -2.054  0.03997 *  
MHS2           0.69632    0.07059   9.864  &lt; 2e-16 ***
MHS3           0.18951    0.07827   2.421  0.01547 *  
MHS4           0.24230    0.07709   3.143  0.00167 ** 
Rscore:Cscore  0.09069    0.01501   6.043 1.51e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 9.8951 on 14 degrees of freedom
AIC: 174.07

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 適合度（X2とL2）</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>observed <span class="ot">&lt;-</span> U<span class="sc">$</span>y</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>expected_U <span class="ot">&lt;-</span> U<span class="sc">$</span>fitted.values</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>df_U <span class="ot">&lt;-</span> (I <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>(J <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>X2_U <span class="ot">&lt;-</span> ((observed <span class="sc">-</span> expected_U)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> expected_U) <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>L2_U <span class="ot">&lt;-</span> (observed <span class="sc">*</span> <span class="fu">log</span>(observed <span class="sc">/</span> expected_U)) <span class="sc">|&gt;</span> <span class="fu">sum</span>() <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"自由度"</span> <span class="ot">=</span> df_U,</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>     <span class="st">"ピアソンのカイ2乗統計量"</span> <span class="ot">=</span> X2_U, </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>     <span class="st">"尤度比統計量"</span> <span class="ot">=</span> L2_U)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$自由度
[1] 14

$ピアソンのカイ2乗統計量
[1] 9.731848

$尤度比統計量
[1] 9.895124</code></pre>
</div>
</div>
<ul>
<li><p>結果がixページと一致することを確認してほしい．</p></li>
<li><p>なお，尤度比統計量<span class="math inline">\(L^2\)</span>と自由度は次のように求めることができる．</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 独立モデルのL</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>O<span class="sc">$</span>deviance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 47.41785</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 独立モデルのdf</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>O<span class="sc">$</span>df.residual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 一様連関モデルのL</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>U<span class="sc">$</span>deviance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.895124</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 一様連関モデルのdf</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>U<span class="sc">$</span>df.residual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
</div>
<ul>
<li>尤度比統計量<span class="math inline">\(L^2\)</span>と自由度の差を求める場合<code>anova</code>関数を用いる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(O, U)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: Freq ~ PSES + MHS
Model 2: Freq ~ PSES + MHS + Rscore:Cscore
  Resid. Df Resid. Dev Df Deviance
1        15     47.418            
2        14      9.895  1   37.523</code></pre>
</div>
</div>
<ul>
<li>以上で本書の序文の再現は終了である．</li>
</ul>
</section>
</section>
<section id="度数行変数列変数のデータからクロス表を作成" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="度数行変数列変数のデータからクロス表を作成">度数，行変数，列変数のデータからクロス表を作成</h2>
<ul>
<li>度数，行変数，列変数のデータからクロス表を作成するには<code>xtabs</code>関数を用いる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> PSES <span class="sc">+</span> MHS, <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    MHS
PSES   1   2   3   4
   1  64  94  58  46
   2  57  94  54  40
   3  57 105  65  60
   4  72 141  77  94
   5  36  97  54  78
   6  21  71  54  71</code></pre>
</div>
</div>
<ul>
<li>Rに初めから準備されている<code>Titanic</code>データは，多少特殊な集計がされているが，これに<code>data.frame</code>関数を適用すると，集計データになる．これに対して<code>xtabs</code>関数を用いればクロス表を簡単に作成できる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(Titanic) <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> Class <span class="sc">+</span> Survived, <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Survived
Class   No Yes
  1st  122 203
  2nd  167 118
  3rd  528 178
  Crew 673 212</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(Titanic) <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> Sex <span class="sc">+</span> Survived, <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Survived
Sex        No  Yes
  Male   1364  367
  Female  126  344</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(Titanic) <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> Age <span class="sc">+</span> Survived, <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Survived
Age       No  Yes
  Child   52   57
  Adult 1438  654</code></pre>
</div>
</div>
</section>
<section id="個票データから集計データを作成" class="level2">
<h2 class="anchored" data-anchor-id="個票データから集計データを作成">個票データから集計データを作成</h2>
<ul>
<li>個票データから集計データを作成する方法はいくつか考えられるが，ここでは<code>count</code>関数を用いる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># スターウォーズデータ</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>starwars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 14
   name     height  mass hair_color skin_color eye_color birth_year sex   gender
   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
 2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
 3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
 4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
 5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
 6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
 7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
 8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
 9 Biggs D…    183    84 black      light      brown           24   male  mascu…
10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
# ℹ 77 more rows
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1つの変数にcount関数を適用</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  sex                n
  &lt;chr&gt;          &lt;int&gt;
1 female            16
2 hermaphroditic     1
3 male              60
4 none               6
5 &lt;NA&gt;               4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2つの変数にcount関数を適用し，集計レベルのデータを作成</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span> </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  sex            gender        n
  &lt;chr&gt;          &lt;chr&gt;     &lt;int&gt;
1 female         feminine     16
2 hermaphroditic masculine     1
3 male           masculine    60
4 none           feminine      1
5 none           masculine     5
6 &lt;NA&gt;           &lt;NA&gt;          4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 欠損値を処理し，nをFreqと名前を変更し，df_dstarwarsとしてデータを保存</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>df_dstarwars <span class="ot">&lt;-</span> starwars <span class="sc">|&gt;</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, gender) <span class="sc">|&gt;</span> </span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Freq =</span> n)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>df_dstarwars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  sex            gender     Freq
  &lt;chr&gt;          &lt;chr&gt;     &lt;int&gt;
1 female         feminine     16
2 hermaphroditic masculine     1
3 male           masculine    60
4 none           feminine      1
5 none           masculine     5</code></pre>
</div>
</div>
</section>
<section id="集計データを個票データに変換" class="level2">
<h2 class="anchored" data-anchor-id="集計データを個票データに変換">集計データを個票データに変換</h2>
<p>集計データを個票データに変換したいときには<code>vcdExtra</code>パッケージの<code>expand.dft</code>を用いる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>d_ind <span class="ot">&lt;-</span> <span class="fu">expand.dft</span>(d, <span class="at">dreq =</span> <span class="st">"Freq"</span>)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>d_ind</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,660 × 4
    PSES   MHS Rscore Cscore
   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1     1     1   -2.5   -1.5
 2     1     1   -2.5   -1.5
 3     1     1   -2.5   -1.5
 4     1     1   -2.5   -1.5
 5     1     1   -2.5   -1.5
 6     1     1   -2.5   -1.5
 7     1     1   -2.5   -1.5
 8     1     1   -2.5   -1.5
 9     1     1   -2.5   -1.5
10     1     1   -2.5   -1.5
# ℹ 1,650 more rows</code></pre>
</div>
</div>
</section>
<section id="元クロス分類表の入力" class="level2">
<h2 class="anchored" data-anchor-id="元クロス分類表の入力">3元クロス分類表の入力</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">1</span>,</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>,</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">5</span>,</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">8</span>,<span class="dv">0</span>,<span class="dv">1</span>,</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">5</span>,</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a><span class="fu">array</span>(data, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1

     [,1] [,2] [,3]
[1,]    2    1    4
[2,]    5    2    7

, , 2

     [,1] [,2] [,3]
[1,]    4    5    0
[2,]    7    8    1

, , 3

     [,1] [,2] [,3]
[1,]   10    5    3
[2,]   11    1    4

, , 4

     [,1] [,2] [,3]
[1,]    1    1    3
[2,]    1    2    4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>tab1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">1</span>,</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>          <span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span><span class="cn">TRUE</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">5</span>,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>          <span class="dv">8</span>,<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span><span class="cn">TRUE</span>)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>tab3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">5</span>,</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>          <span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span><span class="cn">TRUE</span>)</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>tab4 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>          <span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span><span class="cn">TRUE</span>)</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>tab_merge <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(tab1,tab2,tab3,tab4), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>tab_merge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1

     [,1] [,2] [,3]
[1,]    2    5    1
[2,]    2    4    7

, , 2

     [,1] [,2] [,3]
[1,]    4    7    5
[2,]    8    0    1

, , 3

     [,1] [,2] [,3]
[1,]   10   11    5
[2,]    1    3    4

, , 4

     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    2    3    4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab_merge) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">c</span>(<span class="st">"men"</span>,<span class="st">"women"</span>),</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">C =</span> <span class="fu">c</span>(<span class="st">"blue"</span>,<span class="st">"red"</span>,<span class="st">"green"</span>),</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">L =</span> <span class="fu">c</span>(<span class="st">"north"</span>,<span class="st">"south"</span>,<span class="st">"east"</span>,<span class="st">"west"</span>))</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>tab_merge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , L = north

       C
R       blue red green
  men      2   5     1
  women    2   4     7

, , L = south

       C
R       blue red green
  men      4   7     5
  women    8   0     1

, , L = east

       C
R       blue red green
  men     10  11     5
  women    1   3     4

, , L = west

       C
R       blue red green
  men      1   1     1
  women    2   3     4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># フラットな形式で3元表を表示</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(tab_merge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            L north south east west
R     C                            
men   blue        2     4   10    1
      red         5     7   11    1
      green       1     5    5    1
women blue        2     8    1    2
      red         4     0    3    3
      green       7     1    4    4</code></pre>
</div>
</div>
<p>Friendly and Meyer (2016) を参考に表を作成．</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">元のデータ形式</th>
<th style="text-align: left;">変換後のデータ形式</th>
<th style="text-align: left;">方法</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ケース形式</td>
<td style="text-align: left;">度数形式</td>
<td style="text-align: left;"><code>data.frame(table(d$A,d$B))</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">ケース形式</td>
<td style="text-align: left;">表形式</td>
<td style="text-align: left;"><code>table(d$A,d$B)</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">度数形式</td>
<td style="text-align: left;">ケース形式</td>
<td style="text-align: left;"><code>expand.dfr(X)</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">度数形式</td>
<td style="text-align: left;">表形式</td>
<td style="text-align: left;"><code>xtabs(Freq ~ A + B)</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">表形式</td>
<td style="text-align: left;">ケース形式</td>
<td style="text-align: left;"><code>expand.dfr(X)</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">表形式</td>
<td style="text-align: left;">度数形式</td>
<td style="text-align: left;"><code>data.frame(tab)</code></td>
</tr>
</tbody>
</table>
</section>
<section id="練習問題" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="練習問題">練習問題</h2>
<ul>
<li>せっかくデータを入力したので，このデータを使ってGoodman（1979）の表5A，表5B，表5Cの結果を再現しよう．</li>
<li>分析方法については第2章のプログラムを参考にしてほしい．</li>
</ul>
</section>
<section id="参考文献" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="参考文献">参考文献</h2>
<ul>
<li>Goodman, Leo A. 1979. “Simple Models for the Analysis of Association in Cross-Classifications Having Ordered Categories.”<em>Journal of the American Statistical Association</em> 74(367):537–52.</li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">はじめに</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./2-Chapter_1.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">第1章</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb113" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># シリーズ編者による内容紹介 {-}</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>「シリーズ編者による内容紹介」の分析は短いが，Rによるカテゴリカルデータ分析の方法の基礎を身につける上ではよい例である．少し長くなるが，基本的な操作方法の説明やクロス表の分析方法について説明したい．</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>パッケージは<span class="in">`tidyverse`</span>（データセットの処理のため），<span class="in">`DescTools`</span>（記述統計を求めるため），<span class="in">`vcd`</span>パッケージ（カテゴリカルデータの分析のため），<span class="in">`gnm`</span>（連関分析の処理のため）を使用する．</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="co"># パッケージの読み込み</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a><span class="fu">### 独立性の検定 {-}</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>使用するデータは精神的健康と親の社会経済的地位（SES）に関するミッドタウン・マンハッタンデータ（the Midtown Manhattan data）である．元データについて，ここではクロス表（のようにみえる）形式で入力する．これを<span class="in">`Freq`</span>とする．</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 元データの入力（xページ）</span></span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>,  <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>,</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>,  <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>,</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>,</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>           <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>,</span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>           <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>,</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a>           <span class="dv">21</span>,  <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a>実際は横に長い一行のベクトルとなる．</span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認</span></span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a>Freq</span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a>このベクトルを<span class="in">`matrix`</span>関数を用いて，行列に変換する．これを<span class="in">`tab`</span>とする（名前は何でもよい）．<span class="in">`nrow`</span>は行カテゴリ数，<span class="in">`ncol`</span>は列カテゴリ数である．<span class="in">`byrow = TRUE`</span>を忘れないように注意すること．また<span class="in">`dimnames`</span>で行と列のそれぞれの変数名とカテゴリ名を指定することも可能である．この指定は特に無くてもよい．</span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb113-51"><a href="#cb113-51" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb113-52"><a href="#cb113-52" aria-hidden="true" tabindex="-1"></a>  Freq,</span>
<span id="cb113-53"><a href="#cb113-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">6</span>,</span>
<span id="cb113-54"><a href="#cb113-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb113-55"><a href="#cb113-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb113-56"><a href="#cb113-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb113-57"><a href="#cb113-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">SES =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb113-58"><a href="#cb113-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">MHS =</span> <span class="fu">c</span>(<span class="st">"well"</span>,</span>
<span id="cb113-59"><a href="#cb113-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mild"</span>,</span>
<span id="cb113-60"><a href="#cb113-60" aria-hidden="true" tabindex="-1"></a>            <span class="st">"modelrate"</span>,</span>
<span id="cb113-61"><a href="#cb113-61" aria-hidden="true" tabindex="-1"></a>            <span class="st">"impared"</span>)</span>
<span id="cb113-62"><a href="#cb113-62" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb113-63"><a href="#cb113-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb113-64"><a href="#cb113-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-65"><a href="#cb113-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-66"><a href="#cb113-66" aria-hidden="true" tabindex="-1"></a>これで表を再現することができた．</span>
<span id="cb113-67"><a href="#cb113-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-70"><a href="#cb113-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-71"><a href="#cb113-71" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認</span></span>
<span id="cb113-72"><a href="#cb113-72" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb113-73"><a href="#cb113-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-74"><a href="#cb113-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-75"><a href="#cb113-75" aria-hidden="true" tabindex="-1"></a>初歩的なクロス表の分析はここで作成された<span class="in">`tab`</span>に対して行う．</span>
<span id="cb113-76"><a href="#cb113-76" aria-hidden="true" tabindex="-1"></a><span class="in">`as.table`</span>によってクラスを<span class="in">`matrix`</span>から<span class="in">`table`</span>に変えることもできる．分析はどちらであっても問題ないが，周辺分布を<span class="in">`Margins`</span>によって確認したいときはクラスを<span class="in">`table`</span>に変換しておく必要がある．</span>
<span id="cb113-77"><a href="#cb113-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-80"><a href="#cb113-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-81"><a href="#cb113-81" aria-hidden="true" tabindex="-1"></a><span class="co"># クラスを確認</span></span>
<span id="cb113-82"><a href="#cb113-82" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tab)</span>
<span id="cb113-83"><a href="#cb113-83" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tab)</span>
<span id="cb113-84"><a href="#cb113-84" aria-hidden="true" tabindex="-1"></a><span class="co"># クラスをmatrixからtableに変える</span></span>
<span id="cb113-85"><a href="#cb113-85" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">as.table</span>(tab)</span>
<span id="cb113-86"><a href="#cb113-86" aria-hidden="true" tabindex="-1"></a><span class="co"># クラスを確認</span></span>
<span id="cb113-87"><a href="#cb113-87" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tab)</span>
<span id="cb113-88"><a href="#cb113-88" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tab)</span>
<span id="cb113-89"><a href="#cb113-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-90"><a href="#cb113-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-91"><a href="#cb113-91" aria-hidden="true" tabindex="-1"></a>クロス表の周辺分布を確認しておく．ここでは<span class="in">`DescTools`</span>パッケージの<span class="in">`Margins`</span>を用いる．</span>
<span id="cb113-92"><a href="#cb113-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-95"><a href="#cb113-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-96"><a href="#cb113-96" aria-hidden="true" tabindex="-1"></a><span class="co"># 注：tabのクラスはtableに変換が必要</span></span>
<span id="cb113-97"><a href="#cb113-97" aria-hidden="true" tabindex="-1"></a>DescTools<span class="sc">::</span><span class="fu">Margins</span>(tab)</span>
<span id="cb113-98"><a href="#cb113-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-99"><a href="#cb113-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-100"><a href="#cb113-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-101"><a href="#cb113-101" aria-hidden="true" tabindex="-1"></a>次に<span class="in">`vcd`</span>パッケージの<span class="in">`mosaic`</span>を用いてモザイクプロットを確認する．SESとメンタルヘルスが関連しており，SESが高いほどメンタルヘルスが良好である傾向が確認できる．色のあるセルは，結果を解釈する際に参考にすると良い．</span>
<span id="cb113-102"><a href="#cb113-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-105"><a href="#cb113-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-106"><a href="#cb113-106" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(tab, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">keep_aspect_ratio =</span> <span class="cn">FALSE</span>)</span>
<span id="cb113-107"><a href="#cb113-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-108"><a href="#cb113-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-109"><a href="#cb113-109" aria-hidden="true" tabindex="-1"></a><span class="in">`chisq.test`</span>関数を用いて，<span class="in">`tab`</span>に対してカイ2乗検定を行う．ピアソンのカイ2乗値<span class="in">`X-squared`</span>，自由度<span class="in">`df`</span>，p値<span class="in">`p-value`</span>が得られる．</span>
<span id="cb113-110"><a href="#cb113-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-113"><a href="#cb113-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-114"><a href="#cb113-114" aria-hidden="true" tabindex="-1"></a><span class="co"># 表に対してカイ2乗検定を行う</span></span>
<span id="cb113-115"><a href="#cb113-115" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)</span>
<span id="cb113-116"><a href="#cb113-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-117"><a href="#cb113-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-118"><a href="#cb113-118" aria-hidden="true" tabindex="-1"></a><span class="in">`vcd`</span>パッケージの<span class="in">`assocstats`</span>ではピアソンのカイ2乗統計量$\chi^2$だけではなく尤度比統計量$L^2$も出力される．本書と同じ結果になっているのかを確認してほしい．</span>
<span id="cb113-119"><a href="#cb113-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-122"><a href="#cb113-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-123"><a href="#cb113-123" aria-hidden="true" tabindex="-1"></a><span class="co"># ピアソンのカイ2乗統計量と尤度比統計量</span></span>
<span id="cb113-124"><a href="#cb113-124" aria-hidden="true" tabindex="-1"></a><span class="fu">assocstats</span>(tab)</span>
<span id="cb113-125"><a href="#cb113-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-126"><a href="#cb113-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-127"><a href="#cb113-127" aria-hidden="true" tabindex="-1"></a><span class="in">`chisq.test(tab)`</span>からは他にもいろいろな情報が得られる．ヘルプ<span class="in">`?chisq.test`</span>か<span class="in">`names`</span>関数で確認してみよう．</span>
<span id="cb113-128"><a href="#cb113-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-129"><a href="#cb113-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb113-130"><a href="#cb113-130" aria-hidden="true" tabindex="-1"></a><span class="co"># ヘルプの方法</span></span>
<span id="cb113-131"><a href="#cb113-131" aria-hidden="true" tabindex="-1"></a>?chisq.test</span>
<span id="cb113-132"><a href="#cb113-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-133"><a href="#cb113-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-134"><a href="#cb113-134" aria-hidden="true" tabindex="-1"></a><span class="in">`names`</span>関数で確認する．</span>
<span id="cb113-135"><a href="#cb113-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-138"><a href="#cb113-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-139"><a href="#cb113-139" aria-hidden="true" tabindex="-1"></a><span class="co"># chisq.test(tab)に含まれるオブジェクトの名前を確認</span></span>
<span id="cb113-140"><a href="#cb113-140" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab) <span class="sc">|&gt;</span> <span class="fu">names</span>()</span>
<span id="cb113-141"><a href="#cb113-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-142"><a href="#cb113-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-143"><a href="#cb113-143" aria-hidden="true" tabindex="-1"></a>せっかくなので全部確認してみたい．</span>
<span id="cb113-144"><a href="#cb113-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-147"><a href="#cb113-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-148"><a href="#cb113-148" aria-hidden="true" tabindex="-1"></a><span class="co"># カイ2乗統計量</span></span>
<span id="cb113-149"><a href="#cb113-149" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>statistic</span>
<span id="cb113-150"><a href="#cb113-150" aria-hidden="true" tabindex="-1"></a><span class="co"># 自由度</span></span>
<span id="cb113-151"><a href="#cb113-151" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>parameter</span>
<span id="cb113-152"><a href="#cb113-152" aria-hidden="true" tabindex="-1"></a><span class="co"># p値</span></span>
<span id="cb113-153"><a href="#cb113-153" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>p.value</span>
<span id="cb113-154"><a href="#cb113-154" aria-hidden="true" tabindex="-1"></a><span class="co"># 方法</span></span>
<span id="cb113-155"><a href="#cb113-155" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>method</span>
<span id="cb113-156"><a href="#cb113-156" aria-hidden="true" tabindex="-1"></a><span class="co"># データ名</span></span>
<span id="cb113-157"><a href="#cb113-157" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>data.name</span>
<span id="cb113-158"><a href="#cb113-158" aria-hidden="true" tabindex="-1"></a><span class="co"># 観測度数</span></span>
<span id="cb113-159"><a href="#cb113-159" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>observed</span>
<span id="cb113-160"><a href="#cb113-160" aria-hidden="true" tabindex="-1"></a><span class="co"># 期待度数</span></span>
<span id="cb113-161"><a href="#cb113-161" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>expected</span>
<span id="cb113-162"><a href="#cb113-162" aria-hidden="true" tabindex="-1"></a><span class="co"># ピアソンの残差 (observed - expected) / sqrt(expected)</span></span>
<span id="cb113-163"><a href="#cb113-163" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>residuals</span>
<span id="cb113-164"><a href="#cb113-164" aria-hidden="true" tabindex="-1"></a><span class="co"># 標準化残差 (observed - expected) / sqrt(V)</span></span>
<span id="cb113-165"><a href="#cb113-165" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(tab)<span class="sc">$</span>stdres</span>
<span id="cb113-166"><a href="#cb113-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-167"><a href="#cb113-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-168"><a href="#cb113-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-169"><a href="#cb113-169" aria-hidden="true" tabindex="-1"></a>期待度数は<span class="in">`chisq.test(tab)$expected`</span>とすればよい．これを<span class="in">`tab_expected`</span>というオブジェクトとする．</span>
<span id="cb113-170"><a href="#cb113-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-173"><a href="#cb113-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-174"><a href="#cb113-174" aria-hidden="true" tabindex="-1"></a><span class="co"># ixページの期待度数</span></span>
<span id="cb113-175"><a href="#cb113-175" aria-hidden="true" tabindex="-1"></a>tab_expected <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(tab)<span class="sc">$</span>expected <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb113-176"><a href="#cb113-176" aria-hidden="true" tabindex="-1"></a>tab_expected</span>
<span id="cb113-177"><a href="#cb113-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-178"><a href="#cb113-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-179"><a href="#cb113-179" aria-hidden="true" tabindex="-1"></a>なお，<span class="in">`DescTools::ExpFreq(tab)`</span>でも同様の期待度数を求めることができる．</span>
<span id="cb113-180"><a href="#cb113-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-183"><a href="#cb113-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-184"><a href="#cb113-184" aria-hidden="true" tabindex="-1"></a><span class="fu">Margins</span>(tab_expected)</span>
<span id="cb113-185"><a href="#cb113-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-186"><a href="#cb113-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-187"><a href="#cb113-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-188"><a href="#cb113-188" aria-hidden="true" tabindex="-1"></a>ixページの数式用いて，実際に計算することでピアソンの$\chi^2$統計量と尤度比統計量$L^2$を求める（英語版のテキストは式に間違いがあるので注意）．</span>
<span id="cb113-189"><a href="#cb113-189" aria-hidden="true" tabindex="-1"></a>自由度についても<span class="in">`nrow`</span>と<span class="in">`ncol`</span>を用いて計算（<span class="in">`prod(dim(tab) -1)`</span>でもよい）．</span>
<span id="cb113-190"><a href="#cb113-190" aria-hidden="true" tabindex="-1"></a><span class="in">`list`</span>関数は様々なもの（値，ベクトル，データ，リスト等）をまとめ，並べて表示するときに用いる．</span>
<span id="cb113-191"><a href="#cb113-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-194"><a href="#cb113-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-195"><a href="#cb113-195" aria-hidden="true" tabindex="-1"></a><span class="co"># 適合度（X2とL2）</span></span>
<span id="cb113-196"><a href="#cb113-196" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(((tab <span class="sc">-</span> tab_expected)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> tab_expected))</span>
<span id="cb113-197"><a href="#cb113-197" aria-hidden="true" tabindex="-1"></a>L2 <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sum</span>((tab <span class="sc">*</span> <span class="fu">log</span>(tab <span class="sc">/</span> tab_expected)))</span>
<span id="cb113-198"><a href="#cb113-198" aria-hidden="true" tabindex="-1"></a><span class="co"># 自由度</span></span>
<span id="cb113-199"><a href="#cb113-199" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(tab) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (<span class="fu">ncol</span>(tab) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb113-200"><a href="#cb113-200" aria-hidden="true" tabindex="-1"></a><span class="co"># df &lt;- prod(dim(tab) -1)</span></span>
<span id="cb113-201"><a href="#cb113-201" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果をリストで表示</span></span>
<span id="cb113-202"><a href="#cb113-202" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"自由度"</span> <span class="ot">=</span> df,</span>
<span id="cb113-203"><a href="#cb113-203" aria-hidden="true" tabindex="-1"></a>     <span class="st">"ピアソンのカイ2乗統計量"</span> <span class="ot">=</span> X2, </span>
<span id="cb113-204"><a href="#cb113-204" aria-hidden="true" tabindex="-1"></a>     <span class="st">"尤度比統計量"</span> <span class="ot">=</span> L2)</span>
<span id="cb113-205"><a href="#cb113-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-206"><a href="#cb113-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-207"><a href="#cb113-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-208"><a href="#cb113-208" aria-hidden="true" tabindex="-1"></a><span class="fu">### 一様連関モデル {-}</span></span>
<span id="cb113-209"><a href="#cb113-209" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ページixの一様連関モデルを再現する．</span>
<span id="cb113-210"><a href="#cb113-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-211"><a href="#cb113-211" aria-hidden="true" tabindex="-1"></a><span class="fu">#### データの準備 {-}</span></span>
<span id="cb113-212"><a href="#cb113-212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>多元表の分析は表形式（table form）ではなく，度数，行変数，列変数からなる集計データを作成して行うことが多い．このデータの形式は度数形式（frequency form）と呼ばれる．</span>
<span id="cb113-213"><a href="#cb113-213" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>先程のデータについてもクロス表ではなく，次のような集計データを作成する．</span>
<span id="cb113-214"><a href="#cb113-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-215"><a href="#cb113-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-216"><a href="#cb113-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results = FALSE, echo = FALSE}</span></span>
<span id="cb113-217"><a href="#cb113-217" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数のベクトル</span></span>
<span id="cb113-218"><a href="#cb113-218" aria-hidden="true" tabindex="-1"></a>Freq</span>
<span id="cb113-219"><a href="#cb113-219" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数</span></span>
<span id="cb113-220"><a href="#cb113-220" aria-hidden="true" tabindex="-1"></a>PSES <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb113-221"><a href="#cb113-221" aria-hidden="true" tabindex="-1"></a>PSES</span>
<span id="cb113-222"><a href="#cb113-222" aria-hidden="true" tabindex="-1"></a><span class="co"># 列変数</span></span>
<span id="cb113-223"><a href="#cb113-223" aria-hidden="true" tabindex="-1"></a>MHS  <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">24</span>)</span>
<span id="cb113-224"><a href="#cb113-224" aria-hidden="true" tabindex="-1"></a>MHS</span>
<span id="cb113-225"><a href="#cb113-225" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなるデータを作成</span></span>
<span id="cb113-226"><a href="#cb113-226" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, PSES, MHS)</span>
<span id="cb113-227"><a href="#cb113-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-228"><a href="#cb113-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-229"><a href="#cb113-229" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>データを表示して確認する．</span>
<span id="cb113-230"><a href="#cb113-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-231"><a href="#cb113-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results = FALSE, echo = FALSE}</span></span>
<span id="cb113-232"><a href="#cb113-232" aria-hidden="true" tabindex="-1"></a><span class="co"># データの確認</span></span>
<span id="cb113-233"><a href="#cb113-233" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb113-234"><a href="#cb113-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-235"><a href="#cb113-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-236"><a href="#cb113-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb113-237"><a href="#cb113-237" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d, </span>
<span id="cb113-238"><a href="#cb113-238" aria-hidden="true" tabindex="-1"></a>             <span class="at">align =</span> <span class="fu">c</span>(<span class="st">'r'</span>, <span class="st">'r'</span>, <span class="st">'r'</span>), </span>
<span id="cb113-239"><a href="#cb113-239" aria-hidden="true" tabindex="-1"></a>             <span class="at">table.attr =</span> <span class="st">"style='width:30%;'"</span>, </span>
<span id="cb113-240"><a href="#cb113-240" aria-hidden="true" tabindex="-1"></a>             <span class="at">format =</span> <span class="st">"html"</span>, </span>
<span id="cb113-241"><a href="#cb113-241" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">"精神衛生と親の社会経済的地位（SES）に関するミッドタウン・マンハッタンデータ"</span>) <span class="sc">|&gt;</span></span>
<span id="cb113-242"><a href="#cb113-242" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">position =</span> <span class="st">"center"</span>)</span>
<span id="cb113-243"><a href="#cb113-243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-244"><a href="#cb113-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-245"><a href="#cb113-245" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>度数については先程作成した<span class="in">`Freq`</span>を使う．</span>
<span id="cb113-246"><a href="#cb113-246" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`gl`</span>（Generate Factor Levels）によって度数に対応するカテゴリを作成する．数値で作成してもよいが，その場合は最後に<span class="in">`factor`</span>に変換しておく．</span>
<span id="cb113-247"><a href="#cb113-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-250"><a href="#cb113-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-251"><a href="#cb113-251" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数のベクトル</span></span>
<span id="cb113-252"><a href="#cb113-252" aria-hidden="true" tabindex="-1"></a>Freq</span>
<span id="cb113-253"><a href="#cb113-253" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数</span></span>
<span id="cb113-254"><a href="#cb113-254" aria-hidden="true" tabindex="-1"></a>PSES <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb113-255"><a href="#cb113-255" aria-hidden="true" tabindex="-1"></a>PSES</span>
<span id="cb113-256"><a href="#cb113-256" aria-hidden="true" tabindex="-1"></a><span class="co"># 列変数</span></span>
<span id="cb113-257"><a href="#cb113-257" aria-hidden="true" tabindex="-1"></a>MHS  <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">24</span>)</span>
<span id="cb113-258"><a href="#cb113-258" aria-hidden="true" tabindex="-1"></a>MHS</span>
<span id="cb113-259"><a href="#cb113-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-260"><a href="#cb113-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-261"><a href="#cb113-261" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>以上で作成した度数（<span class="in">`Freq`</span>），行変数（<span class="in">`PSES`</span>），列変数（<span class="in">`MHS`</span>）のベクトルを用いてデータを作成する．</span>
<span id="cb113-262"><a href="#cb113-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-265"><a href="#cb113-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-266"><a href="#cb113-266" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる度数形式データを作成</span></span>
<span id="cb113-267"><a href="#cb113-267" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, PSES, MHS)</span>
<span id="cb113-268"><a href="#cb113-268" aria-hidden="true" tabindex="-1"></a><span class="co"># データの確認</span></span>
<span id="cb113-269"><a href="#cb113-269" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb113-270"><a href="#cb113-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-271"><a href="#cb113-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-272"><a href="#cb113-272" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>このような形式のデータにすることで柔軟なモデリングを行うことができる．</span>
<span id="cb113-273"><a href="#cb113-273" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>なお<span class="in">`gnm`</span>パッケージには<span class="in">`mentalHealth`</span>というデータがそもそも存在するのでそれを用いてもよい．</span>
<span id="cb113-274"><a href="#cb113-274" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>表形式データからこのような度数形式データを作成する場合は<span class="in">`data.frame`</span>を用いれば簡単である．</span>
<span id="cb113-275"><a href="#cb113-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-278"><a href="#cb113-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-279"><a href="#cb113-279" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(tab)</span>
<span id="cb113-280"><a href="#cb113-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-281"><a href="#cb113-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-282"><a href="#cb113-282" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>逆に度数形式データから表形式データを作成するためには<span class="in">`xtabs`</span>を用いる．</span>
<span id="cb113-283"><a href="#cb113-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-286"><a href="#cb113-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-287"><a href="#cb113-287" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(Freq <span class="sc">~</span> SES <span class="sc">+</span> MHS, <span class="at">data =</span> <span class="fu">data.frame</span>(tab))</span>
<span id="cb113-288"><a href="#cb113-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-289"><a href="#cb113-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-290"><a href="#cb113-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-291"><a href="#cb113-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-292"><a href="#cb113-292" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 独立モデル {-}</span></span>
<span id="cb113-293"><a href="#cb113-293" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>この形式のデータ（<span class="in">`Freq`</span>）に対して，独立モデルによる分析を行う．これは先程の独立性の検定と同じ結果となる．</span>
<span id="cb113-294"><a href="#cb113-294" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`|&gt;`</span>はパイプ演算子であり，パイプ演算子を使うと<span class="in">`function(x)`</span>を<span class="in">`x |&gt; function()`</span>とすることができ，処理の流れが分かりやすくなる．引数（argument）が複数ある場合（例えば<span class="in">`function(x, y)`</span>）はパイプ演算子の左辺は1つめの引数として用いられる．つまり，<span class="in">`function(x, y)`</span>は<span class="in">`x |&gt; function(y)`</span>とすればよい．では<span class="in">`y |&gt;`</span>とする場合は，<span class="in">`y |&gt; function(x, _)`</span>とすることで<span class="in">`function(x, y)`</span>と同じ結果を得ることができる．<span class="in">`_`</span>はプレースホルダーと呼ばれ，引数が適用される場所を示している．</span>
<span id="cb113-295"><a href="#cb113-295" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`d`</span>というデータに対して，<span class="in">`gnm`</span>を適用する．<span class="in">`度数 ~ 行変数 + 列変数`</span>といった形で関連を指定する．<span class="in">`glm`</span>を使ってもよいが，最終的には<span class="in">`gnm`</span>を使うことになるので，ここでは<span class="in">`gnm`</span>を用いる．</span>
<span id="cb113-296"><a href="#cb113-296" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>モデルの分布族（family）は<span class="in">`poisson`</span>（ポワソン分布）とする．これを忘れると<span class="in">`gaussian`</span>（正規分布）が適用され，異なる結果が出力されるので注意する</span>
<span id="cb113-297"><a href="#cb113-297" aria-hidden="true" tabindex="-1"></a>．<span class="in">`gnm`</span>内で<span class="in">`data = _`</span>となっているが<span class="in">`_`</span>にはパイプ演算子の左辺にある<span class="in">`d`</span>が入る．つまりこれは<span class="in">`data = d`</span>とすることに等しい．</span>
<span id="cb113-298"><a href="#cb113-298" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>こうして得られた分析の結果を<span class="in">`O`</span>としている．</span>
<span id="cb113-299"><a href="#cb113-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-302"><a href="#cb113-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-303"><a href="#cb113-303" aria-hidden="true" tabindex="-1"></a><span class="co"># 独立モデル</span></span>
<span id="cb113-304"><a href="#cb113-304" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb113-305"><a href="#cb113-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> PSES <span class="sc">+</span> MHS, </span>
<span id="cb113-306"><a href="#cb113-306" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb113-307"><a href="#cb113-307" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>,</span>
<span id="cb113-308"><a href="#cb113-308" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb113-309"><a href="#cb113-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-310"><a href="#cb113-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-311"><a href="#cb113-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-312"><a href="#cb113-312" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>結果は<span class="in">`O`</span>（係数と最小限の適合度のみ）あるいは<span class="in">`summary(O)`</span>（標準誤差やp値を含んだモデルの結果の要約）で確認できる．</span>
<span id="cb113-313"><a href="#cb113-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-316"><a href="#cb113-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-317"><a href="#cb113-317" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果の表示</span></span>
<span id="cb113-318"><a href="#cb113-318" aria-hidden="true" tabindex="-1"></a>O</span>
<span id="cb113-319"><a href="#cb113-319" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(O)</span>
<span id="cb113-320"><a href="#cb113-320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-321"><a href="#cb113-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-322"><a href="#cb113-322" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>他にもどのような情報があるのかをヘルプか<span class="in">`names`</span>で確認する．</span>
<span id="cb113-323"><a href="#cb113-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-326"><a href="#cb113-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-327"><a href="#cb113-327" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(O)</span>
<span id="cb113-328"><a href="#cb113-328" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">summary</span>(O))</span>
<span id="cb113-329"><a href="#cb113-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-330"><a href="#cb113-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-331"><a href="#cb113-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-332"><a href="#cb113-332" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>結果には期待度数<span class="in">`fitted.values`</span>があるので，これを用いて適合度を計算してみる．</span>
<span id="cb113-333"><a href="#cb113-333" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>観測度数については<span class="in">`Freq`</span>の変わりに<span class="in">`O$y`</span>を用いてもよい．これはモデル<span class="in">`O`</span>で使用された従属変数<span class="in">`y`</span>であり，<span class="in">`Freq`</span>そのものである．</span>
<span id="cb113-334"><a href="#cb113-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-337"><a href="#cb113-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-338"><a href="#cb113-338" aria-hidden="true" tabindex="-1"></a><span class="co"># 期待度数をexpected_Oとする</span></span>
<span id="cb113-339"><a href="#cb113-339" aria-hidden="true" tabindex="-1"></a>observed <span class="ot">&lt;-</span> O<span class="sc">$</span>y</span>
<span id="cb113-340"><a href="#cb113-340" aria-hidden="true" tabindex="-1"></a>expected_O <span class="ot">&lt;-</span> O<span class="sc">$</span>fitted.values</span>
<span id="cb113-341"><a href="#cb113-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-342"><a href="#cb113-342" aria-hidden="true" tabindex="-1"></a><span class="co"># 行と列のカテゴリ数をユニークな値の数から求める</span></span>
<span id="cb113-343"><a href="#cb113-343" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> d<span class="sc">$</span>PSES <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">length</span>()</span>
<span id="cb113-344"><a href="#cb113-344" aria-hidden="true" tabindex="-1"></a>J <span class="ot">&lt;-</span> d<span class="sc">$</span>MHS <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">length</span>()</span>
<span id="cb113-345"><a href="#cb113-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-346"><a href="#cb113-346" aria-hidden="true" tabindex="-1"></a><span class="co"># 自由度</span></span>
<span id="cb113-347"><a href="#cb113-347" aria-hidden="true" tabindex="-1"></a>df_O <span class="ot">&lt;-</span> (I <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (J <span class="sc">-</span> <span class="dv">1</span>) </span>
<span id="cb113-348"><a href="#cb113-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-349"><a href="#cb113-349" aria-hidden="true" tabindex="-1"></a><span class="co"># 適合度（X2とL2）</span></span>
<span id="cb113-350"><a href="#cb113-350" aria-hidden="true" tabindex="-1"></a>X2_O <span class="ot">&lt;-</span> ((observed <span class="sc">-</span> expected_O)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> expected_O) <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span>
<span id="cb113-351"><a href="#cb113-351" aria-hidden="true" tabindex="-1"></a>L2_O <span class="ot">&lt;-</span> (observed <span class="sc">*</span> <span class="fu">log</span>(observed <span class="sc">/</span> expected_O)) <span class="sc">|&gt;</span> <span class="fu">sum</span>() <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb113-352"><a href="#cb113-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-353"><a href="#cb113-353" aria-hidden="true" tabindex="-1"></a><span class="co"># リストでまとめて表示</span></span>
<span id="cb113-354"><a href="#cb113-354" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"自由度"</span> <span class="ot">=</span> df_O,</span>
<span id="cb113-355"><a href="#cb113-355" aria-hidden="true" tabindex="-1"></a>     <span class="st">"ピアソンのカイ2乗統計量"</span> <span class="ot">=</span> X2_O,</span>
<span id="cb113-356"><a href="#cb113-356" aria-hidden="true" tabindex="-1"></a>     <span class="st">"尤度比統計量"</span> <span class="ot">=</span> L2_O)</span>
<span id="cb113-357"><a href="#cb113-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-358"><a href="#cb113-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-359"><a href="#cb113-359" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`summary(O)`</span>では<span class="in">`Residual deviance: 47.418 on 15 degrees of freedom`</span>となっており，先程の分析と適合度は一致する．</span>
<span id="cb113-360"><a href="#cb113-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-361"><a href="#cb113-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-362"><a href="#cb113-362" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 一様連関モデル {-}</span></span>
<span id="cb113-363"><a href="#cb113-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-364"><a href="#cb113-364" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>次に一様連関モデル（Uniform association model）による分析を行う．</span>
<span id="cb113-365"><a href="#cb113-365" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`PSES`</span>を<span class="in">`as.integer`</span>関数で整数にしたものを<span class="in">`Rscore`</span>，<span class="in">`MHS`</span>を<span class="in">`as.integer`</span>関数で整数にしたものを<span class="in">`Cscore`</span>として，<span class="in">`mutate`</span>関数でデータに新たに変数を作成している．更に平均値を引いて中心化している．<span class="in">`d &lt;- d |&gt;`</span>は<span class="in">`mutate`</span>変数を追加して元のデータに上書きをしている．</span>
<span id="cb113-366"><a href="#cb113-366" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>変数の追加された<span class="in">`d`</span>データに対して，一様連関モデルによる分析を<span class="in">`gnm`</span>パッケージで行う．</span>
<span id="cb113-367"><a href="#cb113-367" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>独立モデルとの違いは，作成した整数スコアの積<span class="in">`Rscore:Cscore`</span>がモデルに追加されているだけである．<span class="in">`Rscore*Cscore`</span>とすると<span class="in">`Rscore`</span>と<span class="in">`Cscore`</span>も表示されるが結果は変わらない．</span>
<span id="cb113-368"><a href="#cb113-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-371"><a href="#cb113-371" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-372"><a href="#cb113-372" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数と列変数を連続した整数値とする</span></span>
<span id="cb113-373"><a href="#cb113-373" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb113-374"><a href="#cb113-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rscore =</span> <span class="fu">as.integer</span>(PSES),</span>
<span id="cb113-375"><a href="#cb113-375" aria-hidden="true" tabindex="-1"></a>         <span class="at">Rscore =</span> Rscore <span class="sc">-</span> <span class="fu">mean</span>(Rscore),</span>
<span id="cb113-376"><a href="#cb113-376" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> <span class="fu">as.integer</span>(MHS),</span>
<span id="cb113-377"><a href="#cb113-377" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> Cscore <span class="sc">-</span> <span class="fu">mean</span>(Cscore))</span>
<span id="cb113-378"><a href="#cb113-378" aria-hidden="true" tabindex="-1"></a><span class="co"># 一様連関モデル</span></span>
<span id="cb113-379"><a href="#cb113-379" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb113-380"><a href="#cb113-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> PSES <span class="sc">+</span> MHS <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore, </span>
<span id="cb113-381"><a href="#cb113-381" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb113-382"><a href="#cb113-382" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>,</span>
<span id="cb113-383"><a href="#cb113-383" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb113-384"><a href="#cb113-384" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果の表示</span></span>
<span id="cb113-385"><a href="#cb113-385" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(U)</span>
<span id="cb113-386"><a href="#cb113-386" aria-hidden="true" tabindex="-1"></a><span class="co"># 適合度（X2とL2）</span></span>
<span id="cb113-387"><a href="#cb113-387" aria-hidden="true" tabindex="-1"></a>observed <span class="ot">&lt;-</span> U<span class="sc">$</span>y</span>
<span id="cb113-388"><a href="#cb113-388" aria-hidden="true" tabindex="-1"></a>expected_U <span class="ot">&lt;-</span> U<span class="sc">$</span>fitted.values</span>
<span id="cb113-389"><a href="#cb113-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-390"><a href="#cb113-390" aria-hidden="true" tabindex="-1"></a>df_U <span class="ot">&lt;-</span> (I <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>(J <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb113-391"><a href="#cb113-391" aria-hidden="true" tabindex="-1"></a>X2_U <span class="ot">&lt;-</span> ((observed <span class="sc">-</span> expected_U)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> expected_U) <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span>
<span id="cb113-392"><a href="#cb113-392" aria-hidden="true" tabindex="-1"></a>L2_U <span class="ot">&lt;-</span> (observed <span class="sc">*</span> <span class="fu">log</span>(observed <span class="sc">/</span> expected_U)) <span class="sc">|&gt;</span> <span class="fu">sum</span>() <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb113-393"><a href="#cb113-393" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"自由度"</span> <span class="ot">=</span> df_U,</span>
<span id="cb113-394"><a href="#cb113-394" aria-hidden="true" tabindex="-1"></a>     <span class="st">"ピアソンのカイ2乗統計量"</span> <span class="ot">=</span> X2_U, </span>
<span id="cb113-395"><a href="#cb113-395" aria-hidden="true" tabindex="-1"></a>     <span class="st">"尤度比統計量"</span> <span class="ot">=</span> L2_U)</span>
<span id="cb113-396"><a href="#cb113-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-397"><a href="#cb113-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-398"><a href="#cb113-398" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>結果がixページと一致することを確認してほしい．</span>
<span id="cb113-399"><a href="#cb113-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-400"><a href="#cb113-400" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>なお，尤度比統計量$L^2$と自由度は次のように求めることができる．</span>
<span id="cb113-401"><a href="#cb113-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-404"><a href="#cb113-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-405"><a href="#cb113-405" aria-hidden="true" tabindex="-1"></a><span class="co"># 独立モデルのL</span></span>
<span id="cb113-406"><a href="#cb113-406" aria-hidden="true" tabindex="-1"></a>O<span class="sc">$</span>deviance</span>
<span id="cb113-407"><a href="#cb113-407" aria-hidden="true" tabindex="-1"></a><span class="co"># 独立モデルのdf</span></span>
<span id="cb113-408"><a href="#cb113-408" aria-hidden="true" tabindex="-1"></a>O<span class="sc">$</span>df.residual</span>
<span id="cb113-409"><a href="#cb113-409" aria-hidden="true" tabindex="-1"></a><span class="co"># 一様連関モデルのL</span></span>
<span id="cb113-410"><a href="#cb113-410" aria-hidden="true" tabindex="-1"></a>U<span class="sc">$</span>deviance</span>
<span id="cb113-411"><a href="#cb113-411" aria-hidden="true" tabindex="-1"></a><span class="co"># 一様連関モデルのdf</span></span>
<span id="cb113-412"><a href="#cb113-412" aria-hidden="true" tabindex="-1"></a>U<span class="sc">$</span>df.residual</span>
<span id="cb113-413"><a href="#cb113-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-414"><a href="#cb113-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-415"><a href="#cb113-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-416"><a href="#cb113-416" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>尤度比統計量$L^2$と自由度の差を求める場合<span class="in">`anova`</span>関数を用いる．</span>
<span id="cb113-417"><a href="#cb113-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-420"><a href="#cb113-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-421"><a href="#cb113-421" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(O, U)</span>
<span id="cb113-422"><a href="#cb113-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-423"><a href="#cb113-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-424"><a href="#cb113-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-425"><a href="#cb113-425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>以上で本書の序文の再現は終了である．</span>
<span id="cb113-426"><a href="#cb113-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-427"><a href="#cb113-427" aria-hidden="true" tabindex="-1"></a><span class="fu">## 度数，行変数，列変数のデータからクロス表を作成 {-}</span></span>
<span id="cb113-428"><a href="#cb113-428" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>度数，行変数，列変数のデータからクロス表を作成するには<span class="in">`xtabs`</span>関数を用いる．</span>
<span id="cb113-429"><a href="#cb113-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-432"><a href="#cb113-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-433"><a href="#cb113-433" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> PSES <span class="sc">+</span> MHS, <span class="at">data =</span> _)</span>
<span id="cb113-434"><a href="#cb113-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-435"><a href="#cb113-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-436"><a href="#cb113-436" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rに初めから準備されている<span class="in">`Titanic`</span>データは，多少特殊な集計がされているが，これに<span class="in">`data.frame`</span>関数を適用すると，集計データになる．これに対して<span class="in">`xtabs`</span>関数を用いればクロス表を簡単に作成できる．</span>
<span id="cb113-437"><a href="#cb113-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-440"><a href="#cb113-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-441"><a href="#cb113-441" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(Titanic) <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> Class <span class="sc">+</span> Survived, <span class="at">data =</span> _)</span>
<span id="cb113-442"><a href="#cb113-442" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(Titanic) <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> Sex <span class="sc">+</span> Survived, <span class="at">data =</span> _)</span>
<span id="cb113-443"><a href="#cb113-443" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(Titanic) <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> Age <span class="sc">+</span> Survived, <span class="at">data =</span> _)</span>
<span id="cb113-444"><a href="#cb113-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-445"><a href="#cb113-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-446"><a href="#cb113-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-447"><a href="#cb113-447" aria-hidden="true" tabindex="-1"></a><span class="fu">## 個票データから集計データを作成</span></span>
<span id="cb113-448"><a href="#cb113-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-449"><a href="#cb113-449" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>個票データから集計データを作成する方法はいくつか考えられるが，ここでは<span class="in">`count`</span>関数を用いる．</span>
<span id="cb113-450"><a href="#cb113-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-453"><a href="#cb113-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-454"><a href="#cb113-454" aria-hidden="true" tabindex="-1"></a><span class="co"># スターウォーズデータ</span></span>
<span id="cb113-455"><a href="#cb113-455" aria-hidden="true" tabindex="-1"></a>starwars</span>
<span id="cb113-456"><a href="#cb113-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-457"><a href="#cb113-457" aria-hidden="true" tabindex="-1"></a><span class="co"># 1つの変数にcount関数を適用</span></span>
<span id="cb113-458"><a href="#cb113-458" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span> </span>
<span id="cb113-459"><a href="#cb113-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex)</span>
<span id="cb113-460"><a href="#cb113-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-461"><a href="#cb113-461" aria-hidden="true" tabindex="-1"></a><span class="co"># 2つの変数にcount関数を適用し，集計レベルのデータを作成</span></span>
<span id="cb113-462"><a href="#cb113-462" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">|&gt;</span> </span>
<span id="cb113-463"><a href="#cb113-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, gender)</span>
<span id="cb113-464"><a href="#cb113-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-465"><a href="#cb113-465" aria-hidden="true" tabindex="-1"></a><span class="co"># 欠損値を処理し，nをFreqと名前を変更し，df_dstarwarsとしてデータを保存</span></span>
<span id="cb113-466"><a href="#cb113-466" aria-hidden="true" tabindex="-1"></a>df_dstarwars <span class="ot">&lt;-</span> starwars <span class="sc">|&gt;</span> </span>
<span id="cb113-467"><a href="#cb113-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, gender) <span class="sc">|&gt;</span> </span>
<span id="cb113-468"><a href="#cb113-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb113-469"><a href="#cb113-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Freq =</span> n)</span>
<span id="cb113-470"><a href="#cb113-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-471"><a href="#cb113-471" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認</span></span>
<span id="cb113-472"><a href="#cb113-472" aria-hidden="true" tabindex="-1"></a>df_dstarwars</span>
<span id="cb113-473"><a href="#cb113-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-474"><a href="#cb113-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-475"><a href="#cb113-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-476"><a href="#cb113-476" aria-hidden="true" tabindex="-1"></a><span class="fu">## 集計データを個票データに変換</span></span>
<span id="cb113-477"><a href="#cb113-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-478"><a href="#cb113-478" aria-hidden="true" tabindex="-1"></a>集計データを個票データに変換したいときには<span class="in">`vcdExtra`</span>パッケージの<span class="in">`expand.dft`</span>を用いる．</span>
<span id="cb113-479"><a href="#cb113-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-480"><a href="#cb113-480" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message =  FALSE}</span></span>
<span id="cb113-481"><a href="#cb113-481" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb113-482"><a href="#cb113-482" aria-hidden="true" tabindex="-1"></a>d_ind <span class="ot">&lt;-</span> <span class="fu">expand.dft</span>(d, <span class="at">dreq =</span> <span class="st">"Freq"</span>)</span>
<span id="cb113-483"><a href="#cb113-483" aria-hidden="true" tabindex="-1"></a>d_ind</span>
<span id="cb113-484"><a href="#cb113-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-485"><a href="#cb113-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-486"><a href="#cb113-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-487"><a href="#cb113-487" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3元クロス分類表の入力</span></span>
<span id="cb113-488"><a href="#cb113-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-491"><a href="#cb113-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb113-492"><a href="#cb113-492" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb113-493"><a href="#cb113-493" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">1</span>,</span>
<span id="cb113-494"><a href="#cb113-494" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>,</span>
<span id="cb113-495"><a href="#cb113-495" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-496"><a href="#cb113-496" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">5</span>,</span>
<span id="cb113-497"><a href="#cb113-497" aria-hidden="true" tabindex="-1"></a>  <span class="dv">8</span>,<span class="dv">0</span>,<span class="dv">1</span>,</span>
<span id="cb113-498"><a href="#cb113-498" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-499"><a href="#cb113-499" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">5</span>,</span>
<span id="cb113-500"><a href="#cb113-500" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,</span>
<span id="cb113-501"><a href="#cb113-501" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-502"><a href="#cb113-502" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb113-503"><a href="#cb113-503" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb113-504"><a href="#cb113-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-505"><a href="#cb113-505" aria-hidden="true" tabindex="-1"></a><span class="fu">array</span>(data, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb113-506"><a href="#cb113-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-507"><a href="#cb113-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-508"><a href="#cb113-508" aria-hidden="true" tabindex="-1"></a>tab1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">1</span>,</span>
<span id="cb113-509"><a href="#cb113-509" aria-hidden="true" tabindex="-1"></a>          <span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span><span class="cn">TRUE</span>)</span>
<span id="cb113-510"><a href="#cb113-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-511"><a href="#cb113-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-512"><a href="#cb113-512" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">5</span>,</span>
<span id="cb113-513"><a href="#cb113-513" aria-hidden="true" tabindex="-1"></a>          <span class="dv">8</span>,<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span><span class="cn">TRUE</span>)</span>
<span id="cb113-514"><a href="#cb113-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-515"><a href="#cb113-515" aria-hidden="true" tabindex="-1"></a>tab3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">5</span>,</span>
<span id="cb113-516"><a href="#cb113-516" aria-hidden="true" tabindex="-1"></a>          <span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span><span class="cn">TRUE</span>)</span>
<span id="cb113-517"><a href="#cb113-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-518"><a href="#cb113-518" aria-hidden="true" tabindex="-1"></a>tab4 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb113-519"><a href="#cb113-519" aria-hidden="true" tabindex="-1"></a>          <span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span><span class="cn">TRUE</span>)</span>
<span id="cb113-520"><a href="#cb113-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-521"><a href="#cb113-521" aria-hidden="true" tabindex="-1"></a>tab_merge <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(tab1,tab2,tab3,tab4), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb113-522"><a href="#cb113-522" aria-hidden="true" tabindex="-1"></a>tab_merge</span>
<span id="cb113-523"><a href="#cb113-523" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab_merge) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">c</span>(<span class="st">"men"</span>,<span class="st">"women"</span>),</span>
<span id="cb113-524"><a href="#cb113-524" aria-hidden="true" tabindex="-1"></a>                            <span class="at">C =</span> <span class="fu">c</span>(<span class="st">"blue"</span>,<span class="st">"red"</span>,<span class="st">"green"</span>),</span>
<span id="cb113-525"><a href="#cb113-525" aria-hidden="true" tabindex="-1"></a>                            <span class="at">L =</span> <span class="fu">c</span>(<span class="st">"north"</span>,<span class="st">"south"</span>,<span class="st">"east"</span>,<span class="st">"west"</span>))</span>
<span id="cb113-526"><a href="#cb113-526" aria-hidden="true" tabindex="-1"></a>tab_merge</span>
<span id="cb113-527"><a href="#cb113-527" aria-hidden="true" tabindex="-1"></a><span class="co"># フラットな形式で3元表を表示</span></span>
<span id="cb113-528"><a href="#cb113-528" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(tab_merge)</span>
<span id="cb113-529"><a href="#cb113-529" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb113-530"><a href="#cb113-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-531"><a href="#cb113-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-532"><a href="#cb113-532" aria-hidden="true" tabindex="-1"></a>Friendly and Meyer (2016) を参考に表を作成．</span>
<span id="cb113-533"><a href="#cb113-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-534"><a href="#cb113-534" aria-hidden="true" tabindex="-1"></a>|元のデータ形式|変換後のデータ形式|方法|</span>
<span id="cb113-535"><a href="#cb113-535" aria-hidden="true" tabindex="-1"></a>|:---|:---|:---|</span>
<span id="cb113-536"><a href="#cb113-536" aria-hidden="true" tabindex="-1"></a>|ケース形式|度数形式|<span class="in">`data.frame(table(d$A,d$B))`</span>|</span>
<span id="cb113-537"><a href="#cb113-537" aria-hidden="true" tabindex="-1"></a>|ケース形式|表形式|<span class="in">`table(d$A,d$B)`</span>|</span>
<span id="cb113-538"><a href="#cb113-538" aria-hidden="true" tabindex="-1"></a>|度数形式|ケース形式|<span class="in">`expand.dfr(X)`</span>|</span>
<span id="cb113-539"><a href="#cb113-539" aria-hidden="true" tabindex="-1"></a>|度数形式|表形式| <span class="in">`xtabs(Freq ~ A + B)`</span>|</span>
<span id="cb113-540"><a href="#cb113-540" aria-hidden="true" tabindex="-1"></a>|表形式|ケース形式|<span class="in">`expand.dfr(X)`</span>|</span>
<span id="cb113-541"><a href="#cb113-541" aria-hidden="true" tabindex="-1"></a>|表形式|度数形式|<span class="in">`data.frame(tab)`</span>|</span>
<span id="cb113-542"><a href="#cb113-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-543"><a href="#cb113-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-544"><a href="#cb113-544" aria-hidden="true" tabindex="-1"></a><span class="fu">## 練習問題 {-}</span></span>
<span id="cb113-545"><a href="#cb113-545" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>せっかくデータを入力したので，このデータを使ってGoodman（1979）の表5A，表5B，表5Cの結果を再現しよう．</span>
<span id="cb113-546"><a href="#cb113-546" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>分析方法については第2章のプログラムを参考にしてほしい．</span>
<span id="cb113-547"><a href="#cb113-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-548"><a href="#cb113-548" aria-hidden="true" tabindex="-1"></a><span class="fu">## 参考文献 {-}</span></span>
<span id="cb113-549"><a href="#cb113-549" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Goodman, Leo A. 1979. “Simple Models for the Analysis of Association in Cross-Classifications Having Ordered Categories.”*Journal of the American Statistical Association* 74(367):537–52.</span>
<span id="cb113-550"><a href="#cb113-550" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>