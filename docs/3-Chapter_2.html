<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>『カテゴリカルデータのための連関モデル』 - 2&nbsp; 第2章</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./4-Chapter_3.html" rel="next">
<link href="./2-Chapter_1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./3-Chapter_2.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">第2章</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">『カテゴリカルデータのための連関モデル』</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">はじめに</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">シリーズ編者による内容紹介</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-Chapter_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">第1章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-Chapter_2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">第2章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4-Chapter_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">第3章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5-Chapter_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">第4章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6-Chapter_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">第5章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7-Chapter_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">第6章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8-df.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">自由度</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9-Note.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">補足のノート</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RとRStudioのインストールと基本的な操作方法</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#対比について" id="toc-対比について" class="nav-link active" data-scroll-target="#対比について"><span class="header-section-number">2.1</span> 対比について</a></li>
  <li><a href="#表2.1-p.11" id="toc-表2.1-p.11" class="nav-link" data-scroll-target="#表2.1-p.11"><span class="header-section-number">2.2</span> 表2.1 (p.11)</a></li>
  <li><a href="#表2.3a-p.32" id="toc-表2.3a-p.32" class="nav-link" data-scroll-target="#表2.3a-p.32"><span class="header-section-number">2.3</span> 表2.3A (p.32)</a>
  <ul class="collapse">
  <li><a href="#独立モデル" id="toc-独立モデル" class="nav-link" data-scroll-target="#独立モデル"><span class="header-section-number">2.3.1</span> 独立モデル</a></li>
  <li><a href="#一様連関モデル" id="toc-一様連関モデル" class="nav-link" data-scroll-target="#一様連関モデル"><span class="header-section-number">2.3.2</span> 一様連関モデル</a></li>
  <li><a href="#行効果モデル" id="toc-行効果モデル" class="nav-link" data-scroll-target="#行効果モデル"><span class="header-section-number">2.3.3</span> 行効果モデル</a></li>
  </ul></li>
  <li><a href="#列効果モデル" id="toc-列効果モデル" class="nav-link" data-scroll-target="#列効果モデル"><span class="header-section-number">2.4</span> 列効果モデル</a></li>
  <li><a href="#行列効果モデルrc" id="toc-行列効果モデルrc" class="nav-link" data-scroll-target="#行列効果モデルrc"><span class="header-section-number">2.5</span> 行・列効果モデル（<span class="math inline">\(R+C\)</span>）</a></li>
  <li><a href="#行列効果モデルrc1" id="toc-行列効果モデルrc1" class="nav-link" data-scroll-target="#行列効果モデルrc1"><span class="header-section-number">2.6</span> 行・列効果モデル（<span class="math inline">\(RC(1)\)</span>）</a></li>
  <li><a href="#周辺重みづけ" id="toc-周辺重みづけ" class="nav-link" data-scroll-target="#周辺重みづけ"><span class="header-section-number">2.7</span> 周辺重みづけ</a></li>
  <li><a href="#表2.4a" id="toc-表2.4a" class="nav-link" data-scroll-target="#表2.4a"><span class="header-section-number">2.8</span> 表2.4A</a></li>
  <li><a href="#表2.4b" id="toc-表2.4b" class="nav-link" data-scroll-target="#表2.4b"><span class="header-section-number">2.9</span> 表2.4B</a></li>
  <li><a href="#表2.5a" id="toc-表2.5a" class="nav-link" data-scroll-target="#表2.5a"><span class="header-section-number">2.10</span> 表2.5A</a></li>
  <li><a href="#表2.5b" id="toc-表2.5b" class="nav-link" data-scroll-target="#表2.5b"><span class="header-section-number">2.11</span> 表2.5B</a></li>
  <li><a href="#表2.5b他の正規化" id="toc-表2.5b他の正規化" class="nav-link" data-scroll-target="#表2.5b他の正規化"><span class="header-section-number">2.12</span> 表2.5B（他の正規化）</a></li>
  <li><a href="#表2.5c" id="toc-表2.5c" class="nav-link" data-scroll-target="#表2.5c"><span class="header-section-number">2.13</span> 表2.5C</a></li>
  <li><a href="#表2.5c他の正規化" id="toc-表2.5c他の正規化" class="nav-link" data-scroll-target="#表2.5c他の正規化"><span class="header-section-number">2.14</span> 表2.5C（他の正規化）</a></li>
  <li><a href="#表2.5d" id="toc-表2.5d" class="nav-link" data-scroll-target="#表2.5d"><span class="header-section-number">2.15</span> 表2.5D</a></li>
  <li><a href="#表2.5d他の正規化" id="toc-表2.5d他の正規化" class="nav-link" data-scroll-target="#表2.5d他の正規化"><span class="header-section-number">2.16</span> 表2.5D（他の正規化）</a></li>
  <li><a href="#表2.5e" id="toc-表2.5e" class="nav-link" data-scroll-target="#表2.5e"><span class="header-section-number">2.17</span> 表2.5E</a></li>
  <li><a href="#logmultパッケージの利用" id="toc-logmultパッケージの利用" class="nav-link" data-scroll-target="#logmultパッケージの利用"><span class="header-section-number">2.18</span> logmultパッケージの利用</a></li>
  <li><a href="#表2.3b" id="toc-表2.3b" class="nav-link" data-scroll-target="#表2.3b"><span class="header-section-number">2.19</span> 表2.3B</a></li>
  <li><a href="#表2.6a" id="toc-表2.6a" class="nav-link" data-scroll-target="#表2.6a"><span class="header-section-number">2.20</span> 表2.6A</a></li>
  <li><a href="#表2.6b" id="toc-表2.6b" class="nav-link" data-scroll-target="#表2.6b"><span class="header-section-number">2.21</span> 表2.6B</a></li>
  <li><a href="#表2.6c" id="toc-表2.6c" class="nav-link" data-scroll-target="#表2.6c"><span class="header-section-number">2.22</span> 表2.6C</a></li>
  <li><a href="#表2.7a" id="toc-表2.7a" class="nav-link" data-scroll-target="#表2.7a"><span class="header-section-number">2.23</span> 表2.7A</a></li>
  <li><a href="#表2.7b" id="toc-表2.7b" class="nav-link" data-scroll-target="#表2.7b"><span class="header-section-number">2.24</span> 表2.7B</a></li>
  <li><a href="#表2.7c" id="toc-表2.7c" class="nav-link" data-scroll-target="#表2.7c"><span class="header-section-number">2.25</span> 表2.7C</a></li>
  <li><a href="#表2.7d" id="toc-表2.7d" class="nav-link" data-scroll-target="#表2.7d"><span class="header-section-number">2.26</span> 表2.7D</a></li>
  <li><a href="#表2.7e" id="toc-表2.7e" class="nav-link" data-scroll-target="#表2.7e"><span class="header-section-number">2.27</span> 表2.7E</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">第2章</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>第2章では2元表の連関モデルが紹介されている．制約のかけかたは少し複雑なのでプログラムとテキストをみながら手順を確認して欲しい．</p>
<p>パッケージは<code>tidyverse</code>（データセットの処理のため），<code>DescTools</code>（記述統計を求めるため），<code>vcd</code>パッケージ（カテゴリカルデータの分析のため），<code>broom</code>（回帰係数の整理），<code>gnm</code>（連関分析の処理のため），<code>logmult</code>（連関モデルのため）を使用する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="対比について" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="対比について"><span class="header-section-number">2.1</span> 対比について</h2>
<p>回帰モデルにおけるカテゴリカル変数の係数を解釈する上では対比 （contrasts）が重要である．まず，デフォルトでの<code>contrasts</code>を確認したい．<code>factor</code>変数については<code>contr.treatment</code>，<code>ordered</code>変数については<code>contr.poly</code>という対比が用いられている．<code>contr.treatment</code>は基準となっている水準とそれぞれの水準を対比する．これはダミーコーディングと呼ばれる． <code>contr.poly</code>は直交多項式（orthogonal polynomials）に基づいた対比を行う（気にしなくてよい）．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトのcontrastsを確認</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$contrasts
        unordered           ordered 
"contr.treatment"      "contr.poly" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># defaultのcontrastsの設定（ここでは特に意味はない．constrastをいじった後にデフォルトに戻す）</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>具体的に何をしているのかを以下のプログラムで確認する． ダミーコーディングの<code>contr.treatment</code>以外にも効果コーディングの<code>contr.sum</code>がある．両者を比較してみたい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの作成</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"E"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A" "B" "C" "D" "E"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 基準カテゴリが0となるような対比</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contr.treatment</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  B C D E
A 0 0 0 0
B 1 0 0 0
C 0 1 0 0
D 0 0 1 0
E 0 0 0 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 合計が0となるような対比</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contr.sum</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [,1] [,2] [,3] [,4]
A    1    0    0    0
B    0    1    0    0
C    0    0    1    0
D    0    0    0    1
E   -1   -1   -1   -1</code></pre>
</div>
</div>
<p>実際に回帰分析を例に<code>contr.treatment</code>と<code>contr.sum</code>の違いを確認する．データは<code>mpg</code>（Fuel economy data from 1999 to 2008 for 38 popular models of cars）である．従属変数は<code>hwy</code>（highway miles per gallon）であり，独立変数は<code>class</code>（“type” of car）とする．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># class別のhwyの平均値</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(hwy)),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Mean =</span> <span class="fu">mean</span>(hwy, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.by =</span> class) <span class="sc">|&gt;</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Diff_1 =</span> Mean <span class="sc">-</span> Mean[class <span class="sc">==</span> <span class="st">"2seater"</span>],</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Diff_2 =</span> Mean <span class="sc">-</span> <span class="fu">mean</span>(Mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  class          n  Mean Diff_1 Diff_2
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 compact       47  28.3   3.50   4.60
2 midsize       41  27.3   2.49   3.59
3 suv           62  18.1  -6.67  -5.57
4 2seater        5  24.8   0      1.10
5 minivan       11  22.4  -2.44  -1.34
6 pickup        33  16.9  -7.92  -6.82
7 subcompact    35  28.1   3.34   4.44</code></pre>
</div>
</div>
<p>まずダミーコーディング（dummy coding）の結果を確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の例（contr.treatmentを使用）</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>fit_ct <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の結果</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_ct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hwy ~ class, data = mpg)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.1429 -1.8788 -0.2927  1.1803 15.8571 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       24.800      1.507  16.454  &lt; 2e-16 ***
classcompact       3.498      1.585   2.206   0.0284 *  
classmidsize       2.493      1.596   1.561   0.1198    
classminivan      -2.436      1.818  -1.340   0.1815    
classpickup       -7.921      1.617  -4.898 1.84e-06 ***
classsubcompact    3.343      1.611   2.075   0.0391 *  
classsuv          -6.671      1.567  -4.258 3.03e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.37 on 227 degrees of freedom
Multiple R-squared:  0.6879,    Adjusted R-squared:  0.6797 
F-statistic: 83.39 on 6 and 227 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデルマトリックス</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(fit_ct) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) classcompact classmidsize classminivan classpickup
1            1            1            0            0           0
16           1            0            1            0           0
19           1            0            0            0           0
24           1            0            0            0           0
38           1            0            0            1           0
49           1            0            0            0           1
91           1            0            0            0           0
   classsubcompact classsuv
1                0        0
16               0        0
19               0        1
24               0        0
38               0        0
49               0        0
91               1        0</code></pre>
</div>
</div>
<p>出力される係数は6つである．<code>class</code>は<code>factor</code>によって水準が設定されているわけではないので，<code>2seater</code>が基準カテゴリとなっており，出力からは省略されている．つまり，<code>2seater</code>の係数は0であり，<code>(Intercept)</code>の値は<code>2seater</code>の平均値を示している．</p>
<p>次に効果コーディングの結果を確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の例（contr.sumを使用）</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.sum"</span>, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>fit_cs <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の結果</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hwy ~ class, data = mpg)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.1429 -1.8788 -0.2927  1.1803 15.8571 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  23.7007     0.3089  76.730  &lt; 2e-16 ***
class1        1.0993     1.3108   0.839    0.403    
class2        4.5972     0.5177   8.880  &lt; 2e-16 ***
class3        3.5920     0.5416   6.633 2.39e-10 ***
class4       -1.3371     0.9127  -1.465    0.144    
class5       -6.8219     0.5842 -11.678  &lt; 2e-16 ***
class6        4.4422     0.5720   7.766 2.77e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.37 on 227 degrees of freedom
Multiple R-squared:  0.6879,    Adjusted R-squared:  0.6797 
F-statistic: 83.39 on 6 and 227 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデルマトリックス</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(fit_cs) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) class1 class2 class3 class4 class5 class6
1            1      0      1      0      0      0      0
16           1      0      0      1      0      0      0
19           1     -1     -1     -1     -1     -1     -1
24           1      1      0      0      0      0      0
38           1      0      0      0      1      0      0
49           1      0      0      0      0      1      0
91           1      0      0      0      0      0      1</code></pre>
</div>
</div>
<p>ここでも出力される係数は6つであるが，ここでは最後のカテゴリが省略されている．しかし，最後のカテゴリである<code>classsuv</code>の係数は0ではない．すべての係数の和が0になるという制約を与えているので，<code>classsuv</code>の係数は他の係数の値の和を0から引いたものとなる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># classという文字が含まれる係数を取り出し，係数の番号を調べる（2から7）</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(fit_cs, <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class1 class2 class3 class4 class5 class6 
     2      3      4      5      6      7 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 係数の2から7までを取り出し，その和を求める．</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fit_cs<span class="sc">$</span>coefficients[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.571663</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 和を0から引く</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="sc">-</span> (fit_cs<span class="sc">$</span>coefficients[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">|&gt;</span> <span class="fu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -5.571663</code></pre>
</div>
</div>
<p>したがって，<code>classsuv</code>の係数は-5.571663となる．</p>
<p><code>contrasts</code>の設定を変更して分析を終えたら必ずもとに戻しておく．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトに戻す</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>lm</code>ではモデルの中で<code>contrasts</code>を指定することもできる．2つの方法で係数を比較してみる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>fit_cs2_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の結果</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cs2_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hwy ~ class, data = mpg)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.1429 -1.8788 -0.2927  1.1803 15.8571 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       24.800      1.507  16.454  &lt; 2e-16 ***
classcompact       3.498      1.585   2.206   0.0284 *  
classmidsize       2.493      1.596   1.561   0.1198    
classminivan      -2.436      1.818  -1.340   0.1815    
classpickup       -7.921      1.617  -4.898 1.84e-06 ***
classsubcompact    3.343      1.611   2.075   0.0391 *  
classsuv          -6.671      1.567  -4.258 3.03e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.37 on 227 degrees of freedom
Multiple R-squared:  0.6879,    Adjusted R-squared:  0.6797 
F-statistic: 83.39 on 6 and 227 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>fit_cs2_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">contrasts =</span> <span class="fu">list</span>(<span class="at">class =</span> <span class="st">"contr.sum"</span>))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の結果</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cs2_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hwy ~ class, data = mpg, contrasts = list(class = "contr.sum"))

Residuals:
    Min      1Q  Median      3Q     Max 
-8.1429 -1.8788 -0.2927  1.1803 15.8571 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  23.7007     0.3089  76.730  &lt; 2e-16 ***
class1        1.0993     1.3108   0.839    0.403    
class2        4.5972     0.5177   8.880  &lt; 2e-16 ***
class3        3.5920     0.5416   6.633 2.39e-10 ***
class4       -1.3371     0.9127  -1.465    0.144    
class5       -6.8219     0.5842 -11.678  &lt; 2e-16 ***
class6        4.4422     0.5720   7.766 2.77e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.37 on 227 degrees of freedom
Multiple R-squared:  0.6879,    Adjusted R-squared:  0.6797 
F-statistic: 83.39 on 6 and 227 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="表2.1-p.11" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="表2.1-p.11"><span class="header-section-number">2.2</span> 表2.1 (p.11)</h2>
<p>まずp.11の表2.1を再現する．クロス表に周辺度数を追加する場合は，<code>addmargins</code>を用いる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">40</span>, <span class="dv">250</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">160</span>,<span class="dv">3000</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>Freq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   40  250  160 3000</code></pre>
</div>
</div>
<p>ベクトルを表にする．ここでは<code>as.table</code>でクラスを<code>table</code>としている．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行列を作成し，表とする．</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  Freq,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">c</span>(<span class="fu">list</span>(</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Member =</span> <span class="fu">c</span>(<span class="st">"Member"</span>, <span class="st">"Nonmember"</span>),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Position =</span> <span class="fu">c</span>(<span class="st">"Have subordinates"</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"No subordinates"</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Position
Member      Have subordinates No subordinates
  Member                   40             250
  Nonmember               160            3000</code></pre>
</div>
</div>
<p>周辺分布とモザイクプロットも確認する．本書で指摘されている関係性が図からも見て取れる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 周辺分布の表示</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Margins</span>(tab_2<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Member
       level   freq   perc  cumfreq  cumperc
1     Member    290   8.4%      290     8.4%
2  Nonmember  3'160  91.6%    3'450   100.0%

$Position
               level   freq   perc  cumfreq  cumperc
1  Have subordinates    200   5.8%      200     5.8%
2    No subordinates  3'250  94.2%    3'450   100.0%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モザイクプロット</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>vcd<span class="sc">::</span><span class="fu">mosaic</span>(tab_2<span class="fl">.1</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">keep_aspect_ratio =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="3-Chapter_2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ggplotでモザイクプロット
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>図はすべて<code>ggplot()</code>を使用して描きたいという場合は，<code>ggmosaic</code>パッケージを用いる． その前に集計データを<code>vcdExtra::expand.dft()</code>によって個票データに変換し，<code>ggmosaic::geom_mosaic</code>を使用する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># パッケージの呼び出し</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmosaic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ggmosaic'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:vcd':

    mosaic, spine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'vcdExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    summarise</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの変換</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>df_tab_2<span class="fl">.1</span> <span class="ot">&lt;-</span> vcdExtra<span class="sc">::</span><span class="fu">expand.dft</span>(<span class="fu">data.frame</span>(tab_2<span class="fl">.1</span>), <span class="at">dreq =</span> <span class="st">"Freq"</span>) <span class="sc">|&gt;</span> <span class="fu">tibble</span>()</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>df_tab_2<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,450 × 2
   Member Position         
   &lt;chr&gt;  &lt;chr&gt;            
 1 Member Have subordinates
 2 Member Have subordinates
 3 Member Have subordinates
 4 Member Have subordinates
 5 Member Have subordinates
 6 Member Have subordinates
 7 Member Have subordinates
 8 Member Have subordinates
 9 Member Have subordinates
10 Member Have subordinates
# ℹ 3,440 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplotでモザイクプロット</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>df_tab_2<span class="fl">.1</span> <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  ggmosaic<span class="sc">::</span><span class="fu">geom_mosaic</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">product</span>(Position, Member), <span class="at">fill =</span> Position)) <span class="sc">+</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()   <span class="co"># mosaicと表示をあわせる</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `unite_()` was deprecated in tidyr 1.2.0.
ℹ Please use `unite()` instead.
ℹ The deprecated feature was likely used in the ggmosaic package.
  Please report the issue at &lt;https://github.com/haleyjeppson/ggmosaic&gt;.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="3-Chapter_2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p>表に<code>addmargins()</code>で周辺度数を追加する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A. 度数（周辺度数の追加）</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.1</span> <span class="sc">|&gt;</span> <span class="fu">addmargins</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Position
Member      Have subordinates No subordinates  Sum
  Member                   40             250  290
  Nonmember               160            3000 3160
  Sum                     200            3250 3450</code></pre>
</div>
</div>
<p>表の数字を用いてオッズ比を計算する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># B. Odds </span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> tab_2<span class="fl">.1</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span>x[<span class="dv">1</span>,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>x[<span class="dv">2</span>,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05333333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># C. Odds ratio</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>OR <span class="ot">&lt;-</span> (x[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span>x[<span class="dv">1</span>,<span class="dv">2</span>]) <span class="sc">/</span> (x[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>x[<span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>OR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>（対数）オッズ比の信頼区間をもとめる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 対数オッズの標準誤差を求める</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>SD <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span>x[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>x[<span class="dv">1</span>,<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>x[<span class="dv">2</span>,<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>x[<span class="dv">2</span>,<span class="dv">2</span>]) </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 対数オッズ比の信頼区間を求める</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>CI_log_OR <span class="ot">&lt;-</span> <span class="fu">log</span>(OR) <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)) <span class="sc">*</span> SD</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>CI_log_OR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7288936 1.4683310</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># オッズ比の信頼区間を求める</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(CI_log_OR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.072786 4.341982</code></pre>
</div>
</div>
<p><code>DescTools</code>パッケージの<code>OddsRatio</code>関数を用いてオッズ比を求める．<code>conf.level = 0.95</code>とすることで信頼区間を求めることもできる． 先程計算したものと値が一致している．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(tab_2<span class="fl">.1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>odds ratio     lwr.ci     upr.ci 
  3.000000   2.072786   4.341982 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
関数の中身を確認する．
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>OddsRatio()</code>がどのような処理をしているのかについては<code>OddsRatio</code>と入力し，関数の中身をみることで確認できる． ただし，<code>UseMethod("OddsRatio")</code>となっており，詳細が分からないことがある．その場合は，<code>methods()</code>を用いる． そして，<code>OddsRatio.default*</code>のように<code>*</code>がついているものについて<code>DescTools:::OddsRatio.default</code>のように入力することで中身を確認することができる．<code>getAnywhere(OddsRatio.default)</code>としてもよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>OddsRatio</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(OddsRatio)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>DescTools<span class="sc">:::</span>OddsRatio.default</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">getAnywhere</span>(OddsRatio.default)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>さらに詳細な結果をみたければ<code>DescTools</code>パッケージの<code>Desc</code>を用いる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Desc</span>(tab_2<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------ 
tab_2.1 (table)

Summary: 
n: 3'450, rows: 2, columns: 2

Pearson's Chi-squared test (cont. adj):
  X-squared = 35.487, df = 1, p-value = 2.568e-09
Fisher's exact test p-value = 9.541e-08
McNemar's chi-squared = 19.32, df = 1, p-value = 1.106e-05

                    estimate lwr.ci upr.ci'
                                          
odds ratio             3.000  2.073  4.342
rel. risk (col1)       2.724  1.968  3.770
rel. risk (col2)       0.908  0.867  0.951


Contingency Coeff.     0.103
Cramer's V             0.104
Kendall Tau-b          0.104

                                                                 
            Position   Have subordinates   No subordinates    Sum
Member                                                           
                                                                 
Member      freq                      40               250    290
            perc                    1.2%              7.2%   8.4%
            p.row                  13.8%             86.2%      .
            p.col                  20.0%              7.7%      .
                                                                 
Nonmember   freq                     160             3'000  3'160
            perc                    4.6%             87.0%  91.6%
            p.row                   5.1%             94.9%      .
            p.col                  80.0%             92.3%      .
                                                                 
Sum         freq                     200             3'250  3'450
            perc                    5.8%             94.2% 100.0%
            p.row                      .                 .      .
            p.col                      .                 .      .
                                                                 

----------
' 95% conf. level</code></pre>
</div>
<div class="cell-output-display">
<p><img src="3-Chapter_2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>次にセルの組み合わせを単位とした集計データを作成し，<code>gnm</code>を適用することでオッズ比を求めてみたい．<code>gl()</code>は<code>n</code>個の水準のある因子を作成する．<code>k</code>は各水準を何度繰り返すのかを指定する．<code>length</code>でベクトルの長さを設定することで，その長さになるまで因子の作成が繰り返される．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数のベクトル</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>Freq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   40  250  160 3000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>COMM <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>COMM</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 2 2
Levels: 1 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 列変数</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>SUP  <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">4</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>SUP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 1 2
Levels: 1 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなるデータを作成</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">tibble</span>(COMM, SUP, Freq)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># データの確認</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  COMM  SUP    Freq
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;
1 1     1        40
2 1     2       250
3 2     1       160
4 2     2      3000</code></pre>
</div>
</div>
<p>分析には通常は<code>glm</code>を用いるが，後の分析とあわせて<code>gnm</code>によって推定する．結果は異ならない．<code>family = poisson</code>という指定を忘れないようにすること．何も指定しないと<code>family = gaussian</code>となり，通常の線形回帰分析を行ってしまうので注意する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gnmで推定</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.1</span> <span class="sc">|&gt;</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> COMM <span class="sc">+</span> SUP <span class="sc">+</span> COMM<span class="sc">:</span>SUP, <span class="at">data =</span> _, <span class="at">family =</span> poisson)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ COMM + SUP + COMM:SUP, family = poisson, 
    data = freq_tab_2.1)

Deviance Residuals: 
[1]  0  0  0  0

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   3.6889     0.1581  23.331  &lt; 2e-16 ***
COMM2         1.3863     0.1768   7.842  &lt; 2e-16 ***
SUP2          1.8326     0.1703  10.761  &lt; 2e-16 ***
COMM2:SUP2    1.0986     0.1886   5.824 5.75e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: -5.3113e-13 on 0 degrees of freedom
AIC: 37.649

Number of iterations: 2</code></pre>
</div>
</div>
<p><code>COMM2:SUP2</code>の係数は1.0986である．これは対数オッズなので，指数関数<code>exp</code>を適用してオッズ比を求める．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratios fit$coefficientsのCOMM2:SUP2の要素のみを取り出し，指数関数expを適用</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span>coefficients[<span class="st">"COMM2:SUP2"</span>] <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>COMM2:SUP2 
         3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> <span class="fu">confint</span>(<span class="st">"COMM2:SUP2"</span>) <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   2.5 %   97.5 % 
2.049627 4.301359 </code></pre>
</div>
</div>
<p>次のようにしてもよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)[<span class="st">"COMM2:SUP2"</span>] <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>COMM2:SUP2 
         3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit)[<span class="st">"COMM2:SUP2"</span>,] <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   2.5 %   97.5 % 
2.049627 4.301359 </code></pre>
</div>
</div>
</section>
<section id="表2.3a-p.32" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="表2.3a-p.32"><span class="header-section-number">2.3</span> 表2.3A (p.32)</h2>
<p>まずは表2.3Aを作成する．値をベクトルの形式で入力する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">39</span>,  <span class="dv">50</span>,  <span class="dv">18</span>,   <span class="dv">4</span>,</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>          <span class="dv">140</span>, <span class="dv">178</span>,  <span class="dv">85</span>,  <span class="dv">23</span>,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">108</span>, <span class="dv">195</span>,  <span class="dv">97</span>,  <span class="dv">23</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>          <span class="dv">238</span>, <span class="dv">598</span>, <span class="dv">363</span>, <span class="dv">111</span>,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>           <span class="dv">78</span>, <span class="dv">250</span>, <span class="dv">150</span>,  <span class="dv">55</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>           <span class="dv">50</span>, <span class="dv">200</span>, <span class="dv">208</span>,  <span class="dv">74</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>            <span class="dv">8</span>,  <span class="dv">29</span>,  <span class="dv">46</span>,  <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ベクトルのデータを<code>matrix</code>で行列にし，最終的には<code>as.table</code>でtable形式にする．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  Freq,</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">7</span>,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">c</span>(<span class="fu">list</span>(</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">polviews =</span>  <span class="fu">c</span>(</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Strongly liberal"</span>,</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Liberal"</span>,</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Slightly liberal"</span>,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Moderate"</span>,</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Slightly conservative"</span>,</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Conservative"</span>,</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Strongly conservative"</span>),</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fefam =</span> <span class="fu">c</span>(<span class="st">"Strongly Disagree"</span>,</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Disagree"</span>,</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Agree"</span>,</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Strongly agree"</span>)</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       fefam
polviews                Strongly Disagree Disagree Agree Strongly agree
  Strongly liberal                     39       50    18              4
  Liberal                             140      178    85             23
  Slightly liberal                    108      195    97             23
  Moderate                            238      598   363            111
  Slightly conservative                78      250   150             55
  Conservative                         50      200   208             74
  Strongly conservative                 8       29    46             21</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる集計データを作成</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>polviews <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">k =</span> <span class="dv">4</span>)   <span class="co"># 1-7までの各数字について4つ値を出す</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>fefam <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">28</span>)   <span class="co"># 1-4までの数字の列を長さが28になるまで繰り返す</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, polviews, fefam)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 3
    Freq polviews fefam
   &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;
 1    39 1        1    
 2    50 1        2    
 3    18 1        3    
 4     4 1        4    
 5   140 2        1    
 6   178 2        2    
 7    85 2        3    
 8    23 2        4    
 9   108 3        1    
10   195 3        2    
# ℹ 18 more rows</code></pre>
</div>
</div>
<ul>
<li>なお<code>tab_2.3A</code>に対して，data.frameを適用しても集計データは作成される．tableの行変数と列変数が指定されていないと，行変数は<code>Var1</code>，列変数は<code>Var2</code>となるので，必要に応じて名前を<code>rename</code>で修正する ．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(tab_2<span class="fl">.3</span>A) <span class="sc">|&gt;</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 3
   polviews              fefam              Freq
   &lt;fct&gt;                 &lt;fct&gt;             &lt;dbl&gt;
 1 Strongly liberal      Strongly Disagree    39
 2 Liberal               Strongly Disagree   140
 3 Slightly liberal      Strongly Disagree   108
 4 Moderate              Strongly Disagree   238
 5 Slightly conservative Strongly Disagree    78
 6 Conservative          Strongly Disagree    50
 7 Strongly conservative Strongly Disagree     8
 8 Strongly liberal      Disagree             50
 9 Liberal               Disagree            178
10 Slightly liberal      Disagree            195
# ℹ 18 more rows</code></pre>
</div>
</div>
<p>以下では複数のモデルの適合度を比較する．そこで，モデル適合度を表示するための関数を作成する．モデルはすべて<code>gnm</code>によって推定されることを前提としている．<code>glm</code>の場合はエラーが出るので注意すること．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 引数となるobjはgnmの結果</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>model.summary <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, <span class="at">Model =</span> <span class="cn">NULL</span>){</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">class</span>(obj) <span class="sc">==</span> <span class="st">"gnm"</span>) <span class="sc">!=</span> <span class="dv">1</span>)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"estimate with gnm"</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  aic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="dv">2</span> <span class="co"># AIC(L2)</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  bic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">sum</span>(obj<span class="sc">$</span>y)) <span class="co">#BIC(L2)</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">abs</span>(obj<span class="sc">$</span>y <span class="sc">-</span> obj<span class="sc">$</span>fitted.values)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(obj<span class="sc">$</span>y))</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(obj<span class="sc">$</span>deviance, obj<span class="sc">$</span>df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)     <span class="co">#p&lt;-ifelse(p&lt;0.001,"&lt;0.001",p)</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(Model)){ </span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>  Model <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(obj))</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Model Description"</span> <span class="ot">=</span> Model,</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"df"</span> <span class="ot">=</span> obj<span class="sc">$</span>df,</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"L2"</span> <span class="ot">=</span> obj<span class="sc">$</span>deviance,</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"AIC(L2)" = aic,</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BIC"</span> <span class="ot">=</span> bic,</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Delta"</span> <span class="ot">=</span> delta,</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p"</span> <span class="ot">=</span> p</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>コントラストがデフォルトの<code>factor = "contr.treatment"</code>と<code>ordered = "contr.poly"</code>になっているのかを確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトのcontrasts</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$contrasts
           factor           ordered 
"contr.treatment"      "contr.poly" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># defaultのcontrastsの設定（ここでは特に意味はない．constrastをいじった後にデフォルトに戻す）</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>行スコアと列スコアを用いるので，まず<code>as.integer</code>を用いて行スコア（<code>Rscore</code>）と列スコア（<code>Cscore</code>）の変数を作成する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数と列変数の整数値を作成</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rscore =</span> <span class="fu">as.integer</span>(polviews),</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Rscore =</span> Rscore <span class="sc">-</span> <span class="fu">mean</span>(Rscore),</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> <span class="fu">as.integer</span>(fefam),</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> Cscore <span class="sc">-</span> <span class="fu">mean</span>(Cscore))</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 5
    Freq polviews fefam Rscore Cscore
   &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1    39 1        1         -3   -1.5
 2    50 1        2         -3   -0.5
 3    18 1        3         -3    0.5
 4     4 1        4         -3    1.5
 5   140 2        1         -2   -1.5
 6   178 2        2         -2   -0.5
 7    85 2        3         -2    0.5
 8    23 2        4         -2    1.5
 9   108 3        1         -1   -1.5
10   195 3        2         -1   -0.5
# ℹ 18 more rows</code></pre>
</div>
</div>
<section id="独立モデル" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="独立モデル"><span class="header-section-number">2.3.1</span> 独立モデル</h3>
<p>独立モデルは次のようになる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  1. O: Independence/Null Association Model</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _,</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam, family = poisson, data = freq_tab_2.3A, 
    tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-5.7415  -2.5344  -0.4283   1.5557   5.8265  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.06035    0.10115  30.256  &lt; 2e-16 ***
polviews2    1.34491    0.10657  12.620  &lt; 2e-16 ***
polviews3    1.33784    0.10664  12.545  &lt; 2e-16 ***
polviews4    2.46825    0.09886  24.968  &lt; 2e-16 ***
polviews5    1.56899    0.10433  15.038  &lt; 2e-16 ***
polviews6    1.56711    0.10435  15.018  &lt; 2e-16 ***
polviews7   -0.06514    0.13647  -0.477    0.633    
fefam2       0.81947    0.04669  17.553  &lt; 2e-16 ***
fefam3       0.38044    0.05047   7.538 4.76e-14 ***
fefam4      -0.75396    0.06876 -10.965  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 211.7 on 18 degrees of freedom
AIC: 403.05

Number of iterations: 5</code></pre>
</div>
</div>
<p>先ほど作成した適合度の関数を用いる．2つめの引数はモデルの名前の詳細を記述可能だが，これは省略してもよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(O, <span class="st">"O:Independent"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta        p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
1 O:Independent          18  212.  65.1  8.09 4.54e-35</code></pre>
</div>
</div>
<p>テキストの表2.4と同じ結果になっているのかを確認してみる．</p>
</section>
<section id="一様連関モデル" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="一様連関モデル"><span class="header-section-number">2.3.2</span> 一様連関モデル</h3>
<p>一様連関モデルでは先ほど作成した行変数と列変数の整数スコアの積である<code>Rscore:Cscore</code>を加える．<code>Rscore*Cscore</code>あるいは<code>I(Rscore*Cscore)</code>でもよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. U: Uniform Association Model</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(U)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Rscore:Cscore, family = poisson, 
    data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.62563  -0.41050  -0.06989   0.53746   1.67998  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    2.77240    0.10449  26.533  &lt; 2e-16 ***
polviews2      1.46434    0.10748  13.625  &lt; 2e-16 ***
polviews3      1.55049    0.10942  14.170  &lt; 2e-16 ***
polviews4      2.74597    0.10368  26.485  &lt; 2e-16 ***
polviews5      1.88202    0.10973  17.151  &lt; 2e-16 ***
polviews6      1.88457    0.10937  17.231  &lt; 2e-16 ***
polviews7      0.22533    0.13937   1.617    0.106    
fefam2         0.85993    0.04746  18.117  &lt; 2e-16 ***
fefam3         0.38502    0.05144   7.484 7.19e-14 ***
fefam4        -0.85901    0.07109 -12.083  &lt; 2e-16 ***
Rscore:Cscore  0.20211    0.01520  13.299  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 20.125 on 17 degrees of freedom
AIC: 213.48

Number of iterations: 4</code></pre>
</div>
</div>
<p>表2.4Aと同じ結果になっているのかを確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(U, <span class="st">"U:Uniform"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 U:Uniform              17  20.1 -118.  2.77 0.268</code></pre>
</div>
</div>
<p>モデル行列を確認するのもよいだろう．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model.matrixを適用し，ユニークな値だけを表示</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(U) <span class="sc">|&gt;</span> <span class="fu">unique</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) polviews2 polviews3 polviews4 polviews5 polviews6 polviews7
1            1         0         0         0         0         0         0
2            1         0         0         0         0         0         0
3            1         0         0         0         0         0         0
4            1         0         0         0         0         0         0
5            1         1         0         0         0         0         0
6            1         1         0         0         0         0         0
7            1         1         0         0         0         0         0
8            1         1         0         0         0         0         0
9            1         0         1         0         0         0         0
10           1         0         1         0         0         0         0
11           1         0         1         0         0         0         0
12           1         0         1         0         0         0         0
13           1         0         0         1         0         0         0
14           1         0         0         1         0         0         0
15           1         0         0         1         0         0         0
16           1         0         0         1         0         0         0
17           1         0         0         0         1         0         0
18           1         0         0         0         1         0         0
19           1         0         0         0         1         0         0
20           1         0         0         0         1         0         0
21           1         0         0         0         0         1         0
22           1         0         0         0         0         1         0
23           1         0         0         0         0         1         0
24           1         0         0         0         0         1         0
25           1         0         0         0         0         0         1
26           1         0         0         0         0         0         1
27           1         0         0         0         0         0         1
28           1         0         0         0         0         0         1
   fefam2 fefam3 fefam4 Rscore:Cscore
1       0      0      0           4.5
2       1      0      0           1.5
3       0      1      0          -1.5
4       0      0      1          -4.5
5       0      0      0           3.0
6       1      0      0           1.0
7       0      1      0          -1.0
8       0      0      1          -3.0
9       0      0      0           1.5
10      1      0      0           0.5
11      0      1      0          -0.5
12      0      0      1          -1.5
13      0      0      0           0.0
14      1      0      0           0.0
15      0      1      0           0.0
16      0      0      1           0.0
17      0      0      0          -1.5
18      1      0      0          -0.5
19      0      1      0           0.5
20      0      0      1           1.5
21      0      0      0          -3.0
22      1      0      0          -1.0
23      0      1      0           1.0
24      0      0      1           3.0
25      0      0      0          -4.5
26      1      0      0          -1.5
27      0      1      0           1.5
28      0      0      1           4.5</code></pre>
</div>
</div>
</section>
<section id="行効果モデル" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="行効果モデル"><span class="header-section-number">2.3.3</span> 行効果モデル</h3>
<p>contrastを修正し，polviewsの係数のすべてを足すと0になるように効果コーディングを行ってる．なお行変数と列スコアの積については<code>Cscore*polviews</code>とし，<code>Cscore:polviews</code>としない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. R: Row Effect Model</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co"># contrastを修正している．</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.sum"</span>, </span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.treatment"</span>))</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$contrasts
           factor           ordered 
      "contr.sum" "contr.treatment" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">*</span>polviews, </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Cscore * polviews, family = poisson, 
    data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.5962  -0.4603   0.0477   0.3840   1.5700  

Coefficients:
                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       4.262045   0.029618 143.902  &lt; 2e-16 ***
polviews1        -1.356438   0.106013 -12.795  &lt; 2e-16 ***
polviews2         0.075995   0.055906   1.359   0.1740    
polviews3         0.142487   0.053465   2.665   0.0077 ** 
polviews4         1.357080   0.036418  37.264  &lt; 2e-16 ***
polviews5         0.478200   0.046111  10.371  &lt; 2e-16 ***
polviews6         0.489287   0.045766  10.691  &lt; 2e-16 ***
fefam1           -0.112887   0.046238  -2.441   0.0146 *  
fefam2            0.758505   0.030086  25.211  &lt; 2e-16 ***
fefam3            0.295555   0.032630   9.058  &lt; 2e-16 ***
Cscore            0.000000         NA      NA       NA    
polviews1:Cscore -0.558727   0.107668  -5.189 2.11e-07 ***
polviews2:Cscore -0.405076   0.059149  -6.848 7.47e-12 ***
polviews3:Cscore -0.248459   0.057741  -4.303 1.69e-05 ***
polviews4:Cscore  0.008764   0.039709   0.221   0.8253    
polviews5:Cscore  0.112245   0.051284   2.189   0.0286 *  
polviews6:Cscore  0.419079   0.051434   8.148  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 15.906 on 12 degrees of freedom
AIC: 219.26

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(R, <span class="st">"R:Row effect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 R:Row effect           12  15.9 -81.8  2.47 0.196</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(R) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) polviews1 polviews2 polviews3 polviews4 polviews5 polviews6
1            1         1         0         0         0         0         0
2            1         1         0         0         0         0         0
3            1         1         0         0         0         0         0
4            1         1         0         0         0         0         0
5            1         0         1         0         0         0         0
6            1         0         1         0         0         0         0
7            1         0         1         0         0         0         0
8            1         0         1         0         0         0         0
9            1         0         0         1         0         0         0
10           1         0         0         1         0         0         0
11           1         0         0         1         0         0         0
12           1         0         0         1         0         0         0
13           1         0         0         0         1         0         0
14           1         0         0         0         1         0         0
15           1         0         0         0         1         0         0
16           1         0         0         0         1         0         0
17           1         0         0         0         0         1         0
18           1         0         0         0         0         1         0
19           1         0         0         0         0         1         0
20           1         0         0         0         0         1         0
21           1         0         0         0         0         0         1
22           1         0         0         0         0         0         1
23           1         0         0         0         0         0         1
24           1         0         0         0         0         0         1
25           1        -1        -1        -1        -1        -1        -1
26           1        -1        -1        -1        -1        -1        -1
27           1        -1        -1        -1        -1        -1        -1
28           1        -1        -1        -1        -1        -1        -1
   fefam1 fefam2 fefam3 Cscore polviews1:Cscore polviews2:Cscore
1       1      0      0   -1.5             -1.5              0.0
2       0      1      0   -0.5             -0.5              0.0
3       0      0      1    0.5              0.5              0.0
4      -1     -1     -1    1.5              1.5              0.0
5       1      0      0   -1.5              0.0             -1.5
6       0      1      0   -0.5              0.0             -0.5
7       0      0      1    0.5              0.0              0.5
8      -1     -1     -1    1.5              0.0              1.5
9       1      0      0   -1.5              0.0              0.0
10      0      1      0   -0.5              0.0              0.0
11      0      0      1    0.5              0.0              0.0
12     -1     -1     -1    1.5              0.0              0.0
13      1      0      0   -1.5              0.0              0.0
14      0      1      0   -0.5              0.0              0.0
15      0      0      1    0.5              0.0              0.0
16     -1     -1     -1    1.5              0.0              0.0
17      1      0      0   -1.5              0.0              0.0
18      0      1      0   -0.5              0.0              0.0
19      0      0      1    0.5              0.0              0.0
20     -1     -1     -1    1.5              0.0              0.0
21      1      0      0   -1.5              0.0              0.0
22      0      1      0   -0.5              0.0              0.0
23      0      0      1    0.5              0.0              0.0
24     -1     -1     -1    1.5              0.0              0.0
25      1      0      0   -1.5              1.5              1.5
26      0      1      0   -0.5              0.5              0.5
27      0      0      1    0.5             -0.5             -0.5
28     -1     -1     -1    1.5             -1.5             -1.5
   polviews3:Cscore polviews4:Cscore polviews5:Cscore polviews6:Cscore
1               0.0              0.0              0.0              0.0
2               0.0              0.0              0.0              0.0
3               0.0              0.0              0.0              0.0
4               0.0              0.0              0.0              0.0
5               0.0              0.0              0.0              0.0
6               0.0              0.0              0.0              0.0
7               0.0              0.0              0.0              0.0
8               0.0              0.0              0.0              0.0
9              -1.5              0.0              0.0              0.0
10             -0.5              0.0              0.0              0.0
11              0.5              0.0              0.0              0.0
12              1.5              0.0              0.0              0.0
13              0.0             -1.5              0.0              0.0
14              0.0             -0.5              0.0              0.0
15              0.0              0.5              0.0              0.0
16              0.0              1.5              0.0              0.0
17              0.0              0.0             -1.5              0.0
18              0.0              0.0             -0.5              0.0
19              0.0              0.0              0.5              0.0
20              0.0              0.0              1.5              0.0
21              0.0              0.0              0.0             -1.5
22              0.0              0.0              0.0             -0.5
23              0.0              0.0              0.0              0.5
24              0.0              0.0              0.0              1.5
25              1.5              1.5              1.5              1.5
26              0.5              0.5              0.5              0.5
27             -0.5             -0.5             -0.5             -0.5
28             -1.5             -1.5             -1.5             -1.5</code></pre>
</div>
</div>
<p>表2.4の適合度を確認しよう．また，パラメータ推定値については，表2.5のBから確認する． Rの結果では，polviews1からpolviews6までの結果が表示されているが，polviews7は示されていない．パラメータのすべての値を足すと0となることから(<span class="math inline">\(\sum \tau_i^A=0\)</span>)，polviews7の係数は<code>0-(-0.6721737)=0.6721737</code>となる．これをRで計算するためには係数を取り出し，それらを足したものを0から引けばよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 取り出す係数を探す</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(R, <span class="st">":Cscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>polviews1:Cscore polviews2:Cscore polviews3:Cscore polviews4:Cscore 
              12               13               14               15 
polviews5:Cscore polviews6:Cscore 
              16               17 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 12から17番目の係数を取り出し，足す</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">$</span>coefficients[<span class="dv">12</span><span class="sc">:</span><span class="dv">17</span>] <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.6721737</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 次のようにもできる</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">$</span>coefficients[<span class="fu">pickCoef</span>(R, <span class="st">":Cscore"</span>)] <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.6721737</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0から足したものを引く</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="sc">-</span> (R<span class="sc">$</span>coefficients[<span class="fu">pickCoef</span>(R, <span class="st">":Cscore"</span>)] <span class="sc">|&gt;</span> <span class="fu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6721737</code></pre>
</div>
</div>
<p>contrastsをもとに戻して同様の分析を行う． 今度は<code>polviews1:Cscore</code>の係数が省略されているが，この値は0である（<span class="math inline">\(\tau_1^A=0\)</span>）．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative (default)</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>Ralt <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">*</span>polviews, </span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>結果は表2.5Bの「他の正規化」の行を確認して欲しい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Ralt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Cscore * polviews, family = poisson, 
    data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.5962  -0.4603   0.0477   0.3840   1.5700  

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)        3.6308     0.1443  25.160  &lt; 2e-16 ***
polviews2          1.4324     0.1342  10.670  &lt; 2e-16 ***
polviews3          1.4989     0.1329  11.279  &lt; 2e-16 ***
polviews4          2.7135     0.1246  21.776  &lt; 2e-16 ***
polviews5          1.8346     0.1290  14.218  &lt; 2e-16 ***
polviews6          1.8457     0.1289  14.323  &lt; 2e-16 ***
polviews7          0.1698     0.1589   1.069  0.28508    
fefam2             0.3127     0.1265   2.471  0.01345 *  
fefam3            -0.7090     0.2447  -2.897  0.00376 ** 
fefam4            -2.5045     0.3703  -6.763 1.36e-11 ***
Cscore             0.0000         NA      NA       NA    
polviews2:Cscore   0.1537     0.1362   1.128  0.25925    
polviews3:Cscore   0.3103     0.1357   2.287  0.02219 *  
polviews4:Cscore   0.5675     0.1268   4.477 7.58e-06 ***
polviews5:Cscore   0.6710     0.1326   5.059 4.21e-07 ***
polviews6:Cscore   0.9778     0.1331   7.346 2.04e-13 ***
polviews7:Cscore   1.2309     0.1678   7.335 2.22e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 15.906 on 12 degrees of freedom
AIC: 219.26

Number of iterations: 4</code></pre>
</div>
</div>
<p>モデルの適合度は全く同じであることがわかる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(R, <span class="st">"R: Row effect (effect coding)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`              df    L2   BIC Delta     p
  &lt;chr&gt;                         &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 R: Row effect (effect coding)    12  15.9 -81.8  2.47 0.196</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(Ralt, <span class="st">"R: Row effect (dummy coding)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`             df    L2   BIC Delta     p
  &lt;chr&gt;                        &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 R: Row effect (dummy coding)    12  15.9 -81.8  2.47 0.196</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(Ralt) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) polviews2 polviews3 polviews4 polviews5 polviews6 polviews7
1            1         0         0         0         0         0         0
2            1         0         0         0         0         0         0
3            1         0         0         0         0         0         0
4            1         0         0         0         0         0         0
5            1         1         0         0         0         0         0
6            1         1         0         0         0         0         0
7            1         1         0         0         0         0         0
8            1         1         0         0         0         0         0
9            1         0         1         0         0         0         0
10           1         0         1         0         0         0         0
11           1         0         1         0         0         0         0
12           1         0         1         0         0         0         0
13           1         0         0         1         0         0         0
14           1         0         0         1         0         0         0
15           1         0         0         1         0         0         0
16           1         0         0         1         0         0         0
17           1         0         0         0         1         0         0
18           1         0         0         0         1         0         0
19           1         0         0         0         1         0         0
20           1         0         0         0         1         0         0
21           1         0         0         0         0         1         0
22           1         0         0         0         0         1         0
23           1         0         0         0         0         1         0
24           1         0         0         0         0         1         0
25           1         0         0         0         0         0         1
26           1         0         0         0         0         0         1
27           1         0         0         0         0         0         1
28           1         0         0         0         0         0         1
   fefam2 fefam3 fefam4 Cscore polviews2:Cscore polviews3:Cscore
1       0      0      0   -1.5              0.0              0.0
2       1      0      0   -0.5              0.0              0.0
3       0      1      0    0.5              0.0              0.0
4       0      0      1    1.5              0.0              0.0
5       0      0      0   -1.5             -1.5              0.0
6       1      0      0   -0.5             -0.5              0.0
7       0      1      0    0.5              0.5              0.0
8       0      0      1    1.5              1.5              0.0
9       0      0      0   -1.5              0.0             -1.5
10      1      0      0   -0.5              0.0             -0.5
11      0      1      0    0.5              0.0              0.5
12      0      0      1    1.5              0.0              1.5
13      0      0      0   -1.5              0.0              0.0
14      1      0      0   -0.5              0.0              0.0
15      0      1      0    0.5              0.0              0.0
16      0      0      1    1.5              0.0              0.0
17      0      0      0   -1.5              0.0              0.0
18      1      0      0   -0.5              0.0              0.0
19      0      1      0    0.5              0.0              0.0
20      0      0      1    1.5              0.0              0.0
21      0      0      0   -1.5              0.0              0.0
22      1      0      0   -0.5              0.0              0.0
23      0      1      0    0.5              0.0              0.0
24      0      0      1    1.5              0.0              0.0
25      0      0      0   -1.5              0.0              0.0
26      1      0      0   -0.5              0.0              0.0
27      0      1      0    0.5              0.0              0.0
28      0      0      1    1.5              0.0              0.0
   polviews4:Cscore polviews5:Cscore polviews6:Cscore polviews7:Cscore
1               0.0              0.0              0.0              0.0
2               0.0              0.0              0.0              0.0
3               0.0              0.0              0.0              0.0
4               0.0              0.0              0.0              0.0
5               0.0              0.0              0.0              0.0
6               0.0              0.0              0.0              0.0
7               0.0              0.0              0.0              0.0
8               0.0              0.0              0.0              0.0
9               0.0              0.0              0.0              0.0
10              0.0              0.0              0.0              0.0
11              0.0              0.0              0.0              0.0
12              0.0              0.0              0.0              0.0
13             -1.5              0.0              0.0              0.0
14             -0.5              0.0              0.0              0.0
15              0.5              0.0              0.0              0.0
16              1.5              0.0              0.0              0.0
17              0.0             -1.5              0.0              0.0
18              0.0             -0.5              0.0              0.0
19              0.0              0.5              0.0              0.0
20              0.0              1.5              0.0              0.0
21              0.0              0.0             -1.5              0.0
22              0.0              0.0             -0.5              0.0
23              0.0              0.0              0.5              0.0
24              0.0              0.0              1.5              0.0
25              0.0              0.0              0.0             -1.5
26              0.0              0.0              0.0             -0.5
27              0.0              0.0              0.0              0.5
28              0.0              0.0              0.0              1.5</code></pre>
</div>
</div>
</section>
</section>
<section id="列効果モデル" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="列効果モデル"><span class="header-section-number">2.4</span> 列効果モデル</h2>
<p>列効果モデルは行効果モデルと同様の方法で推定すればよい．まずは効果コーディングで推定し，その後にダミーコーディングで推定する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. C: Column Effect Model</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co"># contrast</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.sum"</span>, </span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.treatment"</span>))</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">*</span>fefam, <span class="at">family =</span> poisson, </span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(C)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Rscore * fefam, family = poisson, 
    data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7572  -0.4920   0.1628   0.4922   1.4247  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    4.26735    0.02842 150.161  &lt; 2e-16 ***
polviews1     -1.34764    0.08885 -15.167  &lt; 2e-16 ***
polviews2      0.10725    0.05058   2.120 0.033978 *  
polviews3      0.17817    0.04852   3.672 0.000241 ***
polviews4      1.35465    0.03449  39.280  &lt; 2e-16 ***
polviews5      0.47060    0.04547  10.349  &lt; 2e-16 ***
polviews6      0.45489    0.04714   9.650  &lt; 2e-16 ***
fefam1        -0.11795    0.03606  -3.271 0.001072 ** 
fefam2         0.75721    0.02817  26.882  &lt; 2e-16 ***
fefam3         0.27540    0.03195   8.619  &lt; 2e-16 ***
Rscore         0.00000         NA      NA       NA    
fefam1:Rscore -0.32183    0.02601 -12.373  &lt; 2e-16 ***
fefam2:Rscore -0.06518    0.02013  -3.238 0.001203 ** 
fefam3:Rscore  0.13740    0.02282   6.021 1.73e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 14.237 on 15 degrees of freedom
AIC: 211.59

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(C, <span class="st">"C:Column effect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 C:Column effect        15  14.2 -108.  2.32 0.508</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(C) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) polviews1 polviews2 polviews3 polviews4 polviews5 polviews6
1            1         1         0         0         0         0         0
2            1         1         0         0         0         0         0
3            1         1         0         0         0         0         0
4            1         1         0         0         0         0         0
5            1         0         1         0         0         0         0
6            1         0         1         0         0         0         0
7            1         0         1         0         0         0         0
8            1         0         1         0         0         0         0
9            1         0         0         1         0         0         0
10           1         0         0         1         0         0         0
11           1         0         0         1         0         0         0
12           1         0         0         1         0         0         0
13           1         0         0         0         1         0         0
14           1         0         0         0         1         0         0
15           1         0         0         0         1         0         0
16           1         0         0         0         1         0         0
17           1         0         0         0         0         1         0
18           1         0         0         0         0         1         0
19           1         0         0         0         0         1         0
20           1         0         0         0         0         1         0
21           1         0         0         0         0         0         1
22           1         0         0         0         0         0         1
23           1         0         0         0         0         0         1
24           1         0         0         0         0         0         1
25           1        -1        -1        -1        -1        -1        -1
26           1        -1        -1        -1        -1        -1        -1
27           1        -1        -1        -1        -1        -1        -1
28           1        -1        -1        -1        -1        -1        -1
   fefam1 fefam2 fefam3 Rscore fefam1:Rscore fefam2:Rscore fefam3:Rscore
1       1      0      0     -3            -3             0             0
2       0      1      0     -3             0            -3             0
3       0      0      1     -3             0             0            -3
4      -1     -1     -1     -3             3             3             3
5       1      0      0     -2            -2             0             0
6       0      1      0     -2             0            -2             0
7       0      0      1     -2             0             0            -2
8      -1     -1     -1     -2             2             2             2
9       1      0      0     -1            -1             0             0
10      0      1      0     -1             0            -1             0
11      0      0      1     -1             0             0            -1
12     -1     -1     -1     -1             1             1             1
13      1      0      0      0             0             0             0
14      0      1      0      0             0             0             0
15      0      0      1      0             0             0             0
16     -1     -1     -1      0             0             0             0
17      1      0      0      1             1             0             0
18      0      1      0      1             0             1             0
19      0      0      1      1             0             0             1
20     -1     -1     -1      1            -1            -1            -1
21      1      0      0      2             2             0             0
22      0      1      0      2             0             2             0
23      0      0      1      2             0             0             2
24     -1     -1     -1      2            -2            -2            -2
25      1      0      0      3             3             0             0
26      0      1      0      3             0             3             0
27      0      0      1      3             0             0             3
28     -1     -1     -1      3            -3            -3            -3</code></pre>
</div>
</div>
<p>すべてを足すと0となることから(<span class="math inline">\(\sum \tau_j^B=0\)</span>)，polviews7の係数は<code>0-(-0.2496118)=0.2496118</code>となる</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(C, <span class="st">":Rscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fefam1:Rscore fefam2:Rscore fefam3:Rscore 
           12            13            14 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>C<span class="sc">$</span>coefficients[<span class="fu">pickCoef</span>(C, <span class="st">":Rscore"</span>)] <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2496118</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="sc">-</span> (C<span class="sc">$</span>coefficients[<span class="fu">pickCoef</span>(C, <span class="st">":Rscore"</span>)] <span class="sc">|&gt;</span> <span class="fu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2496118</code></pre>
</div>
</div>
<p>以下はダミーコーディングを用いている．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative (default)</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>Calt <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">*</span>fefam, </span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>推定値は表2.5Cを確認せよ．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Calt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Rscore * fefam, family = poisson, 
    data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.7572  -0.4920   0.1628   0.4922   1.4247  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    3.76726    0.11222  33.571  &lt; 2e-16 ***
polviews2      1.13306    0.10785  10.506  &lt; 2e-16 ***
polviews3      0.88215    0.11310   7.800  &lt; 2e-16 ***
polviews4      1.73680    0.11708  14.834  &lt; 2e-16 ***
polviews5      0.53092    0.13848   3.834 0.000126 ***
polviews6      0.19337    0.16048   1.205 0.228239    
polviews7     -1.80128    0.20632  -8.730  &lt; 2e-16 ***
fefam2         0.87516    0.04848  18.050  &lt; 2e-16 ***
fefam3         0.39335    0.05298   7.424 1.13e-13 ***
fefam4        -0.79671    0.07451 -10.692  &lt; 2e-16 ***
Rscore         0.00000         NA      NA       NA    
fefam2:Rscore  0.25665    0.03459   7.421 1.17e-13 ***
fefam3:Rscore  0.45924    0.03851  11.926  &lt; 2e-16 ***
fefam4:Rscore  0.57144    0.05297  10.788  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 14.237 on 15 degrees of freedom
AIC: 211.59

Number of iterations: 4</code></pre>
</div>
</div>
<p>適合度は効果コーディングとダミーコーディングで変化しない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(C, <span class="st">"C:Column effect (effect coding)"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`                df    L2   BIC Delta     p
  &lt;chr&gt;                           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 C:Column effect (effect coding)    15  14.2 -108.  2.32 0.508</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(Calt, <span class="st">"C:Column effect (dummy coding)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`               df    L2   BIC Delta     p
  &lt;chr&gt;                          &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 C:Column effect (dummy coding)    15  14.2 -108.  2.32 0.508</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(Calt) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) polviews2 polviews3 polviews4 polviews5 polviews6 polviews7
1            1         0         0         0         0         0         0
2            1         0         0         0         0         0         0
3            1         0         0         0         0         0         0
4            1         0         0         0         0         0         0
5            1         1         0         0         0         0         0
6            1         1         0         0         0         0         0
7            1         1         0         0         0         0         0
8            1         1         0         0         0         0         0
9            1         0         1         0         0         0         0
10           1         0         1         0         0         0         0
11           1         0         1         0         0         0         0
12           1         0         1         0         0         0         0
13           1         0         0         1         0         0         0
14           1         0         0         1         0         0         0
15           1         0         0         1         0         0         0
16           1         0         0         1         0         0         0
17           1         0         0         0         1         0         0
18           1         0         0         0         1         0         0
19           1         0         0         0         1         0         0
20           1         0         0         0         1         0         0
21           1         0         0         0         0         1         0
22           1         0         0         0         0         1         0
23           1         0         0         0         0         1         0
24           1         0         0         0         0         1         0
25           1         0         0         0         0         0         1
26           1         0         0         0         0         0         1
27           1         0         0         0         0         0         1
28           1         0         0         0         0         0         1
   fefam2 fefam3 fefam4 Rscore fefam2:Rscore fefam3:Rscore fefam4:Rscore
1       0      0      0     -3             0             0             0
2       1      0      0     -3            -3             0             0
3       0      1      0     -3             0            -3             0
4       0      0      1     -3             0             0            -3
5       0      0      0     -2             0             0             0
6       1      0      0     -2            -2             0             0
7       0      1      0     -2             0            -2             0
8       0      0      1     -2             0             0            -2
9       0      0      0     -1             0             0             0
10      1      0      0     -1            -1             0             0
11      0      1      0     -1             0            -1             0
12      0      0      1     -1             0             0            -1
13      0      0      0      0             0             0             0
14      1      0      0      0             0             0             0
15      0      1      0      0             0             0             0
16      0      0      1      0             0             0             0
17      0      0      0      1             0             0             0
18      1      0      0      1             1             0             0
19      0      1      0      1             0             1             0
20      0      0      1      1             0             0             1
21      0      0      0      2             0             0             0
22      1      0      0      2             2             0             0
23      0      1      0      2             0             2             0
24      0      0      1      2             0             0             2
25      0      0      0      3             0             0             0
26      1      0      0      3             3             0             0
27      0      1      0      3             0             3             0
28      0      0      1      3             0             0             3</code></pre>
</div>
</div>
</section>
<section id="行列効果モデルrc" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="行列効果モデルrc"><span class="header-section-number">2.5</span> 行・列効果モデル（<span class="math inline">\(R+C\)</span>）</h2>
<p>普通に推定しても収束しない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># コントラスト</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.treatment"</span>))</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. R+C: Row and Column Effect Model</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 収束しない</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>RplusCno <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
</div>
<p>係数を確認する．この場合，制約は3つ必要であるが2つしかNAとなっていない．テキストや表2.5Dを参照し，どのような制約を課すのかをきめる．ここでは表2.5Dのような制約を課す．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>RplusCno</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Cscore:polviews + Rscore:fefam, 
    family = poisson, data = freq_tab_2.3A, tolerance = 1e-12)

Coefficients:
     (Intercept)         polviews2         polviews3         polviews4  
      -4.898e+13         8.575e+12         1.715e+13         2.572e+13  
       polviews5         polviews6         polviews7            fefam2  
       3.430e+13         4.287e+13         5.145e+13         1.550e+13  
          fefam3            fefam4  polviews1:Cscore  polviews2:Cscore  
       3.101e+13         4.651e+13         1.646e+12        -4.070e+12  
polviews3:Cscore  polviews4:Cscore  polviews5:Cscore  polviews6:Cscore  
      -9.787e+12        -1.550e+13        -2.122e+13        -2.694e+13  
polviews7:Cscore     fefam1:Rscore     fefam2:Rscore     fefam3:Rscore  
      -3.265e+13        -1.715e+13        -1.143e+13        -5.717e+12  
   fefam4:Rscore  
              NA  

Deviance:            8.485116 
Pearson chi-squared: 8.477813 
Residual df:         8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCno, <span class="st">":Cscore"</span>)  <span class="co"># 行効果</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>polviews1:Cscore polviews2:Cscore polviews3:Cscore polviews4:Cscore 
              11               12               13               14 
polviews5:Cscore polviews6:Cscore polviews7:Cscore 
              15               16               17 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCno, <span class="st">":Rscore"</span>)  <span class="co"># 列効果</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fefam1:Rscore fefam2:Rscore fefam3:Rscore fefam4:Rscore 
           18            19            20            21 </code></pre>
</div>
</div>
<p>あるいは次のように一覧にしてもよい．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(RplusCno<span class="sc">$</span>coefficients),</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> RplusCno<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span> </span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              var      estimate number
(Intercept)           (Intercept) -4.898036e+13      1
polviews2               polviews2  8.574948e+12      2
polviews3               polviews3  1.714990e+13      3
polviews4               polviews4  2.572484e+13      4
polviews5               polviews5  3.429979e+13      5
polviews6               polviews6  4.287474e+13      6
polviews7               polviews7  5.144969e+13      7
fefam2                     fefam2  1.550368e+13      8
fefam3                     fefam3  3.100736e+13      9
fefam4                     fefam4  4.651103e+13     10
polviews1:Cscore polviews1:Cscore  1.646217e+12     11
polviews2:Cscore polviews2:Cscore -4.070415e+12     12
polviews3:Cscore polviews3:Cscore -9.787047e+12     13
polviews4:Cscore polviews4:Cscore -1.550368e+13     14
polviews5:Cscore polviews5:Cscore -2.122031e+13     15
polviews6:Cscore polviews6:Cscore -2.693694e+13     16
polviews7:Cscore polviews7:Cscore -3.265357e+13     17
fefam1:Rscore       fefam1:Rscore -1.714990e+13     18
fefam2:Rscore       fefam2:Rscore -1.143326e+13     19
fefam3:Rscore       fefam3:Rscore -5.716632e+12     20
fefam4:Rscore       fefam4:Rscore            NA     21</code></pre>
</div>
</div>
<p>制約を課すのは11番目，17番目，18番目の係数であり，これらを0にする．対象となる係数は<code>constrain = c(11,17,18)</code>で指定し，制約は<code>constrainTo = c(0, 0, 0)</code>とする．あとは同じである．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># polviews1:Cscore(11) = polviews7:Cscore(17) = fefam1:Rscore(18) = 0</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>RplusC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">17</span>, <span class="dv">18</span>), </span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Cscore:polviews + Rscore:fefam, 
    constrain = c(11, 17, 18), constrainTo = c(0, 0, 0), family = poisson, 
    data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07536  -0.33353   0.01859   0.37548   1.05912  

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       3.69896    0.14301  25.866  &lt; 2e-16 ***
polviews2         1.06075    0.12467   8.509  &lt; 2e-16 ***
polviews3         0.76041    0.13412   5.670 1.43e-08 ***
polviews4         1.61203    0.15170  10.626  &lt; 2e-16 ***
polviews5         0.37332    0.18884   1.977 0.048049 *  
polviews6         0.02433    0.22727   0.107 0.914750    
polviews7        -2.01888    0.30512  -6.617 3.67e-11 ***
fefam2            1.00654    0.09822  10.248  &lt; 2e-16 ***
fefam3            0.65193    0.17688   3.686 0.000228 ***
fefam4           -0.40872    0.26352  -1.551 0.120895    
polviews1:Cscore  0.00000         NA      NA       NA    
polviews2:Cscore -0.08578    0.11437  -0.750 0.453211    
polviews3:Cscore -0.15923    0.10585  -1.504 0.132498    
polviews4:Cscore -0.12164    0.09246  -1.316 0.188309    
polviews5:Cscore -0.22243    0.10510  -2.116 0.034309 *  
polviews6:Cscore -0.09452    0.11454  -0.825 0.409232    
polviews7:Cscore  0.00000         NA      NA       NA    
fefam1:Rscore     0.00000         NA      NA       NA    
fefam2:Rscore     0.27936    0.04372   6.389 1.67e-10 ***
fefam3:Rscore     0.48417    0.06239   7.761  &lt; 2e-16 ***
fefam4:Rscore     0.58586    0.08655   6.769 1.30e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 7.6783 on 10 degrees of freedom
AIC: 215.03

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RplusC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RplusC                 10  7.68 -73.8  1.77 0.660</code></pre>
</div>
</div>
<p>11番目，18番目，21番目の係数を0にして推定する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># polviews1:Cscore(11) = polviews7:Cscore(17) = fefam1:Rscore(18) = 0</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>RplusC_2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">18</span>, <span class="dv">21</span>), </span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusC_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Cscore:polviews + Rscore:fefam, 
    constrain = c(11, 18, 21), constrainTo = c(0, 0, 0), family = poisson, 
    data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07536  -0.33353   0.01859   0.37548   1.05912  

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       3.69896    0.14301  25.866  &lt; 2e-16 ***
polviews2         1.35368    0.13397  10.104  &lt; 2e-16 ***
polviews3         1.34627    0.13954   9.648  &lt; 2e-16 ***
polviews4         2.49082    0.14246  17.485  &lt; 2e-16 ***
polviews5         1.54505    0.15938   9.694  &lt; 2e-16 ***
polviews6         1.48899    0.17487   8.515  &lt; 2e-16 ***
polviews7        -0.26129    0.21592  -1.210 0.226224    
fefam2            0.42068    0.12573   3.346 0.000820 ***
fefam3           -0.51980    0.23987  -2.167 0.030233 *  
fefam4           -2.16632    0.36822  -5.883 4.03e-09 ***
polviews1:Cscore  0.00000         NA      NA       NA    
polviews2:Cscore  0.10951    0.12956   0.845 0.397978    
polviews3:Cscore  0.23134    0.13130   1.762 0.078073 .  
polviews4:Cscore  0.46422    0.12511   3.711 0.000207 ***
polviews5:Cscore  0.55872    0.13347   4.186 2.84e-05 ***
polviews6:Cscore  0.88192    0.13507   6.529 6.61e-11 ***
polviews7:Cscore  1.17173    0.17310   6.769 1.30e-11 ***
fefam1:Rscore     0.00000         NA      NA       NA    
fefam2:Rscore     0.08407    0.03224   2.607 0.009124 ** 
fefam3:Rscore     0.09360    0.03861   2.424 0.015346 *  
fefam4:Rscore     0.00000         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 7.6783 on 10 degrees of freedom
AIC: 215.03

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RplusC_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RplusC_2               10  7.68 -73.8  1.77 0.660</code></pre>
</div>
</div>
<p><code>Rscore:Cscore</code>を含めて推定すれば，制約は自動的に課されており（<code>polviews</code>の1番目と7番目，<code>fefam</code>の1 番目と4番目），特に指定する必要はない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. R+C: Row and Column Effect Model (Alternative)</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>RplusCalt <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCalt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:

gnm(formula = Freq ~ polviews + fefam + Rscore:Cscore + Cscore:polviews + 
    Rscore:fefam, family = poisson, data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07536  -0.33353   0.01859   0.37548   1.05912  

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       2.82017    0.13999  20.145  &lt; 2e-16 ***
polviews2         1.35368    0.13397  10.104  &lt; 2e-16 ***
polviews3         1.34627    0.13954   9.648  &lt; 2e-16 ***
polviews4         2.49082    0.14246  17.485  &lt; 2e-16 ***
polviews5         1.54505    0.15938   9.694  &lt; 2e-16 ***
polviews6         1.48899    0.17487   8.515  &lt; 2e-16 ***
polviews7        -0.26129    0.21592  -1.210 0.226224    
fefam2            1.00654    0.09822  10.248  &lt; 2e-16 ***
fefam3            0.65193    0.17688   3.686 0.000228 ***
fefam4           -0.40872    0.26352  -1.551 0.120895    
Rscore:Cscore     0.19529    0.02885   6.769  1.3e-11 ***
polviews2:Cscore -0.08578    0.11437  -0.750 0.453211    
polviews3:Cscore -0.15923    0.10585  -1.504 0.132498    
polviews4:Cscore -0.12164    0.09246  -1.316 0.188309    
polviews5:Cscore -0.22243    0.10510  -2.116 0.034309 *  
polviews6:Cscore -0.09452    0.11454  -0.825 0.409232    
polviews7:Cscore  0.00000         NA      NA       NA    
fefam2:Rscore     0.08407    0.03224   2.607 0.009124 ** 
fefam3:Rscore     0.09360    0.03861   2.424 0.015346 *  
fefam4:Rscore     0.00000         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 7.6783 on 10 degrees of freedom
AIC: 215.03

Number of iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RplusCalt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RplusCalt              10  7.68 -73.8  1.77 0.660</code></pre>
</div>
</div>
</section>
<section id="行列効果モデルrc1" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="行列効果モデルrc1"><span class="header-section-number">2.6</span> 行・列効果モデル（<span class="math inline">\(RC(1)\)</span>）</h2>
<p>RC(1)については<code>Mult(1,polviews,fefam)</code>を含んだモデルで推定する．結果をみると係数は表示されているものの，標準誤差はNAとなっている．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. RC: RC(1) model</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>RC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>,polviews,fefam),</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.......................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam), 
    family = poisson, data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07428  -0.27239   0.03038   0.36792   1.03721  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                  2.90172         NA      NA       NA
polviews2                    1.39045         NA      NA       NA
polviews3                    1.42692         NA      NA       NA
polviews4                    2.58618         NA      NA       NA
polviews5                    1.68549         NA      NA       NA
polviews6                    1.62515         NA      NA       NA
polviews7                   -0.11515         NA      NA       NA
fefam2                       0.89051         NA      NA       NA
fefam3                       0.41659         NA      NA       NA
fefam4                      -0.76463         NA      NA       NA
Mult(., polviews, fefam).    0.39610         NA      NA       NA
Mult(1, ., fefam).polviews1  4.73584         NA      NA       NA
Mult(1, ., fefam).polviews2  3.66093         NA      NA       NA
Mult(1, ., fefam).polviews3  2.22544         NA      NA       NA
Mult(1, ., fefam).polviews4  0.01063         NA      NA       NA
Mult(1, ., fefam).polviews5 -0.94189         NA      NA       NA
Mult(1, ., fefam).polviews6 -4.05681         NA      NA       NA
Mult(1, ., fefam).polviews7 -6.71941         NA      NA       NA
Mult(1, polviews, .).fefam1  0.41242         NA      NA       NA
Mult(1, polviews, .).fefam2  0.05417         NA      NA       NA
Mult(1, polviews, .).fefam3 -0.22508         NA      NA       NA
Mult(1, polviews, .).fefam4 -0.35755         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 8.0718 on 10 degrees of freedom
AIC: 215.43

Number of iterations: 23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC.un                  10  8.07 -73.4  1.77 0.622</code></pre>
</div>
</div>
<p>まずは「重みづけのないまたは単位標準化した解」を求める．<code>scaleWeights = "unit"</code>とする．<code>RC.un</code>から<code>.polviews</code>のある変数を<code>pickCoef(RC.un, "[.]polviews")</code>によって取り出す．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mu[i], i = 1 to 7</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un,</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"[.]polviews"</span>),</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の方向を揃える</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (mu<span class="sc">$</span>qvframe[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span> ) {</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>  mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 合計が0，2乗和が1となっていること確認する．</span></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"和"</span> <span class="ot">=</span> <span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]), </span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>     <span class="st">"2乗和"</span> <span class="ot">=</span> <span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$和
[1] 2.220446e-16

$`2乗和`
[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nu[j], j = 1 to 4</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un, <span class="st">"[.]fefam"</span>), </span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の方向を揃える</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (nu<span class="sc">$</span>qvframe[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span> ) {</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>  nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]</span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 合計が0，2乗和が1となっていること確認する．</span></span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"和"</span> <span class="ot">=</span> <span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]), </span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a>     <span class="st">"2乗和"</span> <span class="ot">=</span> <span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$和
[1] 0

$`2乗和`
[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># muの1番目と7番目，nuの1番目と4番目の値を取り出し保存する．</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>)],</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co">#保存した値で制約を課した上で，再推定する．</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>,polviews,fefam), </span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">22</span>),</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con, </span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...............................
Done</code></pre>
</div>
</div>
<p><code>Deviance is not finite 警告メッセージ: Algorithm failed - no model could be estimated</code>と表示されたらもう一度推定する．<code>set.seed</code>の値をいくつか変えて実行するのがよい．</p>
<p>表2.5Eの値と一致しているのかを確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam), 
    constrain = c(12, 18, 19, 22), constrainTo = con, family = poisson, 
    data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07428  -0.27239   0.03038   0.36792   1.03721  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  2.82020    0.14578  19.346  &lt; 2e-16 ***
polviews2                    1.40280    0.12442  11.275  &lt; 2e-16 ***
polviews3                    1.45577    0.12746  11.421  &lt; 2e-16 ***
polviews4                    2.64048    0.13143  20.090  &lt; 2e-16 ***
polviews5                    1.75073    0.14175  12.351  &lt; 2e-16 ***
polviews6                    1.72618    0.16727  10.320  &lt; 2e-16 ***
polviews7                    0.01648    0.21938   0.075 0.940107    
fefam2                       0.91251    0.12222   7.466 8.25e-14 ***
fefam3                       0.45574    0.20388   2.235 0.025396 *  
fefam4                      -0.71735    0.24913  -2.879 0.003985 ** 
Mult(., polviews, fefam).    2.37331    0.34813   6.817 9.27e-12 ***
Mult(1, ., fefam).polviews1 -0.48165         NA      NA       NA    
Mult(1, ., fefam).polviews2 -0.37580    0.10049  -3.740 0.000184 ***
Mult(1, ., fefam).polviews3 -0.23443    0.09461  -2.478 0.013216 *  
Mult(1, ., fefam).polviews4 -0.01632    0.08366  -0.195 0.845376    
Mult(1, ., fefam).polviews5  0.07749    0.09263   0.837 0.402872    
Mult(1, ., fefam).polviews6  0.38425    0.10926   3.517 0.000437 ***
Mult(1, ., fefam).polviews7  0.64646         NA      NA       NA    
Mult(1, polviews, .).fefam1 -0.74812         NA      NA       NA    
Mult(1, polviews, .).fefam2 -0.14098    0.07469  -1.888 0.059090 .  
Mult(1, polviews, .).fefam3  0.33229    0.09162   3.627 0.000287 ***
Mult(1, polviews, .).fefam4  0.55680         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 8.0718 on 10 degrees of freedom
AIC: 215.43

Number of iterations: 31</code></pre>
</div>
</div>
<p>先ほどの単位標準化した解と推定の結果が一致しているのかを確認する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 指定したmuとnuの値と結果が一致しているかを確認</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="at">mu =</span> mu, <span class="at">nu =</span> nu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$mu
                               Estimate Std. Error
Mult(1, ., fefam).polviews1 -0.48165420 0.06776575
Mult(1, ., fefam).polviews2 -0.37579722 0.05016783
Mult(1, ., fefam).polviews3 -0.23443020 0.04842778
Mult(1, ., fefam).polviews4 -0.01631519 0.03689088
Mult(1, ., fefam).polviews5  0.07748893 0.04931050
Mult(1, ., fefam).polviews6  0.38424697 0.06009815
Mult(1, ., fefam).polviews7  0.64646091 0.06145462

$nu
                              Estimate Std. Error
Mult(1, polviews, .).fefam1 -0.7481178 0.02662158
Mult(1, polviews, .).fefam2 -0.1409760 0.04671343
Mult(1, polviews, .).fefam3  0.3322937 0.05164241
Mult(1, polviews, .).fefam4  0.5568002 0.04821776</code></pre>
</div>
</div>
<p>和が0，2乗和が1となっていることを確認</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.220446e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>適合度は変化していない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC.un                  10  8.07 -73.4  1.77 0.622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC                     10  8.07 -73.4  1.77 0.622</code></pre>
</div>
</div>
</section>
<section id="周辺重みづけ" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="周辺重みづけ"><span class="header-section-number">2.7</span> 周辺重みづけ</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行の周辺確率</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="fu">apply</span>(tab_2<span class="fl">.3</span>A, <span class="dv">1</span>, sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>rp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Strongly liberal               Liberal      Slightly liberal 
           0.03227682            0.12387322            0.12300087 
             Moderate Slightly conservative          Conservative 
           0.38092469            0.15498691            0.15469613 
Strongly conservative 
           0.03024135 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(rp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 列の周辺確率</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>cp <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="fu">apply</span>(tab_2<span class="fl">.3</span>A, <span class="dv">2</span>, sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>cp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Strongly Disagree          Disagree             Agree    Strongly agree 
       0.19220704        0.43617331        0.28118639        0.09043327 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(cp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mu[i], i = 1 to 7</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un,</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"[.]polviews"</span>),</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> rp,</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> rp, </span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> rp)</span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の方向を揃える</span></span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (mu<span class="sc">$</span>qvframe[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span> ) {</span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>  mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]</span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a><span class="co"># nu[j], j = 1 to 4</span></span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un, <span class="st">"[.]fefam"</span>), </span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> cp,</span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> cp,</span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> cp)</span>
<span id="cb215-18"><a href="#cb215-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-19"><a href="#cb215-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の方向を揃える</span></span>
<span id="cb215-20"><a href="#cb215-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (nu<span class="sc">$</span>qvframe[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span> ) {</span>
<span id="cb215-21"><a href="#cb215-21" aria-hidden="true" tabindex="-1"></a>  nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]</span>
<span id="cb215-22"><a href="#cb215-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb215-23"><a href="#cb215-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-24"><a href="#cb215-24" aria-hidden="true" tabindex="-1"></a><span class="co"># muの1番目と7番目，nuの1番目と4番目の値を取り出し保存する．</span></span>
<span id="cb215-25"><a href="#cb215-25" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>)],</span>
<span id="cb215-26"><a href="#cb215-26" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co">#保存した値で制約を課した上で，再推定する．</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>RC_mw <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>,polviews,fefam), </span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">22</span>),</span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con, </span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...................................
Done</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC_mw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam), 
    constrain = c(12, 18, 19, 22), constrainTo = con, family = poisson, 
    data = freq_tab_2.3A, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07428  -0.27239   0.03038   0.36792   1.03721  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  2.90051    0.14144  20.507  &lt; 2e-16 ***
polviews2                    1.38735    0.11722  11.835  &lt; 2e-16 ***
polviews3                    1.41969    0.12024  11.807  &lt; 2e-16 ***
polviews4                    2.57257    0.12376  20.787  &lt; 2e-16 ***
polviews5                    1.66913    0.13414  12.443  &lt; 2e-16 ***
polviews6                    1.59981    0.16013   9.991  &lt; 2e-16 ***
polviews7                   -0.14816    0.21832  -0.679 0.497376    
fefam2                       0.90365    0.12173   7.423 1.14e-13 ***
fefam3                       0.43998    0.20350   2.162 0.030615 *  
fefam4                      -0.73638    0.24896  -2.958 0.003098 ** 
Mult(., polviews, fefam).    0.25673    0.03766   6.817 9.27e-12 ***
Mult(1, ., fefam).polviews1 -1.82062         NA      NA       NA    
Mult(1, ., fefam).polviews2 -1.41532    0.38476  -3.678 0.000235 ***
Mult(1, ., fefam).polviews3 -0.87405    0.36224  -2.413 0.015825 *  
Mult(1, ., fefam).polviews4 -0.03893    0.32031  -0.122 0.903253    
Mult(1, ., fefam).polviews5  0.32022    0.35468   0.903 0.366604    
Mult(1, ., fefam).polviews6  1.49474    0.41835   3.573 0.000353 ***
Mult(1, ., fefam).polviews7  2.49870         NA      NA       NA    
Mult(1, polviews, .).fefam1 -1.65778         NA      NA       NA    
Mult(1, polviews, .).fefam2 -0.19190    0.18033  -1.064 0.287244    
Mult(1, polviews, .).fefam3  0.95076    0.22120   4.298 1.72e-05 ***
Mult(1, polviews, .).fefam4  1.49281         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 8.0718 on 10 degrees of freedom
AIC: 215.43

Number of iterations: 35</code></pre>
</div>
</div>
<p>内的連関パラメータ<span class="math inline">\(\phi\)</span>が0.25673となっている．場合によっては符号が逆となる．</p>
<p>適合度は変化していない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC.un                  10  8.07 -73.4  1.77 0.622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC                     10  8.07 -73.4  1.77 0.622</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC_mw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  `Model Description`    df    L2   BIC Delta     p
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 RC_mw                  10  8.07 -73.4  1.77 0.622</code></pre>
</div>
</div>
</section>
<section id="表2.4a" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="表2.4a"><span class="header-section-number">2.8</span> 表2.4A</h2>
<p>表2.4Aを再現する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(O)</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(U)</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(R)</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(C)</span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusC)</span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RC)</span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a>models <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> <span class="fu">kable</span>(<span class="at">digit =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model Description</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">L2</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">Delta</th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">O</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">211.695</td>
<td style="text-align: right;">65.122</td>
<td style="text-align: right;">8.092</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">U</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">20.125</td>
<td style="text-align: right;">-118.305</td>
<td style="text-align: right;">2.766</td>
<td style="text-align: right;">0.268</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">15.906</td>
<td style="text-align: right;">-81.809</td>
<td style="text-align: right;">2.466</td>
<td style="text-align: right;">0.196</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">14.237</td>
<td style="text-align: right;">-107.907</td>
<td style="text-align: right;">2.321</td>
<td style="text-align: right;">0.508</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RplusC</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7.678</td>
<td style="text-align: right;">-73.751</td>
<td style="text-align: right;">1.772</td>
<td style="text-align: right;">0.660</td>
</tr>
<tr class="even">
<td style="text-align: left;">RC</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8.072</td>
<td style="text-align: right;">-73.358</td>
<td style="text-align: right;">1.767</td>
<td style="text-align: right;">0.622</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="表2.4b" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="表2.4b"><span class="header-section-number">2.9</span> 表2.4B</h2>
<p>モデルの比較のための関数を作成する．引数は2つであり，1つめのモデルと2つめのモデルの比較を行う．2つめが指定されていなければ比較ではなくそのモデルの適合度を示す．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>model_comparison <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">y =</span> <span class="dv">0</span>) {</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>  models <span class="sc">|&gt;</span> </span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="st">`</span><span class="at">Model Used</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">paste0</span>(x),</span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">paste0</span>(x,<span class="st">"-"</span>,y)),</span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">df =</span> <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>                          df[x], </span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a>                          df[x] <span class="sc">-</span> df[y]),</span>
<span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">L2 =</span> <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a>                          L2[x], </span>
<span id="cb227-13"><a href="#cb227-13" aria-hidden="true" tabindex="-1"></a>                          L2[x] <span class="sc">-</span> L2[y]))</span>
<span id="cb227-14"><a href="#cb227-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>表2.4Bは次のように再現できる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel B</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">6</span>),</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">6</span>),</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="fu">kable</span>(<span class="at">digit =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model Used</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">L2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1-2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">191.571</td>
</tr>
<tr class="even">
<td style="text-align: left;">2-6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">12.053</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">8.072</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">211.695</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>表2.4Cも再現できる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel C</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">4</span>),</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">4</span>,<span class="dv">6</span>),</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">6</span>)) <span class="sc">|&gt;</span> <span class="fu">kable</span>(<span class="at">digit =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model Used</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">L2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2-4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5.887</td>
</tr>
<tr class="even">
<td style="text-align: left;">4-6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6.165</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2-6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">12.053</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="表2.5a" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="表2.5a"><span class="header-section-number">2.10</span> 表2.5A</h2>
<p>係数を取り出して表2.5Aを再現する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(U)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore:Cscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Variable  Estimate Std..Error  z.value     Pr...z..
1 Rscore:Cscore 0.2021125 0.01519706 13.29945 2.331718e-40</code></pre>
</div>
</div>
</section>
<section id="表2.5b" class="level2" data-number="2.11">
<h2 data-number="2.11" class="anchored" data-anchor-id="表2.5b"><span class="header-section-number">2.11</span> 表2.5B</h2>
<p>省略された係数について，標準誤差を求める方法は次の通り．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel B </span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(R)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Cscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Variable     Estimate Std..Error    z.value     Pr...z..
1 polviews1:Cscore -0.558726563 0.10766840 -5.1893275 2.110549e-07
2 polviews2:Cscore -0.405075736 0.05914888 -6.8484091 7.467575e-12
3 polviews3:Cscore -0.248458921 0.05774110 -4.3029822 1.685144e-05
4 polviews4:Cscore  0.008763861 0.03970853  0.2207048 8.253223e-01
5 polviews5:Cscore  0.112245001 0.05128383  2.1887016 2.861853e-02
6 polviews6:Cscore  0.419078627 0.05143368  8.1479420 3.701697e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># polviews7:Cscoreを求める</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(<span class="fu">coef</span>(R)))</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(R,<span class="st">"[:]Cscore"</span>)</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>mycontrast[terms] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">6</span>)</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mycontrast)</span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mycontrast) <span class="ot">&lt;-</span> <span class="st">"polviews7:Cscore"</span></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>gnm<span class="sc">::</span><span class="fu">se</span>(R, mycontrast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Estimate Std. Error
polviews7:Cscore 0.6721737  0.1003211</code></pre>
</div>
</div>
</section>
<section id="表2.5b他の正規化" class="level2" data-number="2.12">
<h2 data-number="2.12" class="anchored" data-anchor-id="表2.5b他の正規化"><span class="header-section-number">2.12</span> 表2.5B（他の正規化）</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel B Alternative</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Ralt)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Cscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Variable  Estimate Std..Error  z.value     Pr...z..
1 polviews2:Cscore 0.1536508  0.1361941 1.128176 2.592458e-01
2 polviews3:Cscore 0.3102676  0.1356609 2.287082 2.219102e-02
3 polviews4:Cscore 0.5674904  0.1267654 4.476699 7.580590e-06
4 polviews5:Cscore 0.6709716  0.1326215 5.059297 4.208051e-07
5 polviews6:Cscore 0.9778052  0.1331060 7.346062 2.041319e-13
6 polviews7:Cscore 1.2309003  0.1678130 7.334954 2.217982e-13</code></pre>
</div>
</div>
</section>
<section id="表2.5c" class="level2" data-number="2.13">
<h2 data-number="2.13" class="anchored" data-anchor-id="表2.5c"><span class="header-section-number">2.13</span> 表2.5C</h2>
<p>同様に列効果の最後のカテゴリの推定値と標準誤差を求める．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel C</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(C)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Rscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Variable    Estimate Std..Error    z.value     Pr...z..
1 fefam1:Rscore -0.32183233 0.02601065 -12.373099 3.654449e-35
2 fefam2:Rscore -0.06518238 0.02012977  -3.238109 1.203247e-03
3 fefam3:Rscore  0.13740293 0.02281996   6.021174 1.731567e-09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fefam4:Rscoreを求める</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(<span class="fu">coef</span>(C)))</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(C,<span class="st">"[:]Rscore"</span>)</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>mycontrast[terms] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">3</span>)</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mycontrast)</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mycontrast) <span class="ot">&lt;-</span> <span class="st">"fefam4:Rscore"</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>gnm<span class="sc">::</span><span class="fu">se</span>(C, mycontrast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Estimate Std. Error
fefam4:Rscore 0.2496118 0.03429697</code></pre>
</div>
</div>
</section>
<section id="表2.5c他の正規化" class="level2" data-number="2.14">
<h2 data-number="2.14" class="anchored" data-anchor-id="表2.5c他の正規化"><span class="header-section-number">2.14</span> 表2.5C（他の正規化）</h2>
<p>1つ目のカテゴリの値を0とした正規化の場合は次のようになる．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel C Alternative</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Calt)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Rscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Variable  Estimate Std..Error   z.value     Pr...z..
1 fefam2:Rscore 0.2566499 0.03458604  7.420624 1.165702e-13
2 fefam3:Rscore 0.4592353 0.03850703 11.926012 8.662502e-33
3 fefam4:Rscore 0.5714441 0.05297192 10.787680 3.935998e-27</code></pre>
</div>
</div>
</section>
<section id="表2.5d" class="level2" data-number="2.15">
<h2 data-number="2.15" class="anchored" data-anchor-id="表2.5d"><span class="header-section-number">2.15</span> 表2.5D</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel D</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Variable    Estimate Std..Error    z.value     Pr...z..
1  polviews1:Cscore  0.00000000         NA         NA           NA
2  polviews2:Cscore -0.08578207 0.11436513 -0.7500719 4.532114e-01
3  polviews3:Cscore -0.15923097 0.10584890 -1.5043233 1.324981e-01
4  polviews4:Cscore -0.12164181 0.09246130 -1.3155970 1.883093e-01
5  polviews5:Cscore -0.22242867 0.10509647 -2.1164238 3.430878e-02
6  polviews6:Cscore -0.09452143 0.11453734 -0.8252455 4.092322e-01
7  polviews7:Cscore  0.00000000         NA         NA           NA
8     fefam1:Rscore  0.00000000         NA         NA           NA
9     fefam2:Rscore  0.27935717 0.04372418  6.3890770 1.668900e-10
10    fefam3:Rscore  0.48417258 0.06238681  7.7608170 8.438398e-15
11    fefam4:Rscore  0.58586364 0.08654948  6.7691179 1.295700e-11</code></pre>
</div>
</div>
</section>
<section id="表2.5d他の正規化" class="level2" data-number="2.16">
<h2 data-number="2.16" class="anchored" data-anchor-id="表2.5d他の正規化"><span class="header-section-number">2.16</span> 表2.5D（他の正規化）</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCalt)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Variable    Estimate Std..Error    z.value     Pr...z..
1     Rscore:Cscore  0.19528788 0.02884983  6.7691178 1.295700e-11
2  polviews2:Cscore -0.08578207 0.11436513 -0.7500719 4.532114e-01
3  polviews3:Cscore -0.15923097 0.10584890 -1.5043233 1.324981e-01
4  polviews4:Cscore -0.12164181 0.09246130 -1.3155970 1.883093e-01
5  polviews5:Cscore -0.22242867 0.10509647 -2.1164238 3.430878e-02
6  polviews6:Cscore -0.09452143 0.11453734 -0.8252455 4.092322e-01
7  polviews7:Cscore  0.00000000         NA         NA           NA
8     fefam2:Rscore  0.08406929 0.03224287  2.6073757 9.123919e-03
9     fefam3:Rscore  0.09359682 0.03861067  2.4241178 1.534563e-02
10    fefam4:Rscore  0.00000000         NA         NA           NA</code></pre>
</div>
</div>
</section>
<section id="表2.5e" class="level2" data-number="2.17">
<h2 data-number="2.17" class="anchored" data-anchor-id="表2.5e"><span class="header-section-number">2.17</span> 表2.5E</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Mult"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Variable    Estimate Std..Error    z.value     Pr...z..
1    Mult(., polviews, fefam).  2.37330693 0.34812532  6.8173924 9.270782e-12
2  Mult(1, ., fefam).polviews1 -0.48165420         NA         NA           NA
3  Mult(1, ., fefam).polviews2 -0.37579722 0.10049018 -3.7396411 1.842832e-04
4  Mult(1, ., fefam).polviews3 -0.23443020 0.09460850 -2.4778980 1.321589e-02
5  Mult(1, ., fefam).polviews4 -0.01631519 0.08365831 -0.1950217 8.453760e-01
6  Mult(1, ., fefam).polviews5  0.07748893 0.09263438  0.8365030 4.028720e-01
7  Mult(1, ., fefam).polviews6  0.38424697 0.10926427  3.5166753 4.369880e-04
8  Mult(1, ., fefam).polviews7  0.64646091         NA         NA           NA
9  Mult(1, polviews, .).fefam1 -0.74811781         NA         NA           NA
10 Mult(1, polviews, .).fefam2 -0.14097601 0.07468829 -1.8875250 5.908974e-02
11 Mult(1, polviews, .).fefam3  0.33229365 0.09161751  3.6269668 2.867702e-04
12 Mult(1, polviews, .).fefam4  0.55680017         NA         NA           NA</code></pre>
</div>
</div>
</section>
<section id="logmultパッケージの利用" class="level2" data-number="2.18">
<h2 data-number="2.18" class="anchored" data-anchor-id="logmultパッケージの利用"><span class="header-section-number">2.18</span> logmultパッケージの利用</h2>
<p><code>logmult</code>は<code>gnm</code>をベースとしてRCモデルを簡単に実行できる関数である．</p>
<p>まずは<code>logmult</code>パッケージの<code>anoas</code>で連関分析を行う．データはtableなので<code>tab_2.3A</code>を使用する．</p>
<p><code>anoas</code>は独立モデル，RC(1)，RC(2)，RC(3)，…と次元が<code>min(nrow(tab) - 1, ncol(tab) - 1)</code>までのRCモデルを推定する．RC(1)の結果は表2.4Aと一致している．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anoas</span>(tab_2<span class="fl">.3</span>A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting independence model...
Fitting model with 1 dimension...
Initialising
Running start-up iterations..
Running main iterations...................
Done
Fitting model with 2 dimensions...
Initialising
Running start-up iterations..
Running main iterations..........................
Done
Fitting model with 3 dimensions...
Initialising
Running start-up iterations..
Running main iterations...
Done</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       Res. Df           Res. Dev     Dev./Indep. (%)   Dissim. (%)
Indep.      18 211.69508974175693 100.000000000000000 8.09171028965
RC(1)       10   8.07181892815000   3.812945750417107 1.76730792765
RC(2)        4   1.36909098846095   0.646727796157711 0.49639212377
RC(3)        0  -0.00000000000001  -0.000000000000005 0.00000000004
                      BIC                AIC Dev. Df
Indep.  65.12224155397615 175.69508974175693   NA NA
RC(1)  -73.35754117617265 -11.92818107185000 -204 -8
RC(2)  -31.20265305326811  -6.63090901153905   -7 -6
RC(3)   -0.00000000000001  -0.00000000000001   -1 -4</code></pre>
</div>
</div>
<p>表2.5Eの推定値（RC(1)）は<code>rc</code>を用いて次のように再現できる．<code>nd = 1</code>で次元を1としている．標準誤差を求める上で，ブートストラップ法を用いている．結果には<span class="math inline">\(\gamma=\delta=1/2\)</span>の場合の係数（Adjusted）が示されている．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>rc_fit <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, </span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">nd =</span> <span class="dv">1</span>, </span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">se =</span> <span class="st">"bootstrap"</span>, </span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">weighting =</span> <span class="st">"none"</span>,</span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">nreplicates =</span> <span class="dv">100</span>, </span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncpus =</span> <span class="fu">getOption</span>(<span class="st">"boot.ncpus"</span>)</span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>             )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........
Done
Computing bootstrap standard errors...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: parallel</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rc_fit, <span class="at">weighting =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab_2.3A, nd = 1, weighting = "none", se = "bootstrap", 
    nreplicates = 100, ncpus = getOption("boot.ncpus"))

Deviance Residuals:
    Min       1Q   Median       3Q      Max  
-1.0743  -0.2724   0.0304   0.3679   1.0372  

Association coefficients:
                                    Normalized   Adjusted  Std. error
Dim1                                  2.373307         NA      0.2735
Dim1:polviewsStrongly liberal         0.481654   0.742014      0.0732
Dim1:polviewsLiberal                  0.375797   0.578936      0.0505
Dim1:polviewsSlightly liberal         0.234430   0.361152      0.0544
Dim1:polviewsModerate                 0.016315   0.025134      0.0326
Dim1:polviewsSlightly conservative   -0.077489  -0.119376      0.0492
Dim1:polviewsConservative            -0.384247  -0.591953      0.0596
Dim1:polviewsStrongly conservative   -0.646461  -0.995908      0.0621
Dim1:fefamStrongly Disagree           0.748118   1.152516      0.0252
Dim1:fefamDisagree                    0.140976   0.217181      0.0470
Dim1:fefamAgree                      -0.332294  -0.511916      0.0583
Dim1:fefamStrongly agree             -0.556800  -0.857781      0.0489
                                     Pr(&gt;|z|)     
Dim1                                &lt; 2.2e-16  ***
Dim1:polviewsStrongly liberal       4.834e-11  ***
Dim1:polviewsLiberal                1.003e-13  ***
Dim1:polviewsSlightly liberal       1.609e-05  ***
Dim1:polviewsModerate                0.616651     
Dim1:polviewsSlightly conservative   0.114925     
Dim1:polviewsConservative           1.121e-10  ***
Dim1:polviewsStrongly conservative  &lt; 2.2e-16  ***
Dim1:fefamStrongly Disagree         &lt; 2.2e-16  ***
Dim1:fefamDisagree                   0.002683  ** 
Dim1:fefamAgree                     1.214e-08  ***
Dim1:fefamStrongly agree            &lt; 2.2e-16  ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Normalization weights: none
Deviance:              8.071819
Pearson chi-squared:   8.168769
Dissimilarity index:   1.767308%
Residual df:           10
BIC:                   -73.35754
AIC:                   -11.92818</code></pre>
</div>
</div>
<p>周辺重みづけを用いたい場合は`weighting = “marginal”とする．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>rc_fit_wm <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, </span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">nd =</span> <span class="dv">1</span>, </span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">se =</span> <span class="st">"bootstrap"</span>, </span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">weighting =</span> <span class="st">"marginal"</span>,</span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">nreplicates =</span> <span class="dv">100</span>, </span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncpus =</span> <span class="fu">getOption</span>(<span class="st">"boot.ncpus"</span>)</span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>             )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.............
Done
Computing bootstrap standard errors...
.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rc_fit_wm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab_2.3A, nd = 1, weighting = "marginal", se = "bootstrap", 
    nreplicates = 100, ncpus = getOption("boot.ncpus"))

Deviance Residuals:
    Min       1Q   Median       3Q      Max  
-1.0743  -0.2724   0.0304   0.3679   1.0372  

Association coefficients:
                                    Normalized   Adjusted  Std. error
Dim1                                  0.256734         NA      0.0185
Dim1:polviewsStrongly liberal         1.820624   0.922490      0.3333
Dim1:polviewsLiberal                  1.415319   0.717126      0.1601
Dim1:polviewsSlightly liberal         0.874053   0.442873      0.1882
Dim1:polviewsModerate                 0.038935   0.019728      0.0944
Dim1:polviewsSlightly conservative   -0.320222  -0.162253      0.1777
Dim1:polviewsConservative            -1.494737  -0.757366      0.1303
Dim1:polviewsStrongly conservative   -2.498701  -1.266064      0.4518
Dim1:fefamStrongly Disagree           1.657784   0.839980      0.0847
Dim1:fefamDisagree                    0.191902   0.097234      0.0811
Dim1:fefamAgree                      -0.950760  -0.481739      0.0891
Dim1:fefamStrongly agree             -1.492808  -0.756389      0.1960
                                     Pr(&gt;|z|)     
Dim1                                &lt; 2.2e-16  ***
Dim1:polviewsStrongly liberal       4.701e-08  ***
Dim1:polviewsLiberal                &lt; 2.2e-16  ***
Dim1:polviewsSlightly liberal       3.393e-06  ***
Dim1:polviewsModerate                 0.67992     
Dim1:polviewsSlightly conservative    0.07150  .  
Dim1:polviewsConservative           &lt; 2.2e-16  ***
Dim1:polviewsStrongly conservative  3.197e-08  ***
Dim1:fefamStrongly Disagree         &lt; 2.2e-16  ***
Dim1:fefamDisagree                    0.01798  *  
Dim1:fefamAgree                     &lt; 2.2e-16  ***
Dim1:fefamStrongly agree            2.616e-14  ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Normalization weights: marginal
Deviance:              8.071819
Pearson chi-squared:   8.168769
Dissimilarity index:   1.767308%
Residual df:           10
BIC:                   -73.35754
AIC:                   -11.92818</code></pre>
</div>
</div>
<p>これは先ほど求めた周辺重みづけの結果（内的連関パラメータが0.25673）と一致する．</p>
</section>
<section id="表2.3b" class="level2" data-number="2.19">
<h2 data-number="2.19" class="anchored" data-anchor-id="表2.3b"><span class="header-section-number">2.19</span> 表2.3B</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># コントラストを確認</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$contrasts
           factor           ordered 
"contr.treatment" "contr.treatment" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># default</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>anoas</code>を用いるときにはのエラーを無くすために行列はラベルを用いない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">518</span>,   <span class="dv">95</span>,  <span class="dv">6</span>,  <span class="dv">35</span>,  <span class="dv">5</span>,</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>         　<span class="dv">81</span>,   <span class="dv">67</span>,  <span class="dv">4</span>,  <span class="dv">49</span>,  <span class="dv">2</span>,</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">452</span>, <span class="dv">1003</span>, <span class="dv">67</span>, <span class="dv">630</span>,  <span class="dv">5</span>,</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>           <span class="dv">71</span>,  <span class="dv">157</span>, <span class="dv">37</span>, <span class="dv">562</span>, <span class="dv">12</span>)</span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq, </span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">5</span>,</span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     A    B    C    D    E
A  518   95    6   35    5
B   81   67    4   49    2
C  452 1003   67  630    5
D   71  157   37  562   12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる集計データを作成</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>Educ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>Occ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">20</span>)</span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Educ, Occ)</span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
    Freq Educ  Occ  
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
 1   518 1     1    
 2    95 1     2    
 3     6 1     3    
 4    35 1     4    
 5     5 1     5    
 6    81 2     1    
 7    67 2     2    
 8     4 2     3    
 9    49 2     4    
10     2 2     5    
11   452 3     1    
12  1003 3     2    
13    67 3     3    
14   630 3     4    
15     5 3     5    
16    71 4     1    
17   157 4     2    
18    37 4     3    
19   562 4     4    
20    12 4     5    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数と列変数の整数値を作成</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span> </span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rscore =</span> <span class="fu">as.numeric</span>(Educ),</span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> <span class="fu">as.numeric</span>(Occ))</span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 5
    Freq Educ  Occ   Rscore Cscore
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1   518 1     1          1      1
 2    95 1     2          1      2
 3     6 1     3          1      3
 4    35 1     4          1      4
 5     5 1     5          1      5
 6    81 2     1          2      1
 7    67 2     2          2      2
 8     4 2     3          2      3
 9    49 2     4          2      4
10     2 2     5          2      5
11   452 3     1          3      1
12  1003 3     2          3      2
13    67 3     3          3      3
14   630 3     4          3      4
15     5 3     5          3      5
16    71 4     1          4      1
17   157 4     2          4      2
18    37 4     3          4      3
19   562 4     4          4      4
20    12 4     5          4      5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span> </span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ, </span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore, </span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-14"><a href="#cb272-14" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb272-15"><a href="#cb272-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb272-16"><a href="#cb272-16" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb272-17"><a href="#cb272-17" aria-hidden="true" tabindex="-1"></a>        Educ<span class="sc">:</span>Cscore, </span>
<span id="cb272-18"><a href="#cb272-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb272-19"><a href="#cb272-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb272-20"><a href="#cb272-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb272-21"><a href="#cb272-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-22"><a href="#cb272-22" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb272-23"><a href="#cb272-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb272-24"><a href="#cb272-24" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb272-25"><a href="#cb272-25" aria-hidden="true" tabindex="-1"></a>        Occ<span class="sc">:</span>Rscore, </span>
<span id="cb272-26"><a href="#cb272-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb272-27"><a href="#cb272-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb272-28"><a href="#cb272-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb272-29"><a href="#cb272-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-30"><a href="#cb272-30" aria-hidden="true" tabindex="-1"></a>RplusC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb272-31"><a href="#cb272-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb272-32"><a href="#cb272-32" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb272-33"><a href="#cb272-33" aria-hidden="true" tabindex="-1"></a>        Educ<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb272-34"><a href="#cb272-34" aria-hidden="true" tabindex="-1"></a>        Occ<span class="sc">:</span>Rscore,</span>
<span id="cb272-35"><a href="#cb272-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">16</span>), </span>
<span id="cb272-36"><a href="#cb272-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb272-37"><a href="#cb272-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb272-38"><a href="#cb272-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb272-39"><a href="#cb272-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb272-40"><a href="#cb272-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-41"><a href="#cb272-41" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb272-42"><a href="#cb272-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb272-43"><a href="#cb272-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb272-44"><a href="#cb272-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb272-45"><a href="#cb272-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb272-46"><a href="#cb272-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
.............................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
.
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>),</span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb276-8"><a href="#cb276-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb276-9"><a href="#cb276-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.......................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations......................................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),<span class="dv">2</span>),</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.....................
Done</code></pre>
</div>
</div>
</section>
<section id="表2.6a" class="level2" data-number="2.20">
<h2 data-number="2.20" class="anchored" data-anchor-id="表2.6a"><span class="header-section-number">2.20</span> 表2.6A</h2>
<p>表2.6Aを再現する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(O)</span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(U)</span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(R)</span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(C)</span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusC)</span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RC)</span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">7</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(UplusRC)</span>
<span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">8</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusRC)</span>
<span id="cb284-10"><a href="#cb284-10" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">9</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(CplusRC)</span>
<span id="cb284-11"><a href="#cb284-11" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">10</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusCplusRC)</span>
<span id="cb284-12"><a href="#cb284-12" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">11</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RC2)</span>
<span id="cb284-13"><a href="#cb284-13" aria-hidden="true" tabindex="-1"></a>models <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 6
   `Model Description`    df       L2    BIC   Delta         p
   &lt;chr&gt;               &lt;int&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1 O                      12 1373.    1274.  23.9    8.44e-287
 2 U                      11  244.     153.   8.54   4.99e- 46
 3 R                       9  206.     132.   7.38   1.85e- 39
 4 C                       8  155.      89.3  7.47   1.48e- 29
 5 RplusC                  6   91.6     42.1  4.63   1.40e- 17
 6 RC                      6  125.      75.5  6.44   1.41e- 24
 7 UplusRC                 5   17.6    -23.7  1.52   3.49e-  3
 8 RplusRC                 4    6.94   -26.1  0.832  1.39e-  1
 9 CplusRC                 3   11.4    -13.4  1.01   9.72e-  3
10 RplusCplusRC            2    0.278  -16.2  0.0538 8.70e-  1
11 RC2                     2    0.600  -15.9  0.0935 7.41e-  1</code></pre>
</div>
</div>
</section>
<section id="表2.6b" class="level2" data-number="2.21">
<h2 data-number="2.21" class="anchored" data-anchor-id="表2.6b"><span class="header-section-number">2.21</span> 表2.6B</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel B</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">1</span>,<span class="dv">6</span>),</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">6</span>,<span class="dv">11</span>),</span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">11</span>),</span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  `Model Used`    df       L2
  &lt;chr&gt;        &lt;int&gt;    &lt;dbl&gt;
1 1-6              6 1248.   
2 6-11             4  124.   
3 11               2    0.600
4 1               12 1373.   </code></pre>
</div>
</div>
</section>
<section id="表2.6c" class="level2" data-number="2.22">
<h2 data-number="2.22" class="anchored" data-anchor-id="表2.6c"><span class="header-section-number">2.22</span> 表2.6C</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel C</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">6</span>),</span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">6</span>,<span class="dv">10</span>),</span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">10</span>),</span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  `Model Used`    df       L2
  &lt;chr&gt;        &lt;int&gt;    &lt;dbl&gt;
1 1-2              1 1129.   
2 2-6              5  119.   
3 6-10             4  125.   
4 10               2    0.278
5 1               12 1373.   </code></pre>
</div>
</div>
</section>
<section id="表2.7a" class="level2" data-number="2.23">
<h2 data-number="2.23" class="anchored" data-anchor-id="表2.7a"><span class="header-section-number">2.23</span> 表2.7A</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
..............
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(UplusRC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Rscore:Cscore + Mult(1, Educ, 
    Occ), family = poisson, data = freq_tab_2.3B, tolerance = 1e-12)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0893  -0.5631   0.1321   0.7372   1.9761  

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)             5.49123         NA      NA       NA    
Educ2                  -2.07045         NA      NA       NA    
Educ3                  -1.00877         NA      NA       NA    
Educ4                  -3.55473         NA      NA       NA    
Occ2                   -1.06909         NA      NA       NA    
Occ3                   -5.17113         NA      NA       NA    
Occ4                   -4.53939         NA      NA       NA    
Occ5                  -10.91018         NA      NA       NA    
Rscore:Cscore           0.55212    0.03429    16.1   &lt;2e-16 ***
Mult(., Educ, Occ).     0.05379         NA      NA       NA    
Mult(1, ., Occ).Educ1  57.38879         NA      NA       NA    
Mult(1, ., Occ).Educ2  28.47707         NA      NA       NA    
Mult(1, ., Occ).Educ3 -10.70009         NA      NA       NA    
Mult(1, ., Occ).Educ4   9.22301         NA      NA       NA    
Mult(1, Educ, .).Occ1   0.06067         NA      NA       NA    
Mult(1, Educ, .).Occ2  -0.31188         NA      NA       NA    
Mult(1, Educ, .).Occ3   0.01526         NA      NA       NA    
Mult(1, Educ, .).Occ4   0.19408         NA      NA       NA    
Mult(1, Educ, .).Occ5   1.34889         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 17.602 on 5 degrees of freedom
AIC: 163.98

Number of iterations: 71</code></pre>
</div>
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Educ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ3 
                   11                    12                    13 
Mult(1, ., Occ).Educ4 
                   14 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Occ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ3 
                   15                    16                    17 
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ5 
                   18                    19 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(UplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> UplusRC<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span> </span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        var     estimate number
(Intercept)                     (Intercept)   5.49123206      1
Educ2                                 Educ2  -2.07045034      2
Educ3                                 Educ3  -1.00877122      3
Educ4                                 Educ4  -3.55472593      4
Occ2                                   Occ2  -1.06909237      5
Occ3                                   Occ3  -5.17112951      6
Occ4                                   Occ4  -4.53939355      7
Occ5                                   Occ5 -10.91018443      8
Rscore:Cscore                 Rscore:Cscore   0.55211791      9
Mult(., Educ, Occ).     Mult(., Educ, Occ).   0.05378691     10
Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ1  57.38878762     11
Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ2  28.47707090     12
Mult(1, ., Occ).Educ3 Mult(1, ., Occ).Educ3 -10.70009235     13
Mult(1, ., Occ).Educ4 Mult(1, ., Occ).Educ4   9.22300628     14
Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ1   0.06066883     15
Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ2  -0.31187524     16
Mult(1, Educ, .).Occ3 Mult(1, Educ, .).Occ3   0.01525644     17
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ4   0.19407628     18
Mult(1, Educ, .).Occ5 Mult(1, Educ, .).Occ5   1.34889132     19</code></pre>
</div>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(UplusRC, </span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Educ"</span>), </span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(UplusRC, </span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Occ"</span>), </span>
<span id="cb300-8"><a href="#cb300-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb300-9"><a href="#cb300-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb300-10"><a href="#cb300-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb300-11"><a href="#cb300-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-12"><a href="#cb300-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心化制約と尺度化制約の確認</span></span>
<span id="cb300-13"><a href="#cb300-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]) <span class="sc">|&gt;</span> <span class="fu">round</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]) <span class="sc">|&gt;</span> <span class="fu">round</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行スコアと列スコアの両端の値を固定する</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb308-9"><a href="#cb308-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">19</span>),</span>
<span id="cb308-10"><a href="#cb308-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb308-11"><a href="#cb308-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb308-12"><a href="#cb308-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb308-13"><a href="#cb308-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
.........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(UplusRC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>,</span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a>                      Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Variable    Estimate Std..Error   z.value     Pr...z..
1          Rscore:Cscore  0.55211791 0.03429436 16.099379 2.576758e-58
2    Mult(., Educ, Occ).  3.43558976 0.61932837  5.547283 2.901428e-08
3  Mult(1, ., Occ).Educ1  0.72242916         NA        NA           NA
4  Mult(1, ., Occ).Educ2  0.14690561 0.13431003  1.093780 2.740515e-01
5  Mult(1, ., Occ).Educ3 -0.63296437 0.13149187 -4.813715 1.481501e-06
6  Mult(1, ., Occ).Educ4 -0.23637040         NA        NA           NA
7  Mult(1, Educ, .).Occ1 -0.15787324         NA        NA           NA
8  Mult(1, Educ, .).Occ2 -0.45087063 0.05888770 -7.656448 1.911463e-14
9  Mult(1, Educ, .).Occ3 -0.19358905 0.08174718 -2.368143 1.787760e-02
10 Mult(1, Educ, .).Occ4 -0.05295134 0.05110102 -1.036209 3.001047e-01
11 Mult(1, Educ, .).Occ5  0.85528425         NA        NA           NA</code></pre>
</div>
</div>
</section>
<section id="表2.7b" class="level2" data-number="2.24">
<h2 data-number="2.24" class="anchored" data-anchor-id="表2.7b"><span class="header-section-number">2.24</span> 表2.7B</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>RplusRC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.............................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusRC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Cscore:Educ + Mult(1, Educ, 
    Occ), family = poisson, data = freq_tab_2.3B, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.96462  -0.24301  -0.05231   0.31330   1.21311  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)             7.8043         NA      NA       NA
Educ2                  -2.5496         NA      NA       NA
Educ3                  -1.0924         NA      NA       NA
Educ4                  -3.6305         NA      NA       NA
Occ2                    1.0437         NA      NA       NA
Occ3                   -0.7855         NA      NA       NA
Occ4                    2.0809         NA      NA       NA
Occ5                   -1.8534         NA      NA       NA
Educ1:Cscore           -1.7432         NA      NA       NA
Educ2:Cscore           -0.9182         NA      NA       NA
Educ3:Cscore           -0.5398         NA      NA       NA
Educ4:Cscore            0.0000         NA      NA       NA
Mult(., Educ, Occ).    -0.4213         NA      NA       NA
Mult(1, ., Occ).Educ1  -2.0586         NA      NA       NA
Mult(1, ., Occ).Educ2  -0.7258         NA      NA       NA
Mult(1, ., Occ).Educ3   0.5605         NA      NA       NA
Mult(1, ., Occ).Educ4  -0.2104         NA      NA       NA
Mult(1, Educ, .).Occ1   0.2200         NA      NA       NA
Mult(1, Educ, .).Occ2  -0.9616         NA      NA       NA
Mult(1, Educ, .).Occ3   0.1953         NA      NA       NA
Mult(1, Educ, .).Occ4   0.7768         NA      NA       NA
Mult(1, Educ, .).Occ5   4.8551         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 6.9359 on 4 degrees of freedom
AIC: 155.31

Number of iterations: 29</code></pre>
</div>
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusRC.un, <span class="st">"[:]Cscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Educ1:Cscore Educ2:Cscore Educ3:Cscore Educ4:Cscore 
           9           10           11           12 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>),</span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb318-7"><a href="#cb318-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb318-8"><a href="#cb318-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb318-9"><a href="#cb318-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations........................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusRC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Cscore:Educ + Mult(1, Educ, 
    Occ), constrain = c(9, 12), constrainTo = c(0, 0), family = poisson, 
    data = freq_tab_2.3B, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.96462  -0.24301  -0.05231   0.31330   1.21311  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)             5.0338         NA      NA       NA    
Educ2                  -0.4417         NA      NA       NA    
Educ3                   3.0501         NA      NA       NA    
Educ4                  -0.7074         NA      NA       NA    
Occ2                    0.6767         NA      NA       NA    
Occ3                   -1.1329         NA      NA       NA    
Occ4                    1.6580         NA      NA       NA    
Occ5                   -1.7737         NA      NA       NA    
Educ1:Cscore            0.0000         NA      NA       NA    
Educ2:Cscore           -0.4321     0.2210  -1.955   0.0506 .  
Educ3:Cscore           -1.2670     0.1931  -6.562 5.31e-11 ***
Educ4:Cscore            0.0000         NA      NA       NA    
Mult(., Educ, Occ).    -1.5191         NA      NA       NA    
Mult(1, ., Occ).Educ1   4.6510         NA      NA       NA    
Mult(1, ., Occ).Educ2   0.9307         NA      NA       NA    
Mult(1, ., Occ).Educ3  -2.6602         NA      NA       NA    
Mult(1, ., Occ).Educ4  -0.5081         NA      NA       NA    
Mult(1, Educ, .).Occ1  -0.1724         NA      NA       NA    
Mult(1, Educ, .).Occ2   0.1674         NA      NA       NA    
Mult(1, Educ, .).Occ3   0.2749         NA      NA       NA    
Mult(1, Educ, .).Occ4   0.4395         NA      NA       NA    
Mult(1, Educ, .).Occ5   0.2568         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 6.9359 on 4 degrees of freedom
AIC: 155.31

Number of iterations: 40</code></pre>
</div>
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusRC.un, <span class="st">"[.]Educ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ3 
                   14                    15                    16 
Mult(1, ., Occ).Educ4 
                   17 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusRC.un, <span class="st">"[.]Occ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ3 
                   18                    19                    20 
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ5 
                   21                    22 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(RplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> RplusRC<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span> </span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        var   estimate number
(Intercept)                     (Intercept)  5.0338134      1
Educ2                                 Educ2 -0.4416984      2
Educ3                                 Educ3  3.0500999      3
Educ4                                 Educ4 -0.7074330      4
Occ2                                   Occ2  0.6766646      5
Occ3                                   Occ3 -1.1329222      6
Occ4                                   Occ4  1.6579720      7
Occ5                                   Occ5 -1.7736652      8
Educ1:Cscore                   Educ1:Cscore         NA      9
Educ2:Cscore                   Educ2:Cscore -0.4320760     10
Educ3:Cscore                   Educ3:Cscore -1.2669500     11
Educ4:Cscore                   Educ4:Cscore         NA     12
Mult(., Educ, Occ).     Mult(., Educ, Occ). -1.5191478     13
Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ1  4.6509709     14
Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ2  0.9307366     15
Mult(1, ., Occ).Educ3 Mult(1, ., Occ).Educ3 -2.6601848     16
Mult(1, ., Occ).Educ4 Mult(1, ., Occ).Educ4 -0.5080538     17
Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ1 -0.1724067     18
Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ2  0.1674123     19
Mult(1, Educ, .).Occ3 Mult(1, Educ, .).Occ3  0.2748827     20
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ4  0.4395333     21
Mult(1, Educ, .).Occ5 Mult(1, Educ, .).Occ5  0.2567545     22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusRC, </span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusRC, <span class="st">"[.]Educ"</span>), </span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb328-6"><a href="#cb328-6" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusRC, </span>
<span id="cb328-7"><a href="#cb328-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusRC, <span class="st">"[.]Occ"</span>), </span>
<span id="cb328-8"><a href="#cb328-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb328-9"><a href="#cb328-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb328-10"><a href="#cb328-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb328-11"><a href="#cb328-11" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb328-12"><a href="#cb328-12" aria-hidden="true" tabindex="-1"></a>         mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],</span>
<span id="cb328-13"><a href="#cb328-13" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb328-14"><a href="#cb328-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-15"><a href="#cb328-15" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb328-16"><a href="#cb328-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb328-17"><a href="#cb328-17" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb328-18"><a href="#cb328-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb328-19"><a href="#cb328-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">22</span>),</span>
<span id="cb328-20"><a href="#cb328-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb328-21"><a href="#cb328-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb328-22"><a href="#cb328-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb328-23"><a href="#cb328-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.....................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusRC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Variable    Estimate Std..Error    z.value     Pr...z..
1           Educ1:Cscore  0.00000000         NA         NA           NA
2           Educ2:Cscore -0.43207600  0.2209849 -1.9552282 5.055614e-02
3           Educ3:Cscore -1.26695003  0.1930731 -6.5620238 5.308234e-11
4           Educ4:Cscore  0.00000000         NA         NA           NA
5    Mult(., Educ, Occ). -3.67046405  0.5474332 -6.7048620 2.015968e-11
6  Mult(1, ., Occ).Educ1  0.75983648         NA         NA           NA
7  Mult(1, ., Occ).Educ2  0.06145542  0.1367987  0.4492399 6.532586e-01
8  Mult(1, ., Occ).Educ3 -0.61265036  0.1325427 -4.6222852 3.795357e-06
9  Mult(1, ., Occ).Educ4 -0.20864153         NA         NA           NA
10 Mult(1, Educ, .).Occ1 -0.80614447         NA         NA           NA
11 Mult(1, Educ, .).Occ2 -0.05693272  0.1225191 -0.4646846 6.421573e-01
12 Mult(1, Educ, .).Occ3  0.18001127  0.1630841  1.1037941 2.696825e-01
13 Mult(1, Educ, .).Occ4  0.54302264  0.2004941  2.7084221 6.760398e-03
14 Mult(1, Educ, .).Occ5  0.14004328         NA         NA           NA</code></pre>
</div>
</div>
</section>
<section id="表2.7c" class="level2" data-number="2.25">
<h2 data-number="2.25" class="anchored" data-anchor-id="表2.7c"><span class="header-section-number">2.25</span> 表2.7C</h2>
<p><code>Algorithm failed - no model could be estimated</code>となったら再度推定すること．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a>CplusRC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb332-8"><a href="#cb332-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...................................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Rscore:Occ + Mult(1, Educ, 
    Occ), family = poisson, data = freq_tab_2.3B, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.98938  -0.14103  -0.01486   0.18280   2.20453  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)            7.10137         NA      NA       NA
Educ2                 -0.60908         NA      NA       NA
Educ3                  1.91190         NA      NA       NA
Educ4                  0.89240         NA      NA       NA
Occ2                  -1.92075         NA      NA       NA
Occ3                  -5.71514         NA      NA       NA
Occ4                  -4.14240         NA      NA       NA
Occ5                  -6.62799         NA      NA       NA
Occ1:Rscore           -0.95586         NA      NA       NA
Occ2:Rscore           -0.14909         NA      NA       NA
Occ3:Rscore            0.31615         NA      NA       NA
Occ4:Rscore            0.57050         NA      NA       NA
Occ5:Rscore            0.00000         NA      NA       NA
Mult(., Educ, Occ).    0.66123         NA      NA       NA
Mult(1, ., Occ).Educ1  2.38686         NA      NA       NA
Mult(1, ., Occ).Educ2  0.76217         NA      NA       NA
Mult(1, ., Occ).Educ3 -1.41566         NA      NA       NA
Mult(1, ., Occ).Educ4  2.21619         NA      NA       NA
Mult(1, Educ, .).Occ1  0.05371         NA      NA       NA
Mult(1, Educ, .).Occ2 -0.28583         NA      NA       NA
Mult(1, Educ, .).Occ3  0.04603         NA      NA       NA
Mult(1, Educ, .).Occ4  0.13605         NA      NA       NA
Mult(1, Educ, .).Occ5  0.76573         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 11.405 on 3 degrees of freedom
AIC: 161.78

Number of iterations: 51</code></pre>
</div>
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(CplusRC.un, <span class="st">"[:]Rscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Occ1:Rscore Occ2:Rscore Occ3:Rscore Occ4:Rscore Occ5:Rscore 
          9          10          11          12          13 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">13</span>),</span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb338-8"><a href="#cb338-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb338-9"><a href="#cb338-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations..............................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Rscore:Occ + Mult(1, Educ, 
    Occ), constrain = c(9, 13), constrainTo = c(0, 0), family = poisson, 
    data = freq_tab_2.3B, tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.98938  -0.14103  -0.01486   0.18280   2.20453  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)            6.20363         NA      NA       NA    
Educ2                 -1.63502         NA      NA       NA    
Educ3                 -0.14273         NA      NA       NA    
Educ4                 -2.16197         NA      NA       NA    
Occ2                  -2.71651         NA      NA       NA    
Occ3                  -5.73314         NA      NA       NA    
Occ4                  -3.94944         NA      NA       NA    
Occ5                  -4.95928         NA      NA       NA    
Occ1:Rscore            0.00000         NA      NA       NA    
Occ2:Rscore            1.26259    0.16970   7.440 1.00e-13 ***
Occ3:Rscore            1.28232    0.20937   6.125 9.08e-10 ***
Occ4:Rscore            1.41583    0.09054  15.638  &lt; 2e-16 ***
Occ5:Rscore            0.00000         NA      NA       NA    
Mult(., Educ, Occ).    0.19485         NA      NA       NA    
Mult(1, ., Occ).Educ1  2.16357         NA      NA       NA    
Mult(1, ., Occ).Educ2  3.16895         NA      NA       NA    
Mult(1, ., Occ).Educ3  2.80310         NA      NA       NA    
Mult(1, ., Occ).Educ4 16.83940         NA      NA       NA    
Mult(1, Educ, .).Occ1  0.06320         NA      NA       NA    
Mult(1, Educ, .).Occ2 -0.40161         NA      NA       NA    
Mult(1, Educ, .).Occ3  0.05268         NA      NA       NA    
Mult(1, Educ, .).Occ4  0.17592         NA      NA       NA    
Mult(1, Educ, .).Occ5  1.03792         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 11.405 on 3 degrees of freedom
AIC: 161.78

Number of iterations: 46</code></pre>
</div>
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Variable    Estimate Std..Error   z.value     Pr...z..
1            Occ1:Rscore  0.00000000         NA        NA           NA
2            Occ2:Rscore  1.26259006  0.1696974  7.440245 1.004990e-13
3            Occ3:Rscore  1.28231939  0.2093667  6.124752 9.082487e-10
4            Occ4:Rscore  1.41582828  0.0905404 15.637531 4.040916e-55
5            Occ5:Rscore  0.00000000         NA        NA           NA
6    Mult(., Educ, Occ).  0.19484605         NA        NA           NA
7  Mult(1, ., Occ).Educ1  2.16357386         NA        NA           NA
8  Mult(1, ., Occ).Educ2  3.16895075         NA        NA           NA
9  Mult(1, ., Occ).Educ3  2.80310016         NA        NA           NA
10 Mult(1, ., Occ).Educ4 16.83939688         NA        NA           NA
11 Mult(1, Educ, .).Occ1  0.06320167         NA        NA           NA
12 Mult(1, Educ, .).Occ2 -0.40161169         NA        NA           NA
13 Mult(1, Educ, .).Occ3  0.05268391         NA        NA           NA
14 Mult(1, Educ, .).Occ4  0.17591506         NA        NA           NA
15 Mult(1, Educ, .).Occ5  1.03791723         NA        NA           NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(CplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> CplusRC<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span> </span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        var    estimate number
(Intercept)                     (Intercept)  6.20363194      1
Educ2                                 Educ2 -1.63501732      2
Educ3                                 Educ3 -0.14273304      3
Educ4                                 Educ4 -2.16196522      4
Occ2                                   Occ2 -2.71650934      5
Occ3                                   Occ3 -5.73314338      6
Occ4                                   Occ4 -3.94943954      7
Occ5                                   Occ5 -4.95928306      8
Occ1:Rscore                     Occ1:Rscore          NA      9
Occ2:Rscore                     Occ2:Rscore  1.26259006     10
Occ3:Rscore                     Occ3:Rscore  1.28231939     11
Occ4:Rscore                     Occ4:Rscore  1.41582828     12
Occ5:Rscore                     Occ5:Rscore          NA     13
Mult(., Educ, Occ).     Mult(., Educ, Occ).  0.19484605     14
Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ1  2.16357386     15
Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ2  3.16895075     16
Mult(1, ., Occ).Educ3 Mult(1, ., Occ).Educ3  2.80310016     17
Mult(1, ., Occ).Educ4 Mult(1, ., Occ).Educ4 16.83939688     18
Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ1  0.06320167     19
Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ2 -0.40161169     20
Mult(1, Educ, .).Occ3 Mult(1, Educ, .).Occ3  0.05268391     21
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ4  0.17591506     22
Mult(1, Educ, .).Occ5 Mult(1, Educ, .).Occ5  1.03791723     23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(CplusRC, </span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(CplusRC, <span class="st">"[.]Educ"</span>),</span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(CplusRC, </span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(CplusRC, <span class="st">"[.]Occ"</span>),</span>
<span id="cb346-8"><a href="#cb346-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb346-9"><a href="#cb346-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb346-10"><a href="#cb346-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb346-11"><a href="#cb346-11" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb346-12"><a href="#cb346-12" aria-hidden="true" tabindex="-1"></a>         mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],</span>
<span id="cb346-13"><a href="#cb346-13" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb346-14"><a href="#cb346-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-15"><a href="#cb346-15" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb346-16"><a href="#cb346-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb346-17"><a href="#cb346-17" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb346-18"><a href="#cb346-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb346-19"><a href="#cb346-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">13</span>,<span class="dv">15</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">23</span>),</span>
<span id="cb346-20"><a href="#cb346-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb346-21"><a href="#cb346-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb346-22"><a href="#cb346-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb346-23"><a href="#cb346-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...............................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Variable     Estimate Std..Error   z.value     Pr...z..
1            Occ1:Rscore  0.000000000         NA        NA           NA
2            Occ2:Rscore  1.262590058 0.16969738  7.440245 1.004990e-13
3            Occ3:Rscore  1.282319390 0.20936674  6.124752 9.082487e-10
4            Occ4:Rscore  1.415828283 0.09054040 15.637531 4.040916e-55
5            Occ5:Rscore  0.000000000         NA        NA           NA
6    Mult(., Educ, Occ).  2.509132039 0.47337666  5.300498 1.154873e-07
7  Mult(1, ., Occ).Educ1 -0.332914652         NA        NA           NA
8  Mult(1, ., Occ).Educ2 -0.250882838 0.17043562 -1.472009 1.410183e-01
9  Mult(1, ., Occ).Educ3 -0.280733721 0.25875316 -1.084948 2.779447e-01
10 Mult(1, ., Occ).Educ4  0.864531211         NA        NA           NA
11 Mult(1, Educ, .).Occ1 -0.116510615         NA        NA           NA
12 Mult(1, Educ, .).Occ2 -0.558888360 0.15090381 -3.703607 2.125557e-04
13 Mult(1, Educ, .).Occ3 -0.126520705 0.12280113 -1.030289 3.028742e-01
14 Mult(1, Educ, .).Occ4 -0.009237675 0.06533009 -0.141400 8.875539e-01
15 Mult(1, Educ, .).Occ5  0.811157355         NA        NA           NA</code></pre>
</div>
</div>
</section>
<section id="表2.7d" class="level2" data-number="2.26">
<h2 data-number="2.26" class="anchored" data-anchor-id="表2.7d"><span class="header-section-number">2.26</span> 表2.7D</h2>
<p>まずは行効果と列効果のパラメータに対して0という制約を課し，その上で推定した行スコアと列スコアを正規化し，再度推定する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a>RplusCplusRC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb350-7"><a href="#cb350-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb350-8"><a href="#cb350-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations..............
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCplusRC.un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + Cscore:Educ + Rscore:Occ + 
    Mult(1, Educ, Occ), family = poisson, data = freq_tab_2.3B, 
    tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.46856  -0.01129  -0.00160   0.02313   0.20690  

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)             7.70566         NA      NA       NA
Educ2                   2.93231         NA      NA       NA
Educ3                   9.84106         NA      NA       NA
Educ4                  11.98330         NA      NA       NA
Occ2                   -5.32506         NA      NA       NA
Occ3                  -11.88093         NA      NA       NA
Occ4                  -13.38551         NA      NA       NA
Occ5                  -18.15374         NA      NA       NA
Educ1:Cscore            2.30655         NA      NA       NA
Educ2:Cscore            1.65824         NA      NA       NA
Educ3:Cscore            0.57607         NA      NA       NA
Educ4:Cscore            0.00000         NA      NA       NA
Occ1:Rscore            -3.93278         NA      NA       NA
Occ2:Rscore            -2.23708         NA      NA       NA
Occ3:Rscore            -1.05781         NA      NA       NA
Occ4:Rscore             0.00000         NA      NA       NA
Occ5:Rscore             0.00000         NA      NA       NA
Mult(., Educ, Occ).     0.30868         NA      NA       NA
Mult(1, ., Occ).Educ1   0.24164         NA      NA       NA
Mult(1, ., Occ).Educ2  -0.05431         NA      NA       NA
Mult(1, ., Occ).Educ3  -0.29807         NA      NA       NA
Mult(1, ., Occ).Educ4   0.43140         NA      NA       NA
Mult(1, Educ, .).Occ1   2.28861         NA      NA       NA
Mult(1, Educ, .).Occ2  -2.69886         NA      NA       NA
Mult(1, Educ, .).Occ3   0.26160         NA      NA       NA
Mult(1, Educ, .).Occ4   0.21052         NA      NA       NA
Mult(1, Educ, .).Occ5   7.13039         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 0.27843 on 2 degrees of freedom
AIC: 152.66

Number of iterations: 14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCplusRC.un, <span class="st">"[:]Cscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Educ1:Cscore Educ2:Cscore Educ3:Cscore Educ4:Cscore 
           9           10           11           12 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCplusRC.un, <span class="st">"[:]Rscore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Occ1:Rscore Occ2:Rscore Occ3:Rscore Occ4:Rscore Occ5:Rscore 
         13          14          15          16          17 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb358-6"><a href="#cb358-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">17</span>), </span>
<span id="cb358-7"><a href="#cb358-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb358-8"><a href="#cb358-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb358-9"><a href="#cb358-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb358-10"><a href="#cb358-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations............................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(CplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> CplusRC<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span> </span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb360-5"><a href="#cb360-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        var     estimate number
(Intercept)                     (Intercept)  6.132951036      1
Educ2                                 Educ2 -1.598655285      2
Educ3                                 Educ3 -0.119602932      3
Educ4                                 Educ4 -1.631176445      4
Occ2                                   Occ2 -3.281987830      5
Occ3                                   Occ3 -5.745938986      6
Occ4                                   Occ4 -3.812315688      7
Occ5                                   Occ5 -3.773472310      8
Occ1:Rscore                     Occ1:Rscore           NA      9
Occ2:Rscore                     Occ2:Rscore  1.262590058     10
Occ3:Rscore                     Occ3:Rscore  1.282319390     11
Occ4:Rscore                     Occ4:Rscore  1.415828283     12
Occ5:Rscore                     Occ5:Rscore           NA     13
Mult(., Educ, Occ).     Mult(., Educ, Occ).  2.509132039     14
Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ1           NA     15
Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ2 -0.250882838     16
Mult(1, ., Occ).Educ3 Mult(1, ., Occ).Educ3 -0.280733721     17
Mult(1, ., Occ).Educ4 Mult(1, ., Occ).Educ4           NA     18
Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ1           NA     19
Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ2 -0.558888360     20
Mult(1, Educ, .).Occ3 Mult(1, Educ, .).Occ3 -0.126520705     21
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ4 -0.009237675     22
Mult(1, Educ, .).Occ5 Mult(1, Educ, .).Occ5           NA     23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusCplusRC, </span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusCplusRC, <span class="st">"[.]Educ"</span>), </span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusCplusRC,</span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusCplusRC, <span class="st">"[.]Occ"</span>), </span>
<span id="cb362-8"><a href="#cb362-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb362-9"><a href="#cb362-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb362-10"><a href="#cb362-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb362-11"><a href="#cb362-11" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb362-12"><a href="#cb362-12" aria-hidden="true" tabindex="-1"></a>         mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],</span>
<span id="cb362-13"><a href="#cb362-13" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb362-14"><a href="#cb362-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-15"><a href="#cb362-15" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb362-16"><a href="#cb362-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb362-17"><a href="#cb362-17" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb362-18"><a href="#cb362-18" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb362-19"><a href="#cb362-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb362-20"><a href="#cb362-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">19</span>,<span class="dv">22</span>,<span class="dv">23</span>,<span class="dv">27</span>), </span>
<span id="cb362-21"><a href="#cb362-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb362-22"><a href="#cb362-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb362-23"><a href="#cb362-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb362-24"><a href="#cb362-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations......................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a>mu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Estimate Std. Error
Mult(1, ., Occ).Educ1 -0.76639941 0.03714637
Mult(1, ., Occ).Educ2 -0.05505913 0.08952794
Mult(1, ., Occ).Educ3  0.60073372 0.04744381
Mult(1, ., Occ).Educ4  0.22072481 0.06764890</code></pre>
</div>
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>nu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Estimate Std. Error
Mult(1, Educ, .).Occ1  0.83832072 0.02535129
Mult(1, Educ, .).Occ2 -0.04397713 0.08855421
Mult(1, Educ, .).Occ3 -0.11946443 0.09158773
Mult(1, Educ, .).Occ4 -0.50065982 0.06550415
Mult(1, Educ, .).Occ5 -0.17421935 0.12622465</code></pre>
</div>
<div class="sourceCode cell-code" id="cb368"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCplusRC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb368-4"><a href="#cb368-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Variable    Estimate Std..Error    z.value     Pr...z..
1           Educ1:Cscore  0.00000000         NA         NA           NA
2           Educ2:Cscore -0.29016794  0.1835938 -1.5804884 1.139951e-01
3           Educ3:Cscore -0.95452353  0.2168230 -4.4023158 1.071015e-05
4           Educ4:Cscore  0.00000000         NA         NA           NA
5            Occ1:Rscore  0.00000000         NA         NA           NA
6            Occ2:Rscore  0.00000000         NA         NA           NA
7            Occ3:Rscore  0.39725281  0.1673266  2.3741161 1.759102e-02
8            Occ4:Rscore  0.32684292  0.1614939  2.0238715 4.298337e-02
9            Occ5:Rscore  0.00000000         NA         NA           NA
10   Mult(., Educ, Occ). -2.85715993  0.5343817 -5.3466654 8.958940e-08
11 Mult(1, ., Occ).Educ1 -0.76639941         NA         NA           NA
12 Mult(1, ., Occ).Educ2 -0.05505913  0.1291228 -0.4264091 6.698098e-01
13 Mult(1, ., Occ).Educ3  0.60073372  0.1297703  4.6292078 3.670672e-06
14 Mult(1, ., Occ).Educ4  0.22072481         NA         NA           NA
15 Mult(1, Educ, .).Occ1  0.83832072         NA         NA           NA
16 Mult(1, Educ, .).Occ2 -0.04397713  0.1677272 -0.2621944 7.931715e-01
17 Mult(1, Educ, .).Occ3 -0.11946443  0.1842187 -0.6484923 5.166666e-01
18 Mult(1, Educ, .).Occ4 -0.50065982  0.2149854 -2.3288081 1.986923e-02
19 Mult(1, Educ, .).Occ5 -0.17421935         NA         NA           NA</code></pre>
</div>
</div>
</section>
<section id="表2.7e" class="level2" data-number="2.27">
<h2 data-number="2.27" class="anchored" data-anchor-id="表2.7e"><span class="header-section-number">2.27</span> 表2.7E</h2>
<p>Wongのサポートページにあるように，<code>gnm</code>を用いてRC(2)の係数を推定することは難しい．ここではKateri, Maria. 2014. {}. New York: Birkhäuser. のsupportページにあるプログラムを使用して係数を求める．</p>
<p><span class="math inline">\(M &gt; 1\)</span>のRC(M)を推定するためには<code>gnm</code>の<code>instances</code>を用いる． 今は<code>instances = 2</code>としており，RC(2)を用いている． なお，式(2.35)のように<span class="math inline">\(\phi\)</span>は推定されない． これらスコアは求まるものの，直交という次元間制約が課されてない． そこで，特異値分解（SVD: singular value decomposition）によって行スコアと列スコアのそれぞれが次元間で直行するような変換を行う．</p>
<p>まず次元間制約が課されてない行スコアの行列（<span class="math inline">\(I\times m\)</span>）と列スコアの行列（<span class="math inline">\(J\times m\)</span>）の積を求め，モデル化での2元交互作用パラメータを求める．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">instances</span>(<span class="fu">Mult</span>(Educ, Occ), <span class="at">instances =</span> <span class="dv">2</span>),</span>
<span id="cb370-4"><a href="#cb370-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, <span class="at">data =</span> _, </span>
<span id="cb370-5"><a href="#cb370-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.......................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + instances(Mult(Educ, Occ), 
    instances = 2), family = poisson, data = freq_tab_2.3B, tolerance = 1e-12)

Deviance Residuals: 
      Min         1Q     Median         3Q        Max  
-0.631356  -0.030234  -0.004363   0.050323   0.320666  

Coefficients:
                             Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                   4.98690         NA      NA       NA
Educ2                        -0.82270         NA      NA       NA
Educ3                         1.48754         NA      NA       NA
Educ4                        -0.08253         NA      NA       NA
Occ2                          0.02911         NA      NA       NA
Occ3                         -2.10701         NA      NA       NA
Occ4                          0.26228         NA      NA       NA
Occ5                         -3.17251         NA      NA       NA
Mult(., Occ, inst = 1).Educ1 -6.48058         NA      NA       NA
Mult(., Occ, inst = 1).Educ2 -1.57685         NA      NA       NA
Mult(., Occ, inst = 1).Educ3  0.59452         NA      NA       NA
Mult(., Occ, inst = 1).Educ4  3.79509         NA      NA       NA
Mult(Educ, ., inst = 1).Occ1 -0.22164         NA      NA       NA
Mult(Educ, ., inst = 1).Occ2  0.11057         NA      NA       NA
Mult(Educ, ., inst = 1).Occ3  0.15266         NA      NA       NA
Mult(Educ, ., inst = 1).Occ4  0.21204         NA      NA       NA
Mult(Educ, ., inst = 1).Occ5 -0.15669         NA      NA       NA
Mult(., Occ, inst = 2).Educ1 -0.39694         NA      NA       NA
Mult(., Occ, inst = 2).Educ2 -0.26127         NA      NA       NA
Mult(., Occ, inst = 2).Educ3 -0.52436         NA      NA       NA
Mult(., Occ, inst = 2).Educ4  0.45321         NA      NA       NA
Mult(Educ, ., inst = 2).Occ1  0.43735         NA      NA       NA
Mult(Educ, ., inst = 2).Occ2 -0.65193         NA      NA       NA
Mult(Educ, ., inst = 2).Occ3  0.49859         NA      NA       NA
Mult(Educ, ., inst = 2).Occ4  0.79497         NA      NA       NA
Mult(Educ, ., inst = 2).Occ5  2.99034         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 0.6001 on 2 degrees of freedom
AIC: 152.98

Number of iterations: 23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a>RCmodel_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(RCmodel, row, col, m, data){</span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a>  NI <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>xlevels[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">length</span>()</span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>  NJ <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>xlevels[[<span class="dv">2</span>]] <span class="sc">|&gt;</span> <span class="fu">length</span>()</span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a>  iflag <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb374-5"><a href="#cb374-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">length</span>(RCmodel<span class="sc">$</span>y)</span>
<span id="cb374-6"><a href="#cb374-6" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">gl</span>(NI,NJ,<span class="at">length =</span> y)</span>
<span id="cb374-7"><a href="#cb374-7" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">gl</span>(NJ,<span class="dv">1</span>,<span class="at">length =</span> y)</span>
<span id="cb374-8"><a href="#cb374-8" aria-hidden="true" tabindex="-1"></a>  IX <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(RCmodel, </span>
<span id="cb374-9"><a href="#cb374-9" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">"[.]"</span>,<span class="fu">deparse</span>(<span class="fu">substitute</span>(row))))</span>
<span id="cb374-10"><a href="#cb374-10" aria-hidden="true" tabindex="-1"></a>  IY <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(RCmodel,</span>
<span id="cb374-11"><a href="#cb374-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">"[.]"</span>,<span class="fu">deparse</span>(<span class="fu">substitute</span>(col))))</span>
<span id="cb374-12"><a href="#cb374-12" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>coefficients[IX]</span>
<span id="cb374-13"><a href="#cb374-13" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>coefficients[IY]</span>
<span id="cb374-14"><a href="#cb374-14" aria-hidden="true" tabindex="-1"></a>  mu0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(X,<span class="at">nrow =</span> NI,<span class="at">ncol =</span> m)</span>
<span id="cb374-15"><a href="#cb374-15" aria-hidden="true" tabindex="-1"></a>  nu0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Y,<span class="at">nrow =</span> NJ,<span class="at">ncol =</span> m)</span>
<span id="cb374-16"><a href="#cb374-16" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> mu0</span>
<span id="cb374-17"><a href="#cb374-17" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> nu0</span>
<span id="cb374-18"><a href="#cb374-18" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> mu <span class="sc">%*%</span> <span class="fu">t</span>(nu) <span class="co"># [NI, M] [M. NJ]</span></span>
<span id="cb374-19"><a href="#cb374-19" aria-hidden="true" tabindex="-1"></a>  R1 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>,NI)</span>
<span id="cb374-20"><a href="#cb374-20" aria-hidden="true" tabindex="-1"></a>  C1 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>,NJ)</span>
<span id="cb374-21"><a href="#cb374-21" aria-hidden="true" tabindex="-1"></a>  Rone <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NI<span class="sc">^</span><span class="dv">2</span>),<span class="at">nrow =</span> NI)</span>
<span id="cb374-22"><a href="#cb374-22" aria-hidden="true" tabindex="-1"></a>  Cone <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NJ<span class="sc">^</span><span class="dv">2</span>),<span class="at">nrow =</span> NJ)</span>
<span id="cb374-23"><a href="#cb374-23" aria-hidden="true" tabindex="-1"></a>  rowP <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NI))</span>
<span id="cb374-24"><a href="#cb374-24" aria-hidden="true" tabindex="-1"></a>  colP <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NJ));</span>
<span id="cb374-25"><a href="#cb374-25" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> RC2<span class="sc">$</span>model</span>
<span id="cb374-26"><a href="#cb374-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(y,X,Y,IX,IY,data)</span>
<span id="cb374-27"><a href="#cb374-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (iflag <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb374-28"><a href="#cb374-28" aria-hidden="true" tabindex="-1"></a>    rowP <span class="ot">&lt;-</span> <span class="fu">with</span>(data, <span class="fu">tapply</span>(freq,row,sum)<span class="sc">/</span><span class="fu">sum</span>(freq))</span>
<span id="cb374-29"><a href="#cb374-29" aria-hidden="true" tabindex="-1"></a>    colP <span class="ot">&lt;-</span> <span class="fu">with</span>(data, <span class="fu">tapply</span>(freq,col,sum)<span class="sc">/</span><span class="fu">sum</span>(freq))}</span>
<span id="cb374-30"><a href="#cb374-30" aria-hidden="true" tabindex="-1"></a>  DR <span class="ot">&lt;-</span> <span class="fu">diag</span>(rowP<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NI)</span>
<span id="cb374-31"><a href="#cb374-31" aria-hidden="true" tabindex="-1"></a>  DC <span class="ot">&lt;-</span> <span class="fu">diag</span>(colP<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NJ)</span>
<span id="cb374-32"><a href="#cb374-32" aria-hidden="true" tabindex="-1"></a>  RWsqr <span class="ot">&lt;-</span> <span class="fu">diag</span>(rowP<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NI)</span>
<span id="cb374-33"><a href="#cb374-33" aria-hidden="true" tabindex="-1"></a>  CWsqr <span class="ot">&lt;-</span> <span class="fu">diag</span>(colP<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NJ)</span>
<span id="cb374-34"><a href="#cb374-34" aria-hidden="true" tabindex="-1"></a>  RW <span class="ot">&lt;-</span> RWsqr<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb374-35"><a href="#cb374-35" aria-hidden="true" tabindex="-1"></a>  CW <span class="ot">&lt;-</span> CWsqr<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb374-36"><a href="#cb374-36" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> (R1 <span class="sc">-</span> (Rone <span class="sc">%*%</span> RW)<span class="sc">/</span><span class="fu">sum</span>(RW)) <span class="sc">%*%</span> A <span class="sc">%*%</span> <span class="fu">t</span>(C1 <span class="sc">-</span> (Cone <span class="sc">%*%</span> CW)<span class="sc">/</span><span class="fu">sum</span>(CW))</span>
<span id="cb374-37"><a href="#cb374-37" aria-hidden="true" tabindex="-1"></a>  phiv <span class="ot">&lt;-</span> <span class="fu">svd</span>(RWsqr <span class="sc">%*%</span> L <span class="sc">%*%</span> CWsqr)<span class="sc">$</span>d[<span class="dv">1</span><span class="sc">:</span>m]</span>
<span id="cb374-38"><a href="#cb374-38" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">svd</span>(RWsqr <span class="sc">%*%</span> L <span class="sc">%*%</span> CWsqr)<span class="sc">$</span>u[,<span class="dv">1</span><span class="sc">:</span>m]</span>
<span id="cb374-39"><a href="#cb374-39" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> <span class="fu">svd</span>(RWsqr <span class="sc">%*%</span> L <span class="sc">%*%</span> CWsqr)<span class="sc">$</span>v[,<span class="dv">1</span><span class="sc">:</span>m]</span>
<span id="cb374-40"><a href="#cb374-40" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> DR <span class="sc">%*%</span> mu</span>
<span id="cb374-41"><a href="#cb374-41" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> DC <span class="sc">%*%</span> nu</span>
<span id="cb374-42"><a href="#cb374-42" aria-hidden="true" tabindex="-1"></a>  phi <span class="ot">&lt;-</span> <span class="fu">diag</span>(phiv, m)</span>
<span id="cb374-43"><a href="#cb374-43" aria-hidden="true" tabindex="-1"></a>  L2 <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>deviance</span>
<span id="cb374-44"><a href="#cb374-44" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>df.residual</span>
<span id="cb374-45"><a href="#cb374-45" aria-hidden="true" tabindex="-1"></a>  p.value <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(L2,df)</span>
<span id="cb374-46"><a href="#cb374-46" aria-hidden="true" tabindex="-1"></a>  fit.freq <span class="ot">&lt;-</span> <span class="fu">predict</span>(RCmodel, </span>
<span id="cb374-47"><a href="#cb374-47" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="st">"response"</span>, </span>
<span id="cb374-48"><a href="#cb374-48" aria-hidden="true" tabindex="-1"></a>                      <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb374-49"><a href="#cb374-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb374-50"><a href="#cb374-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">list</span>(<span class="at">model =</span> RCmodel, </span>
<span id="cb374-51"><a href="#cb374-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">L2 =</span> L2, </span>
<span id="cb374-52"><a href="#cb374-52" aria-hidden="true" tabindex="-1"></a>     <span class="at">df =</span> df,</span>
<span id="cb374-53"><a href="#cb374-53" aria-hidden="true" tabindex="-1"></a>     <span class="at">p.value =</span> p.value,</span>
<span id="cb374-54"><a href="#cb374-54" aria-hidden="true" tabindex="-1"></a>     <span class="at">obs_freq =</span> <span class="fu">summary</span>(RC2)<span class="sc">$</span>y, </span>
<span id="cb374-55"><a href="#cb374-55" aria-hidden="true" tabindex="-1"></a>     <span class="at">fit.freq =</span> fit.freq,</span>
<span id="cb374-56"><a href="#cb374-56" aria-hidden="true" tabindex="-1"></a>     <span class="at">phi =</span> phi, </span>
<span id="cb374-57"><a href="#cb374-57" aria-hidden="true" tabindex="-1"></a>     <span class="at">mu =</span> mu, </span>
<span id="cb374-58"><a href="#cb374-58" aria-hidden="true" tabindex="-1"></a>     <span class="at">nu =</span> nu,</span>
<span id="cb374-59"><a href="#cb374-59" aria-hidden="true" tabindex="-1"></a>     <span class="fu">cor</span>(mu) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">3</span>),</span>
<span id="cb374-60"><a href="#cb374-60" aria-hidden="true" tabindex="-1"></a>     <span class="fu">cor</span>(nu) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">3</span>)))</span>
<span id="cb374-61"><a href="#cb374-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb374-62"><a href="#cb374-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-63"><a href="#cb374-63" aria-hidden="true" tabindex="-1"></a><span class="fu">RCmodel_coef</span>(RC2, <span class="at">row =</span> Educ, <span class="at">col =</span> Occ, <span class="at">m =</span>  <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$model

Call:
gnm(formula = Freq ~ Educ + Occ + instances(Mult(Educ, Occ), 
    instances = 2), family = poisson, data = freq_tab_2.3B, tolerance = 1e-12)

Coefficients:
                 (Intercept)                         Educ2  
                     4.98690                      -0.82270  
                       Educ3                         Educ4  
                     1.48754                      -0.08253  
                        Occ2                          Occ3  
                     0.02911                      -2.10701  
                        Occ4                          Occ5  
                     0.26228                      -3.17251  
Mult(., Occ, inst = 1).Educ1  Mult(., Occ, inst = 1).Educ2  
                    -6.48058                      -1.57685  
Mult(., Occ, inst = 1).Educ3  Mult(., Occ, inst = 1).Educ4  
                     0.59452                       3.79509  
Mult(Educ, ., inst = 1).Occ1  Mult(Educ, ., inst = 1).Occ2  
                    -0.22164                       0.11057  
Mult(Educ, ., inst = 1).Occ3  Mult(Educ, ., inst = 1).Occ4  
                     0.15266                       0.21204  
Mult(Educ, ., inst = 1).Occ5  Mult(., Occ, inst = 2).Educ1  
                    -0.15669                      -0.39694  
Mult(., Occ, inst = 2).Educ2  Mult(., Occ, inst = 2).Educ3  
                    -0.26127                      -0.52436  
Mult(., Occ, inst = 2).Educ4  Mult(Educ, ., inst = 2).Occ1  
                     0.45321                       0.43735  
Mult(Educ, ., inst = 2).Occ2  Mult(Educ, ., inst = 2).Occ3  
                    -0.65193                       0.49859  
Mult(Educ, ., inst = 2).Occ4  Mult(Educ, ., inst = 2).Occ5  
                     0.79497                       2.99034  

Deviance:            0.6001022 
Pearson chi-squared: 0.5746549 
Residual df:         2 

$L2
[1] 0.6001022

$df
[1] 2

$p.value
[1] 0.7407804

$obs_freq
NULL

$fit.freq
$fit.freq$fit
          1           2           3           4           5           6 
 517.836063   95.414391    5.433736   35.145848    5.169961   81.405000 
          7           8           9          10          11          12 
  65.976261    5.398934   48.639687    1.580117  451.846566 1003.387842 
         13          14          15          16          17          18 
  66.470016  630.136504    5.159072   70.912370  157.221505   36.697314 
         19          20 
 562.077961   12.090850 

$fit.freq$se.fit
        1         2         3         4         5         6         7         8 
22.748933  9.732333  2.174395  5.860792  2.230227  8.912865  7.856714  1.044826 
        9        10        11        12        13        14        15        16 
 6.616317  0.619348 21.250045 31.666672  8.114913 25.088611  2.233235  8.415482 
       17        18        19        20 
12.530867  6.041164 23.703381  3.469126 

$fit.freq$residual.scale
[1] 1


$phi
         [,1]     [,2]
[1,] 2.600861 0.000000
[2,] 0.000000 1.521971

$mu
            [,1]        [,2]
[1,]  0.74345129  0.27619989
[2,]  0.08846472 -0.06103682
[3,] -0.19984223 -0.77722344
[4,] -0.63207378  0.56206037

$nu
            [,1]         [,2]
[1,]  0.76509960 -0.137064850
[2,]  0.01966104 -0.548959995
[3,] -0.32245067 -0.119769392
[4,] -0.55005650 -0.009934123
[5,]  0.08774653  0.815728360

[[10]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

[[11]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1</code></pre>
</div>
</div>
<p><code>logmult</code>パッケージの<code>rc</code>によってRC(2)を推定する．まずは<code>anoas</code>で連関分析を行う．表2.6Aと同じ結果になっていることを確認する．正規化だけではなく，次元間制約が課されており，表2.7の結果と一致する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anoas</span>(tab_2<span class="fl">.3</span>B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting independence model...
Fitting model with 1 dimension...
Initialising
Running start-up iterations..
Running main iterations.........................................................
........
Done
Fitting model with 2 dimensions...
Initialising
Running start-up iterations..
Running main iterations.........
Done
Fitting model with 3 dimensions...
Initialising
Running start-up iterations..
Running main iterations...
Done</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       Res. Df            Res. Dev     Dev./Indep. (%)   Dissim. (%)
Indep.      12 1373.17576565224545 100.000000000000000 23.8615752953
RC(1)        6  125.05974855014664   9.107337289101110  6.4360390988
RC(2)        2    0.60010223526822   0.043701778772885  0.0935165803
RC(3)        0    0.00000000000009   0.000000000000006  0.0000000007
                       BIC                 AIC    Dev. Df
Indep. 1274.08091533065726 1349.17576565224545      NA NA
RC(1)    75.51232338935259  113.05974855014664 -1248.1 -6
RC(2)   -15.91570615166313   -3.39989776473178  -124.5 -4
RC(3)     0.00000000000009    0.00000000000009    -0.6 -2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab_2<span class="fl">.3</span>B, </span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">nd =</span> <span class="dv">2</span>, </span>
<span id="cb379-3"><a href="#cb379-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weighting =</span> <span class="st">"none"</span>, </span>
<span id="cb379-4"><a href="#cb379-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">se =</span> <span class="st">"bootstrap"</span>,</span>
<span id="cb379-5"><a href="#cb379-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">nreplicates =</span> <span class="dv">1000</span>, </span>
<span id="cb379-6"><a href="#cb379-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncpus =</span> <span class="fu">getOption</span>(<span class="st">"boot.ncpus"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.......
Done
Computing bootstrap standard errors...
.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in jackboot(se, ncpus, nreplicates, tab, model, assoc1 =
getS3method("assoc", : One model replicate failed and its results will be
skipped. Standard errors will not be completely accurate. Consider raising the
value of iterMax.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb382"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab_2.3B, nd = 2, weighting = "none", se = "bootstrap", 
    nreplicates = 1000, ncpus = getOption("boot.ncpus"))

Deviance Residuals:
    Columns
Rows         A         B         C         D         E
   A   0.00720  -0.04245   0.23888  -0.02462  -0.07516
   B  -0.04493   0.12571  -0.63136   0.05160   0.32067
   C   0.00722  -0.01224   0.06492  -0.00544  -0.07040
   D   0.01040  -0.01767   0.04990  -0.00329  -0.02616

Association coefficients:
               Normalized    Adjusted  Std. error   Pr(&gt;|z|)     
Dim1            2.6008615          NA      0.1873  &lt; 2.2e-16  ***
Dim2            1.5219709          NA      0.5272   0.003890  ** 
Dim1:RowsA      0.7434513   1.1989778      0.0188  &lt; 2.2e-16  ***
Dim1:RowsB      0.0884647   0.1426687      0.0410   0.031124  *  
Dim1:RowsC     -0.1998422  -0.3222893      0.0226  &lt; 2.2e-16  ***
Dim1:RowsD     -0.6320738  -1.0193572      0.0185  &lt; 2.2e-16  ***
Dim2:RowsA      0.2761999   0.3407428      0.0903   0.002220  ** 
Dim2:RowsB     -0.0610368  -0.0753000      0.1571   0.697718     
Dim2:RowsC     -0.7772234  -0.9588465      0.0637  &lt; 2.2e-16  ***
Dim2:RowsD      0.5620604   0.6934037      0.0696  6.804e-16  ***
Dim1:ColumnsA   0.7650996   1.2338904      0.0399  &lt; 2.2e-16  ***
Dim1:ColumnsB   0.0196610   0.0317077      0.0404   0.626275     
Dim1:ColumnsC  -0.3224507  -0.5200222      0.0991   0.001142  ** 
Dim1:ColumnsD  -0.5500565  -0.8870864      0.0688  1.277e-15  ***
Dim1:ColumnsE   0.0877465   0.1415105      0.0992   0.376475     
Dim2:ColumnsA  -0.1370648  -0.1690944      0.0473   0.003746  ** 
Dim2:ColumnsB  -0.5489600  -0.6772420      0.0805  9.003e-12  ***
Dim2:ColumnsC  -0.1197694  -0.1477573      0.0935   0.200113     
Dim2:ColumnsD  -0.0099341  -0.0122555      0.0708   0.888363     
Dim2:ColumnsE   0.8157284   1.0063493      0.0557  &lt; 2.2e-16  ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Normalization weights: none
Deviance:              0.6001022
Pearson chi-squared:   0.5746549
Dissimilarity index:   0.09351658%
Residual df:           2
BIC:                   -15.91571
AIC:                   -3.399898</code></pre>
</div>
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="sc">|&gt;</span> </span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(coefficients) <span class="sc">|&gt;</span></span>
<span id="cb384-4"><a href="#cb384-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb384-5"><a href="#cb384-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"Parameter"</span>) <span class="sc">|&gt;</span></span>
<span id="cb384-6"><a href="#cb384-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Parameter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Parameter   Normalized    Adjusted Std..error      Pr...z..
1           Dim1  2.600861491          NA 0.18733724  7.996127e-44
2  Dim1:ColumnsA  0.765099599  1.23389040 0.03987968  4.920472e-82
3  Dim1:ColumnsB  0.019661041  0.03170773 0.04037365  6.262746e-01
4  Dim1:ColumnsC -0.322450671 -0.52002222 0.09912245  1.141718e-03
5  Dim1:ColumnsD -0.550056503 -0.88708639 0.06878444  1.276783e-15
6  Dim1:ColumnsE  0.087746534  0.14151047 0.09921477  3.764749e-01
7     Dim1:RowsA  0.743451285  1.19897776 0.01883771  0.000000e+00
8     Dim1:RowsB  0.088464723  0.14266871 0.04104172  3.112406e-02
9     Dim1:RowsC -0.199842229 -0.32228929 0.02258981  9.025530e-19
10    Dim1:RowsD -0.632073780 -1.01935718 0.01851006 1.452479e-255
11          Dim2  1.521970932          NA 0.52719756  3.890478e-03
12 Dim2:ColumnsA -0.137064849 -0.16909442 0.04728359  3.746148e-03
13 Dim2:ColumnsB -0.548959996 -0.67724199 0.08047383  9.003428e-12
14 Dim2:ColumnsC -0.119769391 -0.14775733 0.09347999  2.001128e-01
15 Dim2:ColumnsD -0.009934123 -0.01225555 0.07076807  8.883631e-01
16 Dim2:ColumnsE  0.815728359  1.00634928 0.05570139  1.457086e-48
17    Dim2:RowsA  0.276199888  0.34074279 0.09028681  2.219741e-03
18    Dim2:RowsB -0.061036818 -0.07530002 0.15714808  6.977177e-01
19    Dim2:RowsC -0.777223438 -0.95884646 0.06373209  3.298285e-34
20    Dim2:RowsD  0.562060367  0.69340368 0.06961379  6.804270e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># getS3method("assoc","rc")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./2-Chapter_1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">第1章</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./4-Chapter_3.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">第3章</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb387" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># 第2章</span></span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a>第2章では2元表の連関モデルが紹介されている．制約のかけかたは少し複雑なのでプログラムとテキストをみながら手順を確認して欲しい．</span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-6"><a href="#cb387-6" aria-hidden="true" tabindex="-1"></a>パッケージは<span class="in">`tidyverse`</span>（データセットの処理のため），<span class="in">`DescTools`</span>（記述統計を求めるため），<span class="in">`vcd`</span>パッケージ（カテゴリカルデータの分析のため），<span class="in">`broom`</span>（回帰係数の整理），<span class="in">`gnm`</span>（連関分析の処理のため），<span class="in">`logmult`</span>（連関モデルのため）を使用する．</span>
<span id="cb387-7"><a href="#cb387-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-8"><a href="#cb387-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-9"><a href="#cb387-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb387-10"><a href="#cb387-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb387-11"><a href="#cb387-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb387-12"><a href="#cb387-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb387-13"><a href="#cb387-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb387-14"><a href="#cb387-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb387-15"><a href="#cb387-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span>
<span id="cb387-16"><a href="#cb387-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb387-17"><a href="#cb387-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-18"><a href="#cb387-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-19"><a href="#cb387-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-20"><a href="#cb387-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## 対比について</span></span>
<span id="cb387-21"><a href="#cb387-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-22"><a href="#cb387-22" aria-hidden="true" tabindex="-1"></a>回帰モデルにおけるカテゴリカル変数の係数を解釈する上では対比</span>
<span id="cb387-23"><a href="#cb387-23" aria-hidden="true" tabindex="-1"></a>（contrasts）が重要である．まず，デフォルトでの<span class="in">`contrasts`</span>を確認したい．<span class="in">`factor`</span>変数については<span class="in">`contr.treatment`</span>，<span class="in">`ordered`</span>変数については<span class="in">`contr.poly`</span>という対比が用いられている．<span class="in">`contr.treatment`</span>は基準となっている水準とそれぞれの水準を対比する．これはダミーコーディングと呼ばれる．</span>
<span id="cb387-24"><a href="#cb387-24" aria-hidden="true" tabindex="-1"></a><span class="in">`contr.poly`</span>は直交多項式（orthogonal polynomials）に基づいた対比を行う（気にしなくてよい）．</span>
<span id="cb387-25"><a href="#cb387-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-28"><a href="#cb387-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-29"><a href="#cb387-29" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトのcontrastsを確認</span></span>
<span id="cb387-30"><a href="#cb387-30" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span>
<span id="cb387-31"><a href="#cb387-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-32"><a href="#cb387-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-35"><a href="#cb387-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-36"><a href="#cb387-36" aria-hidden="true" tabindex="-1"></a><span class="co"># defaultのcontrastsの設定（ここでは特に意味はない．constrastをいじった後にデフォルトに戻す）</span></span>
<span id="cb387-37"><a href="#cb387-37" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, </span>
<span id="cb387-38"><a href="#cb387-38" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb387-39"><a href="#cb387-39" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-40"><a href="#cb387-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-41"><a href="#cb387-41" aria-hidden="true" tabindex="-1"></a>具体的に何をしているのかを以下のプログラムで確認する．</span>
<span id="cb387-42"><a href="#cb387-42" aria-hidden="true" tabindex="-1"></a>ダミーコーディングの<span class="in">`contr.treatment`</span>以外にも効果コーディングの<span class="in">`contr.sum`</span>がある．両者を比較してみたい．</span>
<span id="cb387-43"><a href="#cb387-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-46"><a href="#cb387-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-47"><a href="#cb387-47" aria-hidden="true" tabindex="-1"></a><span class="co"># データの作成</span></span>
<span id="cb387-48"><a href="#cb387-48" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"E"</span>)</span>
<span id="cb387-49"><a href="#cb387-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認</span></span>
<span id="cb387-50"><a href="#cb387-50" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb387-51"><a href="#cb387-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 基準カテゴリが0となるような対比</span></span>
<span id="cb387-52"><a href="#cb387-52" aria-hidden="true" tabindex="-1"></a><span class="fu">contr.treatment</span>(x)</span>
<span id="cb387-53"><a href="#cb387-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 合計が0となるような対比</span></span>
<span id="cb387-54"><a href="#cb387-54" aria-hidden="true" tabindex="-1"></a><span class="fu">contr.sum</span>(x)</span>
<span id="cb387-55"><a href="#cb387-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-56"><a href="#cb387-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-57"><a href="#cb387-57" aria-hidden="true" tabindex="-1"></a>実際に回帰分析を例に<span class="in">`contr.treatment`</span>と<span class="in">`contr.sum`</span>の違いを確認する．データは<span class="in">`mpg`</span>（Fuel economy data from 1999 to 2008 for 38 popular models of cars）である．従属変数は<span class="in">`hwy`</span>（highway miles per gallon）であり，独立変数は<span class="in">`class`</span>（"type" of car）とする．</span>
<span id="cb387-58"><a href="#cb387-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-61"><a href="#cb387-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-62"><a href="#cb387-62" aria-hidden="true" tabindex="-1"></a><span class="co"># class別のhwyの平均値</span></span>
<span id="cb387-63"><a href="#cb387-63" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> </span>
<span id="cb387-64"><a href="#cb387-64" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(hwy)),</span>
<span id="cb387-65"><a href="#cb387-65" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Mean =</span> <span class="fu">mean</span>(hwy, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb387-66"><a href="#cb387-66" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.by =</span> class) <span class="sc">|&gt;</span> </span>
<span id="cb387-67"><a href="#cb387-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Diff_1 =</span> Mean <span class="sc">-</span> Mean[class <span class="sc">==</span> <span class="st">"2seater"</span>],</span>
<span id="cb387-68"><a href="#cb387-68" aria-hidden="true" tabindex="-1"></a>         <span class="at">Diff_2 =</span> Mean <span class="sc">-</span> <span class="fu">mean</span>(Mean))</span>
<span id="cb387-69"><a href="#cb387-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-70"><a href="#cb387-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-71"><a href="#cb387-71" aria-hidden="true" tabindex="-1"></a>まずダミーコーディング（dummy coding）の結果を確認する．</span>
<span id="cb387-72"><a href="#cb387-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-75"><a href="#cb387-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-76"><a href="#cb387-76" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の例（contr.treatmentを使用）</span></span>
<span id="cb387-77"><a href="#cb387-77" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, </span>
<span id="cb387-78"><a href="#cb387-78" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb387-79"><a href="#cb387-79" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析</span></span>
<span id="cb387-80"><a href="#cb387-80" aria-hidden="true" tabindex="-1"></a>fit_ct <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg)</span>
<span id="cb387-81"><a href="#cb387-81" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の結果</span></span>
<span id="cb387-82"><a href="#cb387-82" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_ct)</span>
<span id="cb387-83"><a href="#cb387-83" aria-hidden="true" tabindex="-1"></a><span class="co"># モデルマトリックス</span></span>
<span id="cb387-84"><a href="#cb387-84" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(fit_ct) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb387-85"><a href="#cb387-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-86"><a href="#cb387-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-87"><a href="#cb387-87" aria-hidden="true" tabindex="-1"></a>出力される係数は6つである．<span class="in">`class`</span>は<span class="in">`factor`</span>によって水準が設定されているわけではないので，<span class="in">`2seater`</span>が基準カテゴリとなっており，出力からは省略されている．つまり，<span class="in">`2seater`</span>の係数は0であり，<span class="in">`(Intercept) `</span>の値は<span class="in">`2seater`</span>の平均値を示している．</span>
<span id="cb387-88"><a href="#cb387-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-89"><a href="#cb387-89" aria-hidden="true" tabindex="-1"></a>次に効果コーディングの結果を確認する．</span>
<span id="cb387-90"><a href="#cb387-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-93"><a href="#cb387-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-94"><a href="#cb387-94" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の例（contr.sumを使用）</span></span>
<span id="cb387-95"><a href="#cb387-95" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.sum"</span>, </span>
<span id="cb387-96"><a href="#cb387-96" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb387-97"><a href="#cb387-97" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析</span></span>
<span id="cb387-98"><a href="#cb387-98" aria-hidden="true" tabindex="-1"></a>fit_cs <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg)</span>
<span id="cb387-99"><a href="#cb387-99" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の結果</span></span>
<span id="cb387-100"><a href="#cb387-100" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cs)</span>
<span id="cb387-101"><a href="#cb387-101" aria-hidden="true" tabindex="-1"></a><span class="co"># モデルマトリックス</span></span>
<span id="cb387-102"><a href="#cb387-102" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(fit_cs) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb387-103"><a href="#cb387-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-104"><a href="#cb387-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-105"><a href="#cb387-105" aria-hidden="true" tabindex="-1"></a>ここでも出力される係数は6つであるが，ここでは最後のカテゴリが省略されている．しかし，最後のカテゴリである<span class="in">`classsuv`</span>の係数は0ではない．すべての係数の和が0になるという制約を与えているので，<span class="in">`classsuv`</span>の係数は他の係数の値の和を0から引いたものとなる．</span>
<span id="cb387-106"><a href="#cb387-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-109"><a href="#cb387-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-110"><a href="#cb387-110" aria-hidden="true" tabindex="-1"></a><span class="co"># classという文字が含まれる係数を取り出し，係数の番号を調べる（2から7）</span></span>
<span id="cb387-111"><a href="#cb387-111" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(fit_cs, <span class="st">"class"</span>)</span>
<span id="cb387-112"><a href="#cb387-112" aria-hidden="true" tabindex="-1"></a><span class="co"># 係数の2から7までを取り出し，その和を求める．</span></span>
<span id="cb387-113"><a href="#cb387-113" aria-hidden="true" tabindex="-1"></a>fit_cs<span class="sc">$</span>coefficients[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span>
<span id="cb387-114"><a href="#cb387-114" aria-hidden="true" tabindex="-1"></a><span class="co"># 和を0から引く</span></span>
<span id="cb387-115"><a href="#cb387-115" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="sc">-</span> (fit_cs<span class="sc">$</span>coefficients[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">|&gt;</span> <span class="fu">sum</span>())</span>
<span id="cb387-116"><a href="#cb387-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-117"><a href="#cb387-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-118"><a href="#cb387-118" aria-hidden="true" tabindex="-1"></a>したがって，<span class="in">`classsuv`</span>の係数は-5.571663となる．</span>
<span id="cb387-119"><a href="#cb387-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-120"><a href="#cb387-120" aria-hidden="true" tabindex="-1"></a><span class="in">`contrasts`</span>の設定を変更して分析を終えたら必ずもとに戻しておく．</span>
<span id="cb387-121"><a href="#cb387-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-124"><a href="#cb387-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-125"><a href="#cb387-125" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトに戻す</span></span>
<span id="cb387-126"><a href="#cb387-126" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb387-127"><a href="#cb387-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-128"><a href="#cb387-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-129"><a href="#cb387-129" aria-hidden="true" tabindex="-1"></a><span class="in">`lm`</span>ではモデルの中で<span class="in">`contrasts`</span>を指定することもできる．2つの方法で係数を比較してみる．</span>
<span id="cb387-130"><a href="#cb387-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-133"><a href="#cb387-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-134"><a href="#cb387-134" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析</span></span>
<span id="cb387-135"><a href="#cb387-135" aria-hidden="true" tabindex="-1"></a>fit_cs2_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg)</span>
<span id="cb387-136"><a href="#cb387-136" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の結果</span></span>
<span id="cb387-137"><a href="#cb387-137" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cs2_1)</span>
<span id="cb387-138"><a href="#cb387-138" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析</span></span>
<span id="cb387-139"><a href="#cb387-139" aria-hidden="true" tabindex="-1"></a>fit_cs2_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> class, <span class="at">data =</span> mpg,</span>
<span id="cb387-140"><a href="#cb387-140" aria-hidden="true" tabindex="-1"></a>              <span class="at">contrasts =</span> <span class="fu">list</span>(<span class="at">class =</span> <span class="st">"contr.sum"</span>))</span>
<span id="cb387-141"><a href="#cb387-141" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰分析の結果</span></span>
<span id="cb387-142"><a href="#cb387-142" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cs2_2)</span>
<span id="cb387-143"><a href="#cb387-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-144"><a href="#cb387-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-145"><a href="#cb387-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-146"><a href="#cb387-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-147"><a href="#cb387-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-148"><a href="#cb387-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-149"><a href="#cb387-149" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.1 (p.11)</span></span>
<span id="cb387-150"><a href="#cb387-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-151"><a href="#cb387-151" aria-hidden="true" tabindex="-1"></a>まずp.11の表2.1を再現する．クロス表に周辺度数を追加する場合は，<span class="in">`addmargins`</span>を用いる．</span>
<span id="cb387-152"><a href="#cb387-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-155"><a href="#cb387-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-156"><a href="#cb387-156" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数</span></span>
<span id="cb387-157"><a href="#cb387-157" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">40</span>, <span class="dv">250</span>,</span>
<span id="cb387-158"><a href="#cb387-158" aria-hidden="true" tabindex="-1"></a>          <span class="dv">160</span>,<span class="dv">3000</span>)</span>
<span id="cb387-159"><a href="#cb387-159" aria-hidden="true" tabindex="-1"></a>Freq</span>
<span id="cb387-160"><a href="#cb387-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-161"><a href="#cb387-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-162"><a href="#cb387-162" aria-hidden="true" tabindex="-1"></a>ベクトルを表にする．ここでは<span class="in">`as.table`</span>でクラスを<span class="in">`table`</span>としている．</span>
<span id="cb387-163"><a href="#cb387-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-166"><a href="#cb387-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-167"><a href="#cb387-167" aria-hidden="true" tabindex="-1"></a><span class="co"># 行列を作成し，表とする．</span></span>
<span id="cb387-168"><a href="#cb387-168" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb387-169"><a href="#cb387-169" aria-hidden="true" tabindex="-1"></a>  Freq,</span>
<span id="cb387-170"><a href="#cb387-170" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb387-171"><a href="#cb387-171" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb387-172"><a href="#cb387-172" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb387-173"><a href="#cb387-173" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">c</span>(<span class="fu">list</span>(</span>
<span id="cb387-174"><a href="#cb387-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">Member =</span> <span class="fu">c</span>(<span class="st">"Member"</span>, <span class="st">"Nonmember"</span>),</span>
<span id="cb387-175"><a href="#cb387-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">Position =</span> <span class="fu">c</span>(<span class="st">"Have subordinates"</span>,</span>
<span id="cb387-176"><a href="#cb387-176" aria-hidden="true" tabindex="-1"></a>            <span class="st">"No subordinates"</span>)</span>
<span id="cb387-177"><a href="#cb387-177" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb387-178"><a href="#cb387-178" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb387-179"><a href="#cb387-179" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.1</span></span>
<span id="cb387-180"><a href="#cb387-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-181"><a href="#cb387-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-182"><a href="#cb387-182" aria-hidden="true" tabindex="-1"></a>周辺分布とモザイクプロットも確認する．本書で指摘されている関係性が図からも見て取れる．</span>
<span id="cb387-183"><a href="#cb387-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-186"><a href="#cb387-186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-187"><a href="#cb387-187" aria-hidden="true" tabindex="-1"></a><span class="co"># 周辺分布の表示</span></span>
<span id="cb387-188"><a href="#cb387-188" aria-hidden="true" tabindex="-1"></a><span class="fu">Margins</span>(tab_2<span class="fl">.1</span>)</span>
<span id="cb387-189"><a href="#cb387-189" aria-hidden="true" tabindex="-1"></a><span class="co"># モザイクプロット</span></span>
<span id="cb387-190"><a href="#cb387-190" aria-hidden="true" tabindex="-1"></a>vcd<span class="sc">::</span><span class="fu">mosaic</span>(tab_2<span class="fl">.1</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">keep_aspect_ratio =</span> <span class="cn">FALSE</span>)</span>
<span id="cb387-191"><a href="#cb387-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-192"><a href="#cb387-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-193"><a href="#cb387-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-194"><a href="#cb387-194" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb387-195"><a href="#cb387-195" aria-hidden="true" tabindex="-1"></a><span class="fu">## ggplotでモザイクプロット</span></span>
<span id="cb387-196"><a href="#cb387-196" aria-hidden="true" tabindex="-1"></a>図はすべて<span class="in">`ggplot()`</span>を使用して描きたいという場合は，<span class="in">`ggmosaic`</span>パッケージを用いる．</span>
<span id="cb387-197"><a href="#cb387-197" aria-hidden="true" tabindex="-1"></a>その前に集計データを<span class="in">`vcdExtra::expand.dft()`</span>によって個票データに変換し，<span class="in">`ggmosaic::geom_mosaic`</span>を使用する．</span>
<span id="cb387-198"><a href="#cb387-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-201"><a href="#cb387-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-202"><a href="#cb387-202" aria-hidden="true" tabindex="-1"></a><span class="co"># パッケージの呼び出し</span></span>
<span id="cb387-203"><a href="#cb387-203" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmosaic)</span>
<span id="cb387-204"><a href="#cb387-204" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb387-205"><a href="#cb387-205" aria-hidden="true" tabindex="-1"></a><span class="co"># データの変換</span></span>
<span id="cb387-206"><a href="#cb387-206" aria-hidden="true" tabindex="-1"></a>df_tab_2<span class="fl">.1</span> <span class="ot">&lt;-</span> vcdExtra<span class="sc">::</span><span class="fu">expand.dft</span>(<span class="fu">data.frame</span>(tab_2<span class="fl">.1</span>), <span class="at">dreq =</span> <span class="st">"Freq"</span>) <span class="sc">|&gt;</span> <span class="fu">tibble</span>()</span>
<span id="cb387-207"><a href="#cb387-207" aria-hidden="true" tabindex="-1"></a>df_tab_2<span class="fl">.1</span></span>
<span id="cb387-208"><a href="#cb387-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-209"><a href="#cb387-209" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplotでモザイクプロット</span></span>
<span id="cb387-210"><a href="#cb387-210" aria-hidden="true" tabindex="-1"></a>df_tab_2<span class="fl">.1</span> <span class="sc">|&gt;</span> </span>
<span id="cb387-211"><a href="#cb387-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb387-212"><a href="#cb387-212" aria-hidden="true" tabindex="-1"></a>  ggmosaic<span class="sc">::</span><span class="fu">geom_mosaic</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">product</span>(Position, Member), <span class="at">fill =</span> Position)) <span class="sc">+</span> </span>
<span id="cb387-213"><a href="#cb387-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span> </span>
<span id="cb387-214"><a href="#cb387-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()   <span class="co"># mosaicと表示をあわせる</span></span>
<span id="cb387-215"><a href="#cb387-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-216"><a href="#cb387-216" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb387-217"><a href="#cb387-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-218"><a href="#cb387-218" aria-hidden="true" tabindex="-1"></a>表に<span class="in">`addmargins()`</span>で周辺度数を追加する．</span>
<span id="cb387-219"><a href="#cb387-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-222"><a href="#cb387-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-223"><a href="#cb387-223" aria-hidden="true" tabindex="-1"></a><span class="co"># A. 度数（周辺度数の追加）</span></span>
<span id="cb387-224"><a href="#cb387-224" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.1</span> <span class="sc">|&gt;</span> <span class="fu">addmargins</span>()</span>
<span id="cb387-225"><a href="#cb387-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-226"><a href="#cb387-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-227"><a href="#cb387-227" aria-hidden="true" tabindex="-1"></a>表の数字を用いてオッズ比を計算する．</span>
<span id="cb387-228"><a href="#cb387-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-231"><a href="#cb387-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-232"><a href="#cb387-232" aria-hidden="true" tabindex="-1"></a><span class="co"># B. Odds </span></span>
<span id="cb387-233"><a href="#cb387-233" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> tab_2<span class="fl">.1</span></span>
<span id="cb387-234"><a href="#cb387-234" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span>x[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb387-235"><a href="#cb387-235" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>x[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb387-236"><a href="#cb387-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-237"><a href="#cb387-237" aria-hidden="true" tabindex="-1"></a><span class="co"># C. Odds ratio</span></span>
<span id="cb387-238"><a href="#cb387-238" aria-hidden="true" tabindex="-1"></a>OR <span class="ot">&lt;-</span> (x[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span>x[<span class="dv">1</span>,<span class="dv">2</span>]) <span class="sc">/</span> (x[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>x[<span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb387-239"><a href="#cb387-239" aria-hidden="true" tabindex="-1"></a>OR</span>
<span id="cb387-240"><a href="#cb387-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-241"><a href="#cb387-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-242"><a href="#cb387-242" aria-hidden="true" tabindex="-1"></a>（対数）オッズ比の信頼区間をもとめる．</span>
<span id="cb387-243"><a href="#cb387-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-246"><a href="#cb387-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-247"><a href="#cb387-247" aria-hidden="true" tabindex="-1"></a><span class="co"># 対数オッズの標準誤差を求める</span></span>
<span id="cb387-248"><a href="#cb387-248" aria-hidden="true" tabindex="-1"></a>SD <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span>x[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>x[<span class="dv">1</span>,<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>x[<span class="dv">2</span>,<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>x[<span class="dv">2</span>,<span class="dv">2</span>]) </span>
<span id="cb387-249"><a href="#cb387-249" aria-hidden="true" tabindex="-1"></a><span class="co"># 対数オッズ比の信頼区間を求める</span></span>
<span id="cb387-250"><a href="#cb387-250" aria-hidden="true" tabindex="-1"></a>CI_log_OR <span class="ot">&lt;-</span> <span class="fu">log</span>(OR) <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)) <span class="sc">*</span> SD</span>
<span id="cb387-251"><a href="#cb387-251" aria-hidden="true" tabindex="-1"></a>CI_log_OR</span>
<span id="cb387-252"><a href="#cb387-252" aria-hidden="true" tabindex="-1"></a><span class="co"># オッズ比の信頼区間を求める</span></span>
<span id="cb387-253"><a href="#cb387-253" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(CI_log_OR)</span>
<span id="cb387-254"><a href="#cb387-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-255"><a href="#cb387-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-256"><a href="#cb387-256" aria-hidden="true" tabindex="-1"></a><span class="in">`DescTools`</span>パッケージの<span class="in">`OddsRatio`</span>関数を用いてオッズ比を求める．<span class="in">`conf.level = 0.95`</span>とすることで信頼区間を求めることもできる．</span>
<span id="cb387-257"><a href="#cb387-257" aria-hidden="true" tabindex="-1"></a>先程計算したものと値が一致している．</span>
<span id="cb387-258"><a href="#cb387-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-261"><a href="#cb387-261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-262"><a href="#cb387-262" aria-hidden="true" tabindex="-1"></a><span class="fu">OddsRatio</span>(tab_2<span class="fl">.1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb387-263"><a href="#cb387-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-264"><a href="#cb387-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-265"><a href="#cb387-265" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb387-266"><a href="#cb387-266" aria-hidden="true" tabindex="-1"></a><span class="fu">## 関数の中身を確認する．</span></span>
<span id="cb387-267"><a href="#cb387-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-268"><a href="#cb387-268" aria-hidden="true" tabindex="-1"></a><span class="in">`OddsRatio()`</span>がどのような処理をしているのかについては<span class="in">`OddsRatio`</span>と入力し，関数の中身をみることで確認できる．</span>
<span id="cb387-269"><a href="#cb387-269" aria-hidden="true" tabindex="-1"></a>ただし，<span class="in">`UseMethod("OddsRatio")`</span>となっており，詳細が分からないことがある．その場合は，<span class="in">`methods()`</span>を用いる．</span>
<span id="cb387-270"><a href="#cb387-270" aria-hidden="true" tabindex="-1"></a>そして，<span class="in">`OddsRatio.default*`</span>のように<span class="in">`*`</span>がついているものについて<span class="in">`DescTools:::OddsRatio.default`</span>のように入力することで中身を確認することができる．<span class="in">`getAnywhere(OddsRatio.default)`</span>としてもよい．</span>
<span id="cb387-271"><a href="#cb387-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-274"><a href="#cb387-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-275"><a href="#cb387-275" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb387-276"><a href="#cb387-276" aria-hidden="true" tabindex="-1"></a>OddsRatio</span>
<span id="cb387-277"><a href="#cb387-277" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(OddsRatio)</span>
<span id="cb387-278"><a href="#cb387-278" aria-hidden="true" tabindex="-1"></a>DescTools<span class="sc">:::</span>OddsRatio.default</span>
<span id="cb387-279"><a href="#cb387-279" aria-hidden="true" tabindex="-1"></a><span class="fu">getAnywhere</span>(OddsRatio.default)</span>
<span id="cb387-280"><a href="#cb387-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-281"><a href="#cb387-281" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb387-282"><a href="#cb387-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-283"><a href="#cb387-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-284"><a href="#cb387-284" aria-hidden="true" tabindex="-1"></a>さらに詳細な結果をみたければ<span class="in">`DescTools`</span>パッケージの<span class="in">`Desc`</span>を用いる．</span>
<span id="cb387-285"><a href="#cb387-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-288"><a href="#cb387-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-289"><a href="#cb387-289" aria-hidden="true" tabindex="-1"></a><span class="fu">Desc</span>(tab_2<span class="fl">.1</span>)</span>
<span id="cb387-290"><a href="#cb387-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-291"><a href="#cb387-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-292"><a href="#cb387-292" aria-hidden="true" tabindex="-1"></a>次にセルの組み合わせを単位とした集計データを作成し，<span class="in">`gnm`</span>を適用することでオッズ比を求めてみたい．<span class="in">`gl()`</span>は<span class="in">`n`</span>個の水準のある因子を作成する．<span class="in">`k`</span>は各水準を何度繰り返すのかを指定する．<span class="in">`length`</span>でベクトルの長さを設定することで，その長さになるまで因子の作成が繰り返される．</span>
<span id="cb387-293"><a href="#cb387-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-296"><a href="#cb387-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-297"><a href="#cb387-297" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数のベクトル</span></span>
<span id="cb387-298"><a href="#cb387-298" aria-hidden="true" tabindex="-1"></a>Freq</span>
<span id="cb387-299"><a href="#cb387-299" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数</span></span>
<span id="cb387-300"><a href="#cb387-300" aria-hidden="true" tabindex="-1"></a>COMM <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb387-301"><a href="#cb387-301" aria-hidden="true" tabindex="-1"></a>COMM</span>
<span id="cb387-302"><a href="#cb387-302" aria-hidden="true" tabindex="-1"></a><span class="co"># 列変数</span></span>
<span id="cb387-303"><a href="#cb387-303" aria-hidden="true" tabindex="-1"></a>SUP  <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">4</span>)</span>
<span id="cb387-304"><a href="#cb387-304" aria-hidden="true" tabindex="-1"></a>SUP</span>
<span id="cb387-305"><a href="#cb387-305" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなるデータを作成</span></span>
<span id="cb387-306"><a href="#cb387-306" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">tibble</span>(COMM, SUP, Freq)</span>
<span id="cb387-307"><a href="#cb387-307" aria-hidden="true" tabindex="-1"></a><span class="co"># データの確認</span></span>
<span id="cb387-308"><a href="#cb387-308" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.1</span></span>
<span id="cb387-309"><a href="#cb387-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-310"><a href="#cb387-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-311"><a href="#cb387-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-312"><a href="#cb387-312" aria-hidden="true" tabindex="-1"></a>分析には通常は<span class="in">`glm`</span>を用いるが，後の分析とあわせて<span class="in">`gnm`</span>によって推定する．結果は異ならない．<span class="in">`family = poisson`</span>という指定を忘れないようにすること．何も指定しないと<span class="in">`family = gaussian`</span>となり，通常の線形回帰分析を行ってしまうので注意する．</span>
<span id="cb387-313"><a href="#cb387-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-314"><a href="#cb387-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-317"><a href="#cb387-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-318"><a href="#cb387-318" aria-hidden="true" tabindex="-1"></a><span class="co"># gnmで推定</span></span>
<span id="cb387-319"><a href="#cb387-319" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.1</span> <span class="sc">|&gt;</span> </span>
<span id="cb387-320"><a href="#cb387-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> COMM <span class="sc">+</span> SUP <span class="sc">+</span> COMM<span class="sc">:</span>SUP, <span class="at">data =</span> _, <span class="at">family =</span> poisson)</span>
<span id="cb387-321"><a href="#cb387-321" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-322"><a href="#cb387-322" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb387-323"><a href="#cb387-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-324"><a href="#cb387-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-325"><a href="#cb387-325" aria-hidden="true" tabindex="-1"></a><span class="in">`COMM2:SUP2`</span>の係数は1.0986である．これは対数オッズなので，指数関数<span class="in">`exp`</span>を適用してオッズ比を求める．</span>
<span id="cb387-326"><a href="#cb387-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-327"><a href="#cb387-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-330"><a href="#cb387-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-331"><a href="#cb387-331" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratios fit$coefficientsのCOMM2:SUP2の要素のみを取り出し，指数関数expを適用</span></span>
<span id="cb387-332"><a href="#cb387-332" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span>coefficients[<span class="st">"COMM2:SUP2"</span>] <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span>
<span id="cb387-333"><a href="#cb387-333" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> <span class="fu">confint</span>(<span class="st">"COMM2:SUP2"</span>) <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span>
<span id="cb387-334"><a href="#cb387-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-335"><a href="#cb387-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-336"><a href="#cb387-336" aria-hidden="true" tabindex="-1"></a>次のようにしてもよい．</span>
<span id="cb387-337"><a href="#cb387-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-340"><a href="#cb387-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-341"><a href="#cb387-341" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)[<span class="st">"COMM2:SUP2"</span>] <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span>
<span id="cb387-342"><a href="#cb387-342" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit)[<span class="st">"COMM2:SUP2"</span>,] <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span>
<span id="cb387-343"><a href="#cb387-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-344"><a href="#cb387-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-345"><a href="#cb387-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-346"><a href="#cb387-346" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.3A (p.32)</span></span>
<span id="cb387-347"><a href="#cb387-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-348"><a href="#cb387-348" aria-hidden="true" tabindex="-1"></a>まずは表2.3Aを作成する．値をベクトルの形式で入力する．</span>
<span id="cb387-349"><a href="#cb387-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-352"><a href="#cb387-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-353"><a href="#cb387-353" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">39</span>,  <span class="dv">50</span>,  <span class="dv">18</span>,   <span class="dv">4</span>,</span>
<span id="cb387-354"><a href="#cb387-354" aria-hidden="true" tabindex="-1"></a>          <span class="dv">140</span>, <span class="dv">178</span>,  <span class="dv">85</span>,  <span class="dv">23</span>,</span>
<span id="cb387-355"><a href="#cb387-355" aria-hidden="true" tabindex="-1"></a>          <span class="dv">108</span>, <span class="dv">195</span>,  <span class="dv">97</span>,  <span class="dv">23</span>,</span>
<span id="cb387-356"><a href="#cb387-356" aria-hidden="true" tabindex="-1"></a>          <span class="dv">238</span>, <span class="dv">598</span>, <span class="dv">363</span>, <span class="dv">111</span>,</span>
<span id="cb387-357"><a href="#cb387-357" aria-hidden="true" tabindex="-1"></a>           <span class="dv">78</span>, <span class="dv">250</span>, <span class="dv">150</span>,  <span class="dv">55</span>,</span>
<span id="cb387-358"><a href="#cb387-358" aria-hidden="true" tabindex="-1"></a>           <span class="dv">50</span>, <span class="dv">200</span>, <span class="dv">208</span>,  <span class="dv">74</span>,</span>
<span id="cb387-359"><a href="#cb387-359" aria-hidden="true" tabindex="-1"></a>            <span class="dv">8</span>,  <span class="dv">29</span>,  <span class="dv">46</span>,  <span class="dv">21</span>)</span>
<span id="cb387-360"><a href="#cb387-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-361"><a href="#cb387-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-362"><a href="#cb387-362" aria-hidden="true" tabindex="-1"></a>ベクトルのデータを<span class="in">`matrix`</span>で行列にし，最終的には<span class="in">`as.table`</span>でtable形式にする．</span>
<span id="cb387-363"><a href="#cb387-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-366"><a href="#cb387-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-367"><a href="#cb387-367" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb387-368"><a href="#cb387-368" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb387-369"><a href="#cb387-369" aria-hidden="true" tabindex="-1"></a>  Freq,</span>
<span id="cb387-370"><a href="#cb387-370" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">7</span>,</span>
<span id="cb387-371"><a href="#cb387-371" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb387-372"><a href="#cb387-372" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb387-373"><a href="#cb387-373" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">c</span>(<span class="fu">list</span>(</span>
<span id="cb387-374"><a href="#cb387-374" aria-hidden="true" tabindex="-1"></a>    <span class="at">polviews =</span>  <span class="fu">c</span>(</span>
<span id="cb387-375"><a href="#cb387-375" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Strongly liberal"</span>,</span>
<span id="cb387-376"><a href="#cb387-376" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Liberal"</span>,</span>
<span id="cb387-377"><a href="#cb387-377" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Slightly liberal"</span>,</span>
<span id="cb387-378"><a href="#cb387-378" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Moderate"</span>,</span>
<span id="cb387-379"><a href="#cb387-379" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Slightly conservative"</span>,</span>
<span id="cb387-380"><a href="#cb387-380" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Conservative"</span>,</span>
<span id="cb387-381"><a href="#cb387-381" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Strongly conservative"</span>),</span>
<span id="cb387-382"><a href="#cb387-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">fefam =</span> <span class="fu">c</span>(<span class="st">"Strongly Disagree"</span>,</span>
<span id="cb387-383"><a href="#cb387-383" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Disagree"</span>,</span>
<span id="cb387-384"><a href="#cb387-384" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Agree"</span>,</span>
<span id="cb387-385"><a href="#cb387-385" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Strongly agree"</span>)</span>
<span id="cb387-386"><a href="#cb387-386" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb387-387"><a href="#cb387-387" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>A</span>
<span id="cb387-388"><a href="#cb387-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-389"><a href="#cb387-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-390"><a href="#cb387-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-393"><a href="#cb387-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-394"><a href="#cb387-394" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる集計データを作成</span></span>
<span id="cb387-395"><a href="#cb387-395" aria-hidden="true" tabindex="-1"></a>polviews <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">k =</span> <span class="dv">4</span>)   <span class="co"># 1-7までの各数字について4つ値を出す</span></span>
<span id="cb387-396"><a href="#cb387-396" aria-hidden="true" tabindex="-1"></a>fefam <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">28</span>)   <span class="co"># 1-4までの数字の列を長さが28になるまで繰り返す</span></span>
<span id="cb387-397"><a href="#cb387-397" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, polviews, fefam)</span>
<span id="cb387-398"><a href="#cb387-398" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A</span>
<span id="cb387-399"><a href="#cb387-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-400"><a href="#cb387-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-401"><a href="#cb387-401" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>なお<span class="in">`tab_2.3A`</span>に対して，data.frameを適用しても集計データは作成される．tableの行変数と列変数が指定されていないと，行変数は<span class="in">`Var1`</span>，列変数は<span class="in">`Var2`</span>となるので，必要に応じて名前を<span class="in">`rename`</span>で修正する</span>
<span id="cb387-402"><a href="#cb387-402" aria-hidden="true" tabindex="-1"></a>．</span>
<span id="cb387-403"><a href="#cb387-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-406"><a href="#cb387-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-407"><a href="#cb387-407" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(tab_2<span class="fl">.3</span>A) <span class="sc">|&gt;</span> </span>
<span id="cb387-408"><a href="#cb387-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()</span>
<span id="cb387-409"><a href="#cb387-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-410"><a href="#cb387-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-411"><a href="#cb387-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-412"><a href="#cb387-412" aria-hidden="true" tabindex="-1"></a>以下では複数のモデルの適合度を比較する．そこで，モデル適合度を表示するための関数を作成する．モデルはすべて<span class="in">`gnm`</span>によって推定されることを前提としている．<span class="in">`glm`</span>の場合はエラーが出るので注意すること．</span>
<span id="cb387-413"><a href="#cb387-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-416"><a href="#cb387-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-417"><a href="#cb387-417" aria-hidden="true" tabindex="-1"></a><span class="co"># 引数となるobjはgnmの結果</span></span>
<span id="cb387-418"><a href="#cb387-418" aria-hidden="true" tabindex="-1"></a>model.summary <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, <span class="at">Model =</span> <span class="cn">NULL</span>){</span>
<span id="cb387-419"><a href="#cb387-419" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">class</span>(obj) <span class="sc">==</span> <span class="st">"gnm"</span>) <span class="sc">!=</span> <span class="dv">1</span>)</span>
<span id="cb387-420"><a href="#cb387-420" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"estimate with gnm"</span>)</span>
<span id="cb387-421"><a href="#cb387-421" aria-hidden="true" tabindex="-1"></a>  aic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="dv">2</span> <span class="co"># AIC(L2)</span></span>
<span id="cb387-422"><a href="#cb387-422" aria-hidden="true" tabindex="-1"></a>  bic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">sum</span>(obj<span class="sc">$</span>y)) <span class="co">#BIC(L2)</span></span>
<span id="cb387-423"><a href="#cb387-423" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">abs</span>(obj<span class="sc">$</span>y <span class="sc">-</span> obj<span class="sc">$</span>fitted.values)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(obj<span class="sc">$</span>y))</span>
<span id="cb387-424"><a href="#cb387-424" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(obj<span class="sc">$</span>deviance, obj<span class="sc">$</span>df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)     <span class="co">#p&lt;-ifelse(p&lt;0.001,"&lt;0.001",p)</span></span>
<span id="cb387-425"><a href="#cb387-425" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb387-426"><a href="#cb387-426" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(Model)){ </span>
<span id="cb387-427"><a href="#cb387-427" aria-hidden="true" tabindex="-1"></a>  Model <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(obj))</span>
<span id="cb387-428"><a href="#cb387-428" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb387-429"><a href="#cb387-429" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb387-430"><a href="#cb387-430" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Model Description"</span> <span class="ot">=</span> Model,</span>
<span id="cb387-431"><a href="#cb387-431" aria-hidden="true" tabindex="-1"></a>    <span class="st">"df"</span> <span class="ot">=</span> obj<span class="sc">$</span>df,</span>
<span id="cb387-432"><a href="#cb387-432" aria-hidden="true" tabindex="-1"></a>    <span class="st">"L2"</span> <span class="ot">=</span> obj<span class="sc">$</span>deviance,</span>
<span id="cb387-433"><a href="#cb387-433" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"AIC(L2)" = aic,</span></span>
<span id="cb387-434"><a href="#cb387-434" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BIC"</span> <span class="ot">=</span> bic,</span>
<span id="cb387-435"><a href="#cb387-435" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Delta"</span> <span class="ot">=</span> delta,</span>
<span id="cb387-436"><a href="#cb387-436" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p"</span> <span class="ot">=</span> p</span>
<span id="cb387-437"><a href="#cb387-437" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb387-438"><a href="#cb387-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb387-439"><a href="#cb387-439" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb387-440"><a href="#cb387-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-441"><a href="#cb387-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-442"><a href="#cb387-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-443"><a href="#cb387-443" aria-hidden="true" tabindex="-1"></a>コントラストがデフォルトの<span class="in">`factor = "contr.treatment"`</span>と<span class="in">`ordered = "contr.poly"`</span>になっているのかを確認する．</span>
<span id="cb387-444"><a href="#cb387-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-447"><a href="#cb387-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-448"><a href="#cb387-448" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトのcontrasts</span></span>
<span id="cb387-449"><a href="#cb387-449" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span>
<span id="cb387-450"><a href="#cb387-450" aria-hidden="true" tabindex="-1"></a><span class="co"># defaultのcontrastsの設定（ここでは特に意味はない．constrastをいじった後にデフォルトに戻す）</span></span>
<span id="cb387-451"><a href="#cb387-451" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>, </span>
<span id="cb387-452"><a href="#cb387-452" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb387-453"><a href="#cb387-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-454"><a href="#cb387-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-455"><a href="#cb387-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-456"><a href="#cb387-456" aria-hidden="true" tabindex="-1"></a>行スコアと列スコアを用いるので，まず<span class="in">`as.integer`</span>を用いて行スコア（<span class="in">`Rscore`</span>）と列スコア（<span class="in">`Cscore`</span>）の変数を作成する．</span>
<span id="cb387-457"><a href="#cb387-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-460"><a href="#cb387-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-461"><a href="#cb387-461" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数と列変数の整数値を作成</span></span>
<span id="cb387-462"><a href="#cb387-462" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb387-463"><a href="#cb387-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rscore =</span> <span class="fu">as.integer</span>(polviews),</span>
<span id="cb387-464"><a href="#cb387-464" aria-hidden="true" tabindex="-1"></a>         <span class="at">Rscore =</span> Rscore <span class="sc">-</span> <span class="fu">mean</span>(Rscore),</span>
<span id="cb387-465"><a href="#cb387-465" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> <span class="fu">as.integer</span>(fefam),</span>
<span id="cb387-466"><a href="#cb387-466" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> Cscore <span class="sc">-</span> <span class="fu">mean</span>(Cscore))</span>
<span id="cb387-467"><a href="#cb387-467" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A</span>
<span id="cb387-468"><a href="#cb387-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-469"><a href="#cb387-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-470"><a href="#cb387-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-471"><a href="#cb387-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-472"><a href="#cb387-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-473"><a href="#cb387-473" aria-hidden="true" tabindex="-1"></a><span class="fu">### 独立モデル</span></span>
<span id="cb387-474"><a href="#cb387-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-475"><a href="#cb387-475" aria-hidden="true" tabindex="-1"></a>独立モデルは次のようになる．</span>
<span id="cb387-476"><a href="#cb387-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-479"><a href="#cb387-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-480"><a href="#cb387-480" aria-hidden="true" tabindex="-1"></a><span class="co">#  1. O: Independence/Null Association Model</span></span>
<span id="cb387-481"><a href="#cb387-481" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb387-482"><a href="#cb387-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam,</span>
<span id="cb387-483"><a href="#cb387-483" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb387-484"><a href="#cb387-484" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _,</span>
<span id="cb387-485"><a href="#cb387-485" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb387-486"><a href="#cb387-486" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb387-487"><a href="#cb387-487" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-488"><a href="#cb387-488" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(O)</span>
<span id="cb387-489"><a href="#cb387-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-490"><a href="#cb387-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-491"><a href="#cb387-491" aria-hidden="true" tabindex="-1"></a>先ほど作成した適合度の関数を用いる．2つめの引数はモデルの名前の詳細を記述可能だが，これは省略してもよい．</span>
<span id="cb387-492"><a href="#cb387-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-495"><a href="#cb387-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-496"><a href="#cb387-496" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-497"><a href="#cb387-497" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(O, <span class="st">"O:Independent"</span>)</span>
<span id="cb387-498"><a href="#cb387-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-499"><a href="#cb387-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-500"><a href="#cb387-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-501"><a href="#cb387-501" aria-hidden="true" tabindex="-1"></a>テキストの表2.4と同じ結果になっているのかを確認してみる．</span>
<span id="cb387-502"><a href="#cb387-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-503"><a href="#cb387-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-504"><a href="#cb387-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-505"><a href="#cb387-505" aria-hidden="true" tabindex="-1"></a><span class="fu">### 一様連関モデル</span></span>
<span id="cb387-506"><a href="#cb387-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-507"><a href="#cb387-507" aria-hidden="true" tabindex="-1"></a>一様連関モデルでは先ほど作成した行変数と列変数の整数スコアの積である<span class="in">`Rscore:Cscore`</span>を加える．<span class="in">`Rscore*Cscore`</span>あるいは<span class="in">`I(Rscore*Cscore)`</span>でもよい．</span>
<span id="cb387-508"><a href="#cb387-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-511"><a href="#cb387-511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-512"><a href="#cb387-512" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. U: Uniform Association Model</span></span>
<span id="cb387-513"><a href="#cb387-513" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb387-514"><a href="#cb387-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb387-515"><a href="#cb387-515" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb387-516"><a href="#cb387-516" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb387-517"><a href="#cb387-517" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-518"><a href="#cb387-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-519"><a href="#cb387-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-522"><a href="#cb387-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-523"><a href="#cb387-523" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-524"><a href="#cb387-524" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(U)</span>
<span id="cb387-525"><a href="#cb387-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-526"><a href="#cb387-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-527"><a href="#cb387-527" aria-hidden="true" tabindex="-1"></a>表2.4Aと同じ結果になっているのかを確認する．</span>
<span id="cb387-528"><a href="#cb387-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-531"><a href="#cb387-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-532"><a href="#cb387-532" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-533"><a href="#cb387-533" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(U, <span class="st">"U:Uniform"</span>)</span>
<span id="cb387-534"><a href="#cb387-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-535"><a href="#cb387-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-536"><a href="#cb387-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-537"><a href="#cb387-537" aria-hidden="true" tabindex="-1"></a>モデル行列を確認するのもよいだろう．</span>
<span id="cb387-538"><a href="#cb387-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-541"><a href="#cb387-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-542"><a href="#cb387-542" aria-hidden="true" tabindex="-1"></a><span class="co"># model.matrixを適用し，ユニークな値だけを表示</span></span>
<span id="cb387-543"><a href="#cb387-543" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(U) <span class="sc">|&gt;</span> <span class="fu">unique</span>() </span>
<span id="cb387-544"><a href="#cb387-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-545"><a href="#cb387-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-546"><a href="#cb387-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-547"><a href="#cb387-547" aria-hidden="true" tabindex="-1"></a><span class="fu">### 行効果モデル</span></span>
<span id="cb387-548"><a href="#cb387-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-549"><a href="#cb387-549" aria-hidden="true" tabindex="-1"></a>contrastを修正し，polviewsの係数のすべてを足すと0になるように効果コーディングを行ってる．なお行変数と列スコアの積については<span class="in">`Cscore*polviews`</span>とし，<span class="in">`Cscore:polviews`</span>としない．</span>
<span id="cb387-550"><a href="#cb387-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-553"><a href="#cb387-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-554"><a href="#cb387-554" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. R: Row Effect Model</span></span>
<span id="cb387-555"><a href="#cb387-555" aria-hidden="true" tabindex="-1"></a><span class="co"># contrastを修正している．</span></span>
<span id="cb387-556"><a href="#cb387-556" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.sum"</span>, </span>
<span id="cb387-557"><a href="#cb387-557" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.treatment"</span>))</span>
<span id="cb387-558"><a href="#cb387-558" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span>
<span id="cb387-559"><a href="#cb387-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-560"><a href="#cb387-560" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb387-561"><a href="#cb387-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">*</span>polviews, </span>
<span id="cb387-562"><a href="#cb387-562" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-563"><a href="#cb387-563" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-564"><a href="#cb387-564" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-565"><a href="#cb387-565" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-566"><a href="#cb387-566" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(R)</span>
<span id="cb387-567"><a href="#cb387-567" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-568"><a href="#cb387-568" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(R, <span class="st">"R:Row effect"</span>)</span>
<span id="cb387-569"><a href="#cb387-569" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb387-570"><a href="#cb387-570" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(R) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb387-571"><a href="#cb387-571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-572"><a href="#cb387-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-573"><a href="#cb387-573" aria-hidden="true" tabindex="-1"></a>表2.4の適合度を確認しよう．また，パラメータ推定値については，表2.5のBから確認する．</span>
<span id="cb387-574"><a href="#cb387-574" aria-hidden="true" tabindex="-1"></a>Rの結果では，polviews1からpolviews6までの結果が表示されているが，polviews7は示されていない．パラメータのすべての値を足すと0となることから($\sum \tau_i^A=0$)，polviews7の係数は<span class="in">`0-(-0.6721737)=0.6721737`</span>となる．これをRで計算するためには係数を取り出し，それらを足したものを0から引けばよい．</span>
<span id="cb387-575"><a href="#cb387-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-576"><a href="#cb387-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-579"><a href="#cb387-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-580"><a href="#cb387-580" aria-hidden="true" tabindex="-1"></a><span class="co"># R</span></span>
<span id="cb387-581"><a href="#cb387-581" aria-hidden="true" tabindex="-1"></a><span class="co"># 取り出す係数を探す</span></span>
<span id="cb387-582"><a href="#cb387-582" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(R, <span class="st">":Cscore"</span>)</span>
<span id="cb387-583"><a href="#cb387-583" aria-hidden="true" tabindex="-1"></a><span class="co"># 12から17番目の係数を取り出し，足す</span></span>
<span id="cb387-584"><a href="#cb387-584" aria-hidden="true" tabindex="-1"></a>R<span class="sc">$</span>coefficients[<span class="dv">12</span><span class="sc">:</span><span class="dv">17</span>] <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span>
<span id="cb387-585"><a href="#cb387-585" aria-hidden="true" tabindex="-1"></a><span class="co"># 次のようにもできる</span></span>
<span id="cb387-586"><a href="#cb387-586" aria-hidden="true" tabindex="-1"></a>R<span class="sc">$</span>coefficients[<span class="fu">pickCoef</span>(R, <span class="st">":Cscore"</span>)] <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span>
<span id="cb387-587"><a href="#cb387-587" aria-hidden="true" tabindex="-1"></a><span class="co"># 0から足したものを引く</span></span>
<span id="cb387-588"><a href="#cb387-588" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="sc">-</span> (R<span class="sc">$</span>coefficients[<span class="fu">pickCoef</span>(R, <span class="st">":Cscore"</span>)] <span class="sc">|&gt;</span> <span class="fu">sum</span>())</span>
<span id="cb387-589"><a href="#cb387-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-590"><a href="#cb387-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-591"><a href="#cb387-591" aria-hidden="true" tabindex="-1"></a>contrastsをもとに戻して同様の分析を行う．</span>
<span id="cb387-592"><a href="#cb387-592" aria-hidden="true" tabindex="-1"></a>今度は<span class="in">`polviews1:Cscore`</span>の係数が省略されているが，この値は0である（$\tau_1^A=0$）．</span>
<span id="cb387-593"><a href="#cb387-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-596"><a href="#cb387-596" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-597"><a href="#cb387-597" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative (default)</span></span>
<span id="cb387-598"><a href="#cb387-598" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb387-599"><a href="#cb387-599" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb387-600"><a href="#cb387-600" aria-hidden="true" tabindex="-1"></a>Ralt <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb387-601"><a href="#cb387-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">*</span>polviews, </span>
<span id="cb387-602"><a href="#cb387-602" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-603"><a href="#cb387-603" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-604"><a href="#cb387-604" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-605"><a href="#cb387-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-606"><a href="#cb387-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-607"><a href="#cb387-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-608"><a href="#cb387-608" aria-hidden="true" tabindex="-1"></a>結果は表2.5Bの「他の正規化」の行を確認して欲しい．</span>
<span id="cb387-609"><a href="#cb387-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-612"><a href="#cb387-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-613"><a href="#cb387-613" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-614"><a href="#cb387-614" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Ralt)</span>
<span id="cb387-615"><a href="#cb387-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-616"><a href="#cb387-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-617"><a href="#cb387-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-618"><a href="#cb387-618" aria-hidden="true" tabindex="-1"></a>モデルの適合度は全く同じであることがわかる．</span>
<span id="cb387-619"><a href="#cb387-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-622"><a href="#cb387-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-623"><a href="#cb387-623" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-624"><a href="#cb387-624" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(R, <span class="st">"R: Row effect (effect coding)"</span>)</span>
<span id="cb387-625"><a href="#cb387-625" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(Ralt, <span class="st">"R: Row effect (dummy coding)"</span>)</span>
<span id="cb387-626"><a href="#cb387-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-627"><a href="#cb387-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-630"><a href="#cb387-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-631"><a href="#cb387-631" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb387-632"><a href="#cb387-632" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(Ralt) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb387-633"><a href="#cb387-633" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-634"><a href="#cb387-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-635"><a href="#cb387-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-636"><a href="#cb387-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-637"><a href="#cb387-637" aria-hidden="true" tabindex="-1"></a><span class="fu">## 列効果モデル</span></span>
<span id="cb387-638"><a href="#cb387-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-639"><a href="#cb387-639" aria-hidden="true" tabindex="-1"></a>列効果モデルは行効果モデルと同様の方法で推定すればよい．まずは効果コーディングで推定し，その後にダミーコーディングで推定する．</span>
<span id="cb387-640"><a href="#cb387-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-643"><a href="#cb387-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-644"><a href="#cb387-644" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. C: Column Effect Model</span></span>
<span id="cb387-645"><a href="#cb387-645" aria-hidden="true" tabindex="-1"></a><span class="co"># contrast</span></span>
<span id="cb387-646"><a href="#cb387-646" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.sum"</span>, </span>
<span id="cb387-647"><a href="#cb387-647" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.treatment"</span>))</span>
<span id="cb387-648"><a href="#cb387-648" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb387-649"><a href="#cb387-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">*</span>fefam, <span class="at">family =</span> poisson, </span>
<span id="cb387-650"><a href="#cb387-650" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-651"><a href="#cb387-651" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-652"><a href="#cb387-652" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-653"><a href="#cb387-653" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(C)</span>
<span id="cb387-654"><a href="#cb387-654" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-655"><a href="#cb387-655" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(C, <span class="st">"C:Column effect"</span>)</span>
<span id="cb387-656"><a href="#cb387-656" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb387-657"><a href="#cb387-657" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(C) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb387-658"><a href="#cb387-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-659"><a href="#cb387-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-660"><a href="#cb387-660" aria-hidden="true" tabindex="-1"></a>すべてを足すと0となることから($\sum \tau_j^B=0$)，polviews7の係数は<span class="in">`0-(-0.2496118)=0.2496118`</span>となる</span>
<span id="cb387-661"><a href="#cb387-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-664"><a href="#cb387-664" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-665"><a href="#cb387-665" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(C, <span class="st">":Rscore"</span>)</span>
<span id="cb387-666"><a href="#cb387-666" aria-hidden="true" tabindex="-1"></a>C<span class="sc">$</span>coefficients[<span class="fu">pickCoef</span>(C, <span class="st">":Rscore"</span>)] <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span>
<span id="cb387-667"><a href="#cb387-667" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="sc">-</span> (C<span class="sc">$</span>coefficients[<span class="fu">pickCoef</span>(C, <span class="st">":Rscore"</span>)] <span class="sc">|&gt;</span> <span class="fu">sum</span>())</span>
<span id="cb387-668"><a href="#cb387-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-669"><a href="#cb387-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-670"><a href="#cb387-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-671"><a href="#cb387-671" aria-hidden="true" tabindex="-1"></a>以下はダミーコーディングを用いている．</span>
<span id="cb387-672"><a href="#cb387-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-675"><a href="#cb387-675" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-676"><a href="#cb387-676" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative (default)</span></span>
<span id="cb387-677"><a href="#cb387-677" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb387-678"><a href="#cb387-678" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb387-679"><a href="#cb387-679" aria-hidden="true" tabindex="-1"></a>Calt <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb387-680"><a href="#cb387-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">*</span>fefam, </span>
<span id="cb387-681"><a href="#cb387-681" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-682"><a href="#cb387-682" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-683"><a href="#cb387-683" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-684"><a href="#cb387-684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-685"><a href="#cb387-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-686"><a href="#cb387-686" aria-hidden="true" tabindex="-1"></a>推定値は表2.5Cを確認せよ．</span>
<span id="cb387-687"><a href="#cb387-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-690"><a href="#cb387-690" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-691"><a href="#cb387-691" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-692"><a href="#cb387-692" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Calt)</span>
<span id="cb387-693"><a href="#cb387-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-694"><a href="#cb387-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-695"><a href="#cb387-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-696"><a href="#cb387-696" aria-hidden="true" tabindex="-1"></a>適合度は効果コーディングとダミーコーディングで変化しない．</span>
<span id="cb387-697"><a href="#cb387-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-700"><a href="#cb387-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-701"><a href="#cb387-701" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-702"><a href="#cb387-702" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(C, <span class="st">"C:Column effect (effect coding)"</span>) </span>
<span id="cb387-703"><a href="#cb387-703" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(Calt, <span class="st">"C:Column effect (dummy coding)"</span>)</span>
<span id="cb387-704"><a href="#cb387-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-705"><a href="#cb387-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-706"><a href="#cb387-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-709"><a href="#cb387-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-710"><a href="#cb387-710" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル行列の確認</span></span>
<span id="cb387-711"><a href="#cb387-711" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(Calt) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb387-712"><a href="#cb387-712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-713"><a href="#cb387-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-714"><a href="#cb387-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-715"><a href="#cb387-715" aria-hidden="true" tabindex="-1"></a><span class="fu">## 行・列効果モデル（$R+C$）</span></span>
<span id="cb387-716"><a href="#cb387-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-717"><a href="#cb387-717" aria-hidden="true" tabindex="-1"></a>普通に推定しても収束しない．</span>
<span id="cb387-718"><a href="#cb387-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-721"><a href="#cb387-721" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-722"><a href="#cb387-722" aria-hidden="true" tabindex="-1"></a><span class="co"># コントラスト</span></span>
<span id="cb387-723"><a href="#cb387-723" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb387-724"><a href="#cb387-724" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.treatment"</span>))</span>
<span id="cb387-725"><a href="#cb387-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-726"><a href="#cb387-726" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. R+C: Row and Column Effect Model</span></span>
<span id="cb387-727"><a href="#cb387-727" aria-hidden="true" tabindex="-1"></a><span class="co"># 収束しない</span></span>
<span id="cb387-728"><a href="#cb387-728" aria-hidden="true" tabindex="-1"></a>RplusCno <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb387-729"><a href="#cb387-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb387-730"><a href="#cb387-730" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-731"><a href="#cb387-731" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-732"><a href="#cb387-732" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-733"><a href="#cb387-733" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-734"><a href="#cb387-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-735"><a href="#cb387-735" aria-hidden="true" tabindex="-1"></a>係数を確認する．この場合，制約は3つ必要であるが2つしかNAとなっていない．テキストや表2.5Dを参照し，どのような制約を課すのかをきめる．ここでは表2.5Dのような制約を課す．</span>
<span id="cb387-736"><a href="#cb387-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-739"><a href="#cb387-739" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-740"><a href="#cb387-740" aria-hidden="true" tabindex="-1"></a>RplusCno</span>
<span id="cb387-741"><a href="#cb387-741" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCno, <span class="st">":Cscore"</span>)  <span class="co"># 行効果</span></span>
<span id="cb387-742"><a href="#cb387-742" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCno, <span class="st">":Rscore"</span>)  <span class="co"># 列効果</span></span>
<span id="cb387-743"><a href="#cb387-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-744"><a href="#cb387-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-745"><a href="#cb387-745" aria-hidden="true" tabindex="-1"></a>あるいは次のように一覧にしてもよい．</span>
<span id="cb387-746"><a href="#cb387-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-749"><a href="#cb387-749" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-750"><a href="#cb387-750" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb387-751"><a href="#cb387-751" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(RplusCno<span class="sc">$</span>coefficients),</span>
<span id="cb387-752"><a href="#cb387-752" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> RplusCno<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span> </span>
<span id="cb387-753"><a href="#cb387-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb387-754"><a href="#cb387-754" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span>
<span id="cb387-755"><a href="#cb387-755" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-756"><a href="#cb387-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-757"><a href="#cb387-757" aria-hidden="true" tabindex="-1"></a>制約を課すのは11番目，17番目，18番目の係数であり，これらを0にする．対象となる係数は<span class="in">`constrain = c(11,17,18)`</span>で指定し，制約は<span class="in">`constrainTo = c(0, 0, 0)`</span>とする．あとは同じである．</span>
<span id="cb387-758"><a href="#cb387-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-761"><a href="#cb387-761" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-762"><a href="#cb387-762" aria-hidden="true" tabindex="-1"></a><span class="co"># polviews1:Cscore(11) = polviews7:Cscore(17) = fefam1:Rscore(18) = 0</span></span>
<span id="cb387-763"><a href="#cb387-763" aria-hidden="true" tabindex="-1"></a>RplusC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb387-764"><a href="#cb387-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb387-765"><a href="#cb387-765" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">17</span>, <span class="dv">18</span>), </span>
<span id="cb387-766"><a href="#cb387-766" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb387-767"><a href="#cb387-767" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-768"><a href="#cb387-768" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-769"><a href="#cb387-769" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-770"><a href="#cb387-770" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-771"><a href="#cb387-771" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusC)</span>
<span id="cb387-772"><a href="#cb387-772" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-773"><a href="#cb387-773" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RplusC)</span>
<span id="cb387-774"><a href="#cb387-774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-775"><a href="#cb387-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-776"><a href="#cb387-776" aria-hidden="true" tabindex="-1"></a>11番目，18番目，21番目の係数を0にして推定する．</span>
<span id="cb387-777"><a href="#cb387-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-780"><a href="#cb387-780" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-781"><a href="#cb387-781" aria-hidden="true" tabindex="-1"></a><span class="co"># polviews1:Cscore(11) = polviews7:Cscore(17) = fefam1:Rscore(18) = 0</span></span>
<span id="cb387-782"><a href="#cb387-782" aria-hidden="true" tabindex="-1"></a>RplusC_2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb387-783"><a href="#cb387-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb387-784"><a href="#cb387-784" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">18</span>, <span class="dv">21</span>), </span>
<span id="cb387-785"><a href="#cb387-785" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb387-786"><a href="#cb387-786" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-787"><a href="#cb387-787" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-788"><a href="#cb387-788" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-789"><a href="#cb387-789" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-790"><a href="#cb387-790" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusC_2)</span>
<span id="cb387-791"><a href="#cb387-791" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-792"><a href="#cb387-792" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RplusC_2)</span>
<span id="cb387-793"><a href="#cb387-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-794"><a href="#cb387-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-795"><a href="#cb387-795" aria-hidden="true" tabindex="-1"></a><span class="in">`Rscore:Cscore`</span>を含めて推定すれば，制約は自動的に課されており（<span class="in">`polviews`</span>の1番目と7番目，<span class="in">`fefam`</span>の1 番目と4番目），特に指定する必要はない．</span>
<span id="cb387-796"><a href="#cb387-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-799"><a href="#cb387-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-800"><a href="#cb387-800" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. R+C: Row and Column Effect Model (Alternative)</span></span>
<span id="cb387-801"><a href="#cb387-801" aria-hidden="true" tabindex="-1"></a>RplusCalt <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb387-802"><a href="#cb387-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> Cscore<span class="sc">:</span>polviews <span class="sc">+</span> Rscore<span class="sc">:</span>fefam,</span>
<span id="cb387-803"><a href="#cb387-803" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-804"><a href="#cb387-804" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-805"><a href="#cb387-805" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-806"><a href="#cb387-806" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-807"><a href="#cb387-807" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCalt)</span>
<span id="cb387-808"><a href="#cb387-808" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-809"><a href="#cb387-809" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RplusCalt)</span>
<span id="cb387-810"><a href="#cb387-810" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-811"><a href="#cb387-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-812"><a href="#cb387-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-813"><a href="#cb387-813" aria-hidden="true" tabindex="-1"></a><span class="fu">## 行・列効果モデル（$RC(1)$）</span></span>
<span id="cb387-814"><a href="#cb387-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-815"><a href="#cb387-815" aria-hidden="true" tabindex="-1"></a>RC(1)については<span class="in">`Mult(1,polviews,fefam)`</span>を含んだモデルで推定する．結果をみると係数は表示されているものの，標準誤差はNAとなっている．</span>
<span id="cb387-816"><a href="#cb387-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-817"><a href="#cb387-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-818"><a href="#cb387-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-821"><a href="#cb387-821" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-822"><a href="#cb387-822" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. RC: RC(1) model</span></span>
<span id="cb387-823"><a href="#cb387-823" aria-hidden="true" tabindex="-1"></a>RC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb387-824"><a href="#cb387-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>,polviews,fefam),</span>
<span id="cb387-825"><a href="#cb387-825" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-826"><a href="#cb387-826" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-827"><a href="#cb387-827" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-828"><a href="#cb387-828" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-829"><a href="#cb387-829" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC.un)</span>
<span id="cb387-830"><a href="#cb387-830" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-831"><a href="#cb387-831" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC.un)</span>
<span id="cb387-832"><a href="#cb387-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-833"><a href="#cb387-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-834"><a href="#cb387-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-835"><a href="#cb387-835" aria-hidden="true" tabindex="-1"></a>まずは「重みづけのないまたは単位標準化した解」を求める．<span class="in">`scaleWeights = "unit"`</span>とする．<span class="in">`RC.un`</span>から<span class="in">`.polviews`</span>のある変数を<span class="in">`pickCoef(RC.un, "[.]polviews")`</span>によって取り出す．</span>
<span id="cb387-836"><a href="#cb387-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-839"><a href="#cb387-839" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-840"><a href="#cb387-840" aria-hidden="true" tabindex="-1"></a><span class="co"># mu[i], i = 1 to 7</span></span>
<span id="cb387-841"><a href="#cb387-841" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un,</span>
<span id="cb387-842"><a href="#cb387-842" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"[.]polviews"</span>),</span>
<span id="cb387-843"><a href="#cb387-843" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-844"><a href="#cb387-844" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb387-845"><a href="#cb387-845" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb387-846"><a href="#cb387-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-847"><a href="#cb387-847" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の方向を揃える</span></span>
<span id="cb387-848"><a href="#cb387-848" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (mu<span class="sc">$</span>qvframe[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span> ) {</span>
<span id="cb387-849"><a href="#cb387-849" aria-hidden="true" tabindex="-1"></a>  mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]</span>
<span id="cb387-850"><a href="#cb387-850" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb387-851"><a href="#cb387-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-852"><a href="#cb387-852" aria-hidden="true" tabindex="-1"></a><span class="co"># 合計が0，2乗和が1となっていること確認する．</span></span>
<span id="cb387-853"><a href="#cb387-853" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"和"</span> <span class="ot">=</span> <span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]), </span>
<span id="cb387-854"><a href="#cb387-854" aria-hidden="true" tabindex="-1"></a>     <span class="st">"2乗和"</span> <span class="ot">=</span> <span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb387-855"><a href="#cb387-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-856"><a href="#cb387-856" aria-hidden="true" tabindex="-1"></a><span class="co"># nu[j], j = 1 to 4</span></span>
<span id="cb387-857"><a href="#cb387-857" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un, <span class="st">"[.]fefam"</span>), </span>
<span id="cb387-858"><a href="#cb387-858" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-859"><a href="#cb387-859" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-860"><a href="#cb387-860" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb387-861"><a href="#cb387-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-862"><a href="#cb387-862" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の方向を揃える</span></span>
<span id="cb387-863"><a href="#cb387-863" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (nu<span class="sc">$</span>qvframe[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span> ) {</span>
<span id="cb387-864"><a href="#cb387-864" aria-hidden="true" tabindex="-1"></a>  nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]</span>
<span id="cb387-865"><a href="#cb387-865" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb387-866"><a href="#cb387-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-867"><a href="#cb387-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-868"><a href="#cb387-868" aria-hidden="true" tabindex="-1"></a><span class="co"># 合計が0，2乗和が1となっていること確認する．</span></span>
<span id="cb387-869"><a href="#cb387-869" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="st">"和"</span> <span class="ot">=</span> <span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]), </span>
<span id="cb387-870"><a href="#cb387-870" aria-hidden="true" tabindex="-1"></a>     <span class="st">"2乗和"</span> <span class="ot">=</span> <span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb387-871"><a href="#cb387-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-872"><a href="#cb387-872" aria-hidden="true" tabindex="-1"></a><span class="co"># muの1番目と7番目，nuの1番目と4番目の値を取り出し保存する．</span></span>
<span id="cb387-873"><a href="#cb387-873" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>)],</span>
<span id="cb387-874"><a href="#cb387-874" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)])</span>
<span id="cb387-875"><a href="#cb387-875" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-876"><a href="#cb387-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-877"><a href="#cb387-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-880"><a href="#cb387-880" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-881"><a href="#cb387-881" aria-hidden="true" tabindex="-1"></a><span class="co">#保存した値で制約を課した上で，再推定する．</span></span>
<span id="cb387-882"><a href="#cb387-882" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb387-883"><a href="#cb387-883" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb387-884"><a href="#cb387-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>,polviews,fefam), </span>
<span id="cb387-885"><a href="#cb387-885" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">22</span>),</span>
<span id="cb387-886"><a href="#cb387-886" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con, </span>
<span id="cb387-887"><a href="#cb387-887" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-888"><a href="#cb387-888" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-889"><a href="#cb387-889" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-890"><a href="#cb387-890" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-891"><a href="#cb387-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-892"><a href="#cb387-892" aria-hidden="true" tabindex="-1"></a><span class="in">`Deviance is not finite 警告メッセージ: Algorithm failed - no model could be estimated `</span>と表示されたらもう一度推定する．<span class="in">`set.seed`</span>の値をいくつか変えて実行するのがよい．</span>
<span id="cb387-893"><a href="#cb387-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-894"><a href="#cb387-894" aria-hidden="true" tabindex="-1"></a>表2.5Eの値と一致しているのかを確認する．</span>
<span id="cb387-895"><a href="#cb387-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-898"><a href="#cb387-898" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-899"><a href="#cb387-899" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-900"><a href="#cb387-900" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC)</span>
<span id="cb387-901"><a href="#cb387-901" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-902"><a href="#cb387-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-903"><a href="#cb387-903" aria-hidden="true" tabindex="-1"></a>先ほどの単位標準化した解と推定の結果が一致しているのかを確認する．</span>
<span id="cb387-904"><a href="#cb387-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-907"><a href="#cb387-907" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-908"><a href="#cb387-908" aria-hidden="true" tabindex="-1"></a><span class="co"># 指定したmuとnuの値と結果が一致しているかを確認</span></span>
<span id="cb387-909"><a href="#cb387-909" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="at">mu =</span> mu, <span class="at">nu =</span> nu)</span>
<span id="cb387-910"><a href="#cb387-910" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-911"><a href="#cb387-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-912"><a href="#cb387-912" aria-hidden="true" tabindex="-1"></a>和が0，2乗和が1となっていることを確認</span>
<span id="cb387-913"><a href="#cb387-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-916"><a href="#cb387-916" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-917"><a href="#cb387-917" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>])</span>
<span id="cb387-918"><a href="#cb387-918" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb387-919"><a href="#cb387-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-920"><a href="#cb387-920" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>])</span>
<span id="cb387-921"><a href="#cb387-921" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb387-922"><a href="#cb387-922" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-923"><a href="#cb387-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-924"><a href="#cb387-924" aria-hidden="true" tabindex="-1"></a>適合度は変化していない．</span>
<span id="cb387-925"><a href="#cb387-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-928"><a href="#cb387-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-929"><a href="#cb387-929" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-930"><a href="#cb387-930" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC.un)</span>
<span id="cb387-931"><a href="#cb387-931" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC)</span>
<span id="cb387-932"><a href="#cb387-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-933"><a href="#cb387-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-934"><a href="#cb387-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-935"><a href="#cb387-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-936"><a href="#cb387-936" aria-hidden="true" tabindex="-1"></a><span class="fu">## 周辺重みづけ</span></span>
<span id="cb387-937"><a href="#cb387-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-940"><a href="#cb387-940" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-941"><a href="#cb387-941" aria-hidden="true" tabindex="-1"></a><span class="co"># 行の周辺確率</span></span>
<span id="cb387-942"><a href="#cb387-942" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="fu">apply</span>(tab_2<span class="fl">.3</span>A, <span class="dv">1</span>, sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb387-943"><a href="#cb387-943" aria-hidden="true" tabindex="-1"></a>rp</span>
<span id="cb387-944"><a href="#cb387-944" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(rp)</span>
<span id="cb387-945"><a href="#cb387-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-946"><a href="#cb387-946" aria-hidden="true" tabindex="-1"></a><span class="co"># 列の周辺確率</span></span>
<span id="cb387-947"><a href="#cb387-947" aria-hidden="true" tabindex="-1"></a>cp <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="fu">apply</span>(tab_2<span class="fl">.3</span>A, <span class="dv">2</span>, sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb387-948"><a href="#cb387-948" aria-hidden="true" tabindex="-1"></a>cp</span>
<span id="cb387-949"><a href="#cb387-949" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(cp)</span>
<span id="cb387-950"><a href="#cb387-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-951"><a href="#cb387-951" aria-hidden="true" tabindex="-1"></a><span class="co"># mu[i], i = 1 to 7</span></span>
<span id="cb387-952"><a href="#cb387-952" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un,</span>
<span id="cb387-953"><a href="#cb387-953" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"[.]polviews"</span>),</span>
<span id="cb387-954"><a href="#cb387-954" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> rp,</span>
<span id="cb387-955"><a href="#cb387-955" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> rp, </span>
<span id="cb387-956"><a href="#cb387-956" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> rp)</span>
<span id="cb387-957"><a href="#cb387-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-958"><a href="#cb387-958" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の方向を揃える</span></span>
<span id="cb387-959"><a href="#cb387-959" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (mu<span class="sc">$</span>qvframe[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span> ) {</span>
<span id="cb387-960"><a href="#cb387-960" aria-hidden="true" tabindex="-1"></a>  mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]</span>
<span id="cb387-961"><a href="#cb387-961" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb387-962"><a href="#cb387-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-963"><a href="#cb387-963" aria-hidden="true" tabindex="-1"></a><span class="co"># nu[j], j = 1 to 4</span></span>
<span id="cb387-964"><a href="#cb387-964" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RC.un, <span class="fu">pickCoef</span>(RC.un, <span class="st">"[.]fefam"</span>), </span>
<span id="cb387-965"><a href="#cb387-965" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> cp,</span>
<span id="cb387-966"><a href="#cb387-966" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> cp,</span>
<span id="cb387-967"><a href="#cb387-967" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> cp)</span>
<span id="cb387-968"><a href="#cb387-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-969"><a href="#cb387-969" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の方向を揃える</span></span>
<span id="cb387-970"><a href="#cb387-970" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (nu<span class="sc">$</span>qvframe[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span> ) {</span>
<span id="cb387-971"><a href="#cb387-971" aria-hidden="true" tabindex="-1"></a>  nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]</span>
<span id="cb387-972"><a href="#cb387-972" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb387-973"><a href="#cb387-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-974"><a href="#cb387-974" aria-hidden="true" tabindex="-1"></a><span class="co"># muの1番目と7番目，nuの1番目と4番目の値を取り出し保存する．</span></span>
<span id="cb387-975"><a href="#cb387-975" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>)],</span>
<span id="cb387-976"><a href="#cb387-976" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)])</span>
<span id="cb387-977"><a href="#cb387-977" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-978"><a href="#cb387-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-979"><a href="#cb387-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-982"><a href="#cb387-982" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-983"><a href="#cb387-983" aria-hidden="true" tabindex="-1"></a><span class="co">#保存した値で制約を課した上で，再推定する．</span></span>
<span id="cb387-984"><a href="#cb387-984" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb387-985"><a href="#cb387-985" aria-hidden="true" tabindex="-1"></a>RC_mw <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> </span>
<span id="cb387-986"><a href="#cb387-986" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>,polviews,fefam), </span>
<span id="cb387-987"><a href="#cb387-987" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">22</span>),</span>
<span id="cb387-988"><a href="#cb387-988" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con, </span>
<span id="cb387-989"><a href="#cb387-989" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-990"><a href="#cb387-990" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-991"><a href="#cb387-991" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-992"><a href="#cb387-992" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-993"><a href="#cb387-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-996"><a href="#cb387-996" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-997"><a href="#cb387-997" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果</span></span>
<span id="cb387-998"><a href="#cb387-998" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC_mw)</span>
<span id="cb387-999"><a href="#cb387-999" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1000"><a href="#cb387-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1001"><a href="#cb387-1001" aria-hidden="true" tabindex="-1"></a>内的連関パラメータ$\phi$が0.25673となっている．場合によっては符号が逆となる．</span>
<span id="cb387-1002"><a href="#cb387-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1003"><a href="#cb387-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1004"><a href="#cb387-1004" aria-hidden="true" tabindex="-1"></a>適合度は変化していない．</span>
<span id="cb387-1005"><a href="#cb387-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1008"><a href="#cb387-1008" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1009"><a href="#cb387-1009" aria-hidden="true" tabindex="-1"></a><span class="co"># モデル適合度</span></span>
<span id="cb387-1010"><a href="#cb387-1010" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC.un)</span>
<span id="cb387-1011"><a href="#cb387-1011" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC)</span>
<span id="cb387-1012"><a href="#cb387-1012" aria-hidden="true" tabindex="-1"></a><span class="fu">model.summary</span>(RC_mw)</span>
<span id="cb387-1013"><a href="#cb387-1013" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1014"><a href="#cb387-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1015"><a href="#cb387-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1016"><a href="#cb387-1016" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.4A</span></span>
<span id="cb387-1017"><a href="#cb387-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1018"><a href="#cb387-1018" aria-hidden="true" tabindex="-1"></a>表2.4Aを再現する．</span>
<span id="cb387-1019"><a href="#cb387-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1022"><a href="#cb387-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1023"><a href="#cb387-1023" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb387-1024"><a href="#cb387-1024" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(O)</span>
<span id="cb387-1025"><a href="#cb387-1025" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(U)</span>
<span id="cb387-1026"><a href="#cb387-1026" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(R)</span>
<span id="cb387-1027"><a href="#cb387-1027" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(C)</span>
<span id="cb387-1028"><a href="#cb387-1028" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusC)</span>
<span id="cb387-1029"><a href="#cb387-1029" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RC)</span>
<span id="cb387-1030"><a href="#cb387-1030" aria-hidden="true" tabindex="-1"></a>models <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> <span class="fu">kable</span>(<span class="at">digit =</span> <span class="dv">3</span>)</span>
<span id="cb387-1031"><a href="#cb387-1031" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1032"><a href="#cb387-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1033"><a href="#cb387-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1034"><a href="#cb387-1034" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.4B</span></span>
<span id="cb387-1035"><a href="#cb387-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1036"><a href="#cb387-1036" aria-hidden="true" tabindex="-1"></a>モデルの比較のための関数を作成する．引数は2つであり，1つめのモデルと2つめのモデルの比較を行う．2つめが指定されていなければ比較ではなくそのモデルの適合度を示す．</span>
<span id="cb387-1037"><a href="#cb387-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1040"><a href="#cb387-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1041"><a href="#cb387-1041" aria-hidden="true" tabindex="-1"></a>model_comparison <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">y =</span> <span class="dv">0</span>) {</span>
<span id="cb387-1042"><a href="#cb387-1042" aria-hidden="true" tabindex="-1"></a>  models <span class="sc">|&gt;</span> </span>
<span id="cb387-1043"><a href="#cb387-1043" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1044"><a href="#cb387-1044" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="st">`</span><span class="at">Model Used</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb387-1045"><a href="#cb387-1045" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb387-1046"><a href="#cb387-1046" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">paste0</span>(x),</span>
<span id="cb387-1047"><a href="#cb387-1047" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">paste0</span>(x,<span class="st">"-"</span>,y)),</span>
<span id="cb387-1048"><a href="#cb387-1048" aria-hidden="true" tabindex="-1"></a>              <span class="at">df =</span> <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb387-1049"><a href="#cb387-1049" aria-hidden="true" tabindex="-1"></a>                          df[x], </span>
<span id="cb387-1050"><a href="#cb387-1050" aria-hidden="true" tabindex="-1"></a>                          df[x] <span class="sc">-</span> df[y]),</span>
<span id="cb387-1051"><a href="#cb387-1051" aria-hidden="true" tabindex="-1"></a>              <span class="at">L2 =</span> <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb387-1052"><a href="#cb387-1052" aria-hidden="true" tabindex="-1"></a>                          L2[x], </span>
<span id="cb387-1053"><a href="#cb387-1053" aria-hidden="true" tabindex="-1"></a>                          L2[x] <span class="sc">-</span> L2[y]))</span>
<span id="cb387-1054"><a href="#cb387-1054" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb387-1055"><a href="#cb387-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1056"><a href="#cb387-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1057"><a href="#cb387-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1058"><a href="#cb387-1058" aria-hidden="true" tabindex="-1"></a>表2.4Bは次のように再現できる．</span>
<span id="cb387-1059"><a href="#cb387-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1062"><a href="#cb387-1062" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1063"><a href="#cb387-1063" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel B</span></span>
<span id="cb387-1064"><a href="#cb387-1064" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb387-1065"><a href="#cb387-1065" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">6</span>),</span>
<span id="cb387-1066"><a href="#cb387-1066" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">6</span>),</span>
<span id="cb387-1067"><a href="#cb387-1067" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="fu">kable</span>(<span class="at">digit =</span> <span class="dv">3</span>)</span>
<span id="cb387-1068"><a href="#cb387-1068" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1069"><a href="#cb387-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1070"><a href="#cb387-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1071"><a href="#cb387-1071" aria-hidden="true" tabindex="-1"></a>表2.4Cも再現できる．</span>
<span id="cb387-1072"><a href="#cb387-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1075"><a href="#cb387-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1076"><a href="#cb387-1076" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel C</span></span>
<span id="cb387-1077"><a href="#cb387-1077" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">4</span>),</span>
<span id="cb387-1078"><a href="#cb387-1078" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">4</span>,<span class="dv">6</span>),</span>
<span id="cb387-1079"><a href="#cb387-1079" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">6</span>)) <span class="sc">|&gt;</span> <span class="fu">kable</span>(<span class="at">digit =</span> <span class="dv">3</span>)</span>
<span id="cb387-1080"><a href="#cb387-1080" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1081"><a href="#cb387-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1082"><a href="#cb387-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1083"><a href="#cb387-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1084"><a href="#cb387-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1085"><a href="#cb387-1085" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.5A</span></span>
<span id="cb387-1086"><a href="#cb387-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1087"><a href="#cb387-1087" aria-hidden="true" tabindex="-1"></a>係数を取り出して表2.5Aを再現する．</span>
<span id="cb387-1088"><a href="#cb387-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1091"><a href="#cb387-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1092"><a href="#cb387-1092" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(U)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1093"><a href="#cb387-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1094"><a href="#cb387-1094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1095"><a href="#cb387-1095" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore:Cscore"</span>, Variable))</span>
<span id="cb387-1096"><a href="#cb387-1096" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1097"><a href="#cb387-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1098"><a href="#cb387-1098" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.5B</span></span>
<span id="cb387-1099"><a href="#cb387-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1100"><a href="#cb387-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1101"><a href="#cb387-1101" aria-hidden="true" tabindex="-1"></a>省略された係数について，標準誤差を求める方法は次の通り．</span>
<span id="cb387-1102"><a href="#cb387-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1105"><a href="#cb387-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1106"><a href="#cb387-1106" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel B </span></span>
<span id="cb387-1107"><a href="#cb387-1107" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(R)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1108"><a href="#cb387-1108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1109"><a href="#cb387-1109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1110"><a href="#cb387-1110" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Cscore"</span>, Variable))</span>
<span id="cb387-1111"><a href="#cb387-1111" aria-hidden="true" tabindex="-1"></a><span class="co"># polviews7:Cscoreを求める</span></span>
<span id="cb387-1112"><a href="#cb387-1112" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(<span class="fu">coef</span>(R)))</span>
<span id="cb387-1113"><a href="#cb387-1113" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(R,<span class="st">"[:]Cscore"</span>)</span>
<span id="cb387-1114"><a href="#cb387-1114" aria-hidden="true" tabindex="-1"></a>mycontrast[terms] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">6</span>)</span>
<span id="cb387-1115"><a href="#cb387-1115" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mycontrast)</span>
<span id="cb387-1116"><a href="#cb387-1116" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mycontrast) <span class="ot">&lt;-</span> <span class="st">"polviews7:Cscore"</span></span>
<span id="cb387-1117"><a href="#cb387-1117" aria-hidden="true" tabindex="-1"></a>gnm<span class="sc">::</span><span class="fu">se</span>(R, mycontrast)</span>
<span id="cb387-1118"><a href="#cb387-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1119"><a href="#cb387-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1120"><a href="#cb387-1120" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.5B（他の正規化）</span></span>
<span id="cb387-1121"><a href="#cb387-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1124"><a href="#cb387-1124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1125"><a href="#cb387-1125" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel B Alternative</span></span>
<span id="cb387-1126"><a href="#cb387-1126" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Ralt)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1127"><a href="#cb387-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1128"><a href="#cb387-1128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1129"><a href="#cb387-1129" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Cscore"</span>, Variable))</span>
<span id="cb387-1130"><a href="#cb387-1130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1131"><a href="#cb387-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1132"><a href="#cb387-1132" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.5C</span></span>
<span id="cb387-1133"><a href="#cb387-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1134"><a href="#cb387-1134" aria-hidden="true" tabindex="-1"></a>同様に列効果の最後のカテゴリの推定値と標準誤差を求める．</span>
<span id="cb387-1135"><a href="#cb387-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1138"><a href="#cb387-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1139"><a href="#cb387-1139" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel C</span></span>
<span id="cb387-1140"><a href="#cb387-1140" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(C)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1141"><a href="#cb387-1141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1142"><a href="#cb387-1142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1143"><a href="#cb387-1143" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Rscore"</span>, Variable))</span>
<span id="cb387-1144"><a href="#cb387-1144" aria-hidden="true" tabindex="-1"></a><span class="co"># fefam4:Rscoreを求める</span></span>
<span id="cb387-1145"><a href="#cb387-1145" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(<span class="fu">coef</span>(C)))</span>
<span id="cb387-1146"><a href="#cb387-1146" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(C,<span class="st">"[:]Rscore"</span>)</span>
<span id="cb387-1147"><a href="#cb387-1147" aria-hidden="true" tabindex="-1"></a>mycontrast[terms] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">3</span>)</span>
<span id="cb387-1148"><a href="#cb387-1148" aria-hidden="true" tabindex="-1"></a>mycontrast <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mycontrast)</span>
<span id="cb387-1149"><a href="#cb387-1149" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mycontrast) <span class="ot">&lt;-</span> <span class="st">"fefam4:Rscore"</span></span>
<span id="cb387-1150"><a href="#cb387-1150" aria-hidden="true" tabindex="-1"></a>gnm<span class="sc">::</span><span class="fu">se</span>(C, mycontrast)</span>
<span id="cb387-1151"><a href="#cb387-1151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1152"><a href="#cb387-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1153"><a href="#cb387-1153" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.5C（他の正規化）</span></span>
<span id="cb387-1154"><a href="#cb387-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1155"><a href="#cb387-1155" aria-hidden="true" tabindex="-1"></a>1つ目のカテゴリの値を0とした正規化の場合は次のようになる．</span>
<span id="cb387-1156"><a href="#cb387-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1159"><a href="#cb387-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1160"><a href="#cb387-1160" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel C Alternative</span></span>
<span id="cb387-1161"><a href="#cb387-1161" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Calt)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1162"><a href="#cb387-1162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1163"><a href="#cb387-1163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1164"><a href="#cb387-1164" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":Rscore"</span>, Variable))</span>
<span id="cb387-1165"><a href="#cb387-1165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1166"><a href="#cb387-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1167"><a href="#cb387-1167" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.5D</span></span>
<span id="cb387-1168"><a href="#cb387-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1171"><a href="#cb387-1171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1172"><a href="#cb387-1172" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.5 Panel D</span></span>
<span id="cb387-1173"><a href="#cb387-1173" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1174"><a href="#cb387-1174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1175"><a href="#cb387-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1176"><a href="#cb387-1176" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore"</span>, Variable))</span>
<span id="cb387-1177"><a href="#cb387-1177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1178"><a href="#cb387-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1179"><a href="#cb387-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1180"><a href="#cb387-1180" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.5D（他の正規化）</span></span>
<span id="cb387-1181"><a href="#cb387-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1184"><a href="#cb387-1184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1185"><a href="#cb387-1185" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCalt)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1186"><a href="#cb387-1186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1187"><a href="#cb387-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1188"><a href="#cb387-1188" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore"</span>, Variable))</span>
<span id="cb387-1189"><a href="#cb387-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1190"><a href="#cb387-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1191"><a href="#cb387-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1192"><a href="#cb387-1192" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.5E</span></span>
<span id="cb387-1193"><a href="#cb387-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1196"><a href="#cb387-1196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1197"><a href="#cb387-1197" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1198"><a href="#cb387-1198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1199"><a href="#cb387-1199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1200"><a href="#cb387-1200" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Mult"</span>, Variable))</span>
<span id="cb387-1201"><a href="#cb387-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1202"><a href="#cb387-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1203"><a href="#cb387-1203" aria-hidden="true" tabindex="-1"></a><span class="fu">## logmultパッケージの利用</span></span>
<span id="cb387-1204"><a href="#cb387-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1205"><a href="#cb387-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1206"><a href="#cb387-1206" aria-hidden="true" tabindex="-1"></a><span class="in">`logmult`</span>は<span class="in">`gnm`</span>をベースとしてRCモデルを簡単に実行できる関数である．</span>
<span id="cb387-1207"><a href="#cb387-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1208"><a href="#cb387-1208" aria-hidden="true" tabindex="-1"></a>まずは<span class="in">`logmult`</span>パッケージの<span class="in">`anoas`</span>で連関分析を行う．データはtableなので<span class="in">`tab_2.3A`</span>を使用する．</span>
<span id="cb387-1209"><a href="#cb387-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1210"><a href="#cb387-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1211"><a href="#cb387-1211" aria-hidden="true" tabindex="-1"></a><span class="in">`anoas`</span>は独立モデル，RC(1)，RC(2)，RC(3)，...と次元が<span class="in">`min(nrow(tab) - 1, ncol(tab) - 1)`</span>までのRCモデルを推定する．RC(1)の結果は表2.4Aと一致している．</span>
<span id="cb387-1212"><a href="#cb387-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1215"><a href="#cb387-1215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1216"><a href="#cb387-1216" aria-hidden="true" tabindex="-1"></a><span class="fu">anoas</span>(tab_2<span class="fl">.3</span>A)</span>
<span id="cb387-1217"><a href="#cb387-1217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1218"><a href="#cb387-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1219"><a href="#cb387-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1220"><a href="#cb387-1220" aria-hidden="true" tabindex="-1"></a>表2.5Eの推定値（RC(1)）は<span class="in">`rc`</span>を用いて次のように再現できる．<span class="in">`nd = 1`</span>で次元を1としている．標準誤差を求める上で，ブートストラップ法を用いている．結果には$\gamma=\delta=1/2$の場合の係数（Adjusted）が示されている．</span>
<span id="cb387-1221"><a href="#cb387-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1224"><a href="#cb387-1224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1225"><a href="#cb387-1225" aria-hidden="true" tabindex="-1"></a>rc_fit <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, </span>
<span id="cb387-1226"><a href="#cb387-1226" aria-hidden="true" tabindex="-1"></a>             <span class="at">nd =</span> <span class="dv">1</span>, </span>
<span id="cb387-1227"><a href="#cb387-1227" aria-hidden="true" tabindex="-1"></a>             <span class="at">se =</span> <span class="st">"bootstrap"</span>, </span>
<span id="cb387-1228"><a href="#cb387-1228" aria-hidden="true" tabindex="-1"></a>             <span class="at">weighting =</span> <span class="st">"none"</span>,</span>
<span id="cb387-1229"><a href="#cb387-1229" aria-hidden="true" tabindex="-1"></a>             <span class="at">nreplicates =</span> <span class="dv">100</span>, </span>
<span id="cb387-1230"><a href="#cb387-1230" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncpus =</span> <span class="fu">getOption</span>(<span class="st">"boot.ncpus"</span>)</span>
<span id="cb387-1231"><a href="#cb387-1231" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb387-1232"><a href="#cb387-1232" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rc_fit, <span class="at">weighting =</span> <span class="st">"none"</span>)</span>
<span id="cb387-1233"><a href="#cb387-1233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1234"><a href="#cb387-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1235"><a href="#cb387-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1236"><a href="#cb387-1236" aria-hidden="true" tabindex="-1"></a>周辺重みづけを用いたい場合は`weighting = "marginal"とする．</span>
<span id="cb387-1237"><a href="#cb387-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1240"><a href="#cb387-1240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1241"><a href="#cb387-1241" aria-hidden="true" tabindex="-1"></a>rc_fit_wm <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, </span>
<span id="cb387-1242"><a href="#cb387-1242" aria-hidden="true" tabindex="-1"></a>             <span class="at">nd =</span> <span class="dv">1</span>, </span>
<span id="cb387-1243"><a href="#cb387-1243" aria-hidden="true" tabindex="-1"></a>             <span class="at">se =</span> <span class="st">"bootstrap"</span>, </span>
<span id="cb387-1244"><a href="#cb387-1244" aria-hidden="true" tabindex="-1"></a>             <span class="at">weighting =</span> <span class="st">"marginal"</span>,</span>
<span id="cb387-1245"><a href="#cb387-1245" aria-hidden="true" tabindex="-1"></a>             <span class="at">nreplicates =</span> <span class="dv">100</span>, </span>
<span id="cb387-1246"><a href="#cb387-1246" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncpus =</span> <span class="fu">getOption</span>(<span class="st">"boot.ncpus"</span>)</span>
<span id="cb387-1247"><a href="#cb387-1247" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb387-1248"><a href="#cb387-1248" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rc_fit_wm)</span>
<span id="cb387-1249"><a href="#cb387-1249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1250"><a href="#cb387-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1251"><a href="#cb387-1251" aria-hidden="true" tabindex="-1"></a>これは先ほど求めた周辺重みづけの結果（内的連関パラメータが0.25673）と一致する．</span>
<span id="cb387-1252"><a href="#cb387-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1253"><a href="#cb387-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1254"><a href="#cb387-1254" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.3B</span></span>
<span id="cb387-1255"><a href="#cb387-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1258"><a href="#cb387-1258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1259"><a href="#cb387-1259" aria-hidden="true" tabindex="-1"></a><span class="co"># コントラストを確認</span></span>
<span id="cb387-1260"><a href="#cb387-1260" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'contrasts'</span>)</span>
<span id="cb387-1261"><a href="#cb387-1261" aria-hidden="true" tabindex="-1"></a><span class="co"># default</span></span>
<span id="cb387-1262"><a href="#cb387-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">factor =</span> <span class="st">"contr.treatment"</span>,</span>
<span id="cb387-1263"><a href="#cb387-1263" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ordered =</span> <span class="st">"contr.poly"</span>))</span>
<span id="cb387-1264"><a href="#cb387-1264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1265"><a href="#cb387-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1266"><a href="#cb387-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1267"><a href="#cb387-1267" aria-hidden="true" tabindex="-1"></a><span class="in">`anoas`</span>を用いるときにはのエラーを無くすために行列はラベルを用いない．</span>
<span id="cb387-1268"><a href="#cb387-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1269"><a href="#cb387-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1272"><a href="#cb387-1272" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1273"><a href="#cb387-1273" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">518</span>,   <span class="dv">95</span>,  <span class="dv">6</span>,  <span class="dv">35</span>,  <span class="dv">5</span>,</span>
<span id="cb387-1274"><a href="#cb387-1274" aria-hidden="true" tabindex="-1"></a>         　<span class="dv">81</span>,   <span class="dv">67</span>,  <span class="dv">4</span>,  <span class="dv">49</span>,  <span class="dv">2</span>,</span>
<span id="cb387-1275"><a href="#cb387-1275" aria-hidden="true" tabindex="-1"></a>          <span class="dv">452</span>, <span class="dv">1003</span>, <span class="dv">67</span>, <span class="dv">630</span>,  <span class="dv">5</span>,</span>
<span id="cb387-1276"><a href="#cb387-1276" aria-hidden="true" tabindex="-1"></a>           <span class="dv">71</span>,  <span class="dv">157</span>, <span class="dv">37</span>, <span class="dv">562</span>, <span class="dv">12</span>)</span>
<span id="cb387-1277"><a href="#cb387-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1278"><a href="#cb387-1278" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb387-1279"><a href="#cb387-1279" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq, </span>
<span id="cb387-1280"><a href="#cb387-1280" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb387-1281"><a href="#cb387-1281" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">5</span>,</span>
<span id="cb387-1282"><a href="#cb387-1282" aria-hidden="true" tabindex="-1"></a>                   <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb387-1283"><a href="#cb387-1283" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B</span>
<span id="cb387-1284"><a href="#cb387-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1285"><a href="#cb387-1285" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる集計データを作成</span></span>
<span id="cb387-1286"><a href="#cb387-1286" aria-hidden="true" tabindex="-1"></a>Educ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb387-1287"><a href="#cb387-1287" aria-hidden="true" tabindex="-1"></a>Occ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">20</span>)</span>
<span id="cb387-1288"><a href="#cb387-1288" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Educ, Occ)</span>
<span id="cb387-1289"><a href="#cb387-1289" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B</span>
<span id="cb387-1290"><a href="#cb387-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1291"><a href="#cb387-1291" aria-hidden="true" tabindex="-1"></a><span class="co"># 行変数と列変数の整数値を作成</span></span>
<span id="cb387-1292"><a href="#cb387-1292" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span> </span>
<span id="cb387-1293"><a href="#cb387-1293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rscore =</span> <span class="fu">as.numeric</span>(Educ),</span>
<span id="cb387-1294"><a href="#cb387-1294" aria-hidden="true" tabindex="-1"></a>         <span class="at">Cscore =</span> <span class="fu">as.numeric</span>(Occ))</span>
<span id="cb387-1295"><a href="#cb387-1295" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B</span>
<span id="cb387-1296"><a href="#cb387-1296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1297"><a href="#cb387-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1298"><a href="#cb387-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1301"><a href="#cb387-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1302"><a href="#cb387-1302" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span> </span>
<span id="cb387-1303"><a href="#cb387-1303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ, </span>
<span id="cb387-1304"><a href="#cb387-1304" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1305"><a href="#cb387-1305" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1306"><a href="#cb387-1306" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1307"><a href="#cb387-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1308"><a href="#cb387-1308" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1309"><a href="#cb387-1309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1310"><a href="#cb387-1310" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore, </span>
<span id="cb387-1311"><a href="#cb387-1311" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1312"><a href="#cb387-1312" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1313"><a href="#cb387-1313" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1314"><a href="#cb387-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1315"><a href="#cb387-1315" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1316"><a href="#cb387-1316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1317"><a href="#cb387-1317" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb387-1318"><a href="#cb387-1318" aria-hidden="true" tabindex="-1"></a>        Educ<span class="sc">:</span>Cscore, </span>
<span id="cb387-1319"><a href="#cb387-1319" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1320"><a href="#cb387-1320" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1321"><a href="#cb387-1321" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1322"><a href="#cb387-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1323"><a href="#cb387-1323" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1324"><a href="#cb387-1324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1325"><a href="#cb387-1325" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb387-1326"><a href="#cb387-1326" aria-hidden="true" tabindex="-1"></a>        Occ<span class="sc">:</span>Rscore, </span>
<span id="cb387-1327"><a href="#cb387-1327" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1328"><a href="#cb387-1328" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1329"><a href="#cb387-1329" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1330"><a href="#cb387-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1331"><a href="#cb387-1331" aria-hidden="true" tabindex="-1"></a>RplusC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1332"><a href="#cb387-1332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1333"><a href="#cb387-1333" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb387-1334"><a href="#cb387-1334" aria-hidden="true" tabindex="-1"></a>        Educ<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb387-1335"><a href="#cb387-1335" aria-hidden="true" tabindex="-1"></a>        Occ<span class="sc">:</span>Rscore,</span>
<span id="cb387-1336"><a href="#cb387-1336" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">16</span>), </span>
<span id="cb387-1337"><a href="#cb387-1337" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb387-1338"><a href="#cb387-1338" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1339"><a href="#cb387-1339" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1340"><a href="#cb387-1340" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1341"><a href="#cb387-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1342"><a href="#cb387-1342" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1343"><a href="#cb387-1343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1344"><a href="#cb387-1344" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1345"><a href="#cb387-1345" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1346"><a href="#cb387-1346" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1347"><a href="#cb387-1347" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1348"><a href="#cb387-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1349"><a href="#cb387-1349" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1350"><a href="#cb387-1350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span></span>
<span id="cb387-1351"><a href="#cb387-1351" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb387-1352"><a href="#cb387-1352" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1353"><a href="#cb387-1353" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1354"><a href="#cb387-1354" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1355"><a href="#cb387-1355" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1356"><a href="#cb387-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1357"><a href="#cb387-1357" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1358"><a href="#cb387-1358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1359"><a href="#cb387-1359" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb387-1360"><a href="#cb387-1360" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1361"><a href="#cb387-1361" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>),</span>
<span id="cb387-1362"><a href="#cb387-1362" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb387-1363"><a href="#cb387-1363" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1364"><a href="#cb387-1364" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1365"><a href="#cb387-1365" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1366"><a href="#cb387-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1367"><a href="#cb387-1367" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1368"><a href="#cb387-1368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1369"><a href="#cb387-1369" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb387-1370"><a href="#cb387-1370" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1371"><a href="#cb387-1371" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1372"><a href="#cb387-1372" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1373"><a href="#cb387-1373" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1374"><a href="#cb387-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1375"><a href="#cb387-1375" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1376"><a href="#cb387-1376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1377"><a href="#cb387-1377" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb387-1378"><a href="#cb387-1378" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb387-1379"><a href="#cb387-1379" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1380"><a href="#cb387-1380" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1381"><a href="#cb387-1381" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1382"><a href="#cb387-1382" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1383"><a href="#cb387-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1384"><a href="#cb387-1384" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1385"><a href="#cb387-1385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1386"><a href="#cb387-1386" aria-hidden="true" tabindex="-1"></a>        <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),<span class="dv">2</span>),</span>
<span id="cb387-1387"><a href="#cb387-1387" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1388"><a href="#cb387-1388" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1389"><a href="#cb387-1389" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1390"><a href="#cb387-1390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1391"><a href="#cb387-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1392"><a href="#cb387-1392" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.6A</span></span>
<span id="cb387-1393"><a href="#cb387-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1394"><a href="#cb387-1394" aria-hidden="true" tabindex="-1"></a>表2.6Aを再現する．</span>
<span id="cb387-1395"><a href="#cb387-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1398"><a href="#cb387-1398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1399"><a href="#cb387-1399" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb387-1400"><a href="#cb387-1400" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(O)</span>
<span id="cb387-1401"><a href="#cb387-1401" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(U)</span>
<span id="cb387-1402"><a href="#cb387-1402" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(R)</span>
<span id="cb387-1403"><a href="#cb387-1403" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(C)</span>
<span id="cb387-1404"><a href="#cb387-1404" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusC)</span>
<span id="cb387-1405"><a href="#cb387-1405" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RC)</span>
<span id="cb387-1406"><a href="#cb387-1406" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">7</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(UplusRC)</span>
<span id="cb387-1407"><a href="#cb387-1407" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">8</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusRC)</span>
<span id="cb387-1408"><a href="#cb387-1408" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">9</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(CplusRC)</span>
<span id="cb387-1409"><a href="#cb387-1409" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">10</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RplusCplusRC)</span>
<span id="cb387-1410"><a href="#cb387-1410" aria-hidden="true" tabindex="-1"></a>models[[<span class="dv">11</span>]] <span class="ot">&lt;-</span> <span class="fu">model.summary</span>(RC2)</span>
<span id="cb387-1411"><a href="#cb387-1411" aria-hidden="true" tabindex="-1"></a>models <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb387-1412"><a href="#cb387-1412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1413"><a href="#cb387-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1414"><a href="#cb387-1414" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.6B</span></span>
<span id="cb387-1415"><a href="#cb387-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1418"><a href="#cb387-1418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1419"><a href="#cb387-1419" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel B</span></span>
<span id="cb387-1420"><a href="#cb387-1420" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">1</span>,<span class="dv">6</span>),</span>
<span id="cb387-1421"><a href="#cb387-1421" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">6</span>,<span class="dv">11</span>),</span>
<span id="cb387-1422"><a href="#cb387-1422" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">11</span>),</span>
<span id="cb387-1423"><a href="#cb387-1423" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">1</span>))</span>
<span id="cb387-1424"><a href="#cb387-1424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1425"><a href="#cb387-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1426"><a href="#cb387-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1427"><a href="#cb387-1427" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.6C</span></span>
<span id="cb387-1428"><a href="#cb387-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1431"><a href="#cb387-1431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1432"><a href="#cb387-1432" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.4 Panel C</span></span>
<span id="cb387-1433"><a href="#cb387-1433" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model_comparison</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb387-1434"><a href="#cb387-1434" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">2</span>,<span class="dv">6</span>),</span>
<span id="cb387-1435"><a href="#cb387-1435" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">6</span>,<span class="dv">10</span>),</span>
<span id="cb387-1436"><a href="#cb387-1436" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">10</span>),</span>
<span id="cb387-1437"><a href="#cb387-1437" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model_comparison</span>(<span class="dv">1</span>))</span>
<span id="cb387-1438"><a href="#cb387-1438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1439"><a href="#cb387-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1440"><a href="#cb387-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1441"><a href="#cb387-1441" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.7A</span></span>
<span id="cb387-1442"><a href="#cb387-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1445"><a href="#cb387-1445" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1446"><a href="#cb387-1446" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb387-1447"><a href="#cb387-1447" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1448"><a href="#cb387-1448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1449"><a href="#cb387-1449" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb387-1450"><a href="#cb387-1450" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1451"><a href="#cb387-1451" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1452"><a href="#cb387-1452" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1453"><a href="#cb387-1453" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1454"><a href="#cb387-1454" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(UplusRC)</span>
<span id="cb387-1455"><a href="#cb387-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1456"><a href="#cb387-1456" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb387-1457"><a href="#cb387-1457" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Educ"</span>)</span>
<span id="cb387-1458"><a href="#cb387-1458" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Occ"</span>)</span>
<span id="cb387-1459"><a href="#cb387-1459" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(UplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb387-1460"><a href="#cb387-1460" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> UplusRC<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span> </span>
<span id="cb387-1461"><a href="#cb387-1461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb387-1462"><a href="#cb387-1462" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span>
<span id="cb387-1463"><a href="#cb387-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1464"><a href="#cb387-1464" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(UplusRC, </span>
<span id="cb387-1465"><a href="#cb387-1465" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Educ"</span>), </span>
<span id="cb387-1466"><a href="#cb387-1466" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-1467"><a href="#cb387-1467" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb387-1468"><a href="#cb387-1468" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb387-1469"><a href="#cb387-1469" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(UplusRC, </span>
<span id="cb387-1470"><a href="#cb387-1470" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(UplusRC, <span class="st">"[.]Occ"</span>), </span>
<span id="cb387-1471"><a href="#cb387-1471" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-1472"><a href="#cb387-1472" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb387-1473"><a href="#cb387-1473" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb387-1474"><a href="#cb387-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1475"><a href="#cb387-1475" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心化制約と尺度化制約の確認</span></span>
<span id="cb387-1476"><a href="#cb387-1476" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]) <span class="sc">|&gt;</span> <span class="fu">round</span>()</span>
<span id="cb387-1477"><a href="#cb387-1477" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb387-1478"><a href="#cb387-1478" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]) <span class="sc">|&gt;</span> <span class="fu">round</span>()</span>
<span id="cb387-1479"><a href="#cb387-1479" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb387-1480"><a href="#cb387-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1481"><a href="#cb387-1481" aria-hidden="true" tabindex="-1"></a><span class="co"># 行スコアと列スコアの両端の値を固定する</span></span>
<span id="cb387-1482"><a href="#cb387-1482" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb387-1483"><a href="#cb387-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1484"><a href="#cb387-1484" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb387-1485"><a href="#cb387-1485" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1486"><a href="#cb387-1486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1487"><a href="#cb387-1487" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Cscore <span class="sc">+</span> </span>
<span id="cb387-1488"><a href="#cb387-1488" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1489"><a href="#cb387-1489" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">19</span>),</span>
<span id="cb387-1490"><a href="#cb387-1490" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb387-1491"><a href="#cb387-1491" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1492"><a href="#cb387-1492" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1493"><a href="#cb387-1493" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1494"><a href="#cb387-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1495"><a href="#cb387-1495" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(UplusRC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1496"><a href="#cb387-1496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1497"><a href="#cb387-1497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1498"><a href="#cb387-1498" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>,</span>
<span id="cb387-1499"><a href="#cb387-1499" aria-hidden="true" tabindex="-1"></a>                      Variable))</span>
<span id="cb387-1500"><a href="#cb387-1500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1501"><a href="#cb387-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1502"><a href="#cb387-1502" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.7B</span></span>
<span id="cb387-1503"><a href="#cb387-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1506"><a href="#cb387-1506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1507"><a href="#cb387-1507" aria-hidden="true" tabindex="-1"></a>RplusRC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1508"><a href="#cb387-1508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1509"><a href="#cb387-1509" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb387-1510"><a href="#cb387-1510" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1511"><a href="#cb387-1511" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1512"><a href="#cb387-1512" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1513"><a href="#cb387-1513" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1514"><a href="#cb387-1514" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusRC.un)</span>
<span id="cb387-1515"><a href="#cb387-1515" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusRC.un, <span class="st">"[:]Cscore"</span>)</span>
<span id="cb387-1516"><a href="#cb387-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1517"><a href="#cb387-1517" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1518"><a href="#cb387-1518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1519"><a href="#cb387-1519" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb387-1520"><a href="#cb387-1520" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1521"><a href="#cb387-1521" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>),</span>
<span id="cb387-1522"><a href="#cb387-1522" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb387-1523"><a href="#cb387-1523" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1524"><a href="#cb387-1524" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1525"><a href="#cb387-1525" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1526"><a href="#cb387-1526" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusRC)</span>
<span id="cb387-1527"><a href="#cb387-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1528"><a href="#cb387-1528" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb387-1529"><a href="#cb387-1529" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusRC.un, <span class="st">"[.]Educ"</span>)</span>
<span id="cb387-1530"><a href="#cb387-1530" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusRC.un, <span class="st">"[.]Occ"</span>)</span>
<span id="cb387-1531"><a href="#cb387-1531" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(RplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb387-1532"><a href="#cb387-1532" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> RplusRC<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span> </span>
<span id="cb387-1533"><a href="#cb387-1533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb387-1534"><a href="#cb387-1534" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span>
<span id="cb387-1535"><a href="#cb387-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1536"><a href="#cb387-1536" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusRC, </span>
<span id="cb387-1537"><a href="#cb387-1537" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusRC, <span class="st">"[.]Educ"</span>), </span>
<span id="cb387-1538"><a href="#cb387-1538" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-1539"><a href="#cb387-1539" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb387-1540"><a href="#cb387-1540" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb387-1541"><a href="#cb387-1541" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusRC, </span>
<span id="cb387-1542"><a href="#cb387-1542" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusRC, <span class="st">"[.]Occ"</span>), </span>
<span id="cb387-1543"><a href="#cb387-1543" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-1544"><a href="#cb387-1544" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb387-1545"><a href="#cb387-1545" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb387-1546"><a href="#cb387-1546" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb387-1547"><a href="#cb387-1547" aria-hidden="true" tabindex="-1"></a>         mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],</span>
<span id="cb387-1548"><a href="#cb387-1548" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb387-1549"><a href="#cb387-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1550"><a href="#cb387-1550" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1551"><a href="#cb387-1551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1552"><a href="#cb387-1552" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb387-1553"><a href="#cb387-1553" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1554"><a href="#cb387-1554" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">22</span>),</span>
<span id="cb387-1555"><a href="#cb387-1555" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb387-1556"><a href="#cb387-1556" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1557"><a href="#cb387-1557" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1558"><a href="#cb387-1558" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1559"><a href="#cb387-1559" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusRC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1560"><a href="#cb387-1560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1561"><a href="#cb387-1561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1562"><a href="#cb387-1562" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span>
<span id="cb387-1563"><a href="#cb387-1563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1564"><a href="#cb387-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1565"><a href="#cb387-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1566"><a href="#cb387-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1567"><a href="#cb387-1567" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.7C</span></span>
<span id="cb387-1568"><a href="#cb387-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1569"><a href="#cb387-1569" aria-hidden="true" tabindex="-1"></a><span class="in">`Algorithm failed - no model could be estimated`</span>となったら再度推定すること．</span>
<span id="cb387-1570"><a href="#cb387-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1573"><a href="#cb387-1573" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1574"><a href="#cb387-1574" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb387-1575"><a href="#cb387-1575" aria-hidden="true" tabindex="-1"></a>CplusRC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1576"><a href="#cb387-1576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1577"><a href="#cb387-1577" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb387-1578"><a href="#cb387-1578" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1579"><a href="#cb387-1579" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1580"><a href="#cb387-1580" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1581"><a href="#cb387-1581" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1582"><a href="#cb387-1582" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC.un)</span>
<span id="cb387-1583"><a href="#cb387-1583" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(CplusRC.un, <span class="st">"[:]Rscore"</span>)</span>
<span id="cb387-1584"><a href="#cb387-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1585"><a href="#cb387-1585" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1586"><a href="#cb387-1586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1587"><a href="#cb387-1587" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb387-1588"><a href="#cb387-1588" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1589"><a href="#cb387-1589" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">13</span>),</span>
<span id="cb387-1590"><a href="#cb387-1590" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb387-1591"><a href="#cb387-1591" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1592"><a href="#cb387-1592" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1593"><a href="#cb387-1593" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1594"><a href="#cb387-1594" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC)</span>
<span id="cb387-1595"><a href="#cb387-1595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1596"><a href="#cb387-1596" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1597"><a href="#cb387-1597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1598"><a href="#cb387-1598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1599"><a href="#cb387-1599" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span>
<span id="cb387-1600"><a href="#cb387-1600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1601"><a href="#cb387-1601" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb387-1602"><a href="#cb387-1602" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(CplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb387-1603"><a href="#cb387-1603" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> CplusRC<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span> </span>
<span id="cb387-1604"><a href="#cb387-1604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb387-1605"><a href="#cb387-1605" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span>
<span id="cb387-1606"><a href="#cb387-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1607"><a href="#cb387-1607" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(CplusRC, </span>
<span id="cb387-1608"><a href="#cb387-1608" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(CplusRC, <span class="st">"[.]Educ"</span>),</span>
<span id="cb387-1609"><a href="#cb387-1609" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-1610"><a href="#cb387-1610" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb387-1611"><a href="#cb387-1611" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb387-1612"><a href="#cb387-1612" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(CplusRC, </span>
<span id="cb387-1613"><a href="#cb387-1613" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(CplusRC, <span class="st">"[.]Occ"</span>),</span>
<span id="cb387-1614"><a href="#cb387-1614" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-1615"><a href="#cb387-1615" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb387-1616"><a href="#cb387-1616" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb387-1617"><a href="#cb387-1617" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb387-1618"><a href="#cb387-1618" aria-hidden="true" tabindex="-1"></a>         mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],</span>
<span id="cb387-1619"><a href="#cb387-1619" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb387-1620"><a href="#cb387-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1621"><a href="#cb387-1621" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1622"><a href="#cb387-1622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1623"><a href="#cb387-1623" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb387-1624"><a href="#cb387-1624" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1625"><a href="#cb387-1625" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">13</span>,<span class="dv">15</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">23</span>),</span>
<span id="cb387-1626"><a href="#cb387-1626" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb387-1627"><a href="#cb387-1627" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1628"><a href="#cb387-1628" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1629"><a href="#cb387-1629" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1630"><a href="#cb387-1630" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(CplusRC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1631"><a href="#cb387-1631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1632"><a href="#cb387-1632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1633"><a href="#cb387-1633" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span>
<span id="cb387-1634"><a href="#cb387-1634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1635"><a href="#cb387-1635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1636"><a href="#cb387-1636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1637"><a href="#cb387-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1638"><a href="#cb387-1638" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.7D</span></span>
<span id="cb387-1639"><a href="#cb387-1639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1640"><a href="#cb387-1640" aria-hidden="true" tabindex="-1"></a>まずは行効果と列効果のパラメータに対して0という制約を課し，その上で推定した行スコアと列スコアを正規化し，再度推定する．</span>
<span id="cb387-1641"><a href="#cb387-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1642"><a href="#cb387-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1645"><a href="#cb387-1645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1646"><a href="#cb387-1646" aria-hidden="true" tabindex="-1"></a>RplusCplusRC.un <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1647"><a href="#cb387-1647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1648"><a href="#cb387-1648" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb387-1649"><a href="#cb387-1649" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb387-1650"><a href="#cb387-1650" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1651"><a href="#cb387-1651" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1652"><a href="#cb387-1652" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1653"><a href="#cb387-1653" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1654"><a href="#cb387-1654" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCplusRC.un)</span>
<span id="cb387-1655"><a href="#cb387-1655" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCplusRC.un, <span class="st">"[:]Cscore"</span>)</span>
<span id="cb387-1656"><a href="#cb387-1656" aria-hidden="true" tabindex="-1"></a><span class="fu">pickCoef</span>(RplusCplusRC.un, <span class="st">"[:]Rscore"</span>)</span>
<span id="cb387-1657"><a href="#cb387-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1658"><a href="#cb387-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1659"><a href="#cb387-1659" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1660"><a href="#cb387-1660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1661"><a href="#cb387-1661" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb387-1662"><a href="#cb387-1662" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb387-1663"><a href="#cb387-1663" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1664"><a href="#cb387-1664" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">17</span>), </span>
<span id="cb387-1665"><a href="#cb387-1665" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb387-1666"><a href="#cb387-1666" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1667"><a href="#cb387-1667" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1668"><a href="#cb387-1668" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1669"><a href="#cb387-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1670"><a href="#cb387-1670" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb387-1671"><a href="#cb387-1671" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(CplusRC<span class="sc">$</span>coefficients),</span>
<span id="cb387-1672"><a href="#cb387-1672" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> CplusRC<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span> </span>
<span id="cb387-1673"><a href="#cb387-1673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb387-1674"><a href="#cb387-1674" aria-hidden="true" tabindex="-1"></a>         <span class="at">number =</span> <span class="fu">row_number</span>())</span>
<span id="cb387-1675"><a href="#cb387-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1676"><a href="#cb387-1676" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusCplusRC, </span>
<span id="cb387-1677"><a href="#cb387-1677" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusCplusRC, <span class="st">"[.]Educ"</span>), </span>
<span id="cb387-1678"><a href="#cb387-1678" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-1679"><a href="#cb387-1679" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb387-1680"><a href="#cb387-1680" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb387-1681"><a href="#cb387-1681" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(RplusCplusRC,</span>
<span id="cb387-1682"><a href="#cb387-1682" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">pickCoef</span>(RplusCplusRC, <span class="st">"[.]Occ"</span>), </span>
<span id="cb387-1683"><a href="#cb387-1683" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb387-1684"><a href="#cb387-1684" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleRef =</span> <span class="st">"mean"</span>, </span>
<span id="cb387-1685"><a href="#cb387-1685" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scaleWeights =</span> <span class="st">"unit"</span>)</span>
<span id="cb387-1686"><a href="#cb387-1686" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb387-1687"><a href="#cb387-1687" aria-hidden="true" tabindex="-1"></a>         mu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)],</span>
<span id="cb387-1688"><a href="#cb387-1688" aria-hidden="true" tabindex="-1"></a>         nu<span class="sc">$</span>qvframe[,<span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)])</span>
<span id="cb387-1689"><a href="#cb387-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1690"><a href="#cb387-1690" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1691"><a href="#cb387-1691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1692"><a href="#cb387-1692" aria-hidden="true" tabindex="-1"></a>        Cscore<span class="sc">:</span>Educ <span class="sc">+</span> </span>
<span id="cb387-1693"><a href="#cb387-1693" aria-hidden="true" tabindex="-1"></a>        Rscore<span class="sc">:</span>Occ <span class="sc">+</span> </span>
<span id="cb387-1694"><a href="#cb387-1694" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb387-1695"><a href="#cb387-1695" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">19</span>,<span class="dv">22</span>,<span class="dv">23</span>,<span class="dv">27</span>), </span>
<span id="cb387-1696"><a href="#cb387-1696" aria-hidden="true" tabindex="-1"></a>      <span class="at">constrainTo =</span> con,</span>
<span id="cb387-1697"><a href="#cb387-1697" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, </span>
<span id="cb387-1698"><a href="#cb387-1698" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _, </span>
<span id="cb387-1699"><a href="#cb387-1699" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1700"><a href="#cb387-1700" aria-hidden="true" tabindex="-1"></a>mu</span>
<span id="cb387-1701"><a href="#cb387-1701" aria-hidden="true" tabindex="-1"></a>nu</span>
<span id="cb387-1702"><a href="#cb387-1702" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RplusCplusRC)<span class="sc">$</span>coefficients <span class="sc">|&gt;</span></span>
<span id="cb387-1703"><a href="#cb387-1703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1704"><a href="#cb387-1704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1705"><a href="#cb387-1705" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Rscore|Cscore|Mult"</span>, Variable))</span>
<span id="cb387-1706"><a href="#cb387-1706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1707"><a href="#cb387-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1708"><a href="#cb387-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1709"><a href="#cb387-1709" aria-hidden="true" tabindex="-1"></a><span class="fu">## 表2.7E</span></span>
<span id="cb387-1710"><a href="#cb387-1710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1711"><a href="#cb387-1711" aria-hidden="true" tabindex="-1"></a>Wongのサポートページにあるように，<span class="in">`gnm`</span>を用いてRC(2)の係数を推定することは難しい．ここではKateri, Maria. 2014.  {\it Contingency Table Analysis: Methods and Implementation Using R}. New York: Birkhäuser. のsupportページにあるプログラムを使用して係数を求める．</span>
<span id="cb387-1712"><a href="#cb387-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1713"><a href="#cb387-1713" aria-hidden="true" tabindex="-1"></a>$M &gt; 1$のRC(M)を推定するためには<span class="in">`gnm`</span>の<span class="in">`instances`</span>を用いる．</span>
<span id="cb387-1714"><a href="#cb387-1714" aria-hidden="true" tabindex="-1"></a>今は<span class="in">`instances = 2`</span>としており，RC(2)を用いている．</span>
<span id="cb387-1715"><a href="#cb387-1715" aria-hidden="true" tabindex="-1"></a>なお，式(2.35)のように$\phi$は推定されない．</span>
<span id="cb387-1716"><a href="#cb387-1716" aria-hidden="true" tabindex="-1"></a>これらスコアは求まるものの，直交という次元間制約が課されてない．</span>
<span id="cb387-1717"><a href="#cb387-1717" aria-hidden="true" tabindex="-1"></a>そこで，特異値分解（SVD: singular value decomposition）によって行スコアと列スコアのそれぞれが次元間で直行するような変換を行う．</span>
<span id="cb387-1718"><a href="#cb387-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1719"><a href="#cb387-1719" aria-hidden="true" tabindex="-1"></a>まず次元間制約が課されてない行スコアの行列（$I\times m$）と列スコアの行列（$J\times m$）の積を求め，モデル化での2元交互作用パラメータを求める．</span>
<span id="cb387-1720"><a href="#cb387-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1721"><a href="#cb387-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1722"><a href="#cb387-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1725"><a href="#cb387-1725" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1726"><a href="#cb387-1726" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb387-1727"><a href="#cb387-1727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> </span>
<span id="cb387-1728"><a href="#cb387-1728" aria-hidden="true" tabindex="-1"></a>        <span class="fu">instances</span>(<span class="fu">Mult</span>(Educ, Occ), <span class="at">instances =</span> <span class="dv">2</span>),</span>
<span id="cb387-1729"><a href="#cb387-1729" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson, <span class="at">data =</span> _, </span>
<span id="cb387-1730"><a href="#cb387-1730" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb387-1731"><a href="#cb387-1731" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC2)</span>
<span id="cb387-1732"><a href="#cb387-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1733"><a href="#cb387-1733" aria-hidden="true" tabindex="-1"></a>RCmodel_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(RCmodel, row, col, m, data){</span>
<span id="cb387-1734"><a href="#cb387-1734" aria-hidden="true" tabindex="-1"></a>  NI <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>xlevels[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">length</span>()</span>
<span id="cb387-1735"><a href="#cb387-1735" aria-hidden="true" tabindex="-1"></a>  NJ <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>xlevels[[<span class="dv">2</span>]] <span class="sc">|&gt;</span> <span class="fu">length</span>()</span>
<span id="cb387-1736"><a href="#cb387-1736" aria-hidden="true" tabindex="-1"></a>  iflag <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb387-1737"><a href="#cb387-1737" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">length</span>(RCmodel<span class="sc">$</span>y)</span>
<span id="cb387-1738"><a href="#cb387-1738" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">gl</span>(NI,NJ,<span class="at">length =</span> y)</span>
<span id="cb387-1739"><a href="#cb387-1739" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">gl</span>(NJ,<span class="dv">1</span>,<span class="at">length =</span> y)</span>
<span id="cb387-1740"><a href="#cb387-1740" aria-hidden="true" tabindex="-1"></a>  IX <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(RCmodel, </span>
<span id="cb387-1741"><a href="#cb387-1741" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">"[.]"</span>,<span class="fu">deparse</span>(<span class="fu">substitute</span>(row))))</span>
<span id="cb387-1742"><a href="#cb387-1742" aria-hidden="true" tabindex="-1"></a>  IY <span class="ot">&lt;-</span> <span class="fu">pickCoef</span>(RCmodel,</span>
<span id="cb387-1743"><a href="#cb387-1743" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">"[.]"</span>,<span class="fu">deparse</span>(<span class="fu">substitute</span>(col))))</span>
<span id="cb387-1744"><a href="#cb387-1744" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>coefficients[IX]</span>
<span id="cb387-1745"><a href="#cb387-1745" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>coefficients[IY]</span>
<span id="cb387-1746"><a href="#cb387-1746" aria-hidden="true" tabindex="-1"></a>  mu0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(X,<span class="at">nrow =</span> NI,<span class="at">ncol =</span> m)</span>
<span id="cb387-1747"><a href="#cb387-1747" aria-hidden="true" tabindex="-1"></a>  nu0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Y,<span class="at">nrow =</span> NJ,<span class="at">ncol =</span> m)</span>
<span id="cb387-1748"><a href="#cb387-1748" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> mu0</span>
<span id="cb387-1749"><a href="#cb387-1749" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> nu0</span>
<span id="cb387-1750"><a href="#cb387-1750" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> mu <span class="sc">%*%</span> <span class="fu">t</span>(nu) <span class="co"># [NI, M] [M. NJ]</span></span>
<span id="cb387-1751"><a href="#cb387-1751" aria-hidden="true" tabindex="-1"></a>  R1 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>,NI)</span>
<span id="cb387-1752"><a href="#cb387-1752" aria-hidden="true" tabindex="-1"></a>  C1 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>,NJ)</span>
<span id="cb387-1753"><a href="#cb387-1753" aria-hidden="true" tabindex="-1"></a>  Rone <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NI<span class="sc">^</span><span class="dv">2</span>),<span class="at">nrow =</span> NI)</span>
<span id="cb387-1754"><a href="#cb387-1754" aria-hidden="true" tabindex="-1"></a>  Cone <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NJ<span class="sc">^</span><span class="dv">2</span>),<span class="at">nrow =</span> NJ)</span>
<span id="cb387-1755"><a href="#cb387-1755" aria-hidden="true" tabindex="-1"></a>  rowP <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NI))</span>
<span id="cb387-1756"><a href="#cb387-1756" aria-hidden="true" tabindex="-1"></a>  colP <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,NJ));</span>
<span id="cb387-1757"><a href="#cb387-1757" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> RC2<span class="sc">$</span>model</span>
<span id="cb387-1758"><a href="#cb387-1758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(y,X,Y,IX,IY,data)</span>
<span id="cb387-1759"><a href="#cb387-1759" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (iflag <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb387-1760"><a href="#cb387-1760" aria-hidden="true" tabindex="-1"></a>    rowP <span class="ot">&lt;-</span> <span class="fu">with</span>(data, <span class="fu">tapply</span>(freq,row,sum)<span class="sc">/</span><span class="fu">sum</span>(freq))</span>
<span id="cb387-1761"><a href="#cb387-1761" aria-hidden="true" tabindex="-1"></a>    colP <span class="ot">&lt;-</span> <span class="fu">with</span>(data, <span class="fu">tapply</span>(freq,col,sum)<span class="sc">/</span><span class="fu">sum</span>(freq))}</span>
<span id="cb387-1762"><a href="#cb387-1762" aria-hidden="true" tabindex="-1"></a>  DR <span class="ot">&lt;-</span> <span class="fu">diag</span>(rowP<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NI)</span>
<span id="cb387-1763"><a href="#cb387-1763" aria-hidden="true" tabindex="-1"></a>  DC <span class="ot">&lt;-</span> <span class="fu">diag</span>(colP<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NJ)</span>
<span id="cb387-1764"><a href="#cb387-1764" aria-hidden="true" tabindex="-1"></a>  RWsqr <span class="ot">&lt;-</span> <span class="fu">diag</span>(rowP<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NI)</span>
<span id="cb387-1765"><a href="#cb387-1765" aria-hidden="true" tabindex="-1"></a>  CWsqr <span class="ot">&lt;-</span> <span class="fu">diag</span>(colP<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),NJ)</span>
<span id="cb387-1766"><a href="#cb387-1766" aria-hidden="true" tabindex="-1"></a>  RW <span class="ot">&lt;-</span> RWsqr<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb387-1767"><a href="#cb387-1767" aria-hidden="true" tabindex="-1"></a>  CW <span class="ot">&lt;-</span> CWsqr<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb387-1768"><a href="#cb387-1768" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> (R1 <span class="sc">-</span> (Rone <span class="sc">%*%</span> RW)<span class="sc">/</span><span class="fu">sum</span>(RW)) <span class="sc">%*%</span> A <span class="sc">%*%</span> <span class="fu">t</span>(C1 <span class="sc">-</span> (Cone <span class="sc">%*%</span> CW)<span class="sc">/</span><span class="fu">sum</span>(CW))</span>
<span id="cb387-1769"><a href="#cb387-1769" aria-hidden="true" tabindex="-1"></a>  phiv <span class="ot">&lt;-</span> <span class="fu">svd</span>(RWsqr <span class="sc">%*%</span> L <span class="sc">%*%</span> CWsqr)<span class="sc">$</span>d[<span class="dv">1</span><span class="sc">:</span>m]</span>
<span id="cb387-1770"><a href="#cb387-1770" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">svd</span>(RWsqr <span class="sc">%*%</span> L <span class="sc">%*%</span> CWsqr)<span class="sc">$</span>u[,<span class="dv">1</span><span class="sc">:</span>m]</span>
<span id="cb387-1771"><a href="#cb387-1771" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> <span class="fu">svd</span>(RWsqr <span class="sc">%*%</span> L <span class="sc">%*%</span> CWsqr)<span class="sc">$</span>v[,<span class="dv">1</span><span class="sc">:</span>m]</span>
<span id="cb387-1772"><a href="#cb387-1772" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> DR <span class="sc">%*%</span> mu</span>
<span id="cb387-1773"><a href="#cb387-1773" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> DC <span class="sc">%*%</span> nu</span>
<span id="cb387-1774"><a href="#cb387-1774" aria-hidden="true" tabindex="-1"></a>  phi <span class="ot">&lt;-</span> <span class="fu">diag</span>(phiv, m)</span>
<span id="cb387-1775"><a href="#cb387-1775" aria-hidden="true" tabindex="-1"></a>  L2 <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>deviance</span>
<span id="cb387-1776"><a href="#cb387-1776" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> RCmodel<span class="sc">$</span>df.residual</span>
<span id="cb387-1777"><a href="#cb387-1777" aria-hidden="true" tabindex="-1"></a>  p.value <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(L2,df)</span>
<span id="cb387-1778"><a href="#cb387-1778" aria-hidden="true" tabindex="-1"></a>  fit.freq <span class="ot">&lt;-</span> <span class="fu">predict</span>(RCmodel, </span>
<span id="cb387-1779"><a href="#cb387-1779" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="st">"response"</span>, </span>
<span id="cb387-1780"><a href="#cb387-1780" aria-hidden="true" tabindex="-1"></a>                      <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb387-1781"><a href="#cb387-1781" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb387-1782"><a href="#cb387-1782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">list</span>(<span class="at">model =</span> RCmodel, </span>
<span id="cb387-1783"><a href="#cb387-1783" aria-hidden="true" tabindex="-1"></a>     <span class="at">L2 =</span> L2, </span>
<span id="cb387-1784"><a href="#cb387-1784" aria-hidden="true" tabindex="-1"></a>     <span class="at">df =</span> df,</span>
<span id="cb387-1785"><a href="#cb387-1785" aria-hidden="true" tabindex="-1"></a>     <span class="at">p.value =</span> p.value,</span>
<span id="cb387-1786"><a href="#cb387-1786" aria-hidden="true" tabindex="-1"></a>     <span class="at">obs_freq =</span> <span class="fu">summary</span>(RC2)<span class="sc">$</span>y, </span>
<span id="cb387-1787"><a href="#cb387-1787" aria-hidden="true" tabindex="-1"></a>     <span class="at">fit.freq =</span> fit.freq,</span>
<span id="cb387-1788"><a href="#cb387-1788" aria-hidden="true" tabindex="-1"></a>     <span class="at">phi =</span> phi, </span>
<span id="cb387-1789"><a href="#cb387-1789" aria-hidden="true" tabindex="-1"></a>     <span class="at">mu =</span> mu, </span>
<span id="cb387-1790"><a href="#cb387-1790" aria-hidden="true" tabindex="-1"></a>     <span class="at">nu =</span> nu,</span>
<span id="cb387-1791"><a href="#cb387-1791" aria-hidden="true" tabindex="-1"></a>     <span class="fu">cor</span>(mu) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">3</span>),</span>
<span id="cb387-1792"><a href="#cb387-1792" aria-hidden="true" tabindex="-1"></a>     <span class="fu">cor</span>(nu) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">3</span>)))</span>
<span id="cb387-1793"><a href="#cb387-1793" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb387-1794"><a href="#cb387-1794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1795"><a href="#cb387-1795" aria-hidden="true" tabindex="-1"></a><span class="fu">RCmodel_coef</span>(RC2, <span class="at">row =</span> Educ, <span class="at">col =</span> Occ, <span class="at">m =</span>  <span class="dv">2</span>)</span>
<span id="cb387-1796"><a href="#cb387-1796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1797"><a href="#cb387-1797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1798"><a href="#cb387-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1799"><a href="#cb387-1799" aria-hidden="true" tabindex="-1"></a><span class="in">`logmult`</span>パッケージの<span class="in">`rc`</span>によってRC(2)を推定する．まずは<span class="in">`anoas`</span>で連関分析を行う．表2.6Aと同じ結果になっていることを確認する．正規化だけではなく，次元間制約が課されており，表2.7の結果と一致する．</span>
<span id="cb387-1800"><a href="#cb387-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1801"><a href="#cb387-1801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1804"><a href="#cb387-1804" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1805"><a href="#cb387-1805" aria-hidden="true" tabindex="-1"></a><span class="fu">anoas</span>(tab_2<span class="fl">.3</span>B)</span>
<span id="cb387-1806"><a href="#cb387-1806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb387-1807"><a href="#cb387-1807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1808"><a href="#cb387-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-1811"><a href="#cb387-1811" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb387-1812"><a href="#cb387-1812" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab_2<span class="fl">.3</span>B, </span>
<span id="cb387-1813"><a href="#cb387-1813" aria-hidden="true" tabindex="-1"></a>          <span class="at">nd =</span> <span class="dv">2</span>, </span>
<span id="cb387-1814"><a href="#cb387-1814" aria-hidden="true" tabindex="-1"></a>          <span class="at">weighting =</span> <span class="st">"none"</span>, </span>
<span id="cb387-1815"><a href="#cb387-1815" aria-hidden="true" tabindex="-1"></a>          <span class="at">se =</span> <span class="st">"bootstrap"</span>,</span>
<span id="cb387-1816"><a href="#cb387-1816" aria-hidden="true" tabindex="-1"></a>          <span class="at">nreplicates =</span> <span class="dv">1000</span>, </span>
<span id="cb387-1817"><a href="#cb387-1817" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncpus =</span> <span class="fu">getOption</span>(<span class="st">"boot.ncpus"</span>))</span>
<span id="cb387-1818"><a href="#cb387-1818" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC2)</span>
<span id="cb387-1819"><a href="#cb387-1819" aria-hidden="true" tabindex="-1"></a>RC2 <span class="sc">|&gt;</span> </span>
<span id="cb387-1820"><a href="#cb387-1820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1821"><a href="#cb387-1821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(coefficients) <span class="sc">|&gt;</span></span>
<span id="cb387-1822"><a href="#cb387-1822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb387-1823"><a href="#cb387-1823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"Parameter"</span>) <span class="sc">|&gt;</span></span>
<span id="cb387-1824"><a href="#cb387-1824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Parameter)</span>
<span id="cb387-1825"><a href="#cb387-1825" aria-hidden="true" tabindex="-1"></a><span class="co"># getS3method("assoc","rc")</span></span>
<span id="cb387-1826"><a href="#cb387-1826" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>