<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>『カテゴリカルデータのための連関モデル』 - 補足のノート</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10-R.html" rel="next">
<link href="./8-df.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./9-Note.html">補足のノート</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">『カテゴリカルデータのための連関モデル』</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">はじめに</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">シリーズ編者による内容紹介</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-Chapter_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">第1章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-Chapter_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">第2章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4-Chapter_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">第3章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5-Chapter_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">第4章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6-Chapter_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">第5章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7-Chapter_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">第6章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8-df.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">自由度</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9-Note.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">補足のノート</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RとRStudioのインストールと基本的な操作方法</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#パッケージ" id="toc-パッケージ" class="nav-link active" data-scroll-target="#パッケージ">パッケージ</a></li>
  <li><a href="#クロス表の作成" id="toc-クロス表の作成" class="nav-link" data-scroll-target="#クロス表の作成">クロス表の作成</a></li>
  <li><a href="#集計データの作成" id="toc-集計データの作成" class="nav-link" data-scroll-target="#集計データの作成">集計データの作成</a></li>
  <li><a href="#glmとgnmの結果の比較" id="toc-glmとgnmの結果の比較" class="nav-link" data-scroll-target="#glmとgnmの結果の比較">GLMとGNMの結果の比較</a></li>
  <li><a href="#期待度数" id="toc-期待度数" class="nav-link" data-scroll-target="#期待度数">期待度数</a></li>
  <li><a href="#モザイクプロット" id="toc-モザイクプロット" class="nav-link" data-scroll-target="#モザイクプロット">モザイクプロット</a></li>
  <li><a href="#正規化" id="toc-正規化" class="nav-link" data-scroll-target="#正規化">正規化</a></li>
  <li><a href="#初期値" id="toc-初期値" class="nav-link" data-scroll-target="#初期値">初期値</a></li>
  <li><a href="#位相モデル" id="toc-位相モデル" class="nav-link" data-scroll-target="#位相モデル">位相モデル</a></li>
  <li><a href="#xie" id="toc-xie" class="nav-link" data-scroll-target="#xie">Xie</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">補足のノート</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="パッケージ" class="level2">
<h2 class="anchored" data-anchor-id="パッケージ">パッケージ</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="クロス表の作成" class="level2">
<h2 class="anchored" data-anchor-id="クロス表の作成">クロス表の作成</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>,  <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>,  <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>           <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>           <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>           <span class="dv">21</span>,  <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># byrow = TRUEとすることを忘れずに．</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq, <span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">as.table</span>()</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "A" "B" "C" "D" "E" "F"

[[2]]
[1] "A" "B" "C" "D"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">SES =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MHS =</span> <span class="fu">c</span>(<span class="st">"well"</span>, <span class="st">"mild"</span>, <span class="st">"modelrate"</span>, <span class="st">"impared"</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES well mild modelrate impared
  A   64   94        58      46
  B   57   94        54      40
  C   57  105        65      60
  D   72  141        77      94
  E   36   97        54      78
  F   21   71        54      71</code></pre>
</div>
</div>
</section>
<section id="集計データの作成" class="level2">
<h2 class="anchored" data-anchor-id="集計データの作成">集計データの作成</h2>
<ul>
<li><p>表のデータではなく，各変数の組み合わせとその度数からなるデータを作成する．</p></li>
<li><p>度数はまず1行目について数値を並べ（1行1列から1行<span class="math inline">\(I\)</span>列まで），次に2行目について数値を並べる（2行1列から2行<span class="math inline">\(I\)</span>列まで）．これを<code>Freq</code>とする．</p></li>
<li><p>例として「編者による序文」の親の職業と精神的健康の例で考えてみる．これは<span class="math inline">\(6\times4\)</span>のクロス表なので，まず1行1列から1行4列までの数字を入力し，次に2行1列から2行4列まで入力する．これを3行目から6行目まで繰り返す．表との対応を考えて適当な改行をいれるのもよい．ただしRは改行を入れても入れなくても，単に数値の列（ベクトル）として扱う．</p></li>
<li><p><code>gl</code>によって変数を作成する．度数がどの行と列に対応しているのかに注意してほしい．</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1行1列から1行4列，・・・・，6行1列から6行4列まで順に入力</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>, <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, <span class="dv">57</span>, <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>, <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>, <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>, <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>, <span class="dv">21</span>, <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 表ようにして入力</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>,  <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>,  <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>           <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>           <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>           <span class="dv">21</span>,  <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>行カテゴリと列カテゴリの数は<span class="math inline">\(I\)</span>や<span class="math inline">\(J\)</span>となっている．</li>
<li><code>I</code>を使いたいが，Rの関数にすでに用意されているので別の名前を考える．ここでは<code>NI</code>と<code>NJ</code>とする．</li>
<li>例のデータでは，行カテゴリ数<span class="math inline">\(I = 4\)</span>，列カテゴリ数<span class="math inline">\(J = 5\)</span>である．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>NI <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>NJ <span class="ot">&lt;-</span> <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>では，<code>Freq</code>に対応する行カテゴリと列カテゴリを並べてみる．先程の入力のルールにしたがうと，行については1行1列から1行4列までの数字を入力しているので<code>1,1,1,1</code>となり，次に<code>2,2,2,2</code>となる．これを繰り返し最後は<code>6,6,6,6</code>となる．列については，<code>1,2,3,4</code>が6回繰り返される．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<ul>
<li>属性が数値になっているので<code>as.factor</code>（または<code>factor</code>）で因子（factor）に変換する．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Row)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Col)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row);<span class="fu">class</span>(Col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Row</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 2 2 2 2 3 3 3 3 4 4 4 4 5 5 5 5 6 6 6 6
Levels: 1 2 3 4 5 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Col</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4
Levels: 1 2 3 4</code></pre>
</div>
</div>
<ul>
<li>単純な数値の列を作成したければ<code>rep</code>関数が便利である．これは整数（integer）となる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">20</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Row)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Col)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Row</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 2 2 2 2 2 3 3 3 3 3 4 4 4 4 4
Levels: 1 2 3 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Col</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5
Levels: 1 2 3 4 5</code></pre>
</div>
</div>
<ul>
<li><code>gl</code>はGenerate Factor Levelsという関数で，<code>rep</code>に似ているが，数値ではなく因子を結果として出力する．</li>
<li>1から<code>n</code>までの数字をぞれぞれ<code>k</code>回繰り返して出力する．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">24</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>Row</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 2 2 2 2 3 3 3 3 4 4 4 4 5 5 5 5 6 6 6 6
Levels: 1 2 3 4 5 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>Col</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4
Levels: 1 2 3 4</code></pre>
</div>
</div>
<ul>
<li>以上より，<code>Freq</code>，<code>Row</code>，<code>Col</code>の3つの変数が作成された．これらからなるデータを作成する．<code>data.frame</code>と<code>tibble</code>のどちらでもよいが， <code>tibble</code>の場合は表示させた後に，データの構造（<code>&lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;</code>）が表示される．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Freq, Row, Col)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Freq Row Col
1    64   1   1
2    94   1   2
3    58   1   3
4    46   1   4
5    57   2   1
6    94   2   2
7    54   2   3
8    40   2   4
9    57   3   1
10  105   3   2
11   65   3   3
12   60   3   4
13   72   4   1
14  141   4   2
15   77   4   3
16   94   4   4
17   36   5   1
18   97   5   2
19   54   5   3
20   78   5   4
21   21   6   1
22   71   6   2
23   54   6   3
24   71   6   4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble でもよい</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
    Freq Row   Col  
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
 1    64 1     1    
 2    94 1     2    
 3    58 1     3    
 4    46 1     4    
 5    57 2     1    
 6    94 2     2    
 7    54 2     3    
 8    40 2     4    
 9    57 3     1    
10   105 3     2    
# ℹ 14 more rows</code></pre>
</div>
</div>
<ul>
<li>以上をまとめると次のようになる．本書のプログラム例では<code>gl</code>を使うことが多いのでここで使用方法を覚えておこう．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>, <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, <span class="dv">57</span>, <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>, <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>, <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>, <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>, <span class="dv">21</span>, <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>NI <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>NJ <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> NI, <span class="at">k =</span> NJ, <span class="at">length =</span> NI <span class="sc">*</span> NJ)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> NJ, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> NI <span class="sc">*</span> NJ)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
    Freq Row   Col  
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
 1    64 1     1    
 2    94 1     2    
 3    58 1     3    
 4    46 1     4    
 5    57 1     5    
 6    94 1     6    
 7    54 2     1    
 8    40 2     2    
 9    57 2     3    
10   105 2     4    
# ℹ 14 more rows</code></pre>
</div>
</div>
</section>
<section id="glmとgnmの結果の比較" class="level2">
<h2 class="anchored" data-anchor-id="glmとgnmの結果の比較">GLMとGNMの結果の比較</h2>
<ul>
<li>glmとgnmでは適合度や係数は同じだが，出力されるものが異なる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>fit_gnm <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>fit_glm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = Freq ~ Row + Col, family = poisson, data = d)

Coefficients:
(Intercept)         Row2         Row3         Row4         Col2         Col3  
    4.10604     -0.08065      0.22460     -0.16838      0.36930     -0.13588  
       Col4         Col5         Col6  
    0.25857     -0.14058      0.27738  

Degrees of Freedom: 23 Total (i.e. Null);  15 Residual
Null Deviance:      217.4 
Residual Deviance: 112  AIC: 274.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fit_gnm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Row + Col, family = poisson, data = d)

Coefficients:
(Intercept)         Row2         Row3         Row4         Col2         Col3  
    4.10604     -0.08065      0.22460     -0.16838      0.36930     -0.13588  
       Col4         Col5         Col6  
    0.25857     -0.14058      0.27738  

Deviance:            112.0398 
Pearson chi-squared: 102.2928 
Residual df:         15 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "coefficients"      "residuals"         "fitted.values"    
 [4] "effects"           "R"                 "rank"             
 [7] "qr"                "family"            "linear.predictors"
[10] "deviance"          "aic"               "null.deviance"    
[13] "iter"              "weights"           "prior.weights"    
[16] "df.residual"       "df.null"           "y"                
[19] "converged"         "boundary"          "model"            
[22] "call"              "formula"           "terms"            
[25] "data"              "offset"            "control"          
[28] "method"            "contrasts"         "xlevels"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_gnm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"          "formula"       "terms"         "data"         
 [5] "eliminate"     "ofInterest"    "na.action"     "xlevels"      
 [9] "offset"        "tolerance"     "iterStart"     "iterMax"      
[13] "coefficients"  "residuals"     "fitted.values" "rank"         
[17] "family"        "predictors"    "deviance"      "aic"          
[21] "iter"          "weights"       "prior.weights" "df.residual"  
[25] "y"             "converged"     "constrain"     "constrainTo"  
[29] "x"             "model"        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Freq ~ Row + Col, family = poisson, data = d)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.10604    0.07692  53.378  &lt; 2e-16 ***
Row2        -0.08065    0.07104  -1.135 0.256237    
Row3         0.22460    0.06600   3.403 0.000666 ***
Row4        -0.16838    0.07271  -2.316 0.020573 *  
Col2         0.36930    0.08325   4.436 9.17e-06 ***
Col3        -0.13588    0.09377  -1.449 0.147336    
Col4         0.25857    0.08522   3.034 0.002413 ** 
Col5        -0.14058    0.09389  -1.497 0.134314    
Col6         0.27738    0.08488   3.268 0.001083 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 217.40  on 23  degrees of freedom
Residual deviance: 112.04  on 15  degrees of freedom
AIC: 274.21

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_gnm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Row + Col, family = poisson, data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-5.0571  -0.4520   0.4274   1.1667   3.5712  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.10604    0.07692  53.378  &lt; 2e-16 ***
Row2        -0.08065    0.07104  -1.135 0.256237    
Row3         0.22460    0.06600   3.403 0.000666 ***
Row4        -0.16838    0.07271  -2.316 0.020573 *  
Col2         0.36930    0.08325   4.436 9.17e-06 ***
Col3        -0.13588    0.09377  -1.449 0.147336    
Col4         0.25857    0.08522   3.034 0.002413 ** 
Col5        -0.14058    0.09389  -1.497 0.134314    
Col6         0.27738    0.08488   3.268 0.001083 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 112.04 on 15 degrees of freedom
AIC: 274.21

Number of iterations: 4</code></pre>
</div>
</div>
<ul>
<li>gnmで独立モデルと飽和モデル</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>fit_S <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>モデルの比較は<code>anova</code>で可能．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_S)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: Freq ~ Row + Col
Model 2: Freq ~ Row + Col + Row:Col
  Resid. Df Resid. Dev Df Deviance
1        15     112.04            
2         0       0.00 15   112.04</code></pre>
</div>
</div>
</section>
<section id="期待度数" class="level2">
<h2 class="anchored" data-anchor-id="期待度数">期待度数</h2>
<ul>
<li>期待度数を保存すれば期待度数についてのクロス表を作成することができる．飽和モデルの場合は，観測度数のクロス表と一致する．また独立モデルでの期待度数をみると，行によって列の幅が異なっていない（列によって行の幅がことなっていない）ことがわかる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">O_Freq =</span> fit_O<span class="sc">$</span>fitted.values,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">S_Freq =</span> fit_S<span class="sc">$</span>fitted.values)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> .) <span class="sc">%&gt;%</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="9-Note_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">xtabs</span>(O_Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> .) <span class="sc">%&gt;%</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="9-Note_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">xtabs</span>(S_Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> .) <span class="sc">%&gt;%</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="9-Note_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="モザイクプロット" class="level2">
<h2 class="anchored" data-anchor-id="モザイクプロット">モザイクプロット</h2>
<ul>
<li><code>gnm</code>パッケージには，<code>mentalHealth</code>が用意されているのでこれを使ってみる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>mentalHealth</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   count SES      MHS
1     64   A     well
2     94   A     mild
3     58   A moderate
4     46   A impaired
5     57   B     well
6     94   B     mild
7     54   B moderate
8     40   B impaired
9     57   C     well
10   105   C     mild
11    65   C moderate
12    60   C impaired
13    72   D     well
14   141   D     mild
15    77   D moderate
16    94   D impaired
17    36   E     well
18    97   E     mild
19    54   E moderate
20    78   E impaired
21    21   F     well
22    71   F     mild
23    54   F moderate
24    71   F impaired</code></pre>
</div>
</div>
<ul>
<li><code>xtabs</code>は集計データからクロス表を作成する際に用いる．<code>xtabs(度数 ~ 行変数 + 列変数, data = データ名)</code>とすればよい．<code>mentalHealth</code>では<code>count</code>が度数を示している．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>tab_mentalHealth <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(count <span class="sc">~</span> SES <span class="sc">+</span> MHS, <span class="at">data =</span> mentalHealth)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>tab_mentalHealth</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES well mild moderate impaired
  A   64   94       58       46
  B   57   94       54       40
  C   57  105       65       60
  D   72  141       77       94
  E   36   97       54       78
  F   21   71       54       71</code></pre>
</div>
</div>
<ul>
<li><code>mosaic</code>でモザイクプロットを図示．影をつけたければ<code>shade = TRUE</code>とする．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(tab_mentalHealth,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="9-Note_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>モデル適合度を表示するための関数</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>model.summary <span class="ot">&lt;-</span> <span class="cf">function</span>(obj) {</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  aic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="dv">2</span> <span class="co"># AIC(L2)</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  bic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">sum</span>(obj<span class="sc">$</span>y)) <span class="co">#BIC(L2)</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">&lt;-</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">abs</span>(obj<span class="sc">$</span>y <span class="sc">-</span> obj<span class="sc">$</span>fitted.values)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(obj<span class="sc">$</span>y))</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(obj<span class="sc">$</span>deviance, obj<span class="sc">$</span>df, <span class="at">lower.tail =</span> F)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  Model <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(obj))</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Model Description"</span> <span class="ot">=</span> Model,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"df"</span> <span class="ot">=</span> obj<span class="sc">$</span>df,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"L2"</span> <span class="ot">=</span> obj<span class="sc">$</span>deviance,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"AIC(L2)" = aic,</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BIC"</span> <span class="ot">=</span> bic,</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Delta"</span> <span class="ot">=</span> delta,</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p"</span> <span class="ot">=</span> p</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>変数と係数と係数の順番を表示するための関数</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>var_num <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(model<span class="sc">$</span>coefficients),</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> model<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">number =</span> <span class="fu">row_number</span>())</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="正規化" class="level2">
<h2 class="anchored" data-anchor-id="正規化">正規化</h2>
<ul>
<li>通常のRCモデルでは行スコアと列スコアが正規化されていない．</li>
<li>Agresti (2002)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  Goodman Row-Column association model fits well (deviance 3.57, df 8)</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>mentalHealth<span class="sc">$</span>MHS <span class="ot">&lt;-</span> <span class="fu">C</span>(mentalHealth<span class="sc">$</span>MHS, treatment)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>mentalHealth<span class="sc">$</span>SES <span class="ot">&lt;-</span> <span class="fu">C</span>(mentalHealth<span class="sc">$</span>SES, treatment)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Independent Model</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(count <span class="sc">~</span> SES <span class="sc">+</span> MHS,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> poisson, <span class="at">data =</span> mentalHealth)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Independent Modelの結果を利用して，初期値を設定</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, SES, MHS)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="dv">1</span>, mult1),</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running main iterations..............
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimateには数字があるが，Std. ErrorがNAとなっている．これらのパラメータは識別されていない．</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = count ~ SES + MHS + Mult(1, SES, MHS), family = poisson, 
    data = mentalHealth, start = c(coef(O), 1, mult1))

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.87231  -0.30983   0.01026   0.29898   0.87866  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                  3.97986         NA      NA       NA
SESB                        -0.06671         NA      NA       NA
SESC                         0.05286         NA      NA       NA
SESD                         0.31721         NA      NA       NA
SESE                        -0.13824         NA      NA       NA
SESF                        -0.42641         NA      NA       NA
MHSmild                      0.63608         NA      NA       NA
MHSmoderate                  0.11422         NA      NA       NA
MHSimpaired                  0.09713         NA      NA       NA
Mult(., SES, MHS).           0.56928         NA      NA       NA
Mult(1, ., MHS).SESA        -0.40622         NA      NA       NA
Mult(1, ., MHS).SESB        -0.41074         NA      NA       NA
Mult(1, ., MHS).SESC        -0.03823         NA      NA       NA
Mult(1, ., MHS).SESD         0.15940         NA      NA       NA
Mult(1, ., MHS).SESE         0.64757         NA      NA       NA
Mult(1, ., MHS).SESF         1.04863         NA      NA       NA
Mult(1, SES, .).MHSwell     -0.73506         NA      NA       NA
Mult(1, SES, .).MHSmild      0.17046         NA      NA       NA
Mult(1, SES, .).MHSmoderate  0.33387         NA      NA       NA
Mult(1, SES, .).MHSimpaired  1.08597         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 3.5706 on 8 degrees of freedom
AIC: 179.74

Number of iterations: 14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行スコアと列スコアがどこにあるかを取り出す．</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                    var    estimate number
(Intercept)                                 (Intercept)  3.97986269      1
SESB                                               SESB -0.06671127      2
SESC                                               SESC  0.05286438      3
SESD                                               SESD  0.31721060      4
SESE                                               SESE -0.13824301      5
SESF                                               SESF -0.42641078      6
MHSmild                                         MHSmild  0.63608165      7
MHSmoderate                                 MHSmoderate  0.11422438      8
MHSimpaired                                 MHSimpaired  0.09712562      9
Mult(., SES, MHS).                   Mult(., SES, MHS).  0.56928163     10
Mult(1, ., MHS).SESA               Mult(1, ., MHS).SESA -0.40622196     11
Mult(1, ., MHS).SESB               Mult(1, ., MHS).SESB -0.41074261     12
Mult(1, ., MHS).SESC               Mult(1, ., MHS).SESC -0.03823317     13
Mult(1, ., MHS).SESD               Mult(1, ., MHS).SESD  0.15940228     14
Mult(1, ., MHS).SESE               Mult(1, ., MHS).SESE  0.64756808     15
Mult(1, ., MHS).SESF               Mult(1, ., MHS).SESF  1.04862845     16
Mult(1, SES, .).MHSwell         Mult(1, SES, .).MHSwell -0.73505533     17
Mult(1, SES, .).MHSmild         Mult(1, SES, .).MHSmild  0.17045549     18
Mult(1, SES, .).MHSmoderate Mult(1, SES, .).MHSmoderate  0.33386631     19
Mult(1, SES, .).MHSimpaired Mult(1, SES, .).MHSimpaired  1.08596564     20</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># c(11:16,17:20)</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># getContrastsによって正規化された推定値とその標準誤差を示す．まずは重み付けのない／単位標準化された解を求める．</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>mu_unit <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]SES"</span>),</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> <span class="st">"unit"</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>nu_unit <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]MHS"</span>),</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> <span class="st">"unit"</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化された解を表示</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>mu_unit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Estimate Std. Error
Mult(1, ., MHS).SESA -0.437796539  0.1127343
Mult(1, ., MHS).SESB -0.441250780  0.1141765
Mult(1, ., MHS).SESC -0.156615493  0.1224095
Mult(1, ., MHS).SESD -0.005601809  0.1126574
Mult(1, ., MHS).SESE  0.367406754  0.1240706
Mult(1, ., MHS).SESF  0.673857866  0.0932365</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>nu_unit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               Estimate Std. Error
Mult(1, SES, .).MHSwell     -0.73265426 0.06465622
Mult(1, SES, .).MHSmild     -0.03347418 0.10831242
Mult(1, SES, .).MHSmoderate  0.09270166 0.12250921
Mult(1, SES, .).MHSimpaired  0.67342677 0.07862280</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化制約を確認</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>]), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>]), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span>), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span>), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の制約</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>)], nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)])</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>con</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4377965  0.6738579 -0.7326543  0.6734268</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">20</span>),</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrainTo =</span> con,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = count ~ SES + MHS + Mult(1, SES, MHS), constrain = c(11, 
    16, 17, 20), constrainTo = con, family = poisson, data = mentalHealth, 
    start = c(coef(O), NA, mult1))

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.87231  -0.30983   0.01026   0.29898   0.87866  

Coefficients:
                             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  3.840354   0.100134  38.352  &lt; 2e-16 ***
SESB                        -0.067262   0.089460  -0.752   0.4521    
SESC                         0.097655   0.088726   1.101   0.2711    
SESD                         0.386057   0.087802   4.397 1.10e-05 ***
SESE                        -0.009979   0.110426  -0.090   0.9280    
SESF                        -0.249331   0.133563  -1.867   0.0619 .  
MHSmild                      0.722031   0.096153   7.509 5.95e-14 ***
MHSmoderate                  0.215685   0.108885   1.981   0.0476 *  
MHSimpaired                  0.269974   0.148273   1.821   0.0686 .  
Mult(., SES, MHS).           0.964896   0.191615   5.036 4.76e-07 ***
Mult(1, ., MHS).SESA        -0.437797         NA      NA       NA    
Mult(1, ., MHS).SESB        -0.441251   0.201840  -2.186   0.0288 *  
Mult(1, ., MHS).SESC        -0.156615   0.176666  -0.887   0.3753    
Mult(1, ., MHS).SESD        -0.005602   0.160260  -0.035   0.9721    
Mult(1, ., MHS).SESE         0.367407   0.191566   1.918   0.0551 .  
Mult(1, ., MHS).SESF         0.673858         NA      NA       NA    
Mult(1, SES, .).MHSwell     -0.732654         NA      NA       NA    
Mult(1, SES, .).MHSmild     -0.033474   0.159023  -0.210   0.8333    
Mult(1, SES, .).MHSmoderate  0.092701   0.180220   0.514   0.6070    
Mult(1, SES, .).MHSimpaired  0.673427         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 3.5706 on 8 degrees of freedom
AIC: 179.74

Number of iterations: 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># intrinsic association parameter</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">summary</span>(RC1)<span class="sc">$</span>coefficients[<span class="st">"Mult(., SES, MHS)."</span>, <span class="dv">1</span>]</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> phi <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> phi)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> phi) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> eta <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> eta</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(phi, rho, eta, tau)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.9648955

[[2]]
[1] 0.6080959

[[3]]
[1] 0.5181908

[[4]]
[1] 0.6080959</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(rho, tau)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Marginal weighted solution</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>rowProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(mentalHealth, <span class="fu">tapply</span>(count, SES, sum) <span class="sc">/</span> <span class="fu">sum</span>(count))</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>colProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(mentalHealth, <span class="fu">tapply</span>(count, MHS, sum) <span class="sc">/</span> <span class="fu">sum</span>(count))</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]SES"</span>),</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> rowProbs,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> rowProbs,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> rowProbs</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]MHS"</span>),</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> colProbs,</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> colProbs,</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> colProbs</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>)], nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)])</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>mu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Estimate Std. Error
Mult(1, ., MHS).SESA -1.11233083  0.2990944
Mult(1, ., MHS).SESB -1.12143703  0.3138906
Mult(1, ., MHS).SESC -0.37107606  0.3194546
Mult(1, ., MHS).SESD  0.02702925  0.2734878
Mult(1, ., MHS).SESE  1.01036135  0.3149487
Mult(1, ., MHS).SESF  1.81823312  0.2824636</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>nu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Estimate Std. Error
Mult(1, SES, .).MHSwell     -1.6775144  0.1941179
Mult(1, SES, .).MHSmild     -0.1403989  0.2002803
Mult(1, SES, .).MHSmoderate  0.1369925  0.2799954
Mult(1, SES, .).MHSimpaired  1.4136909  0.1724133</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>con</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.112331  1.818233 -1.677514  1.413691</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化制約を確認</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">*</span> rowProbs), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">*</span> colProbs), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> rowProbs), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> colProbs), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">20</span>),</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrainTo =</span> con,</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth,</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations....................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = count ~ SES + MHS + Mult(1, SES, MHS), constrain = c(11, 
    16, 17, 20), constrainTo = con, family = poisson, data = mentalHealth, 
    start = c(coef(O), NA, mult1), tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.87231  -0.30982   0.01026   0.29898   0.87866  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  3.83919    0.10014  38.338  &lt; 2e-16 ***
SESB                        -0.06736    0.09033  -0.746   0.4558    
SESC                         0.10590    0.08929   1.186   0.2356    
SESD                         0.39873    0.08826   4.517 6.26e-06 ***
SESE                         0.01363    0.11020   0.124   0.9016    
SESF                        -0.21674    0.13232  -1.638   0.1014    
MHSmild                      0.71134    0.09556   7.444 9.77e-14 ***
MHSmoderate                  0.20306    0.10841   1.873   0.0611 .  
MHSimpaired                  0.24846    0.14842   1.674   0.0941 .  
Mult(., SES, MHS).           0.16649    0.03306   5.036 4.76e-07 ***
Mult(1, ., MHS).SESA        -1.11233         NA      NA       NA    
Mult(1, ., MHS).SESB        -1.12144    0.53209  -2.108   0.0351 *  
Mult(1, ., MHS).SESC        -0.37108    0.46573  -0.797   0.4256    
Mult(1, ., MHS).SESD         0.02703    0.42248   0.064   0.9490    
Mult(1, ., MHS).SESE         1.01036    0.50501   2.001   0.0454 *  
Mult(1, ., MHS).SESF         1.81823         NA      NA       NA    
Mult(1, SES, .).MHSwell     -1.67751         NA      NA       NA    
Mult(1, SES, .).MHSmild     -0.14040    0.34961  -0.402   0.6880    
Mult(1, SES, .).MHSmoderate  0.13699    0.39621   0.346   0.7295    
Mult(1, SES, .).MHSimpaired  1.41369         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 3.5706 on 8 degrees of freedom
AIC: 179.74

Number of iterations: 36</code></pre>
</div>
</div>
</section>
<section id="初期値" class="level2">
<h2 class="anchored" data-anchor-id="初期値">初期値</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの準備</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">39</span>, <span class="dv">50</span>, <span class="dv">18</span>,  <span class="dv">4</span>,</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">140</span>,<span class="dv">178</span>, <span class="dv">85</span>, <span class="dv">23</span>,</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>          <span class="dv">108</span>,<span class="dv">195</span>, <span class="dv">97</span>, <span class="dv">23</span>,</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>          <span class="dv">238</span>,<span class="dv">598</span>,<span class="dv">363</span>,<span class="dv">111</span>,</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>           <span class="dv">78</span>,<span class="dv">250</span>,<span class="dv">150</span>, <span class="dv">55</span>,</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>           <span class="dv">50</span>,<span class="dv">200</span>,<span class="dv">208</span>, <span class="dv">74</span>,</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>            <span class="dv">8</span>, <span class="dv">29</span>, <span class="dv">46</span>, <span class="dv">21</span>)</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(Freq,</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">7</span>,</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">as.table</span>()</span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>polviews <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>fefam <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">28</span>)</span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, polviews, fefam)</span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 3
    Freq polviews fefam
   &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;
 1    39 1        1    
 2    50 1        2    
 3    18 1        3    
 4     4 1        4    
 5   140 2        1    
 6   178 2        2    
 7    85 2        3    
 8    23 2        4    
 9   108 3        1    
10   195 3        2    
# ℹ 18 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 独立モデル</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam,</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> freq_tab_2<span class="fl">.3</span>A,</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    var   estimate number
(Intercept) (Intercept)  3.0603480      1
polviews2     polviews2  1.3449091      2
polviews3     polviews3  1.3378420      3
polviews4     polviews4  2.4682522      4
polviews5     polviews5  1.5689912      5
polviews6     polviews6  1.5671133      6
polviews7     polviews7 -0.0651393      7
fefam2           fefam2  0.8194665      8
fefam3           fefam3  0.3804447      9
fefam4           fefam4 -0.7539609     10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam),</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations............................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                    var     estimate number
(Intercept)                                 (Intercept)  2.902702351      1
polviews2                                     polviews2  1.390548385      2
polviews3                                     polviews3  1.427149259      3
polviews4                                     polviews4  2.586614669      4
polviews5                                     polviews5  1.686005670      5
polviews6                                     polviews6  1.625948840      6
polviews7                                     polviews7 -0.114101970      7
fefam2                                           fefam2  0.889280567      8
fefam3                                           fefam3  0.414411068      9
fefam4                                           fefam4 -0.767263370     10
Mult(., polviews, fefam).     Mult(., polviews, fefam).  0.354847803     11
Mult(1, ., fefam).polviews1 Mult(1, ., fefam).polviews1 -4.642973707     12
Mult(1, ., fefam).polviews2 Mult(1, ., fefam).polviews2 -3.587221083     13
Mult(1, ., fefam).polviews3 Mult(1, ., fefam).polviews3 -2.177313145     14
Mult(1, ., fefam).polviews4 Mult(1, ., fefam).polviews4 -0.001967735     15
Mult(1, ., fefam).polviews5 Mult(1, ., fefam).polviews5  0.933577004     16
Mult(1, ., fefam).polviews6 Mult(1, ., fefam).polviews6  3.992993578     17
Mult(1, ., fefam).polviews7 Mult(1, ., fefam).polviews7  6.608154586     18
Mult(1, polviews, .).fefam1 Mult(1, polviews, .).fefam1 -0.468986131     19
Mult(1, polviews, .).fefam2 Mult(1, polviews, .).fefam2 -0.061831609     20
Mult(1, polviews, .).fefam3 Mult(1, polviews, .).fefam3  0.255547101     21
Mult(1, polviews, .).fefam4 Mult(1, polviews, .).fefam4  0.406103105     22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>mult2 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam, <span class="at">d =</span> <span class="dv">2</span>)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>mult3 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam, <span class="at">d =</span> <span class="dv">3</span>)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam),</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam), 
    family = poisson, data = ., start = c(coef(O), NA, mult1), 
    tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07428  -0.27239   0.03038   0.36792   1.03721  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                  2.97067         NA      NA       NA
polviews2                    1.38106         NA      NA       NA
polviews3                    1.40499         NA      NA       NA
polviews4                    2.54490         NA      NA       NA
polviews5                    1.63588         NA      NA       NA
polviews6                    1.54832         NA      NA       NA
polviews7                   -0.21523         NA      NA       NA
fefam2                       0.86521         NA      NA       NA
fefam3                       0.37157         NA      NA       NA
fefam4                      -0.81900         NA      NA       NA
Mult(., polviews, fefam).    0.11476         NA      NA       NA
Mult(1, ., fefam).polviews1 -2.23657         NA      NA       NA
Mult(1, ., fefam).polviews2 -1.70908         NA      NA       NA
Mult(1, ., fefam).polviews3 -1.00463         NA      NA       NA
Mult(1, ., fefam).polviews4  0.08226         NA      NA       NA
Mult(1, ., fefam).polviews5  0.54970         NA      NA       NA
Mult(1, ., fefam).polviews6  2.07831         NA      NA       NA
Mult(1, ., fefam).polviews7  3.38495         NA      NA       NA
Mult(1, polviews, .).fefam1 -2.74560         NA      NA       NA
Mult(1, polviews, .).fefam2 -0.22589         NA      NA       NA
Mult(1, polviews, .).fefam3  1.73823         NA      NA       NA
Mult(1, polviews, .).fefam4  2.66996         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 8.0718 on 10 degrees of freedom
AIC: 215.43

Number of iterations: 27</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">2</span>),</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult2[, <span class="dv">1</span>], <span class="cn">NA</span>, mult2[, <span class="dv">2</span>]),</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
..............
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam, 
    inst = 1) + Mult(1, polviews, fefam, inst = 2), family = poisson, 
    data = ., start = c(coef(O), NA, mult2[, 1], NA, mult2[, 
        2]), tolerance = 1e-12)

Deviance Residuals: 
      Min         1Q     Median         3Q        Max  
-0.500439  -0.068726  -0.002705   0.066147   0.535693  

Coefficients:
                                       Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                            2.993287         NA      NA       NA
polviews2                              1.436412         NA      NA       NA
polviews3                              1.398908         NA      NA       NA
polviews4                              2.518065         NA      NA       NA
polviews5                              1.564082         NA      NA       NA
polviews6                              1.534299         NA      NA       NA
polviews7                             -0.133562         NA      NA       NA
fefam2                                 0.814972         NA      NA       NA
fefam3                                 0.369393         NA      NA       NA
fefam4                                -0.825633         NA      NA       NA
Mult(., polviews, fefam, inst = 1).    0.111566         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews1 -2.370011         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews2 -1.718197         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews3 -1.055282         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews4  0.094489         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews5  0.651356         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews6  2.082776         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews7  3.020457         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam1 -2.548941         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam2 -0.333340         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam3  1.824525         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam4  2.789907         NA      NA       NA
Mult(., polviews, fefam, inst = 2).    0.064972         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews1 -0.129058         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews2  1.061518         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews3 -0.214994         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews4 -0.595091         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews5 -1.469833         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews6 -0.267529         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews7  1.608264         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam1  0.298457         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam2 -1.828478         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam3  0.195655         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam4  0.002679         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 1.3691 on 4 degrees of freedom
AIC: 220.72

Number of iterations: 71</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>RC3 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">3</span>),</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult3[, <span class="dv">1</span>], <span class="cn">NA</span>, mult3[, <span class="dv">2</span>], <span class="cn">NA</span>, mult3[, <span class="dv">3</span>]),</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations......
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam, 
    inst = 1) + Mult(1, polviews, fefam, inst = 2) + Mult(1, 
    polviews, fefam, inst = 3), family = poisson, data = ., start = c(coef(O), 
    NA, mult3[, 1], NA, mult3[, 2], NA, mult3[, 3]), tolerance = 1e-12)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
     0       0       0       0       0  

Coefficients:
                                      Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                            2.98832         NA      NA       NA
polviews2                              1.45668         NA      NA       NA
polviews3                              1.38302         NA      NA       NA
polviews4                              2.52059         NA      NA       NA
polviews5                              1.58491         NA      NA       NA
polviews6                              1.51818         NA      NA       NA
polviews7                             -0.10812         NA      NA       NA
fefam2                                 0.81254         NA      NA       NA
fefam3                                 0.35325         NA      NA       NA
fefam4                                -0.80539         NA      NA       NA
Mult(., polviews, fefam, inst = 1).    0.11105         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews1 -2.36488         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews2 -1.70985         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews3 -1.02644         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews4  0.10832         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews5  0.61151         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews6  2.15910         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews7  2.95936         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam1 -2.41740         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam2 -0.28415         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam3  2.05381         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam4  2.43636         NA      NA       NA
Mult(., polviews, fefam, inst = 2).    0.06452         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews1 -0.12647         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews2  1.13121         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews3 -0.29985         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews4 -0.60482         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews5 -1.37958         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews6 -0.41755         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews7  1.74634         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam1  0.38993         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam2 -1.83914         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam3  0.21225         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam4 -0.11423         NA      NA       NA
Mult(., polviews, fefam, inst = 3).    0.05616         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews1  2.23238         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews2  0.46917         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews3  2.19320         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews4  0.39281         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews5 -0.90419         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews6 -0.22218         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews7 -2.57455         NA      NA       NA
Mult(1, polviews, ., inst = 3).fefam1  0.34732         NA      NA       NA
Mult(1, polviews, ., inst = 3).fefam2  0.17172         NA      NA       NA
Mult(1, polviews, ., inst = 3).fefam3  0.71728         NA      NA       NA
Mult(1, polviews, ., inst = 3).fefam4 -1.25788         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 2.1316e-14 on 0 degrees of freedom
AIC: 227.35

Number of iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'logmult'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:vcd':

    assoc</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:gnm':

    se</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>anoas_model <span class="ot">&lt;-</span> <span class="fu">anoas</span>(tab_2<span class="fl">.3</span>A, <span class="at">nd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting independence model...
Fitting model with 1 dimension...
Initialising
Running start-up iterations..
Running main iterations........
Done
Fitting model with 2 dimensions...
Initialising
Running start-up iterations..
Running main iterations...............................
Done
Fitting model with 3 dimensions...
Initialising
Running start-up iterations..
Running main iterations...
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>anoas_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Res. Df           Res. Dev    Dev./Indep. (%)     Dissim. (%)
Indep.      18 211.69508974175693 100.00000000000000 8.0917102896466
RC(1)       10   8.07181892814987   3.81294575041705 1.7673079267546
RC(2)        4   1.36909098846090   0.64672779615769 0.4963921430961
RC(3)        0   0.00000000000009   0.00000000000004 0.0000000000002
                      BIC                AIC Dev. Df
Indep.  65.12224155397615 175.69508974175693   NA NA
RC(1)  -73.35754117617279 -11.92818107185013 -204 -8
RC(2)  -31.20265305326816  -6.63090901153910   -7 -6
RC(3)    0.00000000000009   0.00000000000009   -1 -4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anoas_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Res. Df           Res. Dev    Dev./Indep. (%)     Dissim. (%)
Indep.      18 211.69508974175693 100.00000000000000 8.0917102896466
RC(1)       10   8.07181892814987   3.81294575041705 1.7673079267546
RC(2)        4   1.36909098846090   0.64672779615769 0.4963921430961
RC(3)        0   0.00000000000009   0.00000000000004 0.0000000000002
                      BIC                AIC Dev. Df
Indep.  65.12224155397615 175.69508974175693   NA NA
RC(1)  -73.35754117617279 -11.92818107185013 -204 -8
RC(2)  -31.20265305326816  -6.63090901153910   -7 -6
RC(3)    0.00000000000009   0.00000000000009   -1 -4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, <span class="at">d =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Levels are not identical, new factor will be based on sorted combined levels.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........
Done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in matrix(pickCoef(model, "Diag\\(", value = TRUE), 1, nrow(tab)): data
length [4] is not a sub-multiple or multiple of the number of columns [7]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rownames(tab) == colnames(tab): longer object length is not a
multiple of shorter object length</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab_2.3A, diagonal = 3)

Intrinsic association coefficients:
 Dim1 
0.259 

Normalized row scores (Rows):
      A       B       C       D       E       F       G 
 1.4876  1.3963  1.1207 -0.0203 -0.3155 -1.4779 -2.4334 

Normalized column scores (Columns):
     A      B      C      D 
 1.475  0.354 -1.077 -1.492 

Diagonal coefficients:
    A:A     B:B     C:C     D:D     E:A     F:B     G:C 
 0.2586 -0.2981  0.2310 -0.0498  0.2586 -0.2981  0.2310 

Normalization weights: marginal
Deviance:              3.191348
Pearson chi-squared:   3.221668
Dissimilarity index:   0.9476085%
Residual df:           6
BIC:                   -45.66627
AIC:                   -8.808652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model.summary</span>(O),</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC),</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC2),</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  `Model Description`    df       L2       BIC    Delta     p
  &lt;chr&gt;               &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 O                      18 2.12e+ 2  6.51e+ 1 8.09e+ 0 1    
2 RC                     10 8.07e+ 0 -7.34e+ 1 1.77e+ 0 0.378
3 RC2                     4 1.37e+ 0 -3.12e+ 1 4.96e- 1 0.150
4 RC3                     0 2.13e-14  2.13e-14 3.29e-14 1    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 表2.3B</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">518</span>,  <span class="dv">95</span>, <span class="dv">6</span>, <span class="dv">35</span>, <span class="dv">5</span>,</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>         　 <span class="dv">81</span>,  <span class="dv">67</span>, <span class="dv">4</span>, <span class="dv">49</span>, <span class="dv">2</span>,</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>          <span class="dv">452</span>,<span class="dv">1003</span>,<span class="dv">67</span>,<span class="dv">630</span>, <span class="dv">5</span>,</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>           <span class="dv">71</span>, <span class="dv">157</span>,<span class="dv">37</span>,<span class="dv">562</span>,<span class="dv">12</span>)</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(Freq,</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">5</span>,</span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">as.table</span>()</span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     A    B    C    D    E
A  518   95    6   35    5
B   81   67    4   49    2
C  452 1003   67  630    5
D   71  157   37  562   12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる集計データを作成</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>Educ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>Occ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">20</span>)</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Educ, Occ)</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
    Freq Educ  Occ  
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
 1   518 1     1    
 2    95 1     2    
 3     6 1     3    
 4    35 1     4    
 5     5 1     5    
 6    81 2     1    
 7    67 2     2    
 8     4 2     3    
 9    49 2     4    
10     2 2     5    
11   452 3     1    
12  1003 3     2    
13    67 3     3    
14   630 3     4    
15     5 3     5    
16    71 4     1    
17   157 4     2    
18    37 4     3    
19   562 4     4    
20    12 4     5    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ,</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> poisson,</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> freq_tab_2<span class="fl">.3</span>B,</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ)</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>mult2 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ, <span class="at">d =</span> <span class="dv">2</span>)</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>mult3 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ, <span class="at">d =</span> <span class="dv">3</span>)</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        var    estimate number
(Intercept)                     (Intercept)  4.84228734      1
Educ2                                 Educ2 -0.83267338      2
Educ3                                 Educ3  1.44242350      3
Educ4                                 Educ4 -0.18953286      4
Occ2                                   Occ2  0.47811221      5
Occ3                                   Occ3 -2.08212145      6
Occ4                                   Occ4  0.15944538      7
Occ5                                   Occ5 -3.57932338      8
Mult(., Educ, Occ).     Mult(., Educ, Occ). -8.94312189      9
Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ1 -0.93109262     10
Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ2 -0.20019786     11
Mult(1, ., Occ).Educ3 Mult(1, ., Occ).Educ3  0.03703327     12
Mult(1, ., Occ).Educ4 Mult(1, ., Occ).Educ4  0.65249407     13
Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ1  0.16481820     14
Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ2 -0.04958694     15
Mult(1, Educ, .).Occ3 Mult(1, Educ, .).Occ3 -0.16515958     16
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ4 -0.25122571     17
Mult(1, Educ, .).Occ5 Mult(1, Educ, .).Occ5 -0.11995114     18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="dv">10</span>, mult1),</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running main iterations.........................................................
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
...........................................
Done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in gnmFit(modelTools = modelTools, y = y, constrain = constrain, : Fitting algorithm has either not converged or converged
to a non-solution of the likelihood equations.
Use exitInfo() for numerical details of last iteration.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ), <span class="dv">2</span>),</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#      start = c(coef(O), NA, mult2[,1], NA, mult2[,2]),</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations....................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>RC2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + instances(Mult(1, Educ, Occ), 
    2), family = poisson, data = ., tolerance = 1e-12)

Coefficients:
                    (Intercept)                            Educ2  
                        5.08611                         -0.94740  
                          Educ3                            Educ4  
                        1.02546                          0.15018  
                           Occ2                             Occ3  
                        0.41826                         -2.08862  
                           Occ4                             Occ5  
                        0.19014                         -3.99813  
  Mult(., Educ, Occ, inst = 1).  Mult(1, ., Occ, inst = 1).Educ1  
                       11.88745                          0.66539  
Mult(1, ., Occ, inst = 1).Educ2  Mult(1, ., Occ, inst = 1).Educ3  
                        0.18460                         -0.08627  
Mult(1, ., Occ, inst = 1).Educ4  Mult(1, Educ, ., inst = 1).Occ1  
                       -0.24059                          0.16592  
Mult(1, Educ, ., inst = 1).Occ2  Mult(1, Educ, ., inst = 1).Occ3  
                       -0.08774                         -0.16440  
Mult(1, Educ, ., inst = 1).Occ4  Mult(1, Educ, ., inst = 1).Occ5  
                       -0.22670                          0.02076  
  Mult(., Educ, Occ, inst = 2).  Mult(1, ., Occ, inst = 2).Educ1  
                       -0.15456                         -5.97628  
Mult(1, ., Occ, inst = 2).Educ2  Mult(1, ., Occ, inst = 2).Educ3  
                       -4.15107                          6.90477  
Mult(1, ., Occ, inst = 2).Educ4  Mult(1, Educ, ., inst = 2).Occ1  
                      -20.09459                         -0.16109  
Mult(1, Educ, ., inst = 2).Occ2  Mult(1, Educ, ., inst = 2).Occ3  
                       -0.27298                         -0.00488  
Mult(1, Educ, ., inst = 2).Occ4  Mult(1, Educ, ., inst = 2).Occ5  
                        0.08269                          0.42296  

Deviance:            0.6001022 
Pearson chi-squared: 0.5746549 
Residual df:         2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>RC3 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ), <span class="dv">3</span>),</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult3[, <span class="dv">1</span>], <span class="cn">NA</span>, mult3[, <span class="dv">2</span>], <span class="cn">NA</span>, mult3[, <span class="dv">3</span>]),</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>RC3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + instances(Mult(1, Educ, Occ), 
    3), family = poisson, data = ., start = c(coef(O), NA, mult3[, 
    1], NA, mult3[, 2], NA, mult3[, 3]), tolerance = 1e-12)

Coefficients:
                    (Intercept)                            Educ2  
                        5.00954                         -0.87996  
                          Educ3                            Educ4  
                        1.68258                          0.48092  
                           Occ2                             Occ3  
                       -0.01525                         -2.58552  
                           Occ4                             Occ5  
                       -0.02533                         -3.31838  
  Mult(., Educ, Occ, inst = 1).  Mult(1, ., Occ, inst = 1).Educ1  
                        0.07208                          4.63786  
Mult(1, ., Occ, inst = 1).Educ2  Mult(1, ., Occ, inst = 1).Educ3  
                        0.76266                         -0.82670  
Mult(1, ., Occ, inst = 1).Educ4  Mult(1, Educ, ., inst = 1).Occ1  
                       -3.35522                          4.30716  
Mult(1, Educ, ., inst = 1).Occ2  Mult(1, Educ, ., inst = 1).Occ3  
                       -0.57739                         -2.16415  
Mult(1, Educ, ., inst = 1).Occ4  Mult(1, Educ, ., inst = 1).Occ5  
                       -3.78893                          0.57256  
  Mult(., Educ, Occ, inst = 2).  Mult(1, ., Occ, inst = 2).Educ1  
                        0.04059                          0.70169  
Mult(1, ., Occ, inst = 2).Educ2  Mult(1, ., Occ, inst = 2).Educ3  
                       -0.65745                         -2.69986  
Mult(1, ., Occ, inst = 2).Educ4  Mult(1, Educ, ., inst = 2).Occ1  
                        2.75298                          0.28440  
Mult(1, Educ, ., inst = 2).Occ2  Mult(1, Educ, ., inst = 2).Occ3  
                       -3.65169                          1.06085  
Mult(1, Educ, ., inst = 2).Occ4  Mult(1, Educ, ., inst = 2).Occ5  
                        1.46992                          9.01638  
  Mult(., Educ, Occ, inst = 3).  Mult(1, ., Occ, inst = 3).Educ1  
                        0.15450                         -1.04824  
Mult(1, ., Occ, inst = 3).Educ2  Mult(1, ., Occ, inst = 3).Educ3  
                        0.18021                         -1.46765  
Mult(1, ., Occ, inst = 3).Educ4  Mult(1, Educ, ., inst = 3).Occ1  
                       -1.10038                          1.28157  
Mult(1, Educ, ., inst = 3).Occ2  Mult(1, Educ, ., inst = 3).Occ3  
                        0.88525                         -0.37664  
Mult(1, Educ, ., inst = 3).Occ4  Mult(1, Educ, ., inst = 3).Occ5  
                        1.26016                          3.27226  

Deviance:            -1.223466e-13 
Pearson chi-squared: 2.455628e-27 
Residual df:         0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model.summary</span>(O),</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC),</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC2),</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  `Model Description`    df        L2       BIC    Delta     p
  &lt;chr&gt;               &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 O                      12  1.37e+ 3  1.27e+ 3 2.39e+ 1 1    
2 RC                      6  1.66e+ 4  1.66e+ 4 3.12e+ 0 1    
3 RC2                     2  6.00e- 1 -1.59e+ 1 9.35e- 2 0.259
4 RC3                     0 -1.22e-13 -1.22e-13 3.45e-14 0    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>anoas_model <span class="ot">&lt;-</span> <span class="fu">anoas</span>(tab_2<span class="fl">.3</span>B, <span class="at">nd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting independence model...
Fitting model with 1 dimension...
Initialising
Running start-up iterations..
Running main iterations.........................................................
..
Done
Fitting model with 2 dimensions...
Initialising
Running start-up iterations..
Running main iterations..........
Done
Fitting model with 3 dimensions...
Initialising
Running start-up iterations..
Running main iterations....
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>anoas_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Res. Df            Res. Dev     Dev./Indep. (%)   Dissim. (%)
Indep.      12 1373.17576565224545 100.000000000000000 23.8615752953
RC(1)        6  125.05974855014668   9.107337289101114  6.4360390984
RC(2)        2    0.60010223526821   0.043701778772885  0.0935165803
RC(3)        0   -0.00000000000007  -0.000000000000005  0.0000000003
                       BIC                 AIC    Dev. Df
Indep. 1274.08091533065726 1349.17576565224545      NA NA
RC(1)    75.51232338935264  113.05974855014668 -1248.1 -6
RC(2)   -15.91570615166313   -3.39989776473179  -124.5 -4
RC(3)    -0.00000000000007   -0.00000000000007    -0.6 -2</code></pre>
</div>
</div>
</section>
<section id="位相モデル" class="level2">
<h2 class="anchored" data-anchor-id="位相モデル">位相モデル</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>occupationalStatus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      destination
origin   1   2   3   4   5   6   7   8
     1  50  19  26   8   7  11   6   2
     2  16  40  34  18  11  20   8   3
     3  12  35  65  66  35  88  23  21
     4  11  20  58 110  40 183  64  32
     5   2   8  12  23  25  46  28  12
     6  12  28 102 162  90 554 230 177
     7   0   6  19  40  21 158 143  71
     8   0   3  14  32  15 126  91 106</code></pre>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(occupationalStatus)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="sc">%&lt;&gt;%</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> destination, origin, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rscore =</span> <span class="fu">scale</span>(<span class="fu">as.numeric</span>(origin), <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cscore =</span> <span class="fu">scale</span>(<span class="fu">as.numeric</span>(destination), <span class="at">scale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span></span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination, <span class="at">family =</span> poisson, <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>fit_QI <span class="ot">&lt;-</span></span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag,</span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>fit_U <span class="ot">&lt;-</span></span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a>fit_QI_U <span class="ot">&lt;-</span></span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a>fit_S <span class="ot">&lt;-</span></span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> origin<span class="sc">:</span>destination,</span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="sc">%&lt;&gt;%</span></span>
<span id="cb181-29"><a href="#cb181-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb181-30"><a href="#cb181-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag1 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb181-31"><a href="#cb181-31" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb181-32"><a href="#cb181-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag2 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span></span>
<span id="cb181-33"><a href="#cb181-33" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb181-34"><a href="#cb181-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag3 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span></span>
<span id="cb181-35"><a href="#cb181-35" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb181-36"><a href="#cb181-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag4 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span></span>
<span id="cb181-37"><a href="#cb181-37" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb181-38"><a href="#cb181-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag5 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span></span>
<span id="cb181-39"><a href="#cb181-39" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb181-40"><a href="#cb181-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag6 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span></span>
<span id="cb181-41"><a href="#cb181-41" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb181-42"><a href="#cb181-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag7 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">7</span> <span class="sc">&amp;</span></span>
<span id="cb181-43"><a href="#cb181-43" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb181-44"><a href="#cb181-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag8 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">8</span> <span class="sc">&amp;</span></span>
<span id="cb181-45"><a href="#cb181-45" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb181-46"><a href="#cb181-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb181-47"><a href="#cb181-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-48"><a href="#cb181-48" aria-hidden="true" tabindex="-1"></a>fit_QI2 <span class="ot">&lt;-</span></span>
<span id="cb181-49"><a href="#cb181-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb181-50"><a href="#cb181-50" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag1 <span class="sc">+</span> diag2 <span class="sc">+</span> diag3 <span class="sc">+</span> diag4 <span class="sc">+</span> diag5 <span class="sc">+</span> diag6 <span class="sc">+</span> diag7 <span class="sc">+</span> diag8,</span>
<span id="cb181-51"><a href="#cb181-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb181-52"><a href="#cb181-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> freq_occupationalStatus</span>
<span id="cb181-53"><a href="#cb181-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb181-54"><a href="#cb181-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-55"><a href="#cb181-55" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_QI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ origin + destination + diag, family = poisson, 
    data = freq_occupationalStatus)

Deviance Residuals: 
       Min          1Q      Median          3Q         Max  
-4.567e+00  -2.318e+00  -1.045e-07   1.018e+00   6.152e+00  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   0.36346    0.17892   2.031 0.042211 *  
origin2       0.35445    0.14755   2.402 0.016292 *  
origin3       1.34923    0.12758  10.575  &lt; 2e-16 ***
origin4       1.76957    0.12322  14.362  &lt; 2e-16 ***
origin5       0.56615    0.14257   3.971 7.16e-05 ***
origin6       2.72612    0.11933  22.845  &lt; 2e-16 ***
origin7       1.54999    0.12619  12.283  &lt; 2e-16 ***
origin8       1.37488    0.12757  10.777  &lt; 2e-16 ***
destination2  0.82044    0.16521   4.966 6.83e-07 ***
destination3  1.69007    0.15065  11.219  &lt; 2e-16 ***
destination4  2.02648    0.14771  13.719  &lt; 2e-16 ***
destination5  1.43966    0.15317   9.399  &lt; 2e-16 ***
destination6  2.96856    0.14439  20.559  &lt; 2e-16 ***
destination7  2.24512    0.14547  15.434  &lt; 2e-16 ***
destination8  1.87534    0.14855  12.624  &lt; 2e-16 ***
diag1         3.54857    0.22806  15.560  &lt; 2e-16 ***
diag2         2.15053    0.20737  10.370  &lt; 2e-16 ***
diag3         0.77163    0.15275   5.052 4.38e-07 ***
diag4         0.54098    0.12287   4.403 1.07e-05 ***
diag5         0.84961    0.22965   3.700 0.000216 ***
diag6         0.25903    0.07531   3.439 0.000583 ***
diag7         0.80428    0.11438   7.031 2.04e-12 ***
diag8         1.04976    0.12946   8.109  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 446.84 on 41 degrees of freedom
AIC: 815.18

Number of iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_QI2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ origin + destination + diag1 + diag2 + diag3 + 
    diag4 + diag5 + diag6 + diag7 + diag8, family = poisson, 
    data = freq_occupationalStatus)

Deviance Residuals: 
       Min          1Q      Median          3Q         Max  
-4.567e+00  -2.318e+00  -1.045e-07   1.018e+00   6.152e+00  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   0.36346    0.17892   2.031 0.042211 *  
origin2       0.35445    0.14755   2.402 0.016292 *  
origin3       1.34923    0.12758  10.575  &lt; 2e-16 ***
origin4       1.76957    0.12322  14.362  &lt; 2e-16 ***
origin5       0.56615    0.14257   3.971 7.16e-05 ***
origin6       2.72612    0.11933  22.845  &lt; 2e-16 ***
origin7       1.54999    0.12619  12.283  &lt; 2e-16 ***
origin8       1.37488    0.12757  10.777  &lt; 2e-16 ***
destination2  0.82044    0.16521   4.966 6.83e-07 ***
destination3  1.69007    0.15065  11.219  &lt; 2e-16 ***
destination4  2.02648    0.14771  13.719  &lt; 2e-16 ***
destination5  1.43966    0.15317   9.399  &lt; 2e-16 ***
destination6  2.96856    0.14439  20.559  &lt; 2e-16 ***
destination7  2.24512    0.14547  15.434  &lt; 2e-16 ***
destination8  1.87534    0.14855  12.624  &lt; 2e-16 ***
diag11        3.54857    0.22806  15.560  &lt; 2e-16 ***
diag21        2.15053    0.20737  10.370  &lt; 2e-16 ***
diag31        0.77163    0.15275   5.052 4.38e-07 ***
diag41        0.54098    0.12287   4.403 1.07e-05 ***
diag51        0.84961    0.22965   3.700 0.000216 ***
diag61        0.25903    0.07531   3.439 0.000583 ***
diag71        0.80428    0.11438   7.031 2.04e-12 ***
diag81        1.04976    0.12946   8.109  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 446.84 on 41 degrees of freedom
AIC: 815.18

Number of iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_QI, fit_U, fit_QI_U, fit_S)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: Freq ~ origin + destination
Model 2: Freq ~ origin + destination + diag
Model 3: Freq ~ origin + destination + Rscore:Cscore
Model 4: Freq ~ origin + destination + diag + Rscore:Cscore
Model 5: Freq ~ origin + destination + origin:destination
  Resid. Df Resid. Dev Df Deviance
1        49     954.49            
2        41     446.84  8   507.65
3        48     164.33 -7   282.51
4        40      58.44  8   105.89
5         0       0.00 40    58.44</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_O),</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_QI),</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_U),</span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_QI_U),</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_S)</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  `Model Description`    df      L2      BIC    Delta     p
  &lt;chr&gt;               &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 fit_O                  49 9.54e+2  5.55e+2 1.66e+ 1 1    
2 fit_QI                 41 4.47e+2  1.12e+2 1.00e+ 1 1    
3 fit_U                  48 1.64e+2 -2.27e+2 7.26e+ 0 1.00 
4 fit_QI_U               40 5.84e+1 -2.68e+2 3.53e+ 0 0.970
5 fit_S                   0 4.50e-8  4.50e-8 3.22e-10 1    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(erikson)</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>erikson</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , country = EW

      destination
origin    I   II  III  IVa  IVb  IVc V/VI VIIa VIIb
  I     311  130   79   24   22    7   70   44    1
  II    161  128   66   22   11    6  112   47    1
  III   128  109   89   26   25    3  197  113    4
  IVa    88   83   43   72   41    5  112   64    4
  IVb    36   45   38   27   47    3  110   80    4
  IVc    43   23   25   16   14   99   86   81   40
  V/VI  356  375  325  108  140    5 1506  839   22
  VIIa  150  180  187   48   74    9  802  685   15
  VIIb   12   14   18    5   18   10   96  114   56

, , country = F

      destination
origin    I   II  III  IVa  IVb  IVc V/VI VIIa VIIb
  I     105   72   19    9    8    3   26   11    1
  II     59  113   37    9   14    0   54   34    2
  III    40   86   64   10   20    4  103   61    4
  IVa    38   37   17   38   23    2   36   22    1
  IVb    40   68   55   38   95   10   92   74    7
  IVc    27   74   77   27   52  461  156  286   73
  V/VI   36  138   93   22   38    5  339  189    9
  VIIa   22   88   79   18   24    8  235  209   11
  VIIb    4   18   26    9   14   19   68  107   47

, , country = S

      destination
origin    I   II  III  IVa  IVb  IVc V/VI VIIa VIIb
  I      52   15   13    3    2    0   11    7    0
  II     30   27   14    3    4    0   27   12    2
  III    10   19   10    2    4    0   16   11    1
  IVa    26   24    5   20    8    1   33   22    0
  IVb     8   13    6    3    9    4   31   20    1
  IVc    24   47   44   17   22   92  132  144   21
  V/VI   33   89   40   13   18    5  188  104    5
  VIIa   32   49   28   14   17    5  159  109    4
  VIIb    5   10    3    0    6    3   33   42    8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$origin
[1] "I"    "II"   "III"  "IVa"  "IVb"  "IVc"  "V/VI" "VIIa" "VIIb"

$destination
[1] "I"    "II"   "III"  "IVa"  "IVb"  "IVc"  "V/VI" "VIIa" "VIIb"

$country
[1] "EW" "F"  "S" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)<span class="sc">$</span>origin <span class="ot">&lt;-</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"I+II"</span>,<span class="st">"I+II"</span>,<span class="st">"III"</span>,<span class="st">"IVab"</span>,<span class="st">"IVab"</span>,<span class="st">"IVc"</span>,<span class="st">"V/VI"</span>,<span class="st">"VIIa"</span>,<span class="st">"VIIb"</span>)</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)<span class="sc">$</span>destination <span class="ot">&lt;-</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"I+II"</span>,<span class="st">"I+II"</span>,<span class="st">"III"</span>,<span class="st">"IVab"</span>,<span class="st">"IVab"</span>,<span class="st">"IVc"</span>,<span class="st">"V/VI"</span>,<span class="st">"VIIa"</span>,<span class="st">"VIIb"</span>)</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>freq_erikson <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(erikson)</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>erikson2 <span class="ot">&lt;-</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xtabs</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country, <span class="at">data =</span> freq_erikson)</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>freq_erikson <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(erikson2)</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>levelMatrix <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">6</span>,</span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>,</span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>,</span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">2</span>,</span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,</span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">5</span>,</span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(freq_erikson, <span class="at">levelMatrix =</span> levelMatrix)</span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-19"><a href="#cb193-19" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span></span>
<span id="cb193-20"><a href="#cb193-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb193-21"><a href="#cb193-21" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span> origin <span class="sc">*</span> country <span class="sc">+</span></span>
<span id="cb193-22"><a href="#cb193-22" aria-hidden="true" tabindex="-1"></a>      destination <span class="sc">*</span> country,</span>
<span id="cb193-23"><a href="#cb193-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb193-24"><a href="#cb193-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d</span>
<span id="cb193-25"><a href="#cb193-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb193-26"><a href="#cb193-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-27"><a href="#cb193-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-28"><a href="#cb193-28" aria-hidden="true" tabindex="-1"></a>fit_Common <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb193-29"><a href="#cb193-29" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span></span>
<span id="cb193-30"><a href="#cb193-30" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> country <span class="sc">+</span> destination <span class="sc">*</span> country <span class="sc">+</span></span>
<span id="cb193-31"><a href="#cb193-31" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> destination,</span>
<span id="cb193-32"><a href="#cb193-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb193-33"><a href="#cb193-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb193-34"><a href="#cb193-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb193-35"><a href="#cb193-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-36"><a href="#cb193-36" aria-hidden="true" tabindex="-1"></a>fit_Common_Pattern <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb193-37"><a href="#cb193-37" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span></span>
<span id="cb193-38"><a href="#cb193-38" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> country <span class="sc">+</span> destination <span class="sc">*</span> country <span class="sc">+</span> levelMatrix,</span>
<span id="cb193-39"><a href="#cb193-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb193-40"><a href="#cb193-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb193-41"><a href="#cb193-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb193-42"><a href="#cb193-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-43"><a href="#cb193-43" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb193-44"><a href="#cb193-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred1 =</span> fit_O<span class="sc">$</span>fitted.values,</span>
<span id="cb193-45"><a href="#cb193-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred2 =</span> fit_Common<span class="sc">$</span>fitted.values,</span>
<span id="cb193-46"><a href="#cb193-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred3 =</span> fit_Common_Pattern<span class="sc">$</span>fitted.values</span>
<span id="cb193-47"><a href="#cb193-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb193-48"><a href="#cb193-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-49"><a href="#cb193-49" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ origin + destination + country + origin * 
    country + destination * country, family = poisson, data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-12.763   -3.562   -1.393    1.767   22.208  

Coefficients:
                         Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)               5.74389    0.03348 171.575  &lt; 2e-16 ***
originIII                -0.58201    0.04739 -12.281  &lt; 2e-16 ***
originIVab               -0.31986    0.04375  -7.312 2.64e-13 ***
originIVc                -1.06769    0.05610 -19.032  &lt; 2e-16 ***
originV/VI                1.08510    0.03282  33.062  &lt; 2e-16 ***
originVIIa                0.54874    0.03564  15.397  &lt; 2e-16 ***
originVIIb               -1.28675    0.06100 -21.095  &lt; 2e-16 ***
destinationIII           -1.00300    0.03964 -25.305  &lt; 2e-16 ***
destinationIVab          -1.16484    0.04211 -27.664  &lt; 2e-16 ***
destinationIVc           -2.78106    0.08498 -32.724  &lt; 2e-16 ***
destinationV/VI           0.26476    0.02730   9.699  &lt; 2e-16 ***
destinationVIIa          -0.13764    0.03009  -4.574 4.78e-06 ***
destinationVIIb          -2.78106    0.08500 -32.720  &lt; 2e-16 ***
countryF                 -0.88695    0.05988 -14.811  &lt; 2e-16 ***
countryS                 -1.74777    0.08424 -20.747  &lt; 2e-16 ***
originIII:countryF        0.19716    0.08083   2.439 0.014718 *  
originIVab:countryF       0.50479    0.07136   7.073 1.51e-12 ***
originIVc:countryF        1.82879    0.07546  24.235  &lt; 2e-16 ***
originV/VI:countryF      -0.67387    0.06296 -10.703  &lt; 2e-16 ***
originVIIa:countryF      -0.36238    0.06669  -5.434 5.51e-08 ***
originVIIb:countryF       0.67364    0.09307   7.238 4.55e-13 ***
originIII:countryS       -0.53021    0.14300  -3.708 0.000209 ***
originIVab:countryS       0.37251    0.10340   3.603 0.000315 ***
originIVc:countryS        1.96213    0.09743  20.138  &lt; 2e-16 ***
originV/VI:countryS      -0.28322    0.08719  -3.248 0.001161 ** 
originVIIa:countryS       0.08166    0.09040   0.903 0.366354    
originVIIb:countryS       0.58455    0.13159   4.442 8.90e-06 ***
destinationIII:countryF   0.17859    0.06820   2.619 0.008827 ** 
destinationIVab:countryF  0.34258    0.06963   4.920 8.66e-07 ***
destinationIVc:countryF   2.04865    0.10057  20.370  &lt; 2e-16 ***
destinationV/VI:countryF -0.22428    0.05085  -4.411 1.03e-05 ***
destinationVIIa:countryF  0.06764    0.05340   1.267 0.205290    
destinationVIIb:countryF  0.85375    0.12089   7.062 1.64e-12 ***
destinationIII:countryS  -0.14353    0.09826  -1.461 0.144099    
destinationIVab:countryS  0.03051    0.09891   0.308 0.757741    
destinationIVc:countryS   1.24126    0.13514   9.185  &lt; 2e-16 ***
destinationV/VI:countryS -0.05932    0.06543  -0.907 0.364667    
destinationVIIa:countryS  0.05222    0.07055   0.740 0.459234    
destinationVIIb:countryS  0.27845    0.18161   1.533 0.125225    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 4860 on 108 degrees of freedom
AIC: 5752.1

Number of iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_Common)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"          "formula"       "terms"         "data"         
 [5] "eliminate"     "ofInterest"    "na.action"     "xlevels"      
 [9] "offset"        "tolerance"     "iterStart"     "iterMax"      
[13] "coefficients"  "residuals"     "fitted.values" "rank"         
[17] "family"        "predictors"    "deviance"      "aic"          
[21] "iter"          "weights"       "prior.weights" "df.residual"  
[25] "y"             "converged"     "constrain"     "constrainTo"  
[29] "x"             "model"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">summary</span>(fit_Common))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"           "ofInterest"     "family"         "deviance"      
 [5] "aic"            "df.residual"    "iter"           "deviance.resid"
 [9] "coefficients"   "eliminated"     "dispersion"     "df"            
[13] "cov.scaled"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_Common)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ origin + destination + country + origin * 
    country + destination * country + origin * destination, family = poisson, 
    data = d)

Deviance Residuals: 
      Min         1Q     Median         3Q        Max  
-2.894368  -0.493141  -0.001321   0.470201   2.903940  

Coefficients:
                           Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                 6.59629    0.03453 191.003  &lt; 2e-16 ***
originIII                  -1.13823    0.06560 -17.351  &lt; 2e-16 ***
originIVab                 -1.07370    0.06143 -17.479  &lt; 2e-16 ***
originIVc                  -2.70361    0.09016 -29.987  &lt; 2e-16 ***
originV/VI                  0.01007    0.04703   0.214 0.830527    
originVIIa                 -0.77338    0.05726 -13.507  &lt; 2e-16 ***
originVIIb                 -3.26650    0.13781 -23.702  &lt; 2e-16 ***
destinationIII             -1.69227    0.07692 -22.001  &lt; 2e-16 ***
destinationIVab            -2.25353    0.09612 -23.445  &lt; 2e-16 ***
destinationIVc             -4.55452    0.25826 -17.635  &lt; 2e-16 ***
destinationV/VI            -1.34800    0.06703 -20.112  &lt; 2e-16 ***
destinationVIIa            -2.03630    0.08773 -23.212  &lt; 2e-16 ***
destinationVIIb            -5.12499    0.38197 -13.417  &lt; 2e-16 ***
countryF                   -0.79371    0.05423 -14.637  &lt; 2e-16 ***
countryS                   -1.65837    0.07661 -21.646  &lt; 2e-16 ***
originIII:countryF          0.20390    0.08179   2.493 0.012668 *  
originIVab:countryF         0.48071    0.07350   6.540 6.15e-11 ***
originIVc:countryF          1.61954    0.08393  19.295  &lt; 2e-16 ***
originV/VI:countryF        -0.64330    0.06586  -9.767  &lt; 2e-16 ***
originVIIa:countryF        -0.33935    0.07019  -4.835 1.33e-06 ***
originVIIb:countryF         0.64616    0.09861   6.553 5.65e-11 ***
originIII:countryS         -0.49402    0.14390  -3.433 0.000597 ***
originIVab:countryS         0.42215    0.10589   3.987 6.70e-05 ***
originIVc:countryS          2.10894    0.10644  19.814  &lt; 2e-16 ***
originV/VI:countryS        -0.23466    0.09102  -2.578 0.009934 ** 
originVIIa:countryS         0.14235    0.09505   1.498 0.134221    
originVIIb:countryS         0.72346    0.13754   5.260 1.44e-07 ***
destinationIII:countryF     0.17483    0.07130   2.452 0.014209 *  
destinationIVab:countryF    0.18250    0.07402   2.465 0.013684 *  
destinationIVc:countryF     0.73972    0.11572   6.392 1.64e-10 ***
destinationV/VI:countryF   -0.11294    0.05496  -2.055 0.039884 *  
destinationVIIa:countryF    0.02129    0.05885   0.362 0.717449    
destinationVIIb:countryF    0.11636    0.13452   0.865 0.387023    
destinationIII:countryS    -0.22236    0.10142  -2.192 0.028352 *  
destinationIVab:countryS   -0.17172    0.10342  -1.660 0.096839 .  
destinationIVc:countryS    -0.38697    0.15155  -2.553 0.010668 *  
destinationV/VI:countryS   -0.09561    0.07021  -1.362 0.173263    
destinationVIIa:countryS   -0.17583    0.07672  -2.292 0.021913 *  
destinationVIIb:countryS   -0.64986    0.19498  -3.333 0.000859 ***
originIII:destinationIII    0.76642    0.11807   6.491 8.52e-11 ***
originIVab:destinationIII   0.52595    0.11560   4.550 5.37e-06 ***
originIVc:destinationIII    1.17849    0.13041   9.037  &lt; 2e-16 ***
originV/VI:destinationIII   0.87374    0.09195   9.502  &lt; 2e-16 ***
originVIIa:destinationIII   1.10866    0.10285  10.779  &lt; 2e-16 ***
originVIIb:destinationIII   1.36163    0.20619   6.604 4.01e-11 ***
originIII:destinationIVab   0.69419    0.15016   4.623 3.78e-06 ***
originIVab:destinationIVab  2.02108    0.11352  17.804  &lt; 2e-16 ***
originIVc:destinationIVab   1.73618    0.14216  12.213  &lt; 2e-16 ***
originV/VI:destinationIVab  1.12813    0.11169  10.101  &lt; 2e-16 ***
originVIIa:destinationIVab  1.25162    0.12471  10.036  &lt; 2e-16 ***
originVIIb:destinationIVab  2.01369    0.20909   9.631  &lt; 2e-16 ***
originIII:destinationIVc    0.23560    0.45713   0.515 0.606273    
originIVab:destinationIVc   1.24669    0.32500   3.836 0.000125 ***
originIVc:destinationIVc    5.21749    0.26575  19.633  &lt; 2e-16 ***
originV/VI:destinationIVc   0.18607    0.36231   0.514 0.607553    
originVIIa:destinationIVc   1.22166    0.33304   3.668 0.000244 ***
originVIIb:destinationIVc   3.56730    0.33324  10.705  &lt; 2e-16 ***
originIII:destinationV/VI   1.17516    0.09949  11.812  &lt; 2e-16 ***
originIVab:destinationV/VI  1.20044    0.09270  12.950  &lt; 2e-16 ***
originIVc:destinationV/VI   1.88309    0.10710  17.582  &lt; 2e-16 ***
originV/VI:destinationV/VI  2.05945    0.07524  27.372  &lt; 2e-16 ***
originVIIa:destinationV/VI  2.21492    0.08327  26.601  &lt; 2e-16 ***
originVIIb:destinationV/VI  2.54647    0.15871  16.045  &lt; 2e-16 ***
originIII:destinationVIIa   1.28947    0.12352  10.440  &lt; 2e-16 ***
originIVab:destinationVIIa  1.46717    0.11334  12.944  &lt; 2e-16 ***
originIVc:destinationVIIa   2.84331    0.11806  24.084  &lt; 2e-16 ***
originV/VI:destinationVIIa  2.14755    0.09583  22.410  &lt; 2e-16 ***
originVIIa:destinationVIIa  2.70994    0.10109  26.807  &lt; 2e-16 ***
originVIIb:destinationVIIa  3.48535    0.16446  21.193  &lt; 2e-16 ***
originIII:destinationVIIb   1.34327    0.50723   2.648 0.008091 ** 
originIVab:destinationVIIb  1.75599    0.45232   3.882 0.000104 ***
originIVc:destinationVIIb   4.65198    0.39743  11.705  &lt; 2e-16 ***
originV/VI:destinationVIIb  1.80532    0.41541   4.346 1.39e-05 ***
originVIIa:destinationVIIb  2.31365    0.42297   5.470 4.50e-08 ***
originVIIb:destinationVIIb  5.72803    0.41103  13.936  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 121.3 on 72 degrees of freedom
AIC: 1085.4

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_Common_Pattern, fit_Common)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: Freq ~ origin + destination + country + origin:country + destination:country
Model 2: Freq ~ origin + destination + country + origin:country + destination:country + 
    levelMatrix
Model 3: Freq ~ origin + destination + country + origin:country + destination:country + 
    origin:destination
  Resid. Df Resid. Dev Df Deviance
1       108     4860.0            
2       103      505.6  5   4354.4
3        72      121.3 31    384.3</code></pre>
</div>
</div>
</section>
<section id="xie" class="level2">
<h2 class="anchored" data-anchor-id="xie">Xie</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">6</span>, <span class="dv">26</span>, <span class="dv">11</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">23</span>, <span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">16</span>)</span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col)</span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span></span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Row + Col + Mult(1, Row, Col), family = poisson, 
    data = d)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.51267  -0.25916  -0.03574   0.25369   0.66120  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)            2.26787         NA      NA       NA
Row2                  -0.11845         NA      NA       NA
Row3                   0.60428         NA      NA       NA
Row4                   0.15022         NA      NA       NA
Col2                  -0.53064         NA      NA       NA
Col3                  -1.15468         NA      NA       NA
Col4                  -0.79274         NA      NA       NA
Mult(., Row, Col).   -13.05260         NA      NA       NA
Mult(1, ., Col).Row1   0.46488         NA      NA       NA
Mult(1, ., Col).Row2   0.36051         NA      NA       NA
Mult(1, ., Col).Row3  -0.21228         NA      NA       NA
Mult(1, ., Col).Row4  -0.46968         NA      NA       NA
Mult(1, Row, .).Col1   0.12239         NA      NA       NA
Mult(1, Row, .).Col2   0.06808         NA      NA       NA
Mult(1, Row, .).Col3  -0.20718         NA      NA       NA
Mult(1, Row, .).Col4  -0.13544         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 1.7442 on 4 degrees of freedom
AIC: 84.814

Number of iterations: 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>rowProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(d, <span class="fu">tapply</span>(Freq, Row, sum) <span class="sc">/</span> <span class="fu">sum</span>(Freq))</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>colProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(d, <span class="fu">tapply</span>(Freq, Col, sum) <span class="sc">/</span> <span class="fu">sum</span>(Freq))</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pickCoef</span>(fit, <span class="st">"[.]Row"</span>),</span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> rowProbs,</span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> rowProbs,</span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> rowProbs</span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pickCoef</span>(fit, <span class="st">"[.]Col"</span>),</span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> colProbs,</span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> colProbs,</span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> colProbs</span>
<span id="cb207-16"><a href="#cb207-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb207-17"><a href="#cb207-17" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span></span>
<span id="cb207-18"><a href="#cb207-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb207-19"><a href="#cb207-19" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb207-20"><a href="#cb207-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb207-21"><a href="#cb207-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d,</span>
<span id="cb207-22"><a href="#cb207-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">constrain =</span> <span class="dv">9</span><span class="sc">:</span><span class="dv">16</span>,</span>
<span id="cb207-23"><a href="#cb207-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">constrainTo =</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>])</span>
<span id="cb207-24"><a href="#cb207-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running main iterations
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>mu_score <span class="ot">&lt;-</span> <span class="fu">rep</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="at">each =</span> <span class="dv">4</span>)</span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>nu_score <span class="ot">&lt;-</span> <span class="fu">rep</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="dv">4</span>)</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">mu =</span> mu_score,</span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">nu =</span> nu_score)</span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Canonical correlation</span></span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wCorr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wCorr v1.9.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(d, <span class="fu">weightedCorr</span>(mu, <span class="at">x =</span> nu, <span class="at">weights =</span> Freq, <span class="at">method=</span><span class="st">"polychoric"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5602552</code></pre>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Row + Col + Mult(1, Row, Col), constrain = 9:16, 
    constrainTo = c(mu$qvframe[, 1], -1 * nu$qvframe[, 1]), family = poisson, 
    data = d)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.51267  -0.25916  -0.03574   0.25369   0.66120  

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)            2.2730     0.2679   8.484  &lt; 2e-16 ***
Row2                  -0.1064     0.2823  -0.377 0.706328    
Row3                   0.6827     0.2698   2.530 0.011397 *  
Row4                   0.2584     0.2844   0.908 0.363656    
Col2                  -0.5588     0.2278  -2.454 0.014141 *  
Col3                  -1.3258     0.3082  -4.301 1.70e-05 ***
Col4                  -0.9266     0.2677  -3.462 0.000536 ***
Mult(., Row, Col).     0.6577     0.1127   5.836 5.35e-09 ***
Mult(1, ., Col).Row1   1.3355         NA      NA       NA    
Mult(1, ., Col).Row2   1.0593         NA      NA       NA    
Mult(1, ., Col).Row3  -0.4565         NA      NA       NA    
Mult(1, ., Col).Row4  -1.1376         NA      NA       NA    
Mult(1, Row, .).Col1  -0.8514         NA      NA       NA    
Mult(1, Row, .).Col2  -0.4441         NA      NA       NA    
Mult(1, Row, .).Col3   1.6203         NA      NA       NA    
Mult(1, Row, .).Col4   1.0823         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 1.7442 on 8 degrees of freedom
AIC: 76.814

Number of iterations: 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> fit<span class="sc">$</span>coefficients[<span class="st">"Mult(., Row, Col)."</span>] <span class="sc">%&gt;%</span> <span class="fu">abs</span>()</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> phi <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> phi)</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> phi) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> eta <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> eta</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>mu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Estimate Std. Error
Mult(1, ., Col).Row1  1.3354658  0.1909635
Mult(1, ., Col).Row2  1.0592605  0.2590555
Mult(1, ., Col).Row3 -0.4564888  0.2467937
Mult(1, ., Col).Row4 -1.1376491  0.2191522</code></pre>
</div>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>nu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Estimate Std. Error
Mult(1, Row, .).Col1  0.8513968  0.1194283
Mult(1, Row, .).Col2  0.4440776  0.2763713
Mult(1, Row, .).Col3 -1.6203060  0.2558555
Mult(1, Row, .).Col4 -1.0822644  0.2870932</code></pre>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>phi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(., Row, Col). 
         0.6576832 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>rho</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(., Row, Col). 
         0.4959289 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>tau</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(., Row, Col). 
         0.4959289 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>delta_mu <span class="ot">&lt;-</span> <span class="fu">abs</span>((<span class="sc">-</span><span class="fl">1.3354658</span> <span class="sc">-</span> <span class="fl">1.1376491</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">4</span>))</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>delta_nu <span class="ot">&lt;-</span> <span class="fu">abs</span>((<span class="sc">-</span><span class="fl">0.8513968</span> <span class="sc">-</span> <span class="fl">1.0822644</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">4</span>))</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>tau <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> delta_mu <span class="sc">/</span> <span class="dv">12</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> delta_nu <span class="sc">/</span> <span class="dv">12</span>)) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(., Row, Col). 
         0.5282781 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq,</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>rc2 <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab,</span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">nd =</span> <span class="dv">1</span>,</span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">weighting =</span> <span class="st">"marginal"</span>,</span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">se =</span> <span class="st">"bootstrap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........
Done
Computing bootstrap standard errors...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: parallel</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in jackboot(se, ncpus, nreplicates, tab, model, assoc1 =
getS3method("assoc", : 3 model replicates failed and their results will be
skipped. Standard errors will not be completely accurate. Consider raising the
value of iterMax.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rc2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab, nd = 1, weighting = "marginal", se = "bootstrap")

Deviance Residuals:
    Columns
Rows         A         B         C         D
   A   0.18575  -0.40583  -0.21673   0.32921
   B  -0.38647   0.66120   0.30497  -0.51267
   C   0.23692  -0.44850  -0.07819   0.21153
   D  -0.15877   0.30399   0.00672  -0.14657

Association coefficients:
               Normalized  Adjusted  Std. error   Pr(&gt;|z|)     
Dim1              0.65768        NA      0.2664  0.0135689  *  
Dim1:RowsA        1.33547   1.08303      0.2484  7.561e-08  ***
Dim1:RowsB        1.05926   0.85904      0.3122  0.0006924  ***
Dim1:RowsC       -0.45649  -0.37020      0.2653  0.0852820  .  
Dim1:RowsD       -1.13765  -0.92261      0.2762  3.801e-05  ***
Dim1:ColumnsA    -0.85140  -0.69046      0.1389  8.915e-10  ***
Dim1:ColumnsB    -0.44408  -0.36014      0.3212  0.1667834     
Dim1:ColumnsC     1.62031   1.31403      0.3316  1.029e-06  ***
Dim1:ColumnsD     1.08226   0.87769      0.3666  0.0031545  ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Normalization weights: marginal
Deviance:              1.744218
Pearson chi-squared:   1.760665
Dissimilarity index:   4.670712%
Residual df:           4
BIC:                   -17.87688
AIC:                   -6.255782</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assoc</span>(rc2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$phi
          Dim1
[1,] 0.6576832

$row
, , 1

        Dim1
A  1.3354659
B  1.0592602
C -0.4564886
D -1.1376492


$col
, , 1

        Dim1
A -0.8513968
B -0.4440776
C  1.6203060
D  1.0822643


$diagonal
numeric(0)

$weighting
[1] "marginal"

$row.weights
  [,1]
A   29
B   23
C   46
D   37

$col.weights
  [,1]
A   58
B   30
C   22
D   25

$vars
[1] "Rows"    "Columns"

attr(,"class")
[1] "assoc.rc" "assoc"   </code></pre>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./8-df.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">自由度</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10-R.html" class="pagination-link">
        <span class="nav-page-text">RとRStudioのインストールと基本的な操作方法</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb236" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># 補足のノート {-}</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## パッケージ</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## クロス表の作成</span></span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>,  <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, </span>
<span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>,  <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>,</span>
<span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>,</span>
<span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a>           <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>,</span>
<span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a>           <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>,</span>
<span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a>           <span class="dv">21</span>,  <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb236-29"><a href="#cb236-29" aria-hidden="true" tabindex="-1"></a><span class="co"># byrow = TRUEとすることを忘れずに．</span></span>
<span id="cb236-30"><a href="#cb236-30" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq, <span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">as.table</span>()</span>
<span id="cb236-31"><a href="#cb236-31" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab)</span>
<span id="cb236-32"><a href="#cb236-32" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">SES =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb236-33"><a href="#cb236-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MHS =</span> <span class="fu">c</span>(<span class="st">"well"</span>, <span class="st">"mild"</span>, <span class="st">"modelrate"</span>, <span class="st">"impared"</span>))</span>
<span id="cb236-34"><a href="#cb236-34" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb236-35"><a href="#cb236-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-36"><a href="#cb236-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-37"><a href="#cb236-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-38"><a href="#cb236-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-39"><a href="#cb236-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## 集計データの作成</span></span>
<span id="cb236-40"><a href="#cb236-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>表のデータではなく，各変数の組み合わせとその度数からなるデータを作成する．</span>
<span id="cb236-41"><a href="#cb236-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>度数はまず1行目について数値を並べ（1行1列から1行$I$列まで），次に2行目について数値を並べる（2行1列から2行$I$列まで）．これを<span class="in">`Freq`</span>とする．</span>
<span id="cb236-42"><a href="#cb236-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>例として「編者による序文」の親の職業と精神的健康の例で考えてみる．これは$6\times4$のクロス表なので，まず1行1列から1行4列までの数字を入力し，次に2行1列から2行4列まで入力する．これを3行目から6行目まで繰り返す．表との対応を考えて適当な改行をいれるのもよい．ただしRは改行を入れても入れなくても，単に数値の列（ベクトル）として扱う．</span>
<span id="cb236-43"><a href="#cb236-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-44"><a href="#cb236-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`gl`</span>によって変数を作成する．度数がどの行と列に対応しているのかに注意してほしい．</span>
<span id="cb236-45"><a href="#cb236-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-46"><a href="#cb236-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-49"><a href="#cb236-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-50"><a href="#cb236-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 1行1列から1行4列，・・・・，6行1列から6行4列まで順に入力</span></span>
<span id="cb236-51"><a href="#cb236-51" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>, <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, <span class="dv">57</span>, <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>, <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>, <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>, <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>, <span class="dv">21</span>, <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb236-52"><a href="#cb236-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-53"><a href="#cb236-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 表ようにして入力</span></span>
<span id="cb236-54"><a href="#cb236-54" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>,  <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, </span>
<span id="cb236-55"><a href="#cb236-55" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>,  <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>,</span>
<span id="cb236-56"><a href="#cb236-56" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>,</span>
<span id="cb236-57"><a href="#cb236-57" aria-hidden="true" tabindex="-1"></a>           <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>,</span>
<span id="cb236-58"><a href="#cb236-58" aria-hidden="true" tabindex="-1"></a>           <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>,</span>
<span id="cb236-59"><a href="#cb236-59" aria-hidden="true" tabindex="-1"></a>           <span class="dv">21</span>,  <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb236-60"><a href="#cb236-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-61"><a href="#cb236-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-62"><a href="#cb236-62" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>行カテゴリと列カテゴリの数は$I$や$J$となっている．</span>
<span id="cb236-63"><a href="#cb236-63" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`I`</span>を使いたいが，Rの関数にすでに用意されているので別の名前を考える．ここでは<span class="in">`NI`</span>と<span class="in">`NJ`</span>とする．</span>
<span id="cb236-64"><a href="#cb236-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>例のデータでは，行カテゴリ数$I = 4$，列カテゴリ数$J = 5$である．</span>
<span id="cb236-65"><a href="#cb236-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-68"><a href="#cb236-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-69"><a href="#cb236-69" aria-hidden="true" tabindex="-1"></a>NI <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb236-70"><a href="#cb236-70" aria-hidden="true" tabindex="-1"></a>NJ <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb236-71"><a href="#cb236-71" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-72"><a href="#cb236-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-73"><a href="#cb236-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-74"><a href="#cb236-74" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>では，<span class="in">`Freq`</span>に対応する行カテゴリと列カテゴリを並べてみる．先程の入力のルールにしたがうと，行については1行1列から1行4列までの数字を入力しているので<span class="in">`1,1,1,1`</span>となり，次に<span class="in">`2,2,2,2`</span>となる．これを繰り返し最後は<span class="in">`6,6,6,6`</span>となる．列については，<span class="in">`1,2,3,4`</span>が6回繰り返される．</span>
<span id="cb236-75"><a href="#cb236-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-78"><a href="#cb236-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-79"><a href="#cb236-79" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>)</span>
<span id="cb236-80"><a href="#cb236-80" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb236-81"><a href="#cb236-81" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span>
<span id="cb236-82"><a href="#cb236-82" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span>
<span id="cb236-83"><a href="#cb236-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-84"><a href="#cb236-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-85"><a href="#cb236-85" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>属性が数値になっているので<span class="in">`as.factor`</span>（または<span class="in">`factor`</span>）で因子（factor）に変換する．</span>
<span id="cb236-86"><a href="#cb236-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-89"><a href="#cb236-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-90"><a href="#cb236-90" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Row)</span>
<span id="cb236-91"><a href="#cb236-91" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Col)</span>
<span id="cb236-92"><a href="#cb236-92" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row);<span class="fu">class</span>(Col)</span>
<span id="cb236-93"><a href="#cb236-93" aria-hidden="true" tabindex="-1"></a>Row</span>
<span id="cb236-94"><a href="#cb236-94" aria-hidden="true" tabindex="-1"></a>Col</span>
<span id="cb236-95"><a href="#cb236-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-96"><a href="#cb236-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-97"><a href="#cb236-97" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>単純な数値の列を作成したければ<span class="in">`rep`</span>関数が便利である．これは整数（integer）となる．</span>
<span id="cb236-98"><a href="#cb236-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-101"><a href="#cb236-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-102"><a href="#cb236-102" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb236-103"><a href="#cb236-103" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">20</span>)</span>
<span id="cb236-104"><a href="#cb236-104" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span>
<span id="cb236-105"><a href="#cb236-105" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span>
<span id="cb236-106"><a href="#cb236-106" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Row)</span>
<span id="cb236-107"><a href="#cb236-107" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Col)</span>
<span id="cb236-108"><a href="#cb236-108" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span>
<span id="cb236-109"><a href="#cb236-109" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span>
<span id="cb236-110"><a href="#cb236-110" aria-hidden="true" tabindex="-1"></a>Row</span>
<span id="cb236-111"><a href="#cb236-111" aria-hidden="true" tabindex="-1"></a>Col</span>
<span id="cb236-112"><a href="#cb236-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-113"><a href="#cb236-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-114"><a href="#cb236-114" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`gl`</span>はGenerate Factor Levelsという関数で，<span class="in">`rep`</span>に似ているが，数値ではなく因子を結果として出力する．</span>
<span id="cb236-115"><a href="#cb236-115" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>1から<span class="in">`n`</span>までの数字をぞれぞれ<span class="in">`k`</span>回繰り返して出力する．</span>
<span id="cb236-116"><a href="#cb236-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-119"><a href="#cb236-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-120"><a href="#cb236-120" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb236-121"><a href="#cb236-121" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">24</span>)</span>
<span id="cb236-122"><a href="#cb236-122" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span>
<span id="cb236-123"><a href="#cb236-123" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span>
<span id="cb236-124"><a href="#cb236-124" aria-hidden="true" tabindex="-1"></a>Row</span>
<span id="cb236-125"><a href="#cb236-125" aria-hidden="true" tabindex="-1"></a>Col</span>
<span id="cb236-126"><a href="#cb236-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-127"><a href="#cb236-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-128"><a href="#cb236-128" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>以上より，<span class="in">`Freq`</span>，<span class="in">`Row`</span>，<span class="in">`Col`</span>の3つの変数が作成された．これらからなるデータを作成する．<span class="in">`data.frame`</span>と<span class="in">`tibble`</span>のどちらでもよいが，</span>
<span id="cb236-129"><a href="#cb236-129" aria-hidden="true" tabindex="-1"></a><span class="in">`tibble`</span>の場合は表示させた後に，データの構造（<span class="in">`&lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;`</span>）が表示される．</span>
<span id="cb236-130"><a href="#cb236-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-133"><a href="#cb236-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-134"><a href="#cb236-134" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Freq, Row, Col)</span>
<span id="cb236-135"><a href="#cb236-135" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb236-136"><a href="#cb236-136" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble でもよい</span></span>
<span id="cb236-137"><a href="#cb236-137" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col)</span>
<span id="cb236-138"><a href="#cb236-138" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb236-139"><a href="#cb236-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-140"><a href="#cb236-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-141"><a href="#cb236-141" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>以上をまとめると次のようになる．本書のプログラム例では<span class="in">`gl`</span>を使うことが多いのでここで使用方法を覚えておこう．</span>
<span id="cb236-142"><a href="#cb236-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-145"><a href="#cb236-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-146"><a href="#cb236-146" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>, <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, <span class="dv">57</span>, <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>, <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>, <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>, <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>, <span class="dv">21</span>, <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb236-147"><a href="#cb236-147" aria-hidden="true" tabindex="-1"></a>NI <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb236-148"><a href="#cb236-148" aria-hidden="true" tabindex="-1"></a>NJ <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb236-149"><a href="#cb236-149" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> NI, <span class="at">k =</span> NJ, <span class="at">length =</span> NI <span class="sc">*</span> NJ)</span>
<span id="cb236-150"><a href="#cb236-150" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> NJ, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> NI <span class="sc">*</span> NJ)</span>
<span id="cb236-151"><a href="#cb236-151" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col)</span>
<span id="cb236-152"><a href="#cb236-152" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb236-153"><a href="#cb236-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-154"><a href="#cb236-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-155"><a href="#cb236-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-156"><a href="#cb236-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-157"><a href="#cb236-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-158"><a href="#cb236-158" aria-hidden="true" tabindex="-1"></a><span class="fu">## GLMとGNMの結果の比較</span></span>
<span id="cb236-159"><a href="#cb236-159" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>glmとgnmでは適合度や係数は同じだが，出力されるものが異なる．</span>
<span id="cb236-160"><a href="#cb236-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-163"><a href="#cb236-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-164"><a href="#cb236-164" aria-hidden="true" tabindex="-1"></a>fit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb236-165"><a href="#cb236-165" aria-hidden="true" tabindex="-1"></a>fit_gnm <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb236-166"><a href="#cb236-166" aria-hidden="true" tabindex="-1"></a>fit_glm</span>
<span id="cb236-167"><a href="#cb236-167" aria-hidden="true" tabindex="-1"></a>fit_gnm</span>
<span id="cb236-168"><a href="#cb236-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-169"><a href="#cb236-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-170"><a href="#cb236-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-173"><a href="#cb236-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-174"><a href="#cb236-174" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_glm)</span>
<span id="cb236-175"><a href="#cb236-175" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_gnm)</span>
<span id="cb236-176"><a href="#cb236-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-177"><a href="#cb236-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-180"><a href="#cb236-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-181"><a href="#cb236-181" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_glm)</span>
<span id="cb236-182"><a href="#cb236-182" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_gnm)</span>
<span id="cb236-183"><a href="#cb236-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-184"><a href="#cb236-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-185"><a href="#cb236-185" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>gnmで独立モデルと飽和モデル</span>
<span id="cb236-186"><a href="#cb236-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-189"><a href="#cb236-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-190"><a href="#cb236-190" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb236-191"><a href="#cb236-191" aria-hidden="true" tabindex="-1"></a>fit_S <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb236-192"><a href="#cb236-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-193"><a href="#cb236-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-194"><a href="#cb236-194" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>モデルの比較は<span class="in">`anova`</span>で可能．</span>
<span id="cb236-195"><a href="#cb236-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-198"><a href="#cb236-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-199"><a href="#cb236-199" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_S)</span>
<span id="cb236-200"><a href="#cb236-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-201"><a href="#cb236-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-202"><a href="#cb236-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-203"><a href="#cb236-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-204"><a href="#cb236-204" aria-hidden="true" tabindex="-1"></a><span class="fu">## 期待度数</span></span>
<span id="cb236-205"><a href="#cb236-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-206"><a href="#cb236-206" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>期待度数を保存すれば期待度数についてのクロス表を作成することができる．飽和モデルの場合は，観測度数のクロス表と一致する．また独立モデルでの期待度数をみると，行によって列の幅が異なっていない（列によって行の幅がことなっていない）ことがわかる．</span>
<span id="cb236-207"><a href="#cb236-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-210"><a href="#cb236-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-211"><a href="#cb236-211" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">O_Freq =</span> fit_O<span class="sc">$</span>fitted.values,</span>
<span id="cb236-212"><a href="#cb236-212" aria-hidden="true" tabindex="-1"></a>              <span class="at">S_Freq =</span> fit_S<span class="sc">$</span>fitted.values)</span>
<span id="cb236-213"><a href="#cb236-213" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> .) <span class="sc">%&gt;%</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span>
<span id="cb236-214"><a href="#cb236-214" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">xtabs</span>(O_Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> .) <span class="sc">%&gt;%</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span>
<span id="cb236-215"><a href="#cb236-215" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">xtabs</span>(S_Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> .) <span class="sc">%&gt;%</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span>
<span id="cb236-216"><a href="#cb236-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-217"><a href="#cb236-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-218"><a href="#cb236-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-219"><a href="#cb236-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-220"><a href="#cb236-220" aria-hidden="true" tabindex="-1"></a><span class="fu">## モザイクプロット</span></span>
<span id="cb236-221"><a href="#cb236-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-222"><a href="#cb236-222" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`gnm`</span>パッケージには，<span class="in">`mentalHealth`</span>が用意されているのでこれを使ってみる．</span>
<span id="cb236-223"><a href="#cb236-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-226"><a href="#cb236-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-227"><a href="#cb236-227" aria-hidden="true" tabindex="-1"></a>mentalHealth</span>
<span id="cb236-228"><a href="#cb236-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-229"><a href="#cb236-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-230"><a href="#cb236-230" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`xtabs`</span>は集計データからクロス表を作成する際に用いる．<span class="in">`xtabs(度数 ~ 行変数 + 列変数, data = データ名)`</span>とすればよい．<span class="in">`mentalHealth`</span>では<span class="in">`count`</span>が度数を示している．</span>
<span id="cb236-231"><a href="#cb236-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-234"><a href="#cb236-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-235"><a href="#cb236-235" aria-hidden="true" tabindex="-1"></a>tab_mentalHealth <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(count <span class="sc">~</span> SES <span class="sc">+</span> MHS, <span class="at">data =</span> mentalHealth)</span>
<span id="cb236-236"><a href="#cb236-236" aria-hidden="true" tabindex="-1"></a>tab_mentalHealth</span>
<span id="cb236-237"><a href="#cb236-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-238"><a href="#cb236-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-239"><a href="#cb236-239" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`mosaic`</span>でモザイクプロットを図示．影をつけたければ<span class="in">`shade = TRUE`</span>とする．</span>
<span id="cb236-240"><a href="#cb236-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-243"><a href="#cb236-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-244"><a href="#cb236-244" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(tab_mentalHealth,</span>
<span id="cb236-245"><a href="#cb236-245" aria-hidden="true" tabindex="-1"></a>       <span class="at">shade =</span> <span class="cn">TRUE</span>)</span>
<span id="cb236-246"><a href="#cb236-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-247"><a href="#cb236-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-248"><a href="#cb236-248" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>モデル適合度を表示するための関数</span>
<span id="cb236-249"><a href="#cb236-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-252"><a href="#cb236-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-253"><a href="#cb236-253" aria-hidden="true" tabindex="-1"></a>model.summary <span class="ot">&lt;-</span> <span class="cf">function</span>(obj) {</span>
<span id="cb236-254"><a href="#cb236-254" aria-hidden="true" tabindex="-1"></a>  aic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="dv">2</span> <span class="co"># AIC(L2)</span></span>
<span id="cb236-255"><a href="#cb236-255" aria-hidden="true" tabindex="-1"></a>  bic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">sum</span>(obj<span class="sc">$</span>y)) <span class="co">#BIC(L2)</span></span>
<span id="cb236-256"><a href="#cb236-256" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">&lt;-</span></span>
<span id="cb236-257"><a href="#cb236-257" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">abs</span>(obj<span class="sc">$</span>y <span class="sc">-</span> obj<span class="sc">$</span>fitted.values)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(obj<span class="sc">$</span>y))</span>
<span id="cb236-258"><a href="#cb236-258" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(obj<span class="sc">$</span>deviance, obj<span class="sc">$</span>df, <span class="at">lower.tail =</span> F)</span>
<span id="cb236-259"><a href="#cb236-259" aria-hidden="true" tabindex="-1"></a>  Model <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(obj))</span>
<span id="cb236-260"><a href="#cb236-260" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb236-261"><a href="#cb236-261" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Model Description"</span> <span class="ot">=</span> Model,</span>
<span id="cb236-262"><a href="#cb236-262" aria-hidden="true" tabindex="-1"></a>    <span class="st">"df"</span> <span class="ot">=</span> obj<span class="sc">$</span>df,</span>
<span id="cb236-263"><a href="#cb236-263" aria-hidden="true" tabindex="-1"></a>    <span class="st">"L2"</span> <span class="ot">=</span> obj<span class="sc">$</span>deviance,</span>
<span id="cb236-264"><a href="#cb236-264" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"AIC(L2)" = aic,</span></span>
<span id="cb236-265"><a href="#cb236-265" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BIC"</span> <span class="ot">=</span> bic,</span>
<span id="cb236-266"><a href="#cb236-266" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Delta"</span> <span class="ot">=</span> delta,</span>
<span id="cb236-267"><a href="#cb236-267" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p"</span> <span class="ot">=</span> p</span>
<span id="cb236-268"><a href="#cb236-268" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-269"><a href="#cb236-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb236-270"><a href="#cb236-270" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb236-271"><a href="#cb236-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-272"><a href="#cb236-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-273"><a href="#cb236-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-274"><a href="#cb236-274" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>変数と係数と係数の順番を表示するための関数</span>
<span id="cb236-275"><a href="#cb236-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-278"><a href="#cb236-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-279"><a href="#cb236-279" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb236-280"><a href="#cb236-280" aria-hidden="true" tabindex="-1"></a>var_num <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb236-281"><a href="#cb236-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(model<span class="sc">$</span>coefficients),</span>
<span id="cb236-282"><a href="#cb236-282" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> model<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span></span>
<span id="cb236-283"><a href="#cb236-283" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb236-284"><a href="#cb236-284" aria-hidden="true" tabindex="-1"></a>           <span class="at">number =</span> <span class="fu">row_number</span>())</span>
<span id="cb236-285"><a href="#cb236-285" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb236-286"><a href="#cb236-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-287"><a href="#cb236-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-288"><a href="#cb236-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-289"><a href="#cb236-289" aria-hidden="true" tabindex="-1"></a><span class="fu">## 正規化</span></span>
<span id="cb236-290"><a href="#cb236-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-291"><a href="#cb236-291" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>通常のRCモデルでは行スコアと列スコアが正規化されていない．</span>
<span id="cb236-292"><a href="#cb236-292" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Agresti (2002) </span>
<span id="cb236-293"><a href="#cb236-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-296"><a href="#cb236-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-297"><a href="#cb236-297" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb236-298"><a href="#cb236-298" aria-hidden="true" tabindex="-1"></a><span class="do">##  Goodman Row-Column association model fits well (deviance 3.57, df 8)</span></span>
<span id="cb236-299"><a href="#cb236-299" aria-hidden="true" tabindex="-1"></a>mentalHealth<span class="sc">$</span>MHS <span class="ot">&lt;-</span> <span class="fu">C</span>(mentalHealth<span class="sc">$</span>MHS, treatment)</span>
<span id="cb236-300"><a href="#cb236-300" aria-hidden="true" tabindex="-1"></a>mentalHealth<span class="sc">$</span>SES <span class="ot">&lt;-</span> <span class="fu">C</span>(mentalHealth<span class="sc">$</span>SES, treatment)</span>
<span id="cb236-301"><a href="#cb236-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-302"><a href="#cb236-302" aria-hidden="true" tabindex="-1"></a><span class="co"># Independent Model</span></span>
<span id="cb236-303"><a href="#cb236-303" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(count <span class="sc">~</span> SES <span class="sc">+</span> MHS,</span>
<span id="cb236-304"><a href="#cb236-304" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> poisson, <span class="at">data =</span> mentalHealth)</span>
<span id="cb236-305"><a href="#cb236-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-306"><a href="#cb236-306" aria-hidden="true" tabindex="-1"></a><span class="co"># Independent Modelの結果を利用して，初期値を設定</span></span>
<span id="cb236-307"><a href="#cb236-307" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, SES, MHS)</span>
<span id="cb236-308"><a href="#cb236-308" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb236-309"><a href="#cb236-309" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb236-310"><a href="#cb236-310" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="dv">1</span>, mult1),</span>
<span id="cb236-311"><a href="#cb236-311" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb236-312"><a href="#cb236-312" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth</span>
<span id="cb236-313"><a href="#cb236-313" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-314"><a href="#cb236-314" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimateには数字があるが，Std. ErrorがNAとなっている．これらのパラメータは識別されていない．</span></span>
<span id="cb236-315"><a href="#cb236-315" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span>
<span id="cb236-316"><a href="#cb236-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-317"><a href="#cb236-317" aria-hidden="true" tabindex="-1"></a><span class="co"># 行スコアと列スコアがどこにあるかを取り出す．</span></span>
<span id="cb236-318"><a href="#cb236-318" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC1)</span>
<span id="cb236-319"><a href="#cb236-319" aria-hidden="true" tabindex="-1"></a><span class="co"># c(11:16,17:20)</span></span>
<span id="cb236-320"><a href="#cb236-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-321"><a href="#cb236-321" aria-hidden="true" tabindex="-1"></a><span class="co"># getContrastsによって正規化された推定値とその標準誤差を示す．まずは重み付けのない／単位標準化された解を求める．</span></span>
<span id="cb236-322"><a href="#cb236-322" aria-hidden="true" tabindex="-1"></a>mu_unit <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb236-323"><a href="#cb236-323" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb236-324"><a href="#cb236-324" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]SES"</span>),</span>
<span id="cb236-325"><a href="#cb236-325" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb236-326"><a href="#cb236-326" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb236-327"><a href="#cb236-327" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> <span class="st">"unit"</span></span>
<span id="cb236-328"><a href="#cb236-328" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-329"><a href="#cb236-329" aria-hidden="true" tabindex="-1"></a>nu_unit <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb236-330"><a href="#cb236-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb236-331"><a href="#cb236-331" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]MHS"</span>),</span>
<span id="cb236-332"><a href="#cb236-332" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb236-333"><a href="#cb236-333" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb236-334"><a href="#cb236-334" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> <span class="st">"unit"</span></span>
<span id="cb236-335"><a href="#cb236-335" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-336"><a href="#cb236-336" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化された解を表示</span></span>
<span id="cb236-337"><a href="#cb236-337" aria-hidden="true" tabindex="-1"></a>mu_unit</span>
<span id="cb236-338"><a href="#cb236-338" aria-hidden="true" tabindex="-1"></a>nu_unit</span>
<span id="cb236-339"><a href="#cb236-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-340"><a href="#cb236-340" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化制約を確認</span></span>
<span id="cb236-341"><a href="#cb236-341" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>]), <span class="dv">0</span>)</span>
<span id="cb236-342"><a href="#cb236-342" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>]), <span class="dv">0</span>)</span>
<span id="cb236-343"><a href="#cb236-343" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span>), <span class="dv">1</span>)</span>
<span id="cb236-344"><a href="#cb236-344" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span>), <span class="dv">1</span>)</span>
<span id="cb236-345"><a href="#cb236-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-346"><a href="#cb236-346" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の制約</span></span>
<span id="cb236-347"><a href="#cb236-347" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>)], nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)])</span>
<span id="cb236-348"><a href="#cb236-348" aria-hidden="true" tabindex="-1"></a>con</span>
<span id="cb236-349"><a href="#cb236-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-350"><a href="#cb236-350" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb236-351"><a href="#cb236-351" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb236-352"><a href="#cb236-352" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">20</span>),</span>
<span id="cb236-353"><a href="#cb236-353" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrainTo =</span> con,</span>
<span id="cb236-354"><a href="#cb236-354" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb236-355"><a href="#cb236-355" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb236-356"><a href="#cb236-356" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth</span>
<span id="cb236-357"><a href="#cb236-357" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-358"><a href="#cb236-358" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span>
<span id="cb236-359"><a href="#cb236-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-360"><a href="#cb236-360" aria-hidden="true" tabindex="-1"></a><span class="co"># intrinsic association parameter</span></span>
<span id="cb236-361"><a href="#cb236-361" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">summary</span>(RC1)<span class="sc">$</span>coefficients[<span class="st">"Mult(., SES, MHS)."</span>, <span class="dv">1</span>]</span>
<span id="cb236-362"><a href="#cb236-362" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> phi <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> phi)</span>
<span id="cb236-363"><a href="#cb236-363" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> phi) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb236-364"><a href="#cb236-364" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> eta <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> eta</span>
<span id="cb236-365"><a href="#cb236-365" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(phi, rho, eta, tau)</span>
<span id="cb236-366"><a href="#cb236-366" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(rho, tau)</span>
<span id="cb236-367"><a href="#cb236-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-368"><a href="#cb236-368" aria-hidden="true" tabindex="-1"></a><span class="do">## Marginal weighted solution</span></span>
<span id="cb236-369"><a href="#cb236-369" aria-hidden="true" tabindex="-1"></a>rowProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(mentalHealth, <span class="fu">tapply</span>(count, SES, sum) <span class="sc">/</span> <span class="fu">sum</span>(count))</span>
<span id="cb236-370"><a href="#cb236-370" aria-hidden="true" tabindex="-1"></a>colProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(mentalHealth, <span class="fu">tapply</span>(count, MHS, sum) <span class="sc">/</span> <span class="fu">sum</span>(count))</span>
<span id="cb236-371"><a href="#cb236-371" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb236-372"><a href="#cb236-372" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb236-373"><a href="#cb236-373" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]SES"</span>),</span>
<span id="cb236-374"><a href="#cb236-374" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> rowProbs,</span>
<span id="cb236-375"><a href="#cb236-375" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> rowProbs,</span>
<span id="cb236-376"><a href="#cb236-376" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> rowProbs</span>
<span id="cb236-377"><a href="#cb236-377" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-378"><a href="#cb236-378" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb236-379"><a href="#cb236-379" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb236-380"><a href="#cb236-380" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]MHS"</span>),</span>
<span id="cb236-381"><a href="#cb236-381" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> colProbs,</span>
<span id="cb236-382"><a href="#cb236-382" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> colProbs,</span>
<span id="cb236-383"><a href="#cb236-383" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> colProbs</span>
<span id="cb236-384"><a href="#cb236-384" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-385"><a href="#cb236-385" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>)], nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)])</span>
<span id="cb236-386"><a href="#cb236-386" aria-hidden="true" tabindex="-1"></a>mu</span>
<span id="cb236-387"><a href="#cb236-387" aria-hidden="true" tabindex="-1"></a>nu</span>
<span id="cb236-388"><a href="#cb236-388" aria-hidden="true" tabindex="-1"></a>con</span>
<span id="cb236-389"><a href="#cb236-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-390"><a href="#cb236-390" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化制約を確認</span></span>
<span id="cb236-391"><a href="#cb236-391" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">*</span> rowProbs), <span class="dv">0</span>)</span>
<span id="cb236-392"><a href="#cb236-392" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">*</span> colProbs), <span class="dv">0</span>)</span>
<span id="cb236-393"><a href="#cb236-393" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> rowProbs), <span class="dv">1</span>)</span>
<span id="cb236-394"><a href="#cb236-394" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> colProbs), <span class="dv">1</span>)</span>
<span id="cb236-395"><a href="#cb236-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-396"><a href="#cb236-396" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb236-397"><a href="#cb236-397" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb236-398"><a href="#cb236-398" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">20</span>),</span>
<span id="cb236-399"><a href="#cb236-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrainTo =</span> con,</span>
<span id="cb236-400"><a href="#cb236-400" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb236-401"><a href="#cb236-401" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb236-402"><a href="#cb236-402" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth,</span>
<span id="cb236-403"><a href="#cb236-403" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb236-404"><a href="#cb236-404" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-405"><a href="#cb236-405" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span>
<span id="cb236-406"><a href="#cb236-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-407"><a href="#cb236-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-408"><a href="#cb236-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-409"><a href="#cb236-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-410"><a href="#cb236-410" aria-hidden="true" tabindex="-1"></a><span class="fu">## 初期値</span></span>
<span id="cb236-411"><a href="#cb236-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-414"><a href="#cb236-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-415"><a href="#cb236-415" aria-hidden="true" tabindex="-1"></a><span class="co"># データの準備</span></span>
<span id="cb236-416"><a href="#cb236-416" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">39</span>, <span class="dv">50</span>, <span class="dv">18</span>,  <span class="dv">4</span>,</span>
<span id="cb236-417"><a href="#cb236-417" aria-hidden="true" tabindex="-1"></a>          <span class="dv">140</span>,<span class="dv">178</span>, <span class="dv">85</span>, <span class="dv">23</span>,</span>
<span id="cb236-418"><a href="#cb236-418" aria-hidden="true" tabindex="-1"></a>          <span class="dv">108</span>,<span class="dv">195</span>, <span class="dv">97</span>, <span class="dv">23</span>,</span>
<span id="cb236-419"><a href="#cb236-419" aria-hidden="true" tabindex="-1"></a>          <span class="dv">238</span>,<span class="dv">598</span>,<span class="dv">363</span>,<span class="dv">111</span>,</span>
<span id="cb236-420"><a href="#cb236-420" aria-hidden="true" tabindex="-1"></a>           <span class="dv">78</span>,<span class="dv">250</span>,<span class="dv">150</span>, <span class="dv">55</span>,</span>
<span id="cb236-421"><a href="#cb236-421" aria-hidden="true" tabindex="-1"></a>           <span class="dv">50</span>,<span class="dv">200</span>,<span class="dv">208</span>, <span class="dv">74</span>,</span>
<span id="cb236-422"><a href="#cb236-422" aria-hidden="true" tabindex="-1"></a>            <span class="dv">8</span>, <span class="dv">29</span>, <span class="dv">46</span>, <span class="dv">21</span>)</span>
<span id="cb236-423"><a href="#cb236-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-424"><a href="#cb236-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-425"><a href="#cb236-425" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span></span>
<span id="cb236-426"><a href="#cb236-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(Freq,</span>
<span id="cb236-427"><a href="#cb236-427" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">7</span>,</span>
<span id="cb236-428"><a href="#cb236-428" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb236-429"><a href="#cb236-429" aria-hidden="true" tabindex="-1"></a>         <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">as.table</span>()</span>
<span id="cb236-430"><a href="#cb236-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-431"><a href="#cb236-431" aria-hidden="true" tabindex="-1"></a>polviews <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb236-432"><a href="#cb236-432" aria-hidden="true" tabindex="-1"></a>fefam <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">28</span>)</span>
<span id="cb236-433"><a href="#cb236-433" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, polviews, fefam)</span>
<span id="cb236-434"><a href="#cb236-434" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A</span>
<span id="cb236-435"><a href="#cb236-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-436"><a href="#cb236-436" aria-hidden="true" tabindex="-1"></a><span class="co"># 独立モデル</span></span>
<span id="cb236-437"><a href="#cb236-437" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb236-438"><a href="#cb236-438" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam,</span>
<span id="cb236-439"><a href="#cb236-439" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb236-440"><a href="#cb236-440" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> freq_tab_2<span class="fl">.3</span>A,</span>
<span id="cb236-441"><a href="#cb236-441" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb236-442"><a href="#cb236-442" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-443"><a href="#cb236-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-444"><a href="#cb236-444" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(O)</span>
<span id="cb236-445"><a href="#cb236-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-446"><a href="#cb236-446" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb236-447"><a href="#cb236-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-448"><a href="#cb236-448" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span></span>
<span id="cb236-449"><a href="#cb236-449" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam),</span>
<span id="cb236-450"><a href="#cb236-450" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-451"><a href="#cb236-451" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb236-452"><a href="#cb236-452" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb236-453"><a href="#cb236-453" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-454"><a href="#cb236-454" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC)</span>
<span id="cb236-455"><a href="#cb236-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-456"><a href="#cb236-456" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam)</span>
<span id="cb236-457"><a href="#cb236-457" aria-hidden="true" tabindex="-1"></a>mult2 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam, <span class="at">d =</span> <span class="dv">2</span>)</span>
<span id="cb236-458"><a href="#cb236-458" aria-hidden="true" tabindex="-1"></a>mult3 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam, <span class="at">d =</span> <span class="dv">3</span>)</span>
<span id="cb236-459"><a href="#cb236-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-460"><a href="#cb236-460" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb236-461"><a href="#cb236-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-462"><a href="#cb236-462" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam),</span>
<span id="cb236-463"><a href="#cb236-463" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb236-464"><a href="#cb236-464" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-465"><a href="#cb236-465" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb236-466"><a href="#cb236-466" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb236-467"><a href="#cb236-467" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-468"><a href="#cb236-468" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC)</span>
<span id="cb236-469"><a href="#cb236-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-470"><a href="#cb236-470" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb236-471"><a href="#cb236-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-472"><a href="#cb236-472" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span></span>
<span id="cb236-473"><a href="#cb236-473" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb236-474"><a href="#cb236-474" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">2</span>),</span>
<span id="cb236-475"><a href="#cb236-475" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult2[, <span class="dv">1</span>], <span class="cn">NA</span>, mult2[, <span class="dv">2</span>]),</span>
<span id="cb236-476"><a href="#cb236-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-477"><a href="#cb236-477" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb236-478"><a href="#cb236-478" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb236-479"><a href="#cb236-479" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-480"><a href="#cb236-480" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC2)</span>
<span id="cb236-481"><a href="#cb236-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-482"><a href="#cb236-482" aria-hidden="true" tabindex="-1"></a>RC3 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">%&gt;%</span></span>
<span id="cb236-483"><a href="#cb236-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-484"><a href="#cb236-484" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb236-485"><a href="#cb236-485" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb236-486"><a href="#cb236-486" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">3</span>),</span>
<span id="cb236-487"><a href="#cb236-487" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult3[, <span class="dv">1</span>], <span class="cn">NA</span>, mult3[, <span class="dv">2</span>], <span class="cn">NA</span>, mult3[, <span class="dv">3</span>]),</span>
<span id="cb236-488"><a href="#cb236-488" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-489"><a href="#cb236-489" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb236-490"><a href="#cb236-490" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb236-491"><a href="#cb236-491" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-492"><a href="#cb236-492" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC3)</span>
<span id="cb236-493"><a href="#cb236-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-494"><a href="#cb236-494" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span>
<span id="cb236-495"><a href="#cb236-495" aria-hidden="true" tabindex="-1"></a>anoas_model <span class="ot">&lt;-</span> <span class="fu">anoas</span>(tab_2<span class="fl">.3</span>A, <span class="at">nd =</span> <span class="dv">3</span>)</span>
<span id="cb236-496"><a href="#cb236-496" aria-hidden="true" tabindex="-1"></a>anoas_model</span>
<span id="cb236-497"><a href="#cb236-497" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anoas_model)</span>
<span id="cb236-498"><a href="#cb236-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-499"><a href="#cb236-499" aria-hidden="true" tabindex="-1"></a><span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, <span class="at">d =</span> <span class="dv">3</span>)</span>
<span id="cb236-500"><a href="#cb236-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-501"><a href="#cb236-501" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model.summary</span>(O),</span>
<span id="cb236-502"><a href="#cb236-502" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC),</span>
<span id="cb236-503"><a href="#cb236-503" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC2),</span>
<span id="cb236-504"><a href="#cb236-504" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC3))</span>
<span id="cb236-505"><a href="#cb236-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-506"><a href="#cb236-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-507"><a href="#cb236-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-508"><a href="#cb236-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-509"><a href="#cb236-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-510"><a href="#cb236-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-511"><a href="#cb236-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-514"><a href="#cb236-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-515"><a href="#cb236-515" aria-hidden="true" tabindex="-1"></a><span class="do">## 表2.3B</span></span>
<span id="cb236-516"><a href="#cb236-516" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">518</span>,  <span class="dv">95</span>, <span class="dv">6</span>, <span class="dv">35</span>, <span class="dv">5</span>,</span>
<span id="cb236-517"><a href="#cb236-517" aria-hidden="true" tabindex="-1"></a>         　 <span class="dv">81</span>,  <span class="dv">67</span>, <span class="dv">4</span>, <span class="dv">49</span>, <span class="dv">2</span>,</span>
<span id="cb236-518"><a href="#cb236-518" aria-hidden="true" tabindex="-1"></a>          <span class="dv">452</span>,<span class="dv">1003</span>,<span class="dv">67</span>,<span class="dv">630</span>, <span class="dv">5</span>,</span>
<span id="cb236-519"><a href="#cb236-519" aria-hidden="true" tabindex="-1"></a>           <span class="dv">71</span>, <span class="dv">157</span>,<span class="dv">37</span>,<span class="dv">562</span>,<span class="dv">12</span>)</span>
<span id="cb236-520"><a href="#cb236-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-521"><a href="#cb236-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-522"><a href="#cb236-522" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb236-523"><a href="#cb236-523" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span></span>
<span id="cb236-524"><a href="#cb236-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(Freq,</span>
<span id="cb236-525"><a href="#cb236-525" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb236-526"><a href="#cb236-526" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">5</span>,</span>
<span id="cb236-527"><a href="#cb236-527" aria-hidden="true" tabindex="-1"></a>         <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">as.table</span>()</span>
<span id="cb236-528"><a href="#cb236-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-529"><a href="#cb236-529" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B</span>
<span id="cb236-530"><a href="#cb236-530" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる集計データを作成</span></span>
<span id="cb236-531"><a href="#cb236-531" aria-hidden="true" tabindex="-1"></a>Educ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb236-532"><a href="#cb236-532" aria-hidden="true" tabindex="-1"></a>Occ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">20</span>)</span>
<span id="cb236-533"><a href="#cb236-533" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Educ, Occ)</span>
<span id="cb236-534"><a href="#cb236-534" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B</span>
<span id="cb236-535"><a href="#cb236-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-536"><a href="#cb236-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-537"><a href="#cb236-537" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ,</span>
<span id="cb236-538"><a href="#cb236-538" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> poisson,</span>
<span id="cb236-539"><a href="#cb236-539" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> freq_tab_2<span class="fl">.3</span>B,</span>
<span id="cb236-540"><a href="#cb236-540" aria-hidden="true" tabindex="-1"></a>         <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb236-541"><a href="#cb236-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-542"><a href="#cb236-542" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ)</span>
<span id="cb236-543"><a href="#cb236-543" aria-hidden="true" tabindex="-1"></a>mult2 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ, <span class="at">d =</span> <span class="dv">2</span>)</span>
<span id="cb236-544"><a href="#cb236-544" aria-hidden="true" tabindex="-1"></a>mult3 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ, <span class="at">d =</span> <span class="dv">3</span>)</span>
<span id="cb236-545"><a href="#cb236-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-546"><a href="#cb236-546" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb236-547"><a href="#cb236-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-548"><a href="#cb236-548" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb236-549"><a href="#cb236-549" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-550"><a href="#cb236-550" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb236-551"><a href="#cb236-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb236-552"><a href="#cb236-552" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-553"><a href="#cb236-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-554"><a href="#cb236-554" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC)</span>
<span id="cb236-555"><a href="#cb236-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-556"><a href="#cb236-556" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb236-557"><a href="#cb236-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-558"><a href="#cb236-558" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb236-559"><a href="#cb236-559" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="dv">10</span>, mult1),</span>
<span id="cb236-560"><a href="#cb236-560" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-561"><a href="#cb236-561" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb236-562"><a href="#cb236-562" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb236-563"><a href="#cb236-563" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-564"><a href="#cb236-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-565"><a href="#cb236-565" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb236-566"><a href="#cb236-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-567"><a href="#cb236-567" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ), <span class="dv">2</span>),</span>
<span id="cb236-568"><a href="#cb236-568" aria-hidden="true" tabindex="-1"></a>    <span class="co">#      start = c(coef(O), NA, mult2[,1], NA, mult2[,2]),</span></span>
<span id="cb236-569"><a href="#cb236-569" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-570"><a href="#cb236-570" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb236-571"><a href="#cb236-571" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb236-572"><a href="#cb236-572" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-573"><a href="#cb236-573" aria-hidden="true" tabindex="-1"></a>RC2</span>
<span id="cb236-574"><a href="#cb236-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-575"><a href="#cb236-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-576"><a href="#cb236-576" aria-hidden="true" tabindex="-1"></a>RC3 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">%&gt;%</span></span>
<span id="cb236-577"><a href="#cb236-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-578"><a href="#cb236-578" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ), <span class="dv">3</span>),</span>
<span id="cb236-579"><a href="#cb236-579" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult3[, <span class="dv">1</span>], <span class="cn">NA</span>, mult3[, <span class="dv">2</span>], <span class="cn">NA</span>, mult3[, <span class="dv">3</span>]),</span>
<span id="cb236-580"><a href="#cb236-580" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-581"><a href="#cb236-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb236-582"><a href="#cb236-582" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb236-583"><a href="#cb236-583" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-584"><a href="#cb236-584" aria-hidden="true" tabindex="-1"></a>RC3</span>
<span id="cb236-585"><a href="#cb236-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-586"><a href="#cb236-586" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model.summary</span>(O),</span>
<span id="cb236-587"><a href="#cb236-587" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC),</span>
<span id="cb236-588"><a href="#cb236-588" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC2),</span>
<span id="cb236-589"><a href="#cb236-589" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC3))</span>
<span id="cb236-590"><a href="#cb236-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-591"><a href="#cb236-591" aria-hidden="true" tabindex="-1"></a>anoas_model <span class="ot">&lt;-</span> <span class="fu">anoas</span>(tab_2<span class="fl">.3</span>B, <span class="at">nd =</span> <span class="dv">3</span>)</span>
<span id="cb236-592"><a href="#cb236-592" aria-hidden="true" tabindex="-1"></a>anoas_model</span>
<span id="cb236-593"><a href="#cb236-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-594"><a href="#cb236-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-595"><a href="#cb236-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-596"><a href="#cb236-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-597"><a href="#cb236-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-598"><a href="#cb236-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-599"><a href="#cb236-599" aria-hidden="true" tabindex="-1"></a><span class="fu">## 位相モデル</span></span>
<span id="cb236-600"><a href="#cb236-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-601"><a href="#cb236-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-604"><a href="#cb236-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-605"><a href="#cb236-605" aria-hidden="true" tabindex="-1"></a>occupationalStatus</span>
<span id="cb236-606"><a href="#cb236-606" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(occupationalStatus)</span>
<span id="cb236-607"><a href="#cb236-607" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="sc">%&lt;&gt;%</span></span>
<span id="cb236-608"><a href="#cb236-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb236-609"><a href="#cb236-609" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> destination, origin, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb236-610"><a href="#cb236-610" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rscore =</span> <span class="fu">scale</span>(<span class="fu">as.numeric</span>(origin), <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb236-611"><a href="#cb236-611" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cscore =</span> <span class="fu">scale</span>(<span class="fu">as.numeric</span>(destination), <span class="at">scale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb236-612"><a href="#cb236-612" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-613"><a href="#cb236-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-614"><a href="#cb236-614" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span></span>
<span id="cb236-615"><a href="#cb236-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination, <span class="at">family =</span> poisson, <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb236-616"><a href="#cb236-616" aria-hidden="true" tabindex="-1"></a>fit_QI <span class="ot">&lt;-</span></span>
<span id="cb236-617"><a href="#cb236-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag,</span>
<span id="cb236-618"><a href="#cb236-618" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb236-619"><a href="#cb236-619" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb236-620"><a href="#cb236-620" aria-hidden="true" tabindex="-1"></a>fit_U <span class="ot">&lt;-</span></span>
<span id="cb236-621"><a href="#cb236-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb236-622"><a href="#cb236-622" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb236-623"><a href="#cb236-623" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb236-624"><a href="#cb236-624" aria-hidden="true" tabindex="-1"></a>fit_QI_U <span class="ot">&lt;-</span></span>
<span id="cb236-625"><a href="#cb236-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb236-626"><a href="#cb236-626" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb236-627"><a href="#cb236-627" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb236-628"><a href="#cb236-628" aria-hidden="true" tabindex="-1"></a>fit_S <span class="ot">&lt;-</span></span>
<span id="cb236-629"><a href="#cb236-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> origin<span class="sc">:</span>destination,</span>
<span id="cb236-630"><a href="#cb236-630" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb236-631"><a href="#cb236-631" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb236-632"><a href="#cb236-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-633"><a href="#cb236-633" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="sc">%&lt;&gt;%</span></span>
<span id="cb236-634"><a href="#cb236-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb236-635"><a href="#cb236-635" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag1 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb236-636"><a href="#cb236-636" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb236-637"><a href="#cb236-637" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag2 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span></span>
<span id="cb236-638"><a href="#cb236-638" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb236-639"><a href="#cb236-639" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag3 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span></span>
<span id="cb236-640"><a href="#cb236-640" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb236-641"><a href="#cb236-641" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag4 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span></span>
<span id="cb236-642"><a href="#cb236-642" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb236-643"><a href="#cb236-643" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag5 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span></span>
<span id="cb236-644"><a href="#cb236-644" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb236-645"><a href="#cb236-645" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag6 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span></span>
<span id="cb236-646"><a href="#cb236-646" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb236-647"><a href="#cb236-647" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag7 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">7</span> <span class="sc">&amp;</span></span>
<span id="cb236-648"><a href="#cb236-648" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb236-649"><a href="#cb236-649" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag8 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">8</span> <span class="sc">&amp;</span></span>
<span id="cb236-650"><a href="#cb236-650" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb236-651"><a href="#cb236-651" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-652"><a href="#cb236-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-653"><a href="#cb236-653" aria-hidden="true" tabindex="-1"></a>fit_QI2 <span class="ot">&lt;-</span></span>
<span id="cb236-654"><a href="#cb236-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-655"><a href="#cb236-655" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag1 <span class="sc">+</span> diag2 <span class="sc">+</span> diag3 <span class="sc">+</span> diag4 <span class="sc">+</span> diag5 <span class="sc">+</span> diag6 <span class="sc">+</span> diag7 <span class="sc">+</span> diag8,</span>
<span id="cb236-656"><a href="#cb236-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-657"><a href="#cb236-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> freq_occupationalStatus</span>
<span id="cb236-658"><a href="#cb236-658" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-659"><a href="#cb236-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-660"><a href="#cb236-660" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_QI)</span>
<span id="cb236-661"><a href="#cb236-661" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_QI2)</span>
<span id="cb236-662"><a href="#cb236-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-663"><a href="#cb236-663" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_QI, fit_U, fit_QI_U, fit_S)</span>
<span id="cb236-664"><a href="#cb236-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-665"><a href="#cb236-665" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb236-666"><a href="#cb236-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_O),</span>
<span id="cb236-667"><a href="#cb236-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_QI),</span>
<span id="cb236-668"><a href="#cb236-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_U),</span>
<span id="cb236-669"><a href="#cb236-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_QI_U),</span>
<span id="cb236-670"><a href="#cb236-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_S)</span>
<span id="cb236-671"><a href="#cb236-671" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-672"><a href="#cb236-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-673"><a href="#cb236-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-674"><a href="#cb236-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-675"><a href="#cb236-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-676"><a href="#cb236-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-677"><a href="#cb236-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-680"><a href="#cb236-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-681"><a href="#cb236-681" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(erikson)</span>
<span id="cb236-682"><a href="#cb236-682" aria-hidden="true" tabindex="-1"></a>erikson</span>
<span id="cb236-683"><a href="#cb236-683" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)</span>
<span id="cb236-684"><a href="#cb236-684" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)<span class="sc">$</span>origin <span class="ot">&lt;-</span></span>
<span id="cb236-685"><a href="#cb236-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"I+II"</span>,<span class="st">"I+II"</span>,<span class="st">"III"</span>,<span class="st">"IVab"</span>,<span class="st">"IVab"</span>,<span class="st">"IVc"</span>,<span class="st">"V/VI"</span>,<span class="st">"VIIa"</span>,<span class="st">"VIIb"</span>)</span>
<span id="cb236-686"><a href="#cb236-686" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)<span class="sc">$</span>destination <span class="ot">&lt;-</span></span>
<span id="cb236-687"><a href="#cb236-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"I+II"</span>,<span class="st">"I+II"</span>,<span class="st">"III"</span>,<span class="st">"IVab"</span>,<span class="st">"IVab"</span>,<span class="st">"IVc"</span>,<span class="st">"V/VI"</span>,<span class="st">"VIIa"</span>,<span class="st">"VIIb"</span>)</span>
<span id="cb236-688"><a href="#cb236-688" aria-hidden="true" tabindex="-1"></a>freq_erikson <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(erikson)</span>
<span id="cb236-689"><a href="#cb236-689" aria-hidden="true" tabindex="-1"></a>erikson2 <span class="ot">&lt;-</span></span>
<span id="cb236-690"><a href="#cb236-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xtabs</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country, <span class="at">data =</span> freq_erikson)</span>
<span id="cb236-691"><a href="#cb236-691" aria-hidden="true" tabindex="-1"></a>freq_erikson <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(erikson2)</span>
<span id="cb236-692"><a href="#cb236-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-693"><a href="#cb236-693" aria-hidden="true" tabindex="-1"></a>levelMatrix <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">6</span>,</span>
<span id="cb236-694"><a href="#cb236-694" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>,</span>
<span id="cb236-695"><a href="#cb236-695" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>,</span>
<span id="cb236-696"><a href="#cb236-696" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">2</span>,</span>
<span id="cb236-697"><a href="#cb236-697" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,</span>
<span id="cb236-698"><a href="#cb236-698" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">5</span>,</span>
<span id="cb236-699"><a href="#cb236-699" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>()</span>
<span id="cb236-700"><a href="#cb236-700" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(freq_erikson, <span class="at">levelMatrix =</span> levelMatrix)</span>
<span id="cb236-701"><a href="#cb236-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-702"><a href="#cb236-702" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span></span>
<span id="cb236-703"><a href="#cb236-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-704"><a href="#cb236-704" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span> origin <span class="sc">*</span> country <span class="sc">+</span></span>
<span id="cb236-705"><a href="#cb236-705" aria-hidden="true" tabindex="-1"></a>      destination <span class="sc">*</span> country,</span>
<span id="cb236-706"><a href="#cb236-706" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-707"><a href="#cb236-707" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d</span>
<span id="cb236-708"><a href="#cb236-708" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-709"><a href="#cb236-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-710"><a href="#cb236-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-711"><a href="#cb236-711" aria-hidden="true" tabindex="-1"></a>fit_Common <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb236-712"><a href="#cb236-712" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span></span>
<span id="cb236-713"><a href="#cb236-713" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> country <span class="sc">+</span> destination <span class="sc">*</span> country <span class="sc">+</span></span>
<span id="cb236-714"><a href="#cb236-714" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> destination,</span>
<span id="cb236-715"><a href="#cb236-715" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb236-716"><a href="#cb236-716" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb236-717"><a href="#cb236-717" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-718"><a href="#cb236-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-719"><a href="#cb236-719" aria-hidden="true" tabindex="-1"></a>fit_Common_Pattern <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb236-720"><a href="#cb236-720" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span></span>
<span id="cb236-721"><a href="#cb236-721" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> country <span class="sc">+</span> destination <span class="sc">*</span> country <span class="sc">+</span> levelMatrix,</span>
<span id="cb236-722"><a href="#cb236-722" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb236-723"><a href="#cb236-723" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb236-724"><a href="#cb236-724" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-725"><a href="#cb236-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-726"><a href="#cb236-726" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb236-727"><a href="#cb236-727" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred1 =</span> fit_O<span class="sc">$</span>fitted.values,</span>
<span id="cb236-728"><a href="#cb236-728" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred2 =</span> fit_Common<span class="sc">$</span>fitted.values,</span>
<span id="cb236-729"><a href="#cb236-729" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred3 =</span> fit_Common_Pattern<span class="sc">$</span>fitted.values</span>
<span id="cb236-730"><a href="#cb236-730" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-731"><a href="#cb236-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-732"><a href="#cb236-732" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_O)</span>
<span id="cb236-733"><a href="#cb236-733" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_Common)</span>
<span id="cb236-734"><a href="#cb236-734" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">summary</span>(fit_Common))</span>
<span id="cb236-735"><a href="#cb236-735" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_Common)</span>
<span id="cb236-736"><a href="#cb236-736" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_Common_Pattern, fit_Common)</span>
<span id="cb236-737"><a href="#cb236-737" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb236-738"><a href="#cb236-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-739"><a href="#cb236-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-740"><a href="#cb236-740" aria-hidden="true" tabindex="-1"></a><span class="fu">## Xie</span></span>
<span id="cb236-741"><a href="#cb236-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-744"><a href="#cb236-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb236-745"><a href="#cb236-745" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb236-746"><a href="#cb236-746" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb236-747"><a href="#cb236-747" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb236-748"><a href="#cb236-748" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">6</span>, <span class="dv">26</span>, <span class="dv">11</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">23</span>, <span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb236-749"><a href="#cb236-749" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb236-750"><a href="#cb236-750" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">16</span>)</span>
<span id="cb236-751"><a href="#cb236-751" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col)</span>
<span id="cb236-752"><a href="#cb236-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-753"><a href="#cb236-753" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span></span>
<span id="cb236-754"><a href="#cb236-754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb236-755"><a href="#cb236-755" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb236-756"><a href="#cb236-756" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> d)</span>
<span id="cb236-757"><a href="#cb236-757" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb236-758"><a href="#cb236-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-759"><a href="#cb236-759" aria-hidden="true" tabindex="-1"></a>rowProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(d, <span class="fu">tapply</span>(Freq, Row, sum) <span class="sc">/</span> <span class="fu">sum</span>(Freq))</span>
<span id="cb236-760"><a href="#cb236-760" aria-hidden="true" tabindex="-1"></a>colProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(d, <span class="fu">tapply</span>(Freq, Col, sum) <span class="sc">/</span> <span class="fu">sum</span>(Freq))</span>
<span id="cb236-761"><a href="#cb236-761" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb236-762"><a href="#cb236-762" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb236-763"><a href="#cb236-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pickCoef</span>(fit, <span class="st">"[.]Row"</span>),</span>
<span id="cb236-764"><a href="#cb236-764" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> rowProbs,</span>
<span id="cb236-765"><a href="#cb236-765" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> rowProbs,</span>
<span id="cb236-766"><a href="#cb236-766" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> rowProbs</span>
<span id="cb236-767"><a href="#cb236-767" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-768"><a href="#cb236-768" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb236-769"><a href="#cb236-769" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb236-770"><a href="#cb236-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pickCoef</span>(fit, <span class="st">"[.]Col"</span>),</span>
<span id="cb236-771"><a href="#cb236-771" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> colProbs,</span>
<span id="cb236-772"><a href="#cb236-772" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> colProbs,</span>
<span id="cb236-773"><a href="#cb236-773" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> colProbs</span>
<span id="cb236-774"><a href="#cb236-774" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-775"><a href="#cb236-775" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span></span>
<span id="cb236-776"><a href="#cb236-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb236-777"><a href="#cb236-777" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb236-778"><a href="#cb236-778" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb236-779"><a href="#cb236-779" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d,</span>
<span id="cb236-780"><a href="#cb236-780" aria-hidden="true" tabindex="-1"></a>    <span class="at">constrain =</span> <span class="dv">9</span><span class="sc">:</span><span class="dv">16</span>,</span>
<span id="cb236-781"><a href="#cb236-781" aria-hidden="true" tabindex="-1"></a>    <span class="at">constrainTo =</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>])</span>
<span id="cb236-782"><a href="#cb236-782" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-783"><a href="#cb236-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-784"><a href="#cb236-784" aria-hidden="true" tabindex="-1"></a>mu_score <span class="ot">&lt;-</span> <span class="fu">rep</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="at">each =</span> <span class="dv">4</span>)</span>
<span id="cb236-785"><a href="#cb236-785" aria-hidden="true" tabindex="-1"></a>nu_score <span class="ot">&lt;-</span> <span class="fu">rep</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="dv">4</span>)</span>
<span id="cb236-786"><a href="#cb236-786" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">mu =</span> mu_score,</span>
<span id="cb236-787"><a href="#cb236-787" aria-hidden="true" tabindex="-1"></a>              <span class="at">nu =</span> nu_score)</span>
<span id="cb236-788"><a href="#cb236-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-789"><a href="#cb236-789" aria-hidden="true" tabindex="-1"></a><span class="co"># Canonical correlation</span></span>
<span id="cb236-790"><a href="#cb236-790" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wCorr)</span>
<span id="cb236-791"><a href="#cb236-791" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(d, <span class="fu">weightedCorr</span>(mu, <span class="at">x =</span> nu, <span class="at">weights =</span> Freq, <span class="at">method=</span><span class="st">"polychoric"</span>))</span>
<span id="cb236-792"><a href="#cb236-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-793"><a href="#cb236-793" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb236-794"><a href="#cb236-794" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> fit<span class="sc">$</span>coefficients[<span class="st">"Mult(., Row, Col)."</span>] <span class="sc">%&gt;%</span> <span class="fu">abs</span>()</span>
<span id="cb236-795"><a href="#cb236-795" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> phi <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> phi)</span>
<span id="cb236-796"><a href="#cb236-796" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> phi) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb236-797"><a href="#cb236-797" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> eta <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> eta</span>
<span id="cb236-798"><a href="#cb236-798" aria-hidden="true" tabindex="-1"></a>mu</span>
<span id="cb236-799"><a href="#cb236-799" aria-hidden="true" tabindex="-1"></a>nu</span>
<span id="cb236-800"><a href="#cb236-800" aria-hidden="true" tabindex="-1"></a>phi</span>
<span id="cb236-801"><a href="#cb236-801" aria-hidden="true" tabindex="-1"></a>rho</span>
<span id="cb236-802"><a href="#cb236-802" aria-hidden="true" tabindex="-1"></a>tau</span>
<span id="cb236-803"><a href="#cb236-803" aria-hidden="true" tabindex="-1"></a>delta_mu <span class="ot">&lt;-</span> <span class="fu">abs</span>((<span class="sc">-</span><span class="fl">1.3354658</span> <span class="sc">-</span> <span class="fl">1.1376491</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">4</span>))</span>
<span id="cb236-804"><a href="#cb236-804" aria-hidden="true" tabindex="-1"></a>delta_nu <span class="ot">&lt;-</span> <span class="fu">abs</span>((<span class="sc">-</span><span class="fl">0.8513968</span> <span class="sc">-</span> <span class="fl">1.0822644</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">4</span>))</span>
<span id="cb236-805"><a href="#cb236-805" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted</span></span>
<span id="cb236-806"><a href="#cb236-806" aria-hidden="true" tabindex="-1"></a>tau <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> delta_mu <span class="sc">/</span> <span class="dv">12</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> delta_nu <span class="sc">/</span> <span class="dv">12</span>)) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb236-807"><a href="#cb236-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-808"><a href="#cb236-808" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span>
<span id="cb236-809"><a href="#cb236-809" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq,</span>
<span id="cb236-810"><a href="#cb236-810" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb236-811"><a href="#cb236-811" aria-hidden="true" tabindex="-1"></a>              <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb236-812"><a href="#cb236-812" aria-hidden="true" tabindex="-1"></a>              <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb236-813"><a href="#cb236-813" aria-hidden="true" tabindex="-1"></a>rc2 <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab,</span>
<span id="cb236-814"><a href="#cb236-814" aria-hidden="true" tabindex="-1"></a>          <span class="at">nd =</span> <span class="dv">1</span>,</span>
<span id="cb236-815"><a href="#cb236-815" aria-hidden="true" tabindex="-1"></a>          <span class="at">weighting =</span> <span class="st">"marginal"</span>,</span>
<span id="cb236-816"><a href="#cb236-816" aria-hidden="true" tabindex="-1"></a>          <span class="at">se =</span> <span class="st">"bootstrap"</span>)</span>
<span id="cb236-817"><a href="#cb236-817" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rc2)</span>
<span id="cb236-818"><a href="#cb236-818" aria-hidden="true" tabindex="-1"></a><span class="fu">assoc</span>(rc2)</span>
<span id="cb236-819"><a href="#cb236-819" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>