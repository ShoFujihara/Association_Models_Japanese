<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.47">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>補足のノート – 『カテゴリカルデータの連関モデル』</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10-R.html" rel="next">
<link href="./8-degrees_of_freedom.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./9-Note.html">補足のノート</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">『カテゴリカルデータの連関モデル』</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">はじめに</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">シリーズ編者による内容紹介</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-Chapter_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">第1章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-Chapter_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">第2章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4-Chapter_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">第3章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5-Chapter_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">第4章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6-Chapter_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">第5章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7-Chapter_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">第6章</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8-degrees_of_freedom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">自由度</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9-Note.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">補足のノート</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RとRStudioのインストールと基本的な操作方法</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-Replication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">先行研究の再現</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">研究の動向</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-Crosstabs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">クロス表</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#パッケージ" id="toc-パッケージ" class="nav-link active" data-scroll-target="#パッケージ">パッケージ</a></li>
  <li><a href="#クロス表の作成" id="toc-クロス表の作成" class="nav-link" data-scroll-target="#クロス表の作成">クロス表の作成</a></li>
  <li><a href="#集計データの作成" id="toc-集計データの作成" class="nav-link" data-scroll-target="#集計データの作成">集計データの作成</a></li>
  <li><a href="#glmとgnmの結果の比較" id="toc-glmとgnmの結果の比較" class="nav-link" data-scroll-target="#glmとgnmの結果の比較">GLMとGNMの結果の比較</a></li>
  <li><a href="#期待度数" id="toc-期待度数" class="nav-link" data-scroll-target="#期待度数">期待度数</a></li>
  <li><a href="#モザイクプロット" id="toc-モザイクプロット" class="nav-link" data-scroll-target="#モザイクプロット">モザイクプロット</a></li>
  <li><a href="#正規化" id="toc-正規化" class="nav-link" data-scroll-target="#正規化">正規化</a></li>
  <li><a href="#初期値" id="toc-初期値" class="nav-link" data-scroll-target="#初期値">初期値</a></li>
  <li><a href="#位相モデル" id="toc-位相モデル" class="nav-link" data-scroll-target="#位相モデル">位相モデル</a></li>
  <li><a href="#連関モデルと正準相関分析" id="toc-連関モデルと正準相関分析" class="nav-link" data-scroll-target="#連関モデルと正準相関分析">連関モデルと正準相関分析</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">補足のノート</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="パッケージ" class="level2">
<h2 class="anchored" data-anchor-id="パッケージ">パッケージ</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: パッケージ 'ggplot2' はバージョン 4.5.2 の R の下で造られました</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: パッケージ 'tibble' はバージョン 4.5.2 の R の下で造られました</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: パッケージ 'tidyr' はバージョン 4.5.2 の R の下で造られました</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: パッケージ 'readr' はバージョン 4.5.2 の R の下で造られました</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: パッケージ 'purrr' はバージョン 4.5.2 の R の下で造られました</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: パッケージ 'broom' はバージョン 4.5.2 の R の下で造られました</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="クロス表の作成" class="level2">
<h2 class="anchored" data-anchor-id="クロス表の作成">クロス表の作成</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>,  <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>,  <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>           <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>           <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>           <span class="dv">21</span>,  <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># byrow = TRUEとすることを忘れずに．</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq, <span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "A" "B" "C" "D" "E" "F"

[[2]]
[1] "A" "B" "C" "D"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">SES =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MHS =</span> <span class="fu">c</span>(<span class="st">"well"</span>, <span class="st">"mild"</span>, <span class="st">"moderate"</span>, <span class="st">"impaired"</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES well mild moderate impaired
  A   64   94       58       46
  B   57   94       54       40
  C   57  105       65       60
  D   72  141       77       94
  E   36   97       54       78
  F   21   71       54       71</code></pre>
</div>
</div>
</section>
<section id="集計データの作成" class="level2">
<h2 class="anchored" data-anchor-id="集計データの作成">集計データの作成</h2>
<ul>
<li><p>表のデータではなく，各変数の組み合わせとその度数からなるデータを作成する．</p></li>
<li><p>度数はまず1行目について数値を並べ（1行1列から1行<span class="math inline">\(I\)</span>列まで），次に2行目について数値を並べる（2行1列から2行<span class="math inline">\(I\)</span>列まで）．これを<code>Freq</code>とする．</p></li>
<li><p>例として「編者による序文」の親の職業と精神的健康の例で考えてみる．これは<span class="math inline">\(6\times4\)</span>のクロス表なので，まず1行1列から1行4列までの数字を入力し，次に2行1列から2行4列まで入力する．これを3行目から6行目まで繰り返す．表との対応を考えて適当な改行をいれるのもよい．ただしRは改行を入れても入れなくても，単に数値の列（ベクトル）として扱う．</p></li>
<li><p><code>gl</code>によって変数を作成する．度数がどの行と列に対応しているのかに注意してほしい．</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1行1列から1行4列，・・・・，6行1列から6行4列まで順に入力</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>, <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, <span class="dv">57</span>, <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>, <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>, <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>, <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>, <span class="dv">21</span>, <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 表ようにして入力</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>,  <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>,  <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>           <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>           <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>           <span class="dv">21</span>,  <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>行カテゴリと列カテゴリの数は<span class="math inline">\(I\)</span>や<span class="math inline">\(J\)</span>となっている．</li>
<li><code>I</code>を使いたいが，Rの関数にすでに用意されているので別の名前を考える．ここでは<code>NI</code>と<code>NJ</code>とする．</li>
<li>例のデータでは，行カテゴリ数<span class="math inline">\(I = 4\)</span>，列カテゴリ数<span class="math inline">\(J = 5\)</span>である．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>NI <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>NJ <span class="ot">&lt;-</span> <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>では，<code>Freq</code>に対応する行カテゴリと列カテゴリを並べてみる．先程の入力のルールにしたがうと，行については1行1列から1行4列までの数字を入力しているので<code>1,1,1,1</code>となり，次に<code>2,2,2,2</code>となる．これを繰り返し最後は<code>6,6,6,6</code>となる．列については，<code>1,2,3,4</code>が6回繰り返される．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<ul>
<li>属性が数値になっているので<code>as.factor</code>（または<code>factor</code>）で因子（factor）に変換する．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Row)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Col)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row);<span class="fu">class</span>(Col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Row</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 2 2 2 2 3 3 3 3 4 4 4 4 5 5 5 5 6 6 6 6
Levels: 1 2 3 4 5 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Col</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4
Levels: 1 2 3 4</code></pre>
</div>
</div>
<ul>
<li>単純な数値の列を作成したければ<code>rep</code>関数が便利である．これは整数（integer）となる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">20</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Row)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Col)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>Row</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 2 2 2 2 2 3 3 3 3 3 4 4 4 4 4
Levels: 1 2 3 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>Col</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5
Levels: 1 2 3 4 5</code></pre>
</div>
</div>
<ul>
<li><code>gl</code>はGenerate Factor Levelsという関数で，<code>rep</code>に似ているが，数値ではなく因子を結果として出力する．</li>
<li>1から<code>n</code>までの数字をぞれぞれ<code>k</code>回繰り返して出力する．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">24</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Row</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 2 2 2 2 3 3 3 3 4 4 4 4 5 5 5 5 6 6 6 6
Levels: 1 2 3 4 5 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Col</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4
Levels: 1 2 3 4</code></pre>
</div>
</div>
<ul>
<li>以上より，<code>Freq</code>，<code>Row</code>，<code>Col</code>の3つの変数が作成された．これらからなるデータを作成する．<code>data.frame</code>と<code>tibble</code>のどちらでもよいが， <code>tibble</code>の場合は表示させた後に，データの構造（<code>&lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;</code>）が表示される．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Freq, Row, Col)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Freq Row Col
1    64   1   1
2    94   1   2
3    58   1   3
4    46   1   4
5    57   2   1
6    94   2   2
7    54   2   3
8    40   2   4
9    57   3   1
10  105   3   2
11   65   3   3
12   60   3   4
13   72   4   1
14  141   4   2
15   77   4   3
16   94   4   4
17   36   5   1
18   97   5   2
19   54   5   3
20   78   5   4
21   21   6   1
22   71   6   2
23   54   6   3
24   71   6   4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble でもよい</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
    Freq Row   Col  
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
 1    64 1     1    
 2    94 1     2    
 3    58 1     3    
 4    46 1     4    
 5    57 2     1    
 6    94 2     2    
 7    54 2     3    
 8    40 2     4    
 9    57 3     1    
10   105 3     2    
# ℹ 14 more rows</code></pre>
</div>
</div>
<ul>
<li>以上をまとめると次のようになる．本書のプログラム例では<code>gl</code>を使うことが多いのでここで使用方法を覚えておこう．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>, <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, <span class="dv">57</span>, <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>, <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>, <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>, <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>, <span class="dv">21</span>, <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>NI <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>NJ <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> NI, <span class="at">k =</span> NJ, <span class="at">length =</span> NI <span class="sc">*</span> NJ)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> NJ, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> NI <span class="sc">*</span> NJ)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
    Freq Row   Col  
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
 1    64 1     1    
 2    94 1     2    
 3    58 1     3    
 4    46 1     4    
 5    57 1     5    
 6    94 1     6    
 7    54 2     1    
 8    40 2     2    
 9    57 2     3    
10   105 2     4    
# ℹ 14 more rows</code></pre>
</div>
</div>
</section>
<section id="glmとgnmの結果の比較" class="level2">
<h2 class="anchored" data-anchor-id="glmとgnmの結果の比較">GLMとGNMの結果の比較</h2>
<ul>
<li>glmとgnmでは適合度や係数は同じだが，出力されるものが異なる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>fit_gnm <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>通常の出力も少し違う．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fit_glm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = Freq ~ Row + Col, family = poisson, data = d)

Coefficients:
(Intercept)         Row2         Row3         Row4         Col2         Col3  
    4.10604     -0.08065      0.22460     -0.16838      0.36930     -0.13588  
       Col4         Col5         Col6  
    0.25857     -0.14058      0.27738  

Degrees of Freedom: 23 Total (i.e. Null);  15 Residual
Null Deviance:      217.4 
Residual Deviance: 112  AIC: 274.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fit_gnm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Row + Col, family = poisson, data = d)

Coefficients:
(Intercept)         Row2         Row3         Row4         Col2         Col3  
    4.10604     -0.08065      0.22460     -0.16838      0.36930     -0.13588  
       Col4         Col5         Col6  
    0.25857     -0.14058      0.27738  

Deviance:            112.0398 
Pearson chi-squared: 102.2928 
Residual df:         15 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "coefficients"      "residuals"         "fitted.values"    
 [4] "effects"           "R"                 "rank"             
 [7] "qr"                "family"            "linear.predictors"
[10] "deviance"          "aic"               "null.deviance"    
[13] "iter"              "weights"           "prior.weights"    
[16] "df.residual"       "df.null"           "y"                
[19] "converged"         "boundary"          "model"            
[22] "call"              "formula"           "terms"            
[25] "data"              "offset"            "control"          
[28] "method"            "contrasts"         "xlevels"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_gnm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"          "formula"       "terms"         "data"         
 [5] "eliminate"     "ofInterest"    "na.action"     "xlevels"      
 [9] "offset"        "tolerance"     "iterStart"     "iterMax"      
[13] "coefficients"  "residuals"     "fitted.values" "rank"         
[17] "family"        "predictors"    "deviance"      "aic"          
[21] "iter"          "weights"       "prior.weights" "df.residual"  
[25] "y"             "converged"     "constrain"     "constrainTo"  
[29] "x"             "model"        </code></pre>
</div>
</div>
<p>係数はもちろん同じ．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Freq ~ Row + Col, family = poisson, data = d)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.10604    0.07692  53.378  &lt; 2e-16 ***
Row2        -0.08065    0.07104  -1.135 0.256237    
Row3         0.22460    0.06600   3.403 0.000666 ***
Row4        -0.16838    0.07271  -2.316 0.020573 *  
Col2         0.36930    0.08325   4.436 9.17e-06 ***
Col3        -0.13588    0.09377  -1.449 0.147336    
Col4         0.25857    0.08522   3.034 0.002413 ** 
Col5        -0.14058    0.09389  -1.497 0.134314    
Col6         0.27738    0.08488   3.268 0.001083 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 217.40  on 23  degrees of freedom
Residual deviance: 112.04  on 15  degrees of freedom
AIC: 274.21

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_gnm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Row + Col, family = poisson, data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-5.0571  -0.4520   0.4274   1.1667   3.5712  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.10604    0.07692  53.378  &lt; 2e-16 ***
Row2        -0.08065    0.07104  -1.135 0.256237    
Row3         0.22460    0.06600   3.403 0.000666 ***
Row4        -0.16838    0.07271  -2.316 0.020573 *  
Col2         0.36930    0.08325   4.436 9.17e-06 ***
Col3        -0.13588    0.09377  -1.449 0.147336    
Col4         0.25857    0.08522   3.034 0.002413 ** 
Col5        -0.14058    0.09389  -1.497 0.134314    
Col6         0.27738    0.08488   3.268 0.001083 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 112.04 on 15 degrees of freedom
AIC: 274.21

Number of iterations: 4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 5
  term        estimate std.error statistic    p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 (Intercept)   4.11      0.0769     53.4  0         
2 Row2         -0.0806    0.0710     -1.14 0.256     
3 Row3          0.225     0.0660      3.40 0.000666  
4 Row4         -0.168     0.0727     -2.32 0.0206    
5 Col2          0.369     0.0833      4.44 0.00000917
6 Col3         -0.136     0.0938     -1.45 0.147     
7 Col4          0.259     0.0852      3.03 0.00241   
8 Col5         -0.141     0.0939     -1.50 0.134     
9 Col6          0.277     0.0849      3.27 0.00108   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit_gnm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `tidy()` method for objects of class `gnm` is not maintained by the broom team, and is only supported through the `glm` tidier method. Please be cautious in interpreting and reporting broom output.

This warning is displayed once per session.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 5
  term        estimate std.error statistic    p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 (Intercept)   4.11      0.0769     53.4  0         
2 Row2         -0.0806    0.0710     -1.14 0.256     
3 Row3          0.225     0.0660      3.40 0.000666  
4 Row4         -0.168     0.0727     -2.32 0.0206    
5 Col2          0.369     0.0833      4.44 0.00000917
6 Col3         -0.136     0.0938     -1.45 0.147     
7 Col4          0.259     0.0852      3.03 0.00241   
8 Col5         -0.141     0.0939     -1.50 0.134     
9 Col6          0.277     0.0849      3.27 0.00108   </code></pre>
</div>
</div>
<p><code>null.deviance</code>と<code>df.null</code>が<code>gnm</code>では出力されない．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
          &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
1          217.      23  -128.  274.  285.     112.          15    24</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_gnm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
1            NA      NA  -128.  274.  285.     112.          15    24</code></pre>
</div>
</div>
<ul>
<li>gnmで独立モデルと飽和モデル</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>fit_S <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>モデルの比較は<code>anova</code>で可能．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_S)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: Freq ~ Row + Col
Model 2: Freq ~ Row + Col + Row:Col
  Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
1        15     112.04                          
2         0       0.00 15   112.04 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
1            NA      NA  -128.  274.  285.     112.          15    24</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_S)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
1            NA      NA  -72.1  192.  220. 4.35e-14           0    24</code></pre>
</div>
</div>
</section>
<section id="期待度数" class="level2">
<h2 class="anchored" data-anchor-id="期待度数">期待度数</h2>
<ul>
<li>期待度数を保存すれば期待度数についてのクロス表を作成することができる．飽和モデルの場合は，観測度数のクロス表と一致する．また独立モデルでの期待度数をみると，行によって列の幅が異なっていない（列によって行の幅がことなっていない）ことがわかる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">O_Freq =</span> fit_O<span class="sc">$</span>fitted.values,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">S_Freq =</span> fit_S<span class="sc">$</span>fitted.values)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> _) <span class="sc">|&gt;</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="9-Note_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(O_Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> _) <span class="sc">|&gt;</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="9-Note_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(S_Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> _) <span class="sc">|&gt;</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="9-Note_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>fit_O$fitted.values</code>の代わりに<code>predict(fit_O, type = "response")</code>としても良い．<code>type = "response"</code>を忘れないようにする．</p>
</section>
<section id="モザイクプロット" class="level2">
<h2 class="anchored" data-anchor-id="モザイクプロット">モザイクプロット</h2>
<ul>
<li><code>gnm</code>パッケージには，<code>mentalHealth</code>が用意されているのでこれを使ってみる．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>mentalHealth</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   count SES      MHS
1     64   A     well
2     94   A     mild
3     58   A moderate
4     46   A impaired
5     57   B     well
6     94   B     mild
7     54   B moderate
8     40   B impaired
9     57   C     well
10   105   C     mild
11    65   C moderate
12    60   C impaired
13    72   D     well
14   141   D     mild
15    77   D moderate
16    94   D impaired
17    36   E     well
18    97   E     mild
19    54   E moderate
20    78   E impaired
21    21   F     well
22    71   F     mild
23    54   F moderate
24    71   F impaired</code></pre>
</div>
</div>
<ul>
<li><code>xtabs</code>は集計データからクロス表を作成する際に用いる．<code>xtabs(度数 ~ 行変数 + 列変数, data = データ名)</code>とすればよい．<code>mentalHealth</code>では<code>count</code>が度数を示している．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>tab_mentalHealth <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(count <span class="sc">~</span> SES <span class="sc">+</span> MHS, <span class="at">data =</span> mentalHealth)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>tab_mentalHealth</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   MHS
SES well mild moderate impaired
  A   64   94       58       46
  B   57   94       54       40
  C   57  105       65       60
  D   72  141       77       94
  E   36   97       54       78
  F   21   71       54       71</code></pre>
</div>
</div>
<ul>
<li><code>mosaic</code>でモザイクプロットを図示．影をつけたければ<code>shade = TRUE</code>とする．</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(tab_mentalHealth,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="9-Note_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="正規化" class="level2">
<h2 class="anchored" data-anchor-id="正規化">正規化</h2>
<ul>
<li>モデル適合度を表示するための関数を準備</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>model.summary <span class="ot">&lt;-</span> <span class="cf">function</span>(obj) {</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  aic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="dv">2</span> <span class="co"># AIC(L2)</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  bic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">sum</span>(obj<span class="sc">$</span>y)) <span class="co">#BIC(L2)</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">&lt;-</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">abs</span>(obj<span class="sc">$</span>y <span class="sc">-</span> obj<span class="sc">$</span>fitted.values)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(obj<span class="sc">$</span>y))</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(obj<span class="sc">$</span>deviance, obj<span class="sc">$</span>df, <span class="at">lower.tail =</span> F)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  Model <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(obj))</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Model Description"</span> <span class="ot">=</span> Model,</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"df"</span> <span class="ot">=</span> obj<span class="sc">$</span>df,</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"L2"</span> <span class="ot">=</span> obj<span class="sc">$</span>deviance,</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"AIC(L2)" = aic,</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BIC"</span> <span class="ot">=</span> bic,</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Delta"</span> <span class="ot">=</span> delta,</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p"</span> <span class="ot">=</span> p</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>変数と係数と係数の順番を表示するための関数を準備</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>var_num <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(model<span class="sc">$</span>coefficients),</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> model<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">number =</span> <span class="fu">row_number</span>())</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>通常のRCモデルでは行スコアと列スコアが正規化されていない．</li>
<li>Agresti (2002)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  Goodman Row-Column association model fits well (deviance 3.57, df 8)</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>mentalHealth<span class="sc">$</span>MHS <span class="ot">&lt;-</span> <span class="fu">C</span>(mentalHealth<span class="sc">$</span>MHS, treatment)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>mentalHealth<span class="sc">$</span>SES <span class="ot">&lt;-</span> <span class="fu">C</span>(mentalHealth<span class="sc">$</span>SES, treatment)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Independent Model</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(count <span class="sc">~</span> SES <span class="sc">+</span> MHS,</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> poisson, <span class="at">data =</span> mentalHealth)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Independent Modelの結果を利用して，初期値を設定</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, SES, MHS)</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="dv">1</span>, mult1),</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running main iterations..............
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimateには数字があるが，Std. ErrorがNAとなっている．これらのパラメータは識別されていない．</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = count ~ SES + MHS + Mult(1, SES, MHS), family = poisson, 
    data = mentalHealth, start = c(coef(O), 1, mult1))

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.87231  -0.30983   0.01026   0.29898   0.87866  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                  3.97986         NA      NA       NA
SESB                        -0.06671         NA      NA       NA
SESC                         0.05286         NA      NA       NA
SESD                         0.31721         NA      NA       NA
SESE                        -0.13824         NA      NA       NA
SESF                        -0.42641         NA      NA       NA
MHSmild                      0.63608         NA      NA       NA
MHSmoderate                  0.11422         NA      NA       NA
MHSimpaired                  0.09713         NA      NA       NA
Mult(., SES, MHS).           0.56928         NA      NA       NA
Mult(1, ., MHS).SESA        -0.40622         NA      NA       NA
Mult(1, ., MHS).SESB        -0.41074         NA      NA       NA
Mult(1, ., MHS).SESC        -0.03823         NA      NA       NA
Mult(1, ., MHS).SESD         0.15940         NA      NA       NA
Mult(1, ., MHS).SESE         0.64757         NA      NA       NA
Mult(1, ., MHS).SESF         1.04863         NA      NA       NA
Mult(1, SES, .).MHSwell     -0.73506         NA      NA       NA
Mult(1, SES, .).MHSmild      0.17046         NA      NA       NA
Mult(1, SES, .).MHSmoderate  0.33387         NA      NA       NA
Mult(1, SES, .).MHSimpaired  1.08597         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 3.5706 on 8 degrees of freedom
AIC: 179.74

Number of iterations: 14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(RC1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 5
   term                        estimate std.error statistic p.value
   &lt;chr&gt;                          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)                   3.98          NA        NA      NA
 2 SESB                         -0.0667        NA        NA      NA
 3 SESC                          0.0529        NA        NA      NA
 4 SESD                          0.317         NA        NA      NA
 5 SESE                         -0.138         NA        NA      NA
 6 SESF                         -0.426         NA        NA      NA
 7 MHSmild                       0.636         NA        NA      NA
 8 MHSmoderate                   0.114         NA        NA      NA
 9 MHSimpaired                   0.0971        NA        NA      NA
10 Mult(., SES, MHS).            0.569         NA        NA      NA
11 Mult(1, ., MHS).SESA         -0.406         NA        NA      NA
12 Mult(1, ., MHS).SESB         -0.411         NA        NA      NA
13 Mult(1, ., MHS).SESC         -0.0382        NA        NA      NA
14 Mult(1, ., MHS).SESD          0.159         NA        NA      NA
15 Mult(1, ., MHS).SESE          0.648         NA        NA      NA
16 Mult(1, ., MHS).SESF          1.05          NA        NA      NA
17 Mult(1, SES, .).MHSwell      -0.735         NA        NA      NA
18 Mult(1, SES, .).MHSmild       0.170         NA        NA      NA
19 Mult(1, SES, .).MHSmoderate   0.334         NA        NA      NA
20 Mult(1, SES, .).MHSimpaired   1.09          NA        NA      NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 行スコアと列スコアがどこにあるかを取り出す．</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                    var    estimate number
(Intercept)                                 (Intercept)  3.97986270      1
SESB                                               SESB -0.06671127      2
SESC                                               SESC  0.05286438      3
SESD                                               SESD  0.31721059      4
SESE                                               SESE -0.13824302      5
SESF                                               SESF -0.42641080      6
MHSmild                                         MHSmild  0.63608165      7
MHSmoderate                                 MHSmoderate  0.11422437      8
MHSimpaired                                 MHSimpaired  0.09712561      9
Mult(., SES, MHS).                   Mult(., SES, MHS).  0.56928163     10
Mult(1, ., MHS).SESA               Mult(1, ., MHS).SESA -0.40622194     11
Mult(1, ., MHS).SESB               Mult(1, ., MHS).SESB -0.41074260     12
Mult(1, ., MHS).SESC               Mult(1, ., MHS).SESC -0.03823316     13
Mult(1, ., MHS).SESD               Mult(1, ., MHS).SESD  0.15940229     14
Mult(1, ., MHS).SESE               Mult(1, ., MHS).SESE  0.64756809     15
Mult(1, ., MHS).SESF               Mult(1, ., MHS).SESF  1.04862845     16
Mult(1, SES, .).MHSwell         Mult(1, SES, .).MHSwell -0.73505531     17
Mult(1, SES, .).MHSmild         Mult(1, SES, .).MHSmild  0.17045552     18
Mult(1, SES, .).MHSmoderate Mult(1, SES, .).MHSmoderate  0.33386634     19
Mult(1, SES, .).MHSimpaired Mult(1, SES, .).MHSimpaired  1.08596567     20</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># c(11:16,17:20)</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># getContrastsによって正規化された推定値とその標準誤差を示す．まずは重み付けのない／単位標準化された解を求める．</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>mu_unit <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]SES"</span>),</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> <span class="st">"unit"</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>nu_unit <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]MHS"</span>),</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> <span class="st">"unit"</span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化された解を表示</span></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>mu_unit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Estimate Std. Error
Mult(1, ., MHS).SESA -0.437796539  0.1127343
Mult(1, ., MHS).SESB -0.441250780  0.1141765
Mult(1, ., MHS).SESC -0.156615493  0.1224095
Mult(1, ., MHS).SESD -0.005601809  0.1126574
Mult(1, ., MHS).SESE  0.367406754  0.1240706
Mult(1, ., MHS).SESF  0.673857866  0.0932365</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>nu_unit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               Estimate Std. Error
Mult(1, SES, .).MHSwell     -0.73265426 0.06465622
Mult(1, SES, .).MHSmild     -0.03347418 0.10831242
Mult(1, SES, .).MHSmoderate  0.09270166 0.12250921
Mult(1, SES, .).MHSimpaired  0.67342677 0.07862280</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化制約を確認</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>]), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>]), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span>), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span>), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の制約</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>)], nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)])</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>con</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4377965  0.6738579 -0.7326543  0.6734268</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">20</span>),</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrainTo =</span> con,</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = count ~ SES + MHS + Mult(1, SES, MHS), constrain = c(11, 
    16, 17, 20), constrainTo = con, family = poisson, data = mentalHealth, 
    start = c(coef(O), NA, mult1))

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.87231  -0.30983   0.01026   0.29898   0.87866  

Coefficients:
                             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  3.840354   0.100134  38.352  &lt; 2e-16 ***
SESB                        -0.067262   0.089460  -0.752   0.4521    
SESC                         0.097655   0.088726   1.101   0.2711    
SESD                         0.386057   0.087802   4.397 1.10e-05 ***
SESE                        -0.009979   0.110426  -0.090   0.9280    
SESF                        -0.249331   0.133563  -1.867   0.0619 .  
MHSmild                      0.722031   0.096153   7.509 5.95e-14 ***
MHSmoderate                  0.215685   0.108885   1.981   0.0476 *  
MHSimpaired                  0.269974   0.148273   1.821   0.0686 .  
Mult(., SES, MHS).           0.964896   0.191615   5.036 4.76e-07 ***
Mult(1, ., MHS).SESA        -0.437797         NA      NA       NA    
Mult(1, ., MHS).SESB        -0.441251   0.201840  -2.186   0.0288 *  
Mult(1, ., MHS).SESC        -0.156615   0.176666  -0.887   0.3753    
Mult(1, ., MHS).SESD        -0.005602   0.160260  -0.035   0.9721    
Mult(1, ., MHS).SESE         0.367407   0.191566   1.918   0.0551 .  
Mult(1, ., MHS).SESF         0.673858         NA      NA       NA    
Mult(1, SES, .).MHSwell     -0.732654         NA      NA       NA    
Mult(1, SES, .).MHSmild     -0.033474   0.159023  -0.210   0.8333    
Mult(1, SES, .).MHSmoderate  0.092701   0.180220   0.514   0.6070    
Mult(1, SES, .).MHSimpaired  0.673427         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 3.5706 on 8 degrees of freedom
AIC: 179.74

Number of iterations: 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># intrinsic association parameter</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">summary</span>(RC1)<span class="sc">$</span>coefficients[<span class="st">"Mult(., SES, MHS)."</span>, <span class="dv">1</span>]</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> phi <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> phi)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> phi) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> eta <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> eta</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(phi, rho, eta, tau)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.9648955

[[2]]
[1] 0.6080959

[[3]]
[1] 0.5181908

[[4]]
[1] 0.6080959</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(rho, tau)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Marginal weighted solution</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>rowProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(mentalHealth, <span class="fu">tapply</span>(count, SES, sum) <span class="sc">/</span> <span class="fu">sum</span>(count))</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>colProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(mentalHealth, <span class="fu">tapply</span>(count, MHS, sum) <span class="sc">/</span> <span class="fu">sum</span>(count))</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]SES"</span>),</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> rowProbs,</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> rowProbs,</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> rowProbs</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]MHS"</span>),</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> colProbs,</span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> colProbs,</span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> colProbs</span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>)], nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)])</span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a>mu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Estimate Std. Error
Mult(1, ., MHS).SESA -1.11233083  0.2990944
Mult(1, ., MHS).SESB -1.12143703  0.3138906
Mult(1, ., MHS).SESC -0.37107606  0.3194546
Mult(1, ., MHS).SESD  0.02702925  0.2734878
Mult(1, ., MHS).SESE  1.01036135  0.3149487
Mult(1, ., MHS).SESF  1.81823312  0.2824636</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>nu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Estimate Std. Error
Mult(1, SES, .).MHSwell     -1.6775144  0.1941179
Mult(1, SES, .).MHSmild     -0.1403989  0.2002803
Mult(1, SES, .).MHSmoderate  0.1369925  0.2799954
Mult(1, SES, .).MHSimpaired  1.4136909  0.1724133</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>con</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.112331  1.818233 -1.677514  1.413691</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化制約を確認</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">*</span> rowProbs), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">*</span> colProbs), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> rowProbs), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> colProbs), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">20</span>),</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrainTo =</span> con,</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth,</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = count ~ SES + MHS + Mult(1, SES, MHS), constrain = c(11, 
    16, 17, 20), constrainTo = con, family = poisson, data = mentalHealth, 
    start = c(coef(O), NA, mult1), tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.87231  -0.30982   0.01026   0.29898   0.87866  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  3.83919    0.10014  38.338  &lt; 2e-16 ***
SESB                        -0.06736    0.09033  -0.746   0.4558    
SESC                         0.10590    0.08929   1.186   0.2356    
SESD                         0.39873    0.08826   4.517 6.26e-06 ***
SESE                         0.01363    0.11020   0.124   0.9016    
SESF                        -0.21674    0.13232  -1.638   0.1014    
MHSmild                      0.71134    0.09556   7.444 9.77e-14 ***
MHSmoderate                  0.20306    0.10841   1.873   0.0611 .  
MHSimpaired                  0.24846    0.14842   1.674   0.0941 .  
Mult(., SES, MHS).           0.16649    0.03306   5.036 4.76e-07 ***
Mult(1, ., MHS).SESA        -1.11233         NA      NA       NA    
Mult(1, ., MHS).SESB        -1.12144    0.53209  -2.108   0.0351 *  
Mult(1, ., MHS).SESC        -0.37108    0.46573  -0.797   0.4256    
Mult(1, ., MHS).SESD         0.02703    0.42248   0.064   0.9490    
Mult(1, ., MHS).SESE         1.01036    0.50501   2.001   0.0454 *  
Mult(1, ., MHS).SESF         1.81823         NA      NA       NA    
Mult(1, SES, .).MHSwell     -1.67751         NA      NA       NA    
Mult(1, SES, .).MHSmild     -0.14040    0.34961  -0.402   0.6880    
Mult(1, SES, .).MHSmoderate  0.13699    0.39621   0.346   0.7295    
Mult(1, SES, .).MHSimpaired  1.41369         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 3.5706 on 8 degrees of freedom
AIC: 179.74

Number of iterations: 41</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(RC1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 5
   term                        estimate std.error statistic    p.value
   &lt;chr&gt;                          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 (Intercept)                   3.84      0.100    38.3     1.41e-321
 2 SESB                         -0.0674    0.0903   -0.746   4.56e-  1
 3 SESC                          0.106     0.0893    1.19    2.36e-  1
 4 SESD                          0.399     0.0883    4.52    6.26e-  6
 5 SESE                          0.0136    0.110     0.124   9.02e-  1
 6 SESF                         -0.217     0.132    -1.64    1.01e-  1
 7 MHSmild                       0.711     0.0956    7.44    9.77e- 14
 8 MHSmoderate                   0.203     0.108     1.87    6.11e-  2
 9 MHSimpaired                   0.248     0.148     1.67    9.41e-  2
10 Mult(., SES, MHS).            0.166     0.0331    5.04    4.76e-  7
11 Mult(1, ., MHS).SESA         -1.11     NA        NA      NA        
12 Mult(1, ., MHS).SESB         -1.12      0.532    -2.11    3.51e-  2
13 Mult(1, ., MHS).SESC         -0.371     0.466    -0.797   4.26e-  1
14 Mult(1, ., MHS).SESD          0.0270    0.422     0.0640  9.49e-  1
15 Mult(1, ., MHS).SESE          1.01      0.505     2.00    4.54e-  2
16 Mult(1, ., MHS).SESF          1.82     NA        NA      NA        
17 Mult(1, SES, .).MHSwell      -1.68     NA        NA      NA        
18 Mult(1, SES, .).MHSmild      -0.140     0.350    -0.402   6.88e-  1
19 Mult(1, SES, .).MHSmoderate   0.137     0.396     0.346   7.30e-  1
20 Mult(1, SES, .).MHSimpaired   1.41     NA        NA      NA        </code></pre>
</div>
</div>
</section>
<section id="初期値" class="level2">
<h2 class="anchored" data-anchor-id="初期値">初期値</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># データの準備</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">39</span>, <span class="dv">50</span>, <span class="dv">18</span>,  <span class="dv">4</span>,</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">140</span>,<span class="dv">178</span>, <span class="dv">85</span>, <span class="dv">23</span>,</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>          <span class="dv">108</span>,<span class="dv">195</span>, <span class="dv">97</span>, <span class="dv">23</span>,</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>          <span class="dv">238</span>,<span class="dv">598</span>,<span class="dv">363</span>,<span class="dv">111</span>,</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>           <span class="dv">78</span>,<span class="dv">250</span>,<span class="dv">150</span>, <span class="dv">55</span>,</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>           <span class="dv">50</span>,<span class="dv">200</span>,<span class="dv">208</span>, <span class="dv">74</span>,</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>            <span class="dv">8</span>, <span class="dv">29</span>, <span class="dv">46</span>, <span class="dv">21</span>)</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(Freq,</span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">7</span>,</span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>polviews <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>fefam <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">28</span>)</span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, polviews, fefam)</span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 3
    Freq polviews fefam
   &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;
 1    39 1        1    
 2    50 1        2    
 3    18 1        3    
 4     4 1        4    
 5   140 2        1    
 6   178 2        2    
 7    85 2        3    
 8    23 2        4    
 9   108 3        1    
10   195 3        2    
# ℹ 18 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 独立モデル</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> <span class="fu">gnm</span>(</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> _,</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    var   estimate number
(Intercept) (Intercept)  3.0603480      1
polviews2     polviews2  1.3449091      2
polviews3     polviews3  1.3378420      3
polviews4     polviews4  2.4682522      4
polviews5     polviews5  1.5689912      5
polviews6     polviews6  1.5671133      6
polviews7     polviews7 -0.0651393      7
fefam2           fefam2  0.8194665      8
fefam3           fefam3  0.3804447      9
fefam4           fefam4 -0.7539609     10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam),</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations............................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                    var     estimate number
(Intercept)                                 (Intercept)  2.902702351      1
polviews2                                     polviews2  1.390548385      2
polviews3                                     polviews3  1.427149259      3
polviews4                                     polviews4  2.586614669      4
polviews5                                     polviews5  1.686005670      5
polviews6                                     polviews6  1.625948840      6
polviews7                                     polviews7 -0.114101970      7
fefam2                                           fefam2  0.889280567      8
fefam3                                           fefam3  0.414411068      9
fefam4                                           fefam4 -0.767263370     10
Mult(., polviews, fefam).     Mult(., polviews, fefam).  0.354847803     11
Mult(1, ., fefam).polviews1 Mult(1, ., fefam).polviews1 -4.642973707     12
Mult(1, ., fefam).polviews2 Mult(1, ., fefam).polviews2 -3.587221083     13
Mult(1, ., fefam).polviews3 Mult(1, ., fefam).polviews3 -2.177313145     14
Mult(1, ., fefam).polviews4 Mult(1, ., fefam).polviews4 -0.001967735     15
Mult(1, ., fefam).polviews5 Mult(1, ., fefam).polviews5  0.933577004     16
Mult(1, ., fefam).polviews6 Mult(1, ., fefam).polviews6  3.992993578     17
Mult(1, ., fefam).polviews7 Mult(1, ., fefam).polviews7  6.608154586     18
Mult(1, polviews, .).fefam1 Mult(1, polviews, .).fefam1 -0.468986131     19
Mult(1, polviews, .).fefam2 Mult(1, polviews, .).fefam2 -0.061831609     20
Mult(1, polviews, .).fefam3 Mult(1, polviews, .).fefam3  0.255547101     21
Mult(1, polviews, .).fefam4 Mult(1, polviews, .).fefam4  0.406103105     22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>mult2 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam, <span class="at">d =</span> <span class="dv">2</span>)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>mult3 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam, <span class="at">d =</span> <span class="dv">3</span>)</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam),</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations..............................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam), 
    family = poisson, data = freq_tab_2.3A, start = c(coef(O), 
        NA, mult1), tolerance = 1e-12)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.07428  -0.27239   0.03038   0.36792   1.03721  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                  2.97067         NA      NA       NA
polviews2                    1.38106         NA      NA       NA
polviews3                    1.40499         NA      NA       NA
polviews4                    2.54490         NA      NA       NA
polviews5                    1.63588         NA      NA       NA
polviews6                    1.54832         NA      NA       NA
polviews7                   -0.21523         NA      NA       NA
fefam2                       0.86521         NA      NA       NA
fefam3                       0.37157         NA      NA       NA
fefam4                      -0.81900         NA      NA       NA
Mult(., polviews, fefam).    0.11476         NA      NA       NA
Mult(1, ., fefam).polviews1 -2.23657         NA      NA       NA
Mult(1, ., fefam).polviews2 -1.70908         NA      NA       NA
Mult(1, ., fefam).polviews3 -1.00463         NA      NA       NA
Mult(1, ., fefam).polviews4  0.08226         NA      NA       NA
Mult(1, ., fefam).polviews5  0.54970         NA      NA       NA
Mult(1, ., fefam).polviews6  2.07831         NA      NA       NA
Mult(1, ., fefam).polviews7  3.38495         NA      NA       NA
Mult(1, polviews, .).fefam1 -2.74560         NA      NA       NA
Mult(1, polviews, .).fefam2 -0.22589         NA      NA       NA
Mult(1, polviews, .).fefam3  1.73823         NA      NA       NA
Mult(1, polviews, .).fefam4  2.66996         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 8.0718 on 10 degrees of freedom
AIC: 215.43

Number of iterations: 30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22 × 5
   term        estimate std.error statistic p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)    2.97         NA        NA      NA
 2 polviews2      1.38         NA        NA      NA
 3 polviews3      1.40         NA        NA      NA
 4 polviews4      2.54         NA        NA      NA
 5 polviews5      1.64         NA        NA      NA
 6 polviews6      1.55         NA        NA      NA
 7 polviews7     -0.215        NA        NA      NA
 8 fefam2         0.865        NA        NA      NA
 9 fefam3         0.372        NA        NA      NA
10 fefam4        -0.819        NA        NA      NA
# ℹ 12 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
1            NA      NA  -89.7  215.  239.     8.07          10    28</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">2</span>),</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult2[, <span class="dv">1</span>], <span class="cn">NA</span>, mult2[, <span class="dv">2</span>]),</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
...........................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam, 
    inst = 1) + Mult(1, polviews, fefam, inst = 2), family = poisson, 
    data = freq_tab_2.3A, start = c(coef(O), NA, mult2[, 1], 
        NA, mult2[, 2]), tolerance = 1e-12)

Deviance Residuals: 
      Min         1Q     Median         3Q        Max  
-0.500439  -0.068726  -0.002705   0.066147   0.535693  

Coefficients:
                                       Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                            2.993287         NA      NA       NA
polviews2                              1.436412         NA      NA       NA
polviews3                              1.398908         NA      NA       NA
polviews4                              2.518065         NA      NA       NA
polviews5                              1.564082         NA      NA       NA
polviews6                              1.534299         NA      NA       NA
polviews7                             -0.133562         NA      NA       NA
fefam2                                 0.814972         NA      NA       NA
fefam3                                 0.369393         NA      NA       NA
fefam4                                -0.825633         NA      NA       NA
Mult(., polviews, fefam, inst = 1).    0.111566         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews1 -2.370011         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews2 -1.718197         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews3 -1.055282         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews4  0.094489         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews5  0.651356         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews6  2.082776         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews7  3.020457         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam1 -2.548941         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam2 -0.333340         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam3  1.824525         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam4  2.789907         NA      NA       NA
Mult(., polviews, fefam, inst = 2).    0.064972         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews1 -0.129058         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews2  1.061518         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews3 -0.214994         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews4 -0.595091         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews5 -1.469833         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews6 -0.267529         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews7  1.608264         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam1  0.298457         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam2 -1.828478         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam3  0.195655         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam4  0.002679         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 1.3691 on 4 degrees of freedom
AIC: 220.72

Number of iterations: 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(RC2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34 × 5
   term        estimate std.error statistic p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)    2.99         NA        NA      NA
 2 polviews2      1.44         NA        NA      NA
 3 polviews3      1.40         NA        NA      NA
 4 polviews4      2.52         NA        NA      NA
 5 polviews5      1.56         NA        NA      NA
 6 polviews6      1.53         NA        NA      NA
 7 polviews7     -0.134        NA        NA      NA
 8 fefam2         0.815        NA        NA      NA
 9 fefam3         0.369        NA        NA      NA
10 fefam4        -0.826        NA        NA      NA
# ℹ 24 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(RC2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
1            NA      NA  -86.4  221.  253.     1.37           4    28</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>RC3 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">3</span>),</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult3[, <span class="dv">1</span>], <span class="cn">NA</span>, mult3[, <span class="dv">2</span>], <span class="cn">NA</span>, mult3[, <span class="dv">3</span>]),</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ polviews + fefam + Mult(1, polviews, fefam, 
    inst = 1) + Mult(1, polviews, fefam, inst = 2) + Mult(1, 
    polviews, fefam, inst = 3), family = poisson, data = freq_tab_2.3A, 
    start = c(coef(O), NA, mult3[, 1], NA, mult3[, 2], NA, mult3[, 
        3]), tolerance = 1e-12)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
     0       0       0       0       0  

Coefficients:
                                      Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                            2.98832         NA      NA       NA
polviews2                              1.45668         NA      NA       NA
polviews3                              1.38302         NA      NA       NA
polviews4                              2.52059         NA      NA       NA
polviews5                              1.58491         NA      NA       NA
polviews6                              1.51818         NA      NA       NA
polviews7                             -0.10812         NA      NA       NA
fefam2                                 0.81254         NA      NA       NA
fefam3                                 0.35325         NA      NA       NA
fefam4                                -0.80539         NA      NA       NA
Mult(., polviews, fefam, inst = 1).    0.11105         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews1 -2.36488         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews2 -1.70985         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews3 -1.02644         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews4  0.10832         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews5  0.61151         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews6  2.15910         NA      NA       NA
Mult(1, ., fefam, inst = 1).polviews7  2.95936         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam1 -2.41740         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam2 -0.28415         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam3  2.05381         NA      NA       NA
Mult(1, polviews, ., inst = 1).fefam4  2.43636         NA      NA       NA
Mult(., polviews, fefam, inst = 2).    0.06452         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews1 -0.12647         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews2  1.13121         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews3 -0.29985         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews4 -0.60482         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews5 -1.37958         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews6 -0.41755         NA      NA       NA
Mult(1, ., fefam, inst = 2).polviews7  1.74634         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam1  0.38993         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam2 -1.83914         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam3  0.21225         NA      NA       NA
Mult(1, polviews, ., inst = 2).fefam4 -0.11423         NA      NA       NA
Mult(., polviews, fefam, inst = 3).    0.05616         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews1  2.23238         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews2  0.46917         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews3  2.19320         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews4  0.39281         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews5 -0.90419         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews6 -0.22218         NA      NA       NA
Mult(1, ., fefam, inst = 3).polviews7 -2.57455         NA      NA       NA
Mult(1, polviews, ., inst = 3).fefam1  0.34732         NA      NA       NA
Mult(1, polviews, ., inst = 3).fefam2  0.17172         NA      NA       NA
Mult(1, polviews, ., inst = 3).fefam3  0.71728         NA      NA       NA
Mult(1, polviews, ., inst = 3).fefam4 -1.25788         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: -3.1086e-15 on 0 degrees of freedom
AIC: 227.35

Number of iterations: 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(RC3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 46 × 5
   term        estimate std.error statistic p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)    2.99         NA        NA      NA
 2 polviews2      1.46         NA        NA      NA
 3 polviews3      1.38         NA        NA      NA
 4 polviews4      2.52         NA        NA      NA
 5 polviews5      1.58         NA        NA      NA
 6 polviews6      1.52         NA        NA      NA
 7 polviews7     -0.108        NA        NA      NA
 8 fefam2         0.813        NA        NA      NA
 9 fefam3         0.353        NA        NA      NA
10 fefam4        -0.805        NA        NA      NA
# ℹ 36 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(RC3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  null.deviance df.null logLik   AIC   BIC  deviance df.residual  nobs
          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
1            NA      NA  -85.7  227.  265. -3.11e-15           0    28</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
次のパッケージを付け加えます: 'logmult'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>以下のオブジェクトは 'package:vcd' からマスクされています:

    assoc</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>以下のオブジェクトは 'package:gnm' からマスクされています:

    se</code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>anoas_model <span class="ot">&lt;-</span> <span class="fu">anoas</span>(tab_2<span class="fl">.3</span>A, <span class="at">nd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting independence model...
Fitting model with 1 dimension...
Initialising
Running start-up iterations..
Running main iterations........
Done
Fitting model with 2 dimensions...
Initialising
Running start-up iterations..
Running main iterations...............................
Done
Fitting model with 3 dimensions...
Initialising
Running start-up iterations..
Running main iterations...
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>anoas_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Res. Df           Res. Dev    Dev./Indep. (%)     Dissim. (%)
Indep.      18 211.69508974175693 100.00000000000000 8.0917102896466
RC(1)       10   8.07181892814987   3.81294575041705 1.7673079267546
RC(2)        4   1.36909098846090   0.64672779615769 0.4963921430961
RC(3)        0   0.00000000000009   0.00000000000004 0.0000000000002
                      BIC                AIC Dev. Df
Indep.  65.12224155397615 175.69508974175693   NA NA
RC(1)  -73.35754117617279 -11.92818107185013 -204 -8
RC(2)  -31.20265305326816  -6.63090901153910   -7 -6
RC(3)    0.00000000000009   0.00000000000009   -1 -4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, <span class="at">nd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations............
Done</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab_2.3A, nd = 1)

Intrinsic association coefficients:
 Dim1 
0.257 

Normalized row scores (Rows):
      A       B       C       D       E       F       G 
 1.8206  1.4153  0.8741  0.0389 -0.3202 -1.4947 -2.4987 

Normalized column scores (Columns):
     A      B      C      D 
 1.658  0.192 -0.951 -1.493 

Normalization weights: marginal
Deviance:              8.071819
Pearson chi-squared:   8.168769
Dissimilarity index:   1.767308%
Residual df:           10
BIC:                   -73.35754
AIC:                   -11.92818</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, <span class="at">nd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations............................
Done</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab_2.3A, nd = 2)

Intrinsic association coefficients:
 Dim1  Dim2 
0.245 0.048 

Normalized row scores (Rows):
  Dim1    Dim2   
A  1.9332  0.1608
B  1.3846 -1.5665
C  0.9161  0.0381
D  0.0375  0.3428
E -0.3632  1.4237
F -1.5171 -0.4611
G -2.3120 -3.1663

Normalized column scores (Columns):
  Dim1   Dim2  
A  1.625 -1.205
B  0.220  1.114
C -0.958 -0.751
D -1.536 -0.480

Normalization weights: marginal
Deviance:              1.369091
Pearson chi-squared:   1.369503
Dissimilarity index:   0.4963921%
Residual df:           4
BIC:                   -31.20265
AIC:                   -6.630909</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, <span class="at">nd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations......
Done</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab_2.3A, nd = 3)

Intrinsic association coefficients:
  Dim1   Dim2   Dim3 
0.2455 0.0485 0.0204 

Normalized row scores (Rows):
  Dim1    Dim2    Dim3   
A  1.9417  0.1575  0.6432
B  1.3708 -1.5534 -1.0724
C  0.9319  0.0444  1.6635
D  0.0365  0.3379  0.0661
E -0.3566  1.3877 -1.4225
F -1.5358 -0.3972  0.9283
G -2.2540 -3.3219 -1.3514

Normalized column scores (Columns):
  Dim1    Dim2    Dim3   
A  1.6240 -1.2103 -0.3173
B  0.2205  1.1151  0.0269
C -0.9567 -0.7330  1.0506
D -1.5401 -0.5267 -2.7219

Normalization weights: marginal
Deviance:              -4.507505e-14
Pearson chi-squared:   2.138457e-27
Dissimilarity index:   3.201213e-14%
Residual df:           0
BIC:                   -4.507505e-14
AIC:                   -4.507505e-14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model.summary</span>(O),</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC),</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC2),</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  `Model Description`    df        L2       BIC    Delta     p
  &lt;chr&gt;               &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 O                      18  2.12e+ 2  6.51e+ 1 8.09e+ 0 1    
2 RC                     10  8.07e+ 0 -7.34e+ 1 1.77e+ 0 0.378
3 RC2                     4  1.37e+ 0 -3.12e+ 1 4.96e- 1 0.150
4 RC3                     0 -3.11e-15 -3.11e-15 2.75e-14 0    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 表2.3B</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">518</span>,  <span class="dv">95</span>, <span class="dv">6</span>, <span class="dv">35</span>, <span class="dv">5</span>,</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>         　 <span class="dv">81</span>,  <span class="dv">67</span>, <span class="dv">4</span>, <span class="dv">49</span>, <span class="dv">2</span>,</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>          <span class="dv">452</span>,<span class="dv">1003</span>,<span class="dv">67</span>,<span class="dv">630</span>, <span class="dv">5</span>,</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>           <span class="dv">71</span>, <span class="dv">157</span>,<span class="dv">37</span>,<span class="dv">562</span>,<span class="dv">12</span>)</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(Freq,</span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">5</span>,</span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     A    B    C    D    E
A  518   95    6   35    5
B   81   67    4   49    2
C  452 1003   67  630    5
D   71  157   37  562   12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる集計データを作成</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>Educ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>Occ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">20</span>)</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Educ, Occ)</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
    Freq Educ  Occ  
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
 1   518 1     1    
 2    95 1     2    
 3     6 1     3    
 4    35 1     4    
 5     5 1     5    
 6    81 2     1    
 7    67 2     2    
 8     4 2     3    
 9    49 2     4    
10     2 2     5    
11   452 3     1    
12  1003 3     2    
13    67 3     3    
14   630 3     4    
15     5 3     5    
16    71 4     1    
17   157 4     2    
18    37 4     3    
19   562 4     4    
20    12 4     5    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span> </span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ,</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> poisson,</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> _,</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ)</span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>mult2 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ, <span class="at">d =</span> <span class="dv">2</span>)</span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>mult3 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ, <span class="at">d =</span> <span class="dv">3</span>)</span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.........................................................
..................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        var    estimate number
(Intercept)                     (Intercept)  4.84609319      1
Educ2                                 Educ2 -0.84036732      2
Educ3                                 Educ3  1.43223229      3
Educ4                                 Educ4 -0.20620288      4
Occ2                                   Occ2  0.48596765      5
Occ3                                   Occ3 -2.07003164      6
Occ4                                   Occ4  0.17468852      7
Occ5                                   Occ5 -3.56888992      8
Mult(., Educ, Occ).     Mult(., Educ, Occ). 28.27801364      9
Mult(1, ., Occ).Educ1 Mult(1, ., Occ).Educ1  0.31457624     10
Mult(1, ., Occ).Educ2 Mult(1, ., Occ).Educ2  0.06872003     11
Mult(1, ., Occ).Educ3 Mult(1, ., Occ).Educ3 -0.01107907     12
Mult(1, ., Occ).Educ4 Mult(1, ., Occ).Educ4 -0.21810595     13
Mult(1, Educ, .).Occ1 Mult(1, Educ, .).Occ1  0.15385314     14
Mult(1, Educ, .).Occ2 Mult(1, Educ, .).Occ2 -0.04772764     15
Mult(1, Educ, .).Occ3 Mult(1, Educ, .).Occ3 -0.15638745     16
Mult(1, Educ, .).Occ4 Mult(1, Educ, .).Occ4 -0.23730565     17
Mult(1, Educ, .).Occ5 Mult(1, Educ, .).Occ5 -0.11388309     18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="dv">10</span>, mult1),</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running main iterations.........................................................
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
...........................................
Done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in gnmFit(modelTools = modelTools, y = y, constrain = constrain, : Fitting algorithm has either not converged or converged
to a non-solution of the likelihood equations.
Use exitInfo() for numerical details of last iteration.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ), <span class="dv">2</span>),</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#      start = c(coef(O), NA, mult2[,1], NA, mult2[,2]),</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations.....................................
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>RC2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + instances(Mult(1, Educ, Occ), 
    2), family = poisson, data = freq_tab_2.3B, tolerance = 1e-12)

Coefficients:
                    (Intercept)                            Educ2  
                        4.90354                         -0.75950  
                          Educ3                            Educ4  
                        1.50187                          0.18447  
                           Occ2                             Occ3  
                        0.01502                         -2.22224  
                           Occ4                             Occ5  
                        0.10667                         -3.38853  
  Mult(., Educ, Occ, inst = 1).  Mult(1, ., Occ, inst = 1).Educ1  
                        1.54189                          1.35778  
Mult(1, ., Occ, inst = 1).Educ2  Mult(1, ., Occ, inst = 1).Educ3  
                        0.27886                         -0.20567  
Mult(1, ., Occ, inst = 1).Educ4  Mult(1, Educ, ., inst = 1).Occ1  
                       -0.89120                          0.67274  
Mult(1, Educ, ., inst = 1).Occ2  Mult(1, Educ, ., inst = 1).Occ3  
                       -0.31932                         -0.42628  
Mult(1, Educ, ., inst = 1).Occ4  Mult(1, Educ, ., inst = 1).Occ5  
                       -0.59644                          0.51900  
  Mult(., Educ, Occ, inst = 2).  Mult(1, ., Occ, inst = 2).Educ1  
                        0.26953                         -5.13301  
Mult(1, ., Occ, inst = 2).Educ2  Mult(1, ., Occ, inst = 2).Educ3  
                       -2.79039                         -6.48668  
Mult(1, ., Occ, inst = 2).Educ4  Mult(1, Educ, ., inst = 2).Occ1  
                        8.06413                          0.04503  
Mult(1, Educ, ., inst = 2).Occ2  Mult(1, Educ, ., inst = 2).Occ3  
                       -0.22275                          0.06955  
Mult(1, Educ, ., inst = 2).Occ4  Mult(1, Educ, ., inst = 2).Occ5  
                        0.14602                          0.69295  

Deviance:            0.6001022 
Pearson chi-squared: 0.5746549 
Residual df:         2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>RC3 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ), <span class="dv">3</span>),</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult3[, <span class="dv">1</span>], <span class="cn">NA</span>, mult3[, <span class="dv">2</span>], <span class="cn">NA</span>, mult3[, <span class="dv">3</span>]),</span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations......
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>RC3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Educ + Occ + instances(Mult(1, Educ, Occ), 
    3), family = poisson, data = freq_tab_2.3B, start = c(coef(O), 
    NA, mult3[, 1], NA, mult3[, 2], NA, mult3[, 3]), tolerance = 1e-12)

Coefficients:
                    (Intercept)                            Educ2  
                        4.95717                         -0.82096  
                          Educ3                            Educ4  
                        1.80233                          0.56088  
                           Occ2                             Occ3  
                       -0.01071                         -2.60229  
                           Occ4                             Occ5  
                       -0.03443                         -3.33220  
  Mult(., Educ, Occ, inst = 1).  Mult(1, ., Occ, inst = 1).Educ1  
                        0.07701                          4.49001  
Mult(1, ., Occ, inst = 1).Educ2  Mult(1, ., Occ, inst = 1).Educ3  
                        0.73209                         -0.80675  
Mult(1, ., Occ, inst = 1).Educ4  Mult(1, Educ, ., inst = 1).Occ1  
                       -3.27385                          4.25316  
Mult(1, Educ, ., inst = 1).Occ2  Mult(1, Educ, ., inst = 1).Occ3  
                       -0.45231                         -1.88306  
Mult(1, Educ, ., inst = 1).Occ4  Mult(1, Educ, ., inst = 1).Occ5  
                       -3.54657                          0.57475  
  Mult(., Educ, Occ, inst = 2).  Mult(1, ., Occ, inst = 2).Educ1  
                        0.03847                          0.71197  
Mult(1, ., Occ, inst = 2).Educ2  Mult(1, ., Occ, inst = 2).Educ3  
                       -0.60272                         -2.69755  
Mult(1, ., Occ, inst = 2).Educ4  Mult(1, Educ, ., inst = 2).Occ1  
                        2.85641                          0.42735  
Mult(1, Educ, ., inst = 2).Occ2  Mult(1, Educ, ., inst = 2).Occ3  
                       -3.63366                          1.48249  
Mult(1, Educ, ., inst = 2).Occ4  Mult(1, Educ, ., inst = 2).Occ5  
                        1.63057                          9.18646  
  Mult(., Educ, Occ, inst = 3).  Mult(1, ., Occ, inst = 3).Educ1  
                        0.18372                         -0.83753  
Mult(1, ., Occ, inst = 3).Educ2  Mult(1, ., Occ, inst = 3).Educ3  
                        0.12534                         -1.49027  
Mult(1, ., Occ, inst = 3).Educ4  Mult(1, Educ, ., inst = 3).Occ1  
                       -1.01651                          1.23176  
Mult(1, Educ, ., inst = 3).Occ2  Mult(1, Educ, ., inst = 3).Occ3  
                        0.88823                         -0.30798  
Mult(1, Educ, ., inst = 3).Occ4  Mult(1, Educ, ., inst = 3).Occ5  
                        1.20713                          3.02765  

Deviance:            -1.132427e-14 
Pearson chi-squared: 4.543462e-27 
Residual df:         0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model.summary</span>(O),</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC),</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC2),</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  `Model Description`    df        L2       BIC    Delta     p
  &lt;chr&gt;               &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 O                      12  1.37e+ 3  1.27e+ 3 2.39e+ 1 1    
2 RC                      6  1.66e+ 4  1.66e+ 4 3.12e+ 0 1    
3 RC2                     2  6.00e- 1 -1.59e+ 1 9.35e- 2 0.259
4 RC3                     0 -1.13e-14 -1.13e-14 4.88e-14 0    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>anoas_model <span class="ot">&lt;-</span> <span class="fu">anoas</span>(tab_2<span class="fl">.3</span>B, <span class="at">nd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting independence model...
Fitting model with 1 dimension...
Initialising
Running start-up iterations..
Running main iterations.........................................................
...
Done
Fitting model with 2 dimensions...
Initialising
Running start-up iterations..
Running main iterations........
Done
Fitting model with 3 dimensions...
Initialising
Running start-up iterations..
Running main iterations......
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>anoas_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Res. Df           Res. Dev     Dev./Indep. (%)   Dissim. (%)
Indep.      12 1373.1757656522454 100.000000000000000 23.8615752953
RC(1)        6  125.0597485501469   9.107337289101130  6.4360390978
RC(2)        2    0.6001022352683   0.043701778772891  0.0935165802
RC(3)        0   -0.0000000000001  -0.000000000000008  0.0000000005
                      BIC                AIC    Dev. Df
Indep. 1274.0809153306573 1349.1757656522454      NA NA
RC(1)    75.5123233893528  113.0597485501469 -1248.1 -6
RC(2)   -15.9157061516631   -3.3998977647317  -124.5 -4
RC(3)    -0.0000000000001   -0.0000000000001    -0.6 -2</code></pre>
</div>
</div>
</section>
<section id="位相モデル" class="level2">
<h2 class="anchored" data-anchor-id="位相モデル">位相モデル</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>occupationalStatus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      destination
origin   1   2   3   4   5   6   7   8
     1  50  19  26   8   7  11   6   2
     2  16  40  34  18  11  20   8   3
     3  12  35  65  66  35  88  23  21
     4  11  20  58 110  40 183  64  32
     5   2   8  12  23  25  46  28  12
     6  12  28 102 162  90 554 230 177
     7   0   6  19  40  21 158 143  71
     8   0   3  14  32  15 126  91 106</code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(occupationalStatus)</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="ot">&lt;-</span> freq_occupationalStatus <span class="sc">|&gt;</span> </span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> destination, origin, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rscore =</span> <span class="fu">scale</span>(<span class="fu">as.numeric</span>(origin), <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cscore =</span> <span class="fu">scale</span>(<span class="fu">as.numeric</span>(destination), <span class="at">scale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span></span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination, <span class="at">family =</span> poisson, <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a>fit_QI <span class="ot">&lt;-</span></span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag,</span>
<span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb220-14"><a href="#cb220-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb220-15"><a href="#cb220-15" aria-hidden="true" tabindex="-1"></a>fit_U <span class="ot">&lt;-</span></span>
<span id="cb220-16"><a href="#cb220-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb220-17"><a href="#cb220-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb220-18"><a href="#cb220-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb220-19"><a href="#cb220-19" aria-hidden="true" tabindex="-1"></a>fit_QI_U <span class="ot">&lt;-</span></span>
<span id="cb220-20"><a href="#cb220-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb220-21"><a href="#cb220-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb220-22"><a href="#cb220-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb220-23"><a href="#cb220-23" aria-hidden="true" tabindex="-1"></a>fit_S <span class="ot">&lt;-</span></span>
<span id="cb220-24"><a href="#cb220-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> origin<span class="sc">:</span>destination,</span>
<span id="cb220-25"><a href="#cb220-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb220-26"><a href="#cb220-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb220-27"><a href="#cb220-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-28"><a href="#cb220-28" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="ot">&lt;-</span> freq_occupationalStatus <span class="sc">|&gt;</span> </span>
<span id="cb220-29"><a href="#cb220-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb220-30"><a href="#cb220-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag1 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb220-31"><a href="#cb220-31" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb220-32"><a href="#cb220-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag2 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span></span>
<span id="cb220-33"><a href="#cb220-33" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb220-34"><a href="#cb220-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag3 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span></span>
<span id="cb220-35"><a href="#cb220-35" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb220-36"><a href="#cb220-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag4 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span></span>
<span id="cb220-37"><a href="#cb220-37" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb220-38"><a href="#cb220-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag5 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span></span>
<span id="cb220-39"><a href="#cb220-39" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb220-40"><a href="#cb220-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag6 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span></span>
<span id="cb220-41"><a href="#cb220-41" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb220-42"><a href="#cb220-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag7 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">7</span> <span class="sc">&amp;</span></span>
<span id="cb220-43"><a href="#cb220-43" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb220-44"><a href="#cb220-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag8 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">8</span> <span class="sc">&amp;</span></span>
<span id="cb220-45"><a href="#cb220-45" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>()</span>
<span id="cb220-46"><a href="#cb220-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb220-47"><a href="#cb220-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-48"><a href="#cb220-48" aria-hidden="true" tabindex="-1"></a>fit_QI2 <span class="ot">&lt;-</span></span>
<span id="cb220-49"><a href="#cb220-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb220-50"><a href="#cb220-50" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag1 <span class="sc">+</span> diag2 <span class="sc">+</span> diag3 <span class="sc">+</span> diag4 <span class="sc">+</span> diag5 <span class="sc">+</span> diag6 <span class="sc">+</span> diag7 <span class="sc">+</span> diag8,</span>
<span id="cb220-51"><a href="#cb220-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb220-52"><a href="#cb220-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> freq_occupationalStatus</span>
<span id="cb220-53"><a href="#cb220-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb220-54"><a href="#cb220-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-55"><a href="#cb220-55" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_QI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ origin + destination + diag, family = poisson, 
    data = freq_occupationalStatus)

Deviance Residuals: 
       Min          1Q      Median          3Q         Max  
-4.567e+00  -2.318e+00  -1.045e-07   1.018e+00   6.152e+00  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   0.36346    0.17892   2.031 0.042211 *  
origin2       0.35445    0.14755   2.402 0.016292 *  
origin3       1.34923    0.12758  10.575  &lt; 2e-16 ***
origin4       1.76957    0.12322  14.362  &lt; 2e-16 ***
origin5       0.56615    0.14257   3.971 7.16e-05 ***
origin6       2.72612    0.11933  22.845  &lt; 2e-16 ***
origin7       1.54999    0.12619  12.283  &lt; 2e-16 ***
origin8       1.37488    0.12757  10.777  &lt; 2e-16 ***
destination2  0.82044    0.16521   4.966 6.83e-07 ***
destination3  1.69007    0.15065  11.219  &lt; 2e-16 ***
destination4  2.02648    0.14771  13.719  &lt; 2e-16 ***
destination5  1.43966    0.15317   9.399  &lt; 2e-16 ***
destination6  2.96856    0.14439  20.559  &lt; 2e-16 ***
destination7  2.24512    0.14547  15.434  &lt; 2e-16 ***
destination8  1.87534    0.14855  12.624  &lt; 2e-16 ***
diag1         3.54857    0.22806  15.560  &lt; 2e-16 ***
diag2         2.15053    0.20737  10.370  &lt; 2e-16 ***
diag3         0.77163    0.15275   5.052 4.38e-07 ***
diag4         0.54098    0.12287   4.403 1.07e-05 ***
diag5         0.84961    0.22965   3.700 0.000216 ***
diag6         0.25903    0.07531   3.439 0.000583 ***
diag7         0.80428    0.11438   7.031 2.04e-12 ***
diag8         1.04976    0.12946   8.109  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 446.84 on 41 degrees of freedom
AIC: 815.18

Number of iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_QI2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ origin + destination + diag1 + diag2 + diag3 + 
    diag4 + diag5 + diag6 + diag7 + diag8, family = poisson, 
    data = freq_occupationalStatus)

Deviance Residuals: 
       Min          1Q      Median          3Q         Max  
-4.567e+00  -2.318e+00  -1.045e-07   1.018e+00   6.152e+00  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   0.36346    0.17892   2.031 0.042211 *  
origin2       0.35445    0.14755   2.402 0.016292 *  
origin3       1.34923    0.12758  10.575  &lt; 2e-16 ***
origin4       1.76957    0.12322  14.362  &lt; 2e-16 ***
origin5       0.56615    0.14257   3.971 7.16e-05 ***
origin6       2.72612    0.11933  22.845  &lt; 2e-16 ***
origin7       1.54999    0.12619  12.283  &lt; 2e-16 ***
origin8       1.37488    0.12757  10.777  &lt; 2e-16 ***
destination2  0.82044    0.16521   4.966 6.83e-07 ***
destination3  1.69007    0.15065  11.219  &lt; 2e-16 ***
destination4  2.02648    0.14771  13.719  &lt; 2e-16 ***
destination5  1.43966    0.15317   9.399  &lt; 2e-16 ***
destination6  2.96856    0.14439  20.559  &lt; 2e-16 ***
destination7  2.24512    0.14547  15.434  &lt; 2e-16 ***
destination8  1.87534    0.14855  12.624  &lt; 2e-16 ***
diag11        3.54857    0.22806  15.560  &lt; 2e-16 ***
diag21        2.15053    0.20737  10.370  &lt; 2e-16 ***
diag31        0.77163    0.15275   5.052 4.38e-07 ***
diag41        0.54098    0.12287   4.403 1.07e-05 ***
diag51        0.84961    0.22965   3.700 0.000216 ***
diag61        0.25903    0.07531   3.439 0.000583 ***
diag71        0.80428    0.11438   7.031 2.04e-12 ***
diag81        1.04976    0.12946   8.109  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 446.84 on 41 degrees of freedom
AIC: 815.18

Number of iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_QI, fit_U, fit_QI_U, fit_S)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: Freq ~ origin + destination
Model 2: Freq ~ origin + destination + diag
Model 3: Freq ~ origin + destination + Rscore:Cscore
Model 4: Freq ~ origin + destination + diag + Rscore:Cscore
Model 5: Freq ~ origin + destination + origin:destination
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)    
1        49     954.49                         
2        41     446.84  8   507.65  &lt; 2e-16 ***
3        48     164.33 -7   282.51             
4        40      58.44  8   105.89  &lt; 2e-16 ***
5         0       0.00 40    58.44  0.02995 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_O),</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_QI),</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_U),</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_QI_U),</span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_S)</span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  `Model Description`    df      L2      BIC    Delta     p
  &lt;chr&gt;               &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 fit_O                  49 9.54e+2  5.55e+2 1.66e+ 1 1    
2 fit_QI                 41 4.47e+2  1.12e+2 1.00e+ 1 1    
3 fit_U                  48 1.64e+2 -2.27e+2 7.26e+ 0 1.000
4 fit_QI_U               40 5.84e+1 -2.68e+2 3.53e+ 0 0.970
5 fit_S                   0 4.50e-8  4.50e-8 3.22e-10 1    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(erikson)</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>erikson</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , country = EW

      destination
origin    I   II  III  IVa  IVb  IVc V/VI VIIa VIIb
  I     311  130   79   24   22    7   70   44    1
  II    161  128   66   22   11    6  112   47    1
  III   128  109   89   26   25    3  197  113    4
  IVa    88   83   43   72   41    5  112   64    4
  IVb    36   45   38   27   47    3  110   80    4
  IVc    43   23   25   16   14   99   86   81   40
  V/VI  356  375  325  108  140    5 1506  839   22
  VIIa  150  180  187   48   74    9  802  685   15
  VIIb   12   14   18    5   18   10   96  114   56

, , country = F

      destination
origin    I   II  III  IVa  IVb  IVc V/VI VIIa VIIb
  I     105   72   19    9    8    3   26   11    1
  II     59  113   37    9   14    0   54   34    2
  III    40   86   64   10   20    4  103   61    4
  IVa    38   37   17   38   23    2   36   22    1
  IVb    40   68   55   38   95   10   92   74    7
  IVc    27   74   77   27   52  461  156  286   73
  V/VI   36  138   93   22   38    5  339  189    9
  VIIa   22   88   79   18   24    8  235  209   11
  VIIb    4   18   26    9   14   19   68  107   47

, , country = S

      destination
origin    I   II  III  IVa  IVb  IVc V/VI VIIa VIIb
  I      52   15   13    3    2    0   11    7    0
  II     30   27   14    3    4    0   27   12    2
  III    10   19   10    2    4    0   16   11    1
  IVa    26   24    5   20    8    1   33   22    0
  IVb     8   13    6    3    9    4   31   20    1
  IVc    24   47   44   17   22   92  132  144   21
  V/VI   33   89   40   13   18    5  188  104    5
  VIIa   32   49   28   14   17    5  159  109    4
  VIIb    5   10    3    0    6    3   33   42    8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$origin
[1] "I"    "II"   "III"  "IVa"  "IVb"  "IVc"  "V/VI" "VIIa" "VIIb"

$destination
[1] "I"    "II"   "III"  "IVa"  "IVb"  "IVc"  "V/VI" "VIIa" "VIIb"

$country
[1] "EW" "F"  "S" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)<span class="sc">$</span>origin <span class="ot">&lt;-</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"I+II"</span>,<span class="st">"I+II"</span>,<span class="st">"III"</span>,<span class="st">"IVab"</span>,<span class="st">"IVab"</span>,<span class="st">"IVc"</span>,<span class="st">"V/VI"</span>,<span class="st">"VIIa"</span>,<span class="st">"VIIb"</span>)</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)<span class="sc">$</span>destination <span class="ot">&lt;-</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"I+II"</span>,<span class="st">"I+II"</span>,<span class="st">"III"</span>,<span class="st">"IVab"</span>,<span class="st">"IVab"</span>,<span class="st">"IVc"</span>,<span class="st">"V/VI"</span>,<span class="st">"VIIa"</span>,<span class="st">"VIIb"</span>)</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>freq_erikson <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(erikson)</span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>erikson2 <span class="ot">&lt;-</span></span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xtabs</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country, <span class="at">data =</span> freq_erikson)</span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a>freq_erikson <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(erikson2)</span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a>levelMatrix <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">6</span>,</span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>,</span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>,</span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">2</span>,</span>
<span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,</span>
<span id="cb232-15"><a href="#cb232-15" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">5</span>,</span>
<span id="cb232-16"><a href="#cb232-16" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">as.factor</span>()</span>
<span id="cb232-17"><a href="#cb232-17" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(freq_erikson, <span class="at">levelMatrix =</span> levelMatrix)</span>
<span id="cb232-18"><a href="#cb232-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-19"><a href="#cb232-19" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span></span>
<span id="cb232-20"><a href="#cb232-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb232-21"><a href="#cb232-21" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span> origin <span class="sc">*</span> country <span class="sc">+</span></span>
<span id="cb232-22"><a href="#cb232-22" aria-hidden="true" tabindex="-1"></a>      destination <span class="sc">*</span> country,</span>
<span id="cb232-23"><a href="#cb232-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb232-24"><a href="#cb232-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d</span>
<span id="cb232-25"><a href="#cb232-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb232-26"><a href="#cb232-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-27"><a href="#cb232-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-28"><a href="#cb232-28" aria-hidden="true" tabindex="-1"></a>fit_Common <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb232-29"><a href="#cb232-29" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span></span>
<span id="cb232-30"><a href="#cb232-30" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> country <span class="sc">+</span> destination <span class="sc">*</span> country <span class="sc">+</span></span>
<span id="cb232-31"><a href="#cb232-31" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> destination,</span>
<span id="cb232-32"><a href="#cb232-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb232-33"><a href="#cb232-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb232-34"><a href="#cb232-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb232-35"><a href="#cb232-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-36"><a href="#cb232-36" aria-hidden="true" tabindex="-1"></a>fit_Common_Pattern <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb232-37"><a href="#cb232-37" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span></span>
<span id="cb232-38"><a href="#cb232-38" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> country <span class="sc">+</span> destination <span class="sc">*</span> country <span class="sc">+</span> levelMatrix,</span>
<span id="cb232-39"><a href="#cb232-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb232-40"><a href="#cb232-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb232-41"><a href="#cb232-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb232-42"><a href="#cb232-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-43"><a href="#cb232-43" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb232-44"><a href="#cb232-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb232-45"><a href="#cb232-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred1 =</span> fit_O<span class="sc">$</span>fitted.values,</span>
<span id="cb232-46"><a href="#cb232-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred2 =</span> fit_Common<span class="sc">$</span>fitted.values,</span>
<span id="cb232-47"><a href="#cb232-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred3 =</span> fit_Common_Pattern<span class="sc">$</span>fitted.values</span>
<span id="cb232-48"><a href="#cb232-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb232-49"><a href="#cb232-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-50"><a href="#cb232-50" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ origin + destination + country + origin * 
    country + destination * country, family = poisson, data = d)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-12.763   -3.562   -1.393    1.767   22.208  

Coefficients:
                         Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)               5.74389    0.03348 171.575  &lt; 2e-16 ***
originIII                -0.58201    0.04739 -12.281  &lt; 2e-16 ***
originIVab               -0.31986    0.04375  -7.312 2.64e-13 ***
originIVc                -1.06769    0.05610 -19.032  &lt; 2e-16 ***
originV/VI                1.08510    0.03282  33.062  &lt; 2e-16 ***
originVIIa                0.54874    0.03564  15.397  &lt; 2e-16 ***
originVIIb               -1.28675    0.06100 -21.095  &lt; 2e-16 ***
destinationIII           -1.00300    0.03964 -25.305  &lt; 2e-16 ***
destinationIVab          -1.16484    0.04211 -27.664  &lt; 2e-16 ***
destinationIVc           -2.78106    0.08498 -32.724  &lt; 2e-16 ***
destinationV/VI           0.26476    0.02730   9.699  &lt; 2e-16 ***
destinationVIIa          -0.13764    0.03009  -4.574 4.78e-06 ***
destinationVIIb          -2.78106    0.08500 -32.720  &lt; 2e-16 ***
countryF                 -0.88695    0.05988 -14.811  &lt; 2e-16 ***
countryS                 -1.74777    0.08424 -20.747  &lt; 2e-16 ***
originIII:countryF        0.19716    0.08083   2.439 0.014718 *  
originIVab:countryF       0.50479    0.07136   7.073 1.51e-12 ***
originIVc:countryF        1.82879    0.07546  24.235  &lt; 2e-16 ***
originV/VI:countryF      -0.67387    0.06296 -10.703  &lt; 2e-16 ***
originVIIa:countryF      -0.36238    0.06669  -5.434 5.51e-08 ***
originVIIb:countryF       0.67364    0.09307   7.238 4.55e-13 ***
originIII:countryS       -0.53021    0.14300  -3.708 0.000209 ***
originIVab:countryS       0.37251    0.10340   3.603 0.000315 ***
originIVc:countryS        1.96213    0.09743  20.138  &lt; 2e-16 ***
originV/VI:countryS      -0.28322    0.08719  -3.248 0.001161 ** 
originVIIa:countryS       0.08166    0.09040   0.903 0.366354    
originVIIb:countryS       0.58455    0.13159   4.442 8.90e-06 ***
destinationIII:countryF   0.17859    0.06820   2.619 0.008827 ** 
destinationIVab:countryF  0.34258    0.06963   4.920 8.66e-07 ***
destinationIVc:countryF   2.04865    0.10057  20.370  &lt; 2e-16 ***
destinationV/VI:countryF -0.22428    0.05085  -4.411 1.03e-05 ***
destinationVIIa:countryF  0.06764    0.05340   1.267 0.205290    
destinationVIIb:countryF  0.85375    0.12089   7.062 1.64e-12 ***
destinationIII:countryS  -0.14353    0.09826  -1.461 0.144099    
destinationIVab:countryS  0.03051    0.09891   0.308 0.757741    
destinationIVc:countryS   1.24126    0.13514   9.185  &lt; 2e-16 ***
destinationV/VI:countryS -0.05932    0.06543  -0.907 0.364667    
destinationVIIa:countryS  0.05222    0.07055   0.740 0.459234    
destinationVIIb:countryS  0.27845    0.18161   1.533 0.125225    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 4860 on 108 degrees of freedom
AIC: 5752.1

Number of iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_Common)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"          "formula"       "terms"         "data"         
 [5] "eliminate"     "ofInterest"    "na.action"     "xlevels"      
 [9] "offset"        "tolerance"     "iterStart"     "iterMax"      
[13] "coefficients"  "residuals"     "fitted.values" "rank"         
[17] "family"        "predictors"    "deviance"      "aic"          
[21] "iter"          "weights"       "prior.weights" "df.residual"  
[25] "y"             "converged"     "constrain"     "constrainTo"  
[29] "x"             "model"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">summary</span>(fit_Common))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"           "ofInterest"     "family"         "deviance"      
 [5] "aic"            "df.residual"    "iter"           "deviance.resid"
 [9] "coefficients"   "eliminated"     "dispersion"     "df"            
[13] "cov.scaled"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_Common)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ origin + destination + country + origin * 
    country + destination * country + origin * destination, family = poisson, 
    data = d)

Deviance Residuals: 
      Min         1Q     Median         3Q        Max  
-2.894368  -0.493141  -0.001321   0.470201   2.903940  

Coefficients:
                           Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                 6.59629    0.03453 191.003  &lt; 2e-16 ***
originIII                  -1.13823    0.06560 -17.351  &lt; 2e-16 ***
originIVab                 -1.07370    0.06143 -17.479  &lt; 2e-16 ***
originIVc                  -2.70361    0.09016 -29.987  &lt; 2e-16 ***
originV/VI                  0.01007    0.04703   0.214 0.830527    
originVIIa                 -0.77338    0.05726 -13.507  &lt; 2e-16 ***
originVIIb                 -3.26650    0.13781 -23.702  &lt; 2e-16 ***
destinationIII             -1.69227    0.07692 -22.001  &lt; 2e-16 ***
destinationIVab            -2.25353    0.09612 -23.445  &lt; 2e-16 ***
destinationIVc             -4.55452    0.25826 -17.635  &lt; 2e-16 ***
destinationV/VI            -1.34800    0.06703 -20.112  &lt; 2e-16 ***
destinationVIIa            -2.03630    0.08773 -23.212  &lt; 2e-16 ***
destinationVIIb            -5.12499    0.38197 -13.417  &lt; 2e-16 ***
countryF                   -0.79371    0.05423 -14.637  &lt; 2e-16 ***
countryS                   -1.65837    0.07661 -21.646  &lt; 2e-16 ***
originIII:countryF          0.20390    0.08179   2.493 0.012668 *  
originIVab:countryF         0.48071    0.07350   6.540 6.15e-11 ***
originIVc:countryF          1.61954    0.08393  19.295  &lt; 2e-16 ***
originV/VI:countryF        -0.64330    0.06586  -9.767  &lt; 2e-16 ***
originVIIa:countryF        -0.33935    0.07019  -4.835 1.33e-06 ***
originVIIb:countryF         0.64616    0.09861   6.553 5.65e-11 ***
originIII:countryS         -0.49402    0.14390  -3.433 0.000597 ***
originIVab:countryS         0.42215    0.10589   3.987 6.70e-05 ***
originIVc:countryS          2.10894    0.10644  19.814  &lt; 2e-16 ***
originV/VI:countryS        -0.23466    0.09102  -2.578 0.009934 ** 
originVIIa:countryS         0.14235    0.09505   1.498 0.134221    
originVIIb:countryS         0.72346    0.13754   5.260 1.44e-07 ***
destinationIII:countryF     0.17483    0.07130   2.452 0.014209 *  
destinationIVab:countryF    0.18250    0.07402   2.465 0.013684 *  
destinationIVc:countryF     0.73972    0.11572   6.392 1.64e-10 ***
destinationV/VI:countryF   -0.11294    0.05496  -2.055 0.039884 *  
destinationVIIa:countryF    0.02129    0.05885   0.362 0.717449    
destinationVIIb:countryF    0.11636    0.13452   0.865 0.387023    
destinationIII:countryS    -0.22236    0.10142  -2.192 0.028352 *  
destinationIVab:countryS   -0.17172    0.10342  -1.660 0.096839 .  
destinationIVc:countryS    -0.38697    0.15155  -2.553 0.010668 *  
destinationV/VI:countryS   -0.09561    0.07021  -1.362 0.173263    
destinationVIIa:countryS   -0.17583    0.07672  -2.292 0.021913 *  
destinationVIIb:countryS   -0.64986    0.19498  -3.333 0.000859 ***
originIII:destinationIII    0.76642    0.11807   6.491 8.52e-11 ***
originIVab:destinationIII   0.52595    0.11560   4.550 5.37e-06 ***
originIVc:destinationIII    1.17849    0.13041   9.037  &lt; 2e-16 ***
originV/VI:destinationIII   0.87374    0.09195   9.502  &lt; 2e-16 ***
originVIIa:destinationIII   1.10866    0.10285  10.779  &lt; 2e-16 ***
originVIIb:destinationIII   1.36163    0.20619   6.604 4.01e-11 ***
originIII:destinationIVab   0.69419    0.15016   4.623 3.78e-06 ***
originIVab:destinationIVab  2.02108    0.11352  17.804  &lt; 2e-16 ***
originIVc:destinationIVab   1.73618    0.14216  12.213  &lt; 2e-16 ***
originV/VI:destinationIVab  1.12813    0.11169  10.101  &lt; 2e-16 ***
originVIIa:destinationIVab  1.25162    0.12471  10.036  &lt; 2e-16 ***
originVIIb:destinationIVab  2.01369    0.20909   9.631  &lt; 2e-16 ***
originIII:destinationIVc    0.23560    0.45713   0.515 0.606273    
originIVab:destinationIVc   1.24669    0.32500   3.836 0.000125 ***
originIVc:destinationIVc    5.21749    0.26575  19.633  &lt; 2e-16 ***
originV/VI:destinationIVc   0.18607    0.36231   0.514 0.607553    
originVIIa:destinationIVc   1.22166    0.33304   3.668 0.000244 ***
originVIIb:destinationIVc   3.56730    0.33324  10.705  &lt; 2e-16 ***
originIII:destinationV/VI   1.17516    0.09949  11.812  &lt; 2e-16 ***
originIVab:destinationV/VI  1.20044    0.09270  12.950  &lt; 2e-16 ***
originIVc:destinationV/VI   1.88309    0.10710  17.582  &lt; 2e-16 ***
originV/VI:destinationV/VI  2.05945    0.07524  27.372  &lt; 2e-16 ***
originVIIa:destinationV/VI  2.21492    0.08327  26.601  &lt; 2e-16 ***
originVIIb:destinationV/VI  2.54647    0.15871  16.045  &lt; 2e-16 ***
originIII:destinationVIIa   1.28947    0.12352  10.440  &lt; 2e-16 ***
originIVab:destinationVIIa  1.46717    0.11334  12.944  &lt; 2e-16 ***
originIVc:destinationVIIa   2.84331    0.11806  24.084  &lt; 2e-16 ***
originV/VI:destinationVIIa  2.14755    0.09583  22.410  &lt; 2e-16 ***
originVIIa:destinationVIIa  2.70994    0.10109  26.807  &lt; 2e-16 ***
originVIIb:destinationVIIa  3.48535    0.16446  21.193  &lt; 2e-16 ***
originIII:destinationVIIb   1.34327    0.50723   2.648 0.008091 ** 
originIVab:destinationVIIb  1.75599    0.45232   3.882 0.000104 ***
originIVc:destinationVIIb   4.65198    0.39743  11.705  &lt; 2e-16 ***
originV/VI:destinationVIIb  1.80532    0.41541   4.346 1.39e-05 ***
originVIIa:destinationVIIb  2.31365    0.42297   5.470 4.50e-08 ***
originVIIb:destinationVIIb  5.72803    0.41103  13.936  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Residual deviance: 121.3 on 72 degrees of freedom
AIC: 1085.4

Number of iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_Common_Pattern, fit_Common)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: Freq ~ origin + destination + country + origin:country + destination:country
Model 2: Freq ~ origin + destination + country + origin:country + destination:country + 
    levelMatrix
Model 3: Freq ~ origin + destination + country + origin:country + destination:country + 
    origin:destination
  Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
1       108     4860.0                          
2       103      505.6  5   4354.4 &lt; 2.2e-16 ***
3        72      121.3 31    384.3 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="連関モデルと正準相関分析" class="level2">
<h2 class="anchored" data-anchor-id="連関モデルと正準相関分析">連関モデルと正準相関分析</h2>
<p><span class="citation" data-cites="goodman1981">Goodman (<a href="#ref-goodman1981" role="doc-biblioref">1981</a>)</span> のTable 1のaより．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">6</span>, <span class="dv">26</span>, <span class="dv">11</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">23</span>, <span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">16</span>)</span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col) <span class="sc">|&gt;</span> </span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">U =</span> <span class="fu">as.numeric</span>(Row),</span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">V =</span> <span class="fu">as.numeric</span>(Col))</span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Col
Row  1  2  3  4
  1  5  3 10 11
  2  4  5  8  6
  3 26 11  3  6
  4 23 11  1  2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) O</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col,</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) U</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> U<span class="sc">:</span>V,</span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true" tabindex="-1"></a><span class="co"># (3) R</span></span>
<span id="cb244-12"><a href="#cb244-12" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb244-13"><a href="#cb244-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>V,</span>
<span id="cb244-14"><a href="#cb244-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb244-15"><a href="#cb244-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb244-16"><a href="#cb244-16" aria-hidden="true" tabindex="-1"></a><span class="co"># (4) C</span></span>
<span id="cb244-17"><a href="#cb244-17" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb244-18"><a href="#cb244-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Col<span class="sc">:</span>U,</span>
<span id="cb244-19"><a href="#cb244-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb244-20"><a href="#cb244-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb244-21"><a href="#cb244-21" aria-hidden="true" tabindex="-1"></a><span class="co"># (5) RC</span></span>
<span id="cb244-22"><a href="#cb244-22" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb244-23"><a href="#cb244-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb244-24"><a href="#cb244-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb244-25"><a href="#cb244-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (6) U + RC</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> U<span class="sc">:</span>V <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations..............
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (7) R + RC</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>V <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...............
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (8) C + RC</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Col<span class="sc">:</span>U <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations....
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (9) R + C + RC</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>V <span class="sc">+</span> Col<span class="sc">:</span>U <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations..
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (10) R + C</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>RplusC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>V <span class="sc">+</span> Col<span class="sc">:</span>U,</span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(O, U, R, C, RC, UplusRC, RplusRC, CplusRC, RplusCplusRC, RplusC) <span class="sc">|&gt;</span> </span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(glance, <span class="at">id =</span> <span class="st">"Model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 8
   null.deviance df.null logLik   AIC   BIC    deviance df.residual  nobs
           &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
 1            NA      NA  -53.0 120.  125.  46.9                  9    16
 2            NA      NA  -35.5  86.9  93.1 11.9                  8    16
 3            NA      NA  -34.5  88.9  96.7  9.88                 6    16
 4            NA      NA  -31.7  83.4  91.1  4.35                 6    16
 5            NA      NA  -30.4  84.8  94.1  1.74                 4    16
 6            NA      NA  -30.3  86.7  96.7  1.60                 3    16
 7            NA      NA  -30.3  88.6  99.4  1.49                 2    16
 8            NA      NA  -29.5  87.1  97.9  0.00771              2    16
 9            NA      NA  -29.5  89.1 101.   0.00000129           1    16
10            NA      NA  -30.9  85.9  95.2  2.81                 4    16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations........
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Row + Col + Mult(1, Row, Col), family = poisson, 
    data = d)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.51267  -0.25916  -0.03574   0.25369   0.66120  

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)            2.2607         NA      NA       NA
Row2                  -0.1177         NA      NA       NA
Row3                   0.6089         NA      NA       NA
Row4                   0.1565         NA      NA       NA
Col2                  -0.5289         NA      NA       NA
Col3                  -1.1438         NA      NA       NA
Col4                  -0.7842         NA      NA       NA
Mult(., Row, Col).   -10.0887         NA      NA       NA
Mult(1, ., Col).Row1   0.4145         NA      NA       NA
Mult(1, ., Col).Row2   0.3209         NA      NA       NA
Mult(1, ., Col).Row3  -0.1926         NA      NA       NA
Mult(1, ., Col).Row4  -0.4234         NA      NA       NA
Mult(1, Row, .).Col1   0.1759         NA      NA       NA
Mult(1, Row, .).Col2   0.0975         NA      NA       NA
Mult(1, Row, .).Col3  -0.2997         NA      NA       NA
Mult(1, Row, .).Col4  -0.1962         NA      NA       NA

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 1.7442 on 4 degrees of freedom
AIC: 84.814

Number of iterations: 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>rowProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(d, <span class="fu">tapply</span>(Freq, Row, sum) <span class="sc">/</span> <span class="fu">sum</span>(Freq))</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>colProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(d, <span class="fu">tapply</span>(Freq, Col, sum) <span class="sc">/</span> <span class="fu">sum</span>(Freq))</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pickCoef</span>(fit, <span class="st">"[.]Row"</span>),</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> rowProbs,</span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> rowProbs,</span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> rowProbs</span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pickCoef</span>(fit, <span class="st">"[.]Col"</span>),</span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> colProbs,</span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> colProbs,</span>
<span id="cb260-15"><a href="#cb260-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> colProbs</span>
<span id="cb260-16"><a href="#cb260-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb260-17"><a href="#cb260-17" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span></span>
<span id="cb260-18"><a href="#cb260-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb260-19"><a href="#cb260-19" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb260-20"><a href="#cb260-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb260-21"><a href="#cb260-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d,</span>
<span id="cb260-22"><a href="#cb260-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">constrain =</span> <span class="dv">9</span><span class="sc">:</span><span class="dv">16</span>,</span>
<span id="cb260-23"><a href="#cb260-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">constrainTo =</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>])</span>
<span id="cb260-24"><a href="#cb260-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running main iterations
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>mu_score <span class="ot">&lt;-</span> <span class="fu">rep</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="at">each =</span> <span class="dv">4</span>)</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>nu_score <span class="ot">&lt;-</span> <span class="fu">rep</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="dv">4</span>)</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">mu =</span> mu_score,</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">nu =</span> nu_score)</span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Canonical correlation</span></span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wCorr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>wCorr v1.9.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(d, <span class="fu">weightedCorr</span>(mu, <span class="at">x =</span> nu, <span class="at">weights =</span> Freq, <span class="at">method =</span> <span class="st">"Pearson"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5585432</code></pre>
</div>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(d, <span class="fu">weightedCorr</span>(U, <span class="at">x =</span> V, <span class="at">weights =</span> Freq, <span class="at">method =</span> <span class="st">"Polychoric"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5380634</code></pre>
</div>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(polycor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: パッケージ 'polycor' はバージョン 4.5.2 の R の下で造られました</code></pre>
</div>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
次のパッケージを付け加えます: 'vcdExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>以下のオブジェクトは 'package:dplyr' からマスクされています:

    summarise</code></pre>
</div>
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>d_ind <span class="ot">&lt;-</span> <span class="fu">expand.dft</span>(d, <span class="at">dreq =</span> <span class="st">"Freq"</span>)</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>d_ind</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 135 × 6
     Row   Col     U     V    mu     nu
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1     1     1     1     1  1.34  0.851
 2     1     1     1     1  1.34  0.851
 3     1     1     1     1  1.34  0.851
 4     1     1     1     1  1.34  0.851
 5     1     1     1     1  1.34  0.851
 6     1     2     1     2  1.34  0.444
 7     1     2     1     2  1.34  0.444
 8     1     2     1     2  1.34  0.444
 9     1     3     1     3  1.34 -1.62 
10     1     3     1     3  1.34 -1.62 
# ℹ 125 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">CorPolychor</span>(d_ind<span class="sc">$</span>U, d_ind<span class="sc">$</span>V, <span class="at">ML =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5326198</code></pre>
</div>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
gnm(formula = Freq ~ Row + Col + Mult(1, Row, Col), constrain = 9:16, 
    constrainTo = c(mu$qvframe[, 1], -1 * nu$qvframe[, 1]), family = poisson, 
    data = d)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.51267  -0.25916  -0.03574   0.25369   0.66120  

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)            2.2730     0.2679   8.484  &lt; 2e-16 ***
Row2                  -0.1064     0.2823  -0.377 0.706328    
Row3                   0.6827     0.2698   2.530 0.011397 *  
Row4                   0.2584     0.2844   0.908 0.363656    
Col2                  -0.5588     0.2278  -2.454 0.014141 *  
Col3                  -1.3258     0.3082  -4.301 1.70e-05 ***
Col4                  -0.9266     0.2677  -3.462 0.000536 ***
Mult(., Row, Col).     0.6577     0.1127   5.836 5.35e-09 ***
Mult(1, ., Col).Row1   1.3355         NA      NA       NA    
Mult(1, ., Col).Row2   1.0593         NA      NA       NA    
Mult(1, ., Col).Row3  -0.4565         NA      NA       NA    
Mult(1, ., Col).Row4  -1.1376         NA      NA       NA    
Mult(1, Row, .).Col1  -0.8514         NA      NA       NA    
Mult(1, Row, .).Col2  -0.4441         NA      NA       NA    
Mult(1, Row, .).Col3   1.6203         NA      NA       NA    
Mult(1, Row, .).Col4   1.0823         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

Std. Error is NA where coefficient has been constrained or is unidentified

Residual deviance: 1.7442 on 8 degrees of freedom
AIC: 76.814

Number of iterations: 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> fit<span class="sc">$</span>coefficients[<span class="st">"Mult(., Row, Col)."</span>] <span class="sc">|&gt;</span> <span class="fu">abs</span>()</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> phi <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> phi)</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> phi) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> eta <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> eta</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>mu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Estimate Std. Error
Mult(1, ., Col).Row1  1.3354657  0.1909635
Mult(1, ., Col).Row2  1.0592605  0.2590555
Mult(1, ., Col).Row3 -0.4564888  0.2467937
Mult(1, ., Col).Row4 -1.1376490  0.2191522</code></pre>
</div>
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>nu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Estimate Std. Error
Mult(1, Row, .).Col1  0.8513968  0.1194283
Mult(1, Row, .).Col2  0.4440776  0.2763713
Mult(1, Row, .).Col3 -1.6203060  0.2558555
Mult(1, Row, .).Col4 -1.0822644  0.2870932</code></pre>
</div>
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>phi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(., Row, Col). 
         0.6576831 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>rho</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(., Row, Col). 
         0.4959289 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>tau</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(., Row, Col). 
         0.4959289 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>delta_mu <span class="ot">&lt;-</span> <span class="fu">abs</span>((<span class="sc">-</span><span class="fl">1.3354658</span> <span class="sc">-</span> <span class="fl">1.1376491</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">4</span>))</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>delta_nu <span class="ot">&lt;-</span> <span class="fu">abs</span>((<span class="sc">-</span><span class="fl">0.8513968</span> <span class="sc">-</span> <span class="fl">1.0822644</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">4</span>))</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted</span></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>tau <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> delta_mu <span class="sc">/</span> <span class="dv">12</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> delta_nu <span class="sc">/</span> <span class="dv">12</span>)) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mult(., Row, Col). 
         0.5282781 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq,</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a>rc2 <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab,</span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">nd =</span> <span class="dv">1</span>,</span>
<span id="cb291-8"><a href="#cb291-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">weighting =</span> <span class="st">"marginal"</span>,</span>
<span id="cb291-9"><a href="#cb291-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">se =</span> <span class="st">"bootstrap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initialising
Running start-up iterations..
Running main iterations...........
Done
Computing bootstrap standard errors...
.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in jackboot(se, ncpus, nreplicates, tab, model, assoc1 =
getS3method("assoc", : 3 model replicates failed and their results will be
skipped. Standard errors will not be completely accurate. Consider raising the
value of iterMax.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rc2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rc(tab = tab, nd = 1, weighting = "marginal", se = "bootstrap")

Deviance Residuals:
    Columns
Rows         A         B         C         D
   A   0.18575  -0.40583  -0.21673   0.32921
   B  -0.38647   0.66120   0.30497  -0.51267
   C   0.23692  -0.44850  -0.07819   0.21153
   D  -0.15877   0.30399   0.00672  -0.14657

Association coefficients:
               Normalized  Adjusted  Std. error   Pr(&gt;|z|)     
Dim1              0.65768        NA      0.2651  0.0130990  *  
Dim1:RowsA        1.33547   1.08303      0.2442  4.533e-08  ***
Dim1:RowsB        1.05926   0.85904      0.3106  0.0006477  ***
Dim1:RowsC       -0.45649  -0.37020      0.2656  0.0856311  .  
Dim1:RowsD       -1.13765  -0.92261      0.2738  3.243e-05  ***
Dim1:ColumnsA    -0.85140  -0.69046      0.1382  7.336e-10  ***
Dim1:ColumnsB    -0.44408  -0.36014      0.3170  0.1612772     
Dim1:ColumnsC     1.62031   1.31403      0.3335  1.186e-06  ***
Dim1:ColumnsD     1.08226   0.87769      0.3662  0.0031246  ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Normalization weights: marginal
Deviance:              1.744218
Pearson chi-squared:   1.760665
Dissimilarity index:   4.670712%
Residual df:           4
BIC:                   -17.87688
AIC:                   -6.255782</code></pre>
</div>
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assoc</span>(rc2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$phi
          Dim1
[1,] 0.6576832

$row
, , 1

        Dim1
A  1.3354659
B  1.0592602
C -0.4564886
D -1.1376492


$col
, , 1

        Dim1
A -0.8513968
B -0.4440776
C  1.6203060
D  1.0822643


$diagonal
numeric(0)

$weighting
[1] "marginal"

$row.weights
  [,1]
A   29
B   23
C   46
D   37

$col.weights
  [,1]
A   58
B   30
C   22
D   25

$vars
[1] "Rows"    "Columns"

attr(,"class")
[1] "assoc.rc" "assoc"   </code></pre>
</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-goodman1981" class="csl-entry" role="listitem">
Goodman, Leo A. 1981. <span>“Association <span>Models</span> and <span>Canonical Correlation</span> in the <span>Analysis</span> of <span>Cross-Classifications Having Ordered Categories</span>.”</span> <em>Journal of the American Statistical Association</em> 76 (374): 320–34. <a href="https://doi.org/10.1080/01621459.1981.10477651">https://doi.org/10.1080/01621459.1981.10477651</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./8-degrees_of_freedom.html" class="pagination-link" aria-label="自由度">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">自由度</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10-R.html" class="pagination-link" aria-label="RとRStudioのインストールと基本的な操作方法">
        <span class="nav-page-text">RとRStudioのインストールと基本的な操作方法</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb298" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># 補足のノート {-}</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## パッケージ</span></span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb298-8"><a href="#cb298-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb298-9"><a href="#cb298-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb298-10"><a href="#cb298-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb298-11"><a href="#cb298-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb298-12"><a href="#cb298-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-13"><a href="#cb298-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-14"><a href="#cb298-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-15"><a href="#cb298-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## クロス表の作成</span></span>
<span id="cb298-16"><a href="#cb298-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-19"><a href="#cb298-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-20"><a href="#cb298-20" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>,  <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, </span>
<span id="cb298-21"><a href="#cb298-21" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>,  <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>,</span>
<span id="cb298-22"><a href="#cb298-22" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>,</span>
<span id="cb298-23"><a href="#cb298-23" aria-hidden="true" tabindex="-1"></a>           <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>,</span>
<span id="cb298-24"><a href="#cb298-24" aria-hidden="true" tabindex="-1"></a>           <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>,</span>
<span id="cb298-25"><a href="#cb298-25" aria-hidden="true" tabindex="-1"></a>           <span class="dv">21</span>,  <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb298-26"><a href="#cb298-26" aria-hidden="true" tabindex="-1"></a><span class="co"># byrow = TRUEとすることを忘れずに．</span></span>
<span id="cb298-27"><a href="#cb298-27" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq, <span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb298-28"><a href="#cb298-28" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab)</span>
<span id="cb298-29"><a href="#cb298-29" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">SES =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb298-30"><a href="#cb298-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MHS =</span> <span class="fu">c</span>(<span class="st">"well"</span>, <span class="st">"mild"</span>, <span class="st">"moderate"</span>, <span class="st">"impaired"</span>))</span>
<span id="cb298-31"><a href="#cb298-31" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb298-32"><a href="#cb298-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-33"><a href="#cb298-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-34"><a href="#cb298-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-35"><a href="#cb298-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-36"><a href="#cb298-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## 集計データの作成</span></span>
<span id="cb298-37"><a href="#cb298-37" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>表のデータではなく，各変数の組み合わせとその度数からなるデータを作成する．</span>
<span id="cb298-38"><a href="#cb298-38" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>度数はまず1行目について数値を並べ（1行1列から1行$I$列まで），次に2行目について数値を並べる（2行1列から2行$I$列まで）．これを<span class="in">`Freq`</span>とする．</span>
<span id="cb298-39"><a href="#cb298-39" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>例として「編者による序文」の親の職業と精神的健康の例で考えてみる．これは$6\times4$のクロス表なので，まず1行1列から1行4列までの数字を入力し，次に2行1列から2行4列まで入力する．これを3行目から6行目まで繰り返す．表との対応を考えて適当な改行をいれるのもよい．ただしRは改行を入れても入れなくても，単に数値の列（ベクトル）として扱う．</span>
<span id="cb298-40"><a href="#cb298-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-41"><a href="#cb298-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`gl`</span>によって変数を作成する．度数がどの行と列に対応しているのかに注意してほしい．</span>
<span id="cb298-42"><a href="#cb298-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-43"><a href="#cb298-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-46"><a href="#cb298-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-47"><a href="#cb298-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 1行1列から1行4列，・・・・，6行1列から6行4列まで順に入力</span></span>
<span id="cb298-48"><a href="#cb298-48" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>, <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, <span class="dv">57</span>, <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>, <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>, <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>, <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>, <span class="dv">21</span>, <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb298-49"><a href="#cb298-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-50"><a href="#cb298-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 表ようにして入力</span></span>
<span id="cb298-51"><a href="#cb298-51" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>,  <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, </span>
<span id="cb298-52"><a href="#cb298-52" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>,  <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>,</span>
<span id="cb298-53"><a href="#cb298-53" aria-hidden="true" tabindex="-1"></a>           <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>,</span>
<span id="cb298-54"><a href="#cb298-54" aria-hidden="true" tabindex="-1"></a>           <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>,</span>
<span id="cb298-55"><a href="#cb298-55" aria-hidden="true" tabindex="-1"></a>           <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>,</span>
<span id="cb298-56"><a href="#cb298-56" aria-hidden="true" tabindex="-1"></a>           <span class="dv">21</span>,  <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb298-57"><a href="#cb298-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-58"><a href="#cb298-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-59"><a href="#cb298-59" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>行カテゴリと列カテゴリの数は$I$や$J$となっている．</span>
<span id="cb298-60"><a href="#cb298-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`I`</span>を使いたいが，Rの関数にすでに用意されているので別の名前を考える．ここでは<span class="in">`NI`</span>と<span class="in">`NJ`</span>とする．</span>
<span id="cb298-61"><a href="#cb298-61" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>例のデータでは，行カテゴリ数$I = 4$，列カテゴリ数$J = 5$である．</span>
<span id="cb298-62"><a href="#cb298-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-65"><a href="#cb298-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-66"><a href="#cb298-66" aria-hidden="true" tabindex="-1"></a>NI <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb298-67"><a href="#cb298-67" aria-hidden="true" tabindex="-1"></a>NJ <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb298-68"><a href="#cb298-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-69"><a href="#cb298-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-70"><a href="#cb298-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-71"><a href="#cb298-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>では，<span class="in">`Freq`</span>に対応する行カテゴリと列カテゴリを並べてみる．先程の入力のルールにしたがうと，行については1行1列から1行4列までの数字を入力しているので<span class="in">`1,1,1,1`</span>となり，次に<span class="in">`2,2,2,2`</span>となる．これを繰り返し最後は<span class="in">`6,6,6,6`</span>となる．列については，<span class="in">`1,2,3,4`</span>が6回繰り返される．</span>
<span id="cb298-72"><a href="#cb298-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-75"><a href="#cb298-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-76"><a href="#cb298-76" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>)</span>
<span id="cb298-77"><a href="#cb298-77" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb298-78"><a href="#cb298-78" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span>
<span id="cb298-79"><a href="#cb298-79" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span>
<span id="cb298-80"><a href="#cb298-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-81"><a href="#cb298-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-82"><a href="#cb298-82" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>属性が数値になっているので<span class="in">`as.factor`</span>（または<span class="in">`factor`</span>）で因子（factor）に変換する．</span>
<span id="cb298-83"><a href="#cb298-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-86"><a href="#cb298-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-87"><a href="#cb298-87" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Row)</span>
<span id="cb298-88"><a href="#cb298-88" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Col)</span>
<span id="cb298-89"><a href="#cb298-89" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row);<span class="fu">class</span>(Col)</span>
<span id="cb298-90"><a href="#cb298-90" aria-hidden="true" tabindex="-1"></a>Row</span>
<span id="cb298-91"><a href="#cb298-91" aria-hidden="true" tabindex="-1"></a>Col</span>
<span id="cb298-92"><a href="#cb298-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-93"><a href="#cb298-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-94"><a href="#cb298-94" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>単純な数値の列を作成したければ<span class="in">`rep`</span>関数が便利である．これは整数（integer）となる．</span>
<span id="cb298-95"><a href="#cb298-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-98"><a href="#cb298-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-99"><a href="#cb298-99" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb298-100"><a href="#cb298-100" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">20</span>)</span>
<span id="cb298-101"><a href="#cb298-101" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span>
<span id="cb298-102"><a href="#cb298-102" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span>
<span id="cb298-103"><a href="#cb298-103" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Row)</span>
<span id="cb298-104"><a href="#cb298-104" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Col)</span>
<span id="cb298-105"><a href="#cb298-105" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span>
<span id="cb298-106"><a href="#cb298-106" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span>
<span id="cb298-107"><a href="#cb298-107" aria-hidden="true" tabindex="-1"></a>Row</span>
<span id="cb298-108"><a href="#cb298-108" aria-hidden="true" tabindex="-1"></a>Col</span>
<span id="cb298-109"><a href="#cb298-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-110"><a href="#cb298-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-111"><a href="#cb298-111" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`gl`</span>はGenerate Factor Levelsという関数で，<span class="in">`rep`</span>に似ているが，数値ではなく因子を結果として出力する．</span>
<span id="cb298-112"><a href="#cb298-112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>1から<span class="in">`n`</span>までの数字をぞれぞれ<span class="in">`k`</span>回繰り返して出力する．</span>
<span id="cb298-113"><a href="#cb298-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-116"><a href="#cb298-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-117"><a href="#cb298-117" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb298-118"><a href="#cb298-118" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">24</span>)</span>
<span id="cb298-119"><a href="#cb298-119" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Row)</span>
<span id="cb298-120"><a href="#cb298-120" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Col)</span>
<span id="cb298-121"><a href="#cb298-121" aria-hidden="true" tabindex="-1"></a>Row</span>
<span id="cb298-122"><a href="#cb298-122" aria-hidden="true" tabindex="-1"></a>Col</span>
<span id="cb298-123"><a href="#cb298-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-124"><a href="#cb298-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-125"><a href="#cb298-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>以上より，<span class="in">`Freq`</span>，<span class="in">`Row`</span>，<span class="in">`Col`</span>の3つの変数が作成された．これらからなるデータを作成する．<span class="in">`data.frame`</span>と<span class="in">`tibble`</span>のどちらでもよいが，</span>
<span id="cb298-126"><a href="#cb298-126" aria-hidden="true" tabindex="-1"></a><span class="in">`tibble`</span>の場合は表示させた後に，データの構造（<span class="in">`&lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;`</span>）が表示される．</span>
<span id="cb298-127"><a href="#cb298-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-130"><a href="#cb298-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-131"><a href="#cb298-131" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Freq, Row, Col)</span>
<span id="cb298-132"><a href="#cb298-132" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb298-133"><a href="#cb298-133" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble でもよい</span></span>
<span id="cb298-134"><a href="#cb298-134" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col)</span>
<span id="cb298-135"><a href="#cb298-135" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb298-136"><a href="#cb298-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-137"><a href="#cb298-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-138"><a href="#cb298-138" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>以上をまとめると次のようになる．本書のプログラム例では<span class="in">`gl`</span>を使うことが多いのでここで使用方法を覚えておこう．</span>
<span id="cb298-139"><a href="#cb298-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-142"><a href="#cb298-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-143"><a href="#cb298-143" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">64</span>, <span class="dv">94</span>, <span class="dv">58</span>, <span class="dv">46</span>, <span class="dv">57</span>, <span class="dv">94</span>, <span class="dv">54</span>, <span class="dv">40</span>, <span class="dv">57</span>, <span class="dv">105</span>, <span class="dv">65</span>, <span class="dv">60</span>, <span class="dv">72</span>, <span class="dv">141</span>, <span class="dv">77</span>, <span class="dv">94</span>, <span class="dv">36</span>,  <span class="dv">97</span>, <span class="dv">54</span>, <span class="dv">78</span>, <span class="dv">21</span>, <span class="dv">71</span>, <span class="dv">54</span>, <span class="dv">71</span>)</span>
<span id="cb298-144"><a href="#cb298-144" aria-hidden="true" tabindex="-1"></a>NI <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb298-145"><a href="#cb298-145" aria-hidden="true" tabindex="-1"></a>NJ <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb298-146"><a href="#cb298-146" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> NI, <span class="at">k =</span> NJ, <span class="at">length =</span> NI <span class="sc">*</span> NJ)</span>
<span id="cb298-147"><a href="#cb298-147" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> NJ, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> NI <span class="sc">*</span> NJ)</span>
<span id="cb298-148"><a href="#cb298-148" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col)</span>
<span id="cb298-149"><a href="#cb298-149" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb298-150"><a href="#cb298-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-151"><a href="#cb298-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-152"><a href="#cb298-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-153"><a href="#cb298-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-154"><a href="#cb298-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-155"><a href="#cb298-155" aria-hidden="true" tabindex="-1"></a><span class="fu">## GLMとGNMの結果の比較</span></span>
<span id="cb298-156"><a href="#cb298-156" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>glmとgnmでは適合度や係数は同じだが，出力されるものが異なる．</span>
<span id="cb298-157"><a href="#cb298-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-160"><a href="#cb298-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-161"><a href="#cb298-161" aria-hidden="true" tabindex="-1"></a>fit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb298-162"><a href="#cb298-162" aria-hidden="true" tabindex="-1"></a>fit_gnm <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb298-163"><a href="#cb298-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-164"><a href="#cb298-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-165"><a href="#cb298-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-166"><a href="#cb298-166" aria-hidden="true" tabindex="-1"></a>通常の出力も少し違う．</span>
<span id="cb298-167"><a href="#cb298-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-170"><a href="#cb298-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-171"><a href="#cb298-171" aria-hidden="true" tabindex="-1"></a>fit_glm</span>
<span id="cb298-172"><a href="#cb298-172" aria-hidden="true" tabindex="-1"></a>fit_gnm</span>
<span id="cb298-173"><a href="#cb298-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-174"><a href="#cb298-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-175"><a href="#cb298-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-178"><a href="#cb298-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-179"><a href="#cb298-179" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_glm)</span>
<span id="cb298-180"><a href="#cb298-180" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_gnm)</span>
<span id="cb298-181"><a href="#cb298-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-182"><a href="#cb298-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-183"><a href="#cb298-183" aria-hidden="true" tabindex="-1"></a>係数はもちろん同じ．</span>
<span id="cb298-184"><a href="#cb298-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-187"><a href="#cb298-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-188"><a href="#cb298-188" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_glm)</span>
<span id="cb298-189"><a href="#cb298-189" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_gnm)</span>
<span id="cb298-190"><a href="#cb298-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-191"><a href="#cb298-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-194"><a href="#cb298-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-195"><a href="#cb298-195" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit_glm)</span>
<span id="cb298-196"><a href="#cb298-196" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit_gnm)</span>
<span id="cb298-197"><a href="#cb298-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-198"><a href="#cb298-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-199"><a href="#cb298-199" aria-hidden="true" tabindex="-1"></a><span class="in">`null.deviance`</span>と<span class="in">`df.null`</span>が<span class="in">`gnm`</span>では出力されない．</span>
<span id="cb298-200"><a href="#cb298-200" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb298-203"><a href="#cb298-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-204"><a href="#cb298-204" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_glm)</span>
<span id="cb298-205"><a href="#cb298-205" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_gnm)</span>
<span id="cb298-206"><a href="#cb298-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-207"><a href="#cb298-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-208"><a href="#cb298-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-209"><a href="#cb298-209" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>gnmで独立モデルと飽和モデル</span>
<span id="cb298-210"><a href="#cb298-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-213"><a href="#cb298-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-214"><a href="#cb298-214" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb298-215"><a href="#cb298-215" aria-hidden="true" tabindex="-1"></a>fit_S <span class="ot">&lt;-</span> <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>Col, <span class="at">data =</span> d, <span class="at">family =</span> poisson)</span>
<span id="cb298-216"><a href="#cb298-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-217"><a href="#cb298-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-218"><a href="#cb298-218" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>モデルの比較は<span class="in">`anova`</span>で可能．</span>
<span id="cb298-219"><a href="#cb298-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-222"><a href="#cb298-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-223"><a href="#cb298-223" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_S)</span>
<span id="cb298-224"><a href="#cb298-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-225"><a href="#cb298-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-228"><a href="#cb298-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-229"><a href="#cb298-229" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_O)</span>
<span id="cb298-230"><a href="#cb298-230" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(fit_S)</span>
<span id="cb298-231"><a href="#cb298-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-232"><a href="#cb298-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-233"><a href="#cb298-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-234"><a href="#cb298-234" aria-hidden="true" tabindex="-1"></a><span class="fu">## 期待度数</span></span>
<span id="cb298-235"><a href="#cb298-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-236"><a href="#cb298-236" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>期待度数を保存すれば期待度数についてのクロス表を作成することができる．飽和モデルの場合は，観測度数のクロス表と一致する．また独立モデルでの期待度数をみると，行によって列の幅が異なっていない（列によって行の幅がことなっていない）ことがわかる．</span>
<span id="cb298-237"><a href="#cb298-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-240"><a href="#cb298-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-241"><a href="#cb298-241" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">O_Freq =</span> fit_O<span class="sc">$</span>fitted.values,</span>
<span id="cb298-242"><a href="#cb298-242" aria-hidden="true" tabindex="-1"></a>              <span class="at">S_Freq =</span> fit_S<span class="sc">$</span>fitted.values)</span>
<span id="cb298-243"><a href="#cb298-243" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> _) <span class="sc">|&gt;</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span>
<span id="cb298-244"><a href="#cb298-244" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(O_Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> _) <span class="sc">|&gt;</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span>
<span id="cb298-245"><a href="#cb298-245" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> <span class="fu">xtabs</span>(S_Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> _) <span class="sc">|&gt;</span> <span class="fu">mosaic</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span>
<span id="cb298-246"><a href="#cb298-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-247"><a href="#cb298-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-248"><a href="#cb298-248" aria-hidden="true" tabindex="-1"></a><span class="in">`fit_O$fitted.values`</span>の代わりに<span class="in">`predict(fit_O, type = "response")`</span>としても良い．<span class="in">`type = "response"`</span>を忘れないようにする．</span>
<span id="cb298-249"><a href="#cb298-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-250"><a href="#cb298-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-251"><a href="#cb298-251" aria-hidden="true" tabindex="-1"></a><span class="fu">## モザイクプロット</span></span>
<span id="cb298-252"><a href="#cb298-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-253"><a href="#cb298-253" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`gnm`</span>パッケージには，<span class="in">`mentalHealth`</span>が用意されているのでこれを使ってみる．</span>
<span id="cb298-254"><a href="#cb298-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-257"><a href="#cb298-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-258"><a href="#cb298-258" aria-hidden="true" tabindex="-1"></a>mentalHealth</span>
<span id="cb298-259"><a href="#cb298-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-260"><a href="#cb298-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-261"><a href="#cb298-261" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`xtabs`</span>は集計データからクロス表を作成する際に用いる．<span class="in">`xtabs(度数 ~ 行変数 + 列変数, data = データ名)`</span>とすればよい．<span class="in">`mentalHealth`</span>では<span class="in">`count`</span>が度数を示している．</span>
<span id="cb298-262"><a href="#cb298-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-265"><a href="#cb298-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-266"><a href="#cb298-266" aria-hidden="true" tabindex="-1"></a>tab_mentalHealth <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(count <span class="sc">~</span> SES <span class="sc">+</span> MHS, <span class="at">data =</span> mentalHealth)</span>
<span id="cb298-267"><a href="#cb298-267" aria-hidden="true" tabindex="-1"></a>tab_mentalHealth</span>
<span id="cb298-268"><a href="#cb298-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-269"><a href="#cb298-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-270"><a href="#cb298-270" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`mosaic`</span>でモザイクプロットを図示．影をつけたければ<span class="in">`shade = TRUE`</span>とする．</span>
<span id="cb298-271"><a href="#cb298-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-274"><a href="#cb298-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-275"><a href="#cb298-275" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(tab_mentalHealth,</span>
<span id="cb298-276"><a href="#cb298-276" aria-hidden="true" tabindex="-1"></a>       <span class="at">shade =</span> <span class="cn">TRUE</span>)</span>
<span id="cb298-277"><a href="#cb298-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-278"><a href="#cb298-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-279"><a href="#cb298-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-280"><a href="#cb298-280" aria-hidden="true" tabindex="-1"></a><span class="fu">## 正規化</span></span>
<span id="cb298-281"><a href="#cb298-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-282"><a href="#cb298-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-283"><a href="#cb298-283" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>モデル適合度を表示するための関数を準備</span>
<span id="cb298-284"><a href="#cb298-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-287"><a href="#cb298-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-288"><a href="#cb298-288" aria-hidden="true" tabindex="-1"></a>model.summary <span class="ot">&lt;-</span> <span class="cf">function</span>(obj) {</span>
<span id="cb298-289"><a href="#cb298-289" aria-hidden="true" tabindex="-1"></a>  aic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="dv">2</span> <span class="co"># AIC(L2)</span></span>
<span id="cb298-290"><a href="#cb298-290" aria-hidden="true" tabindex="-1"></a>  bic <span class="ot">&lt;-</span> obj<span class="sc">$</span>deviance <span class="sc">-</span> obj<span class="sc">$</span>df <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">sum</span>(obj<span class="sc">$</span>y)) <span class="co">#BIC(L2)</span></span>
<span id="cb298-291"><a href="#cb298-291" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">&lt;-</span></span>
<span id="cb298-292"><a href="#cb298-292" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">abs</span>(obj<span class="sc">$</span>y <span class="sc">-</span> obj<span class="sc">$</span>fitted.values)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(obj<span class="sc">$</span>y))</span>
<span id="cb298-293"><a href="#cb298-293" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(obj<span class="sc">$</span>deviance, obj<span class="sc">$</span>df, <span class="at">lower.tail =</span> F)</span>
<span id="cb298-294"><a href="#cb298-294" aria-hidden="true" tabindex="-1"></a>  Model <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(obj))</span>
<span id="cb298-295"><a href="#cb298-295" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb298-296"><a href="#cb298-296" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Model Description"</span> <span class="ot">=</span> Model,</span>
<span id="cb298-297"><a href="#cb298-297" aria-hidden="true" tabindex="-1"></a>    <span class="st">"df"</span> <span class="ot">=</span> obj<span class="sc">$</span>df,</span>
<span id="cb298-298"><a href="#cb298-298" aria-hidden="true" tabindex="-1"></a>    <span class="st">"L2"</span> <span class="ot">=</span> obj<span class="sc">$</span>deviance,</span>
<span id="cb298-299"><a href="#cb298-299" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"AIC(L2)" = aic,</span></span>
<span id="cb298-300"><a href="#cb298-300" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BIC"</span> <span class="ot">=</span> bic,</span>
<span id="cb298-301"><a href="#cb298-301" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Delta"</span> <span class="ot">=</span> delta,</span>
<span id="cb298-302"><a href="#cb298-302" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p"</span> <span class="ot">=</span> p</span>
<span id="cb298-303"><a href="#cb298-303" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-304"><a href="#cb298-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb298-305"><a href="#cb298-305" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb298-306"><a href="#cb298-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-307"><a href="#cb298-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-308"><a href="#cb298-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-309"><a href="#cb298-309" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>変数と係数と係数の順番を表示するための関数を準備</span>
<span id="cb298-310"><a href="#cb298-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-313"><a href="#cb298-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-314"><a href="#cb298-314" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数と係数と係数の順番を表示</span></span>
<span id="cb298-315"><a href="#cb298-315" aria-hidden="true" tabindex="-1"></a>var_num <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb298-316"><a href="#cb298-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">names</span>(model<span class="sc">$</span>coefficients),</span>
<span id="cb298-317"><a href="#cb298-317" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> model<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span></span>
<span id="cb298-318"><a href="#cb298-318" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate,</span>
<span id="cb298-319"><a href="#cb298-319" aria-hidden="true" tabindex="-1"></a>           <span class="at">number =</span> <span class="fu">row_number</span>())</span>
<span id="cb298-320"><a href="#cb298-320" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb298-321"><a href="#cb298-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-322"><a href="#cb298-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-323"><a href="#cb298-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-324"><a href="#cb298-324" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>通常のRCモデルでは行スコアと列スコアが正規化されていない．</span>
<span id="cb298-325"><a href="#cb298-325" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Agresti (2002) </span>
<span id="cb298-326"><a href="#cb298-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-329"><a href="#cb298-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-330"><a href="#cb298-330" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb298-331"><a href="#cb298-331" aria-hidden="true" tabindex="-1"></a><span class="do">##  Goodman Row-Column association model fits well (deviance 3.57, df 8)</span></span>
<span id="cb298-332"><a href="#cb298-332" aria-hidden="true" tabindex="-1"></a>mentalHealth<span class="sc">$</span>MHS <span class="ot">&lt;-</span> <span class="fu">C</span>(mentalHealth<span class="sc">$</span>MHS, treatment)</span>
<span id="cb298-333"><a href="#cb298-333" aria-hidden="true" tabindex="-1"></a>mentalHealth<span class="sc">$</span>SES <span class="ot">&lt;-</span> <span class="fu">C</span>(mentalHealth<span class="sc">$</span>SES, treatment)</span>
<span id="cb298-334"><a href="#cb298-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-335"><a href="#cb298-335" aria-hidden="true" tabindex="-1"></a><span class="co"># Independent Model</span></span>
<span id="cb298-336"><a href="#cb298-336" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> <span class="fu">gnm</span>(count <span class="sc">~</span> SES <span class="sc">+</span> MHS,</span>
<span id="cb298-337"><a href="#cb298-337" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> poisson, <span class="at">data =</span> mentalHealth)</span>
<span id="cb298-338"><a href="#cb298-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-339"><a href="#cb298-339" aria-hidden="true" tabindex="-1"></a><span class="co"># Independent Modelの結果を利用して，初期値を設定</span></span>
<span id="cb298-340"><a href="#cb298-340" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, SES, MHS)</span>
<span id="cb298-341"><a href="#cb298-341" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb298-342"><a href="#cb298-342" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb298-343"><a href="#cb298-343" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="dv">1</span>, mult1),</span>
<span id="cb298-344"><a href="#cb298-344" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb298-345"><a href="#cb298-345" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth</span>
<span id="cb298-346"><a href="#cb298-346" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-347"><a href="#cb298-347" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimateには数字があるが，Std. ErrorがNAとなっている．これらのパラメータは識別されていない．</span></span>
<span id="cb298-348"><a href="#cb298-348" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span>
<span id="cb298-349"><a href="#cb298-349" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(RC1)</span>
<span id="cb298-350"><a href="#cb298-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-351"><a href="#cb298-351" aria-hidden="true" tabindex="-1"></a><span class="co"># 行スコアと列スコアがどこにあるかを取り出す．</span></span>
<span id="cb298-352"><a href="#cb298-352" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC1)</span>
<span id="cb298-353"><a href="#cb298-353" aria-hidden="true" tabindex="-1"></a><span class="co"># c(11:16,17:20)</span></span>
<span id="cb298-354"><a href="#cb298-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-355"><a href="#cb298-355" aria-hidden="true" tabindex="-1"></a><span class="co"># getContrastsによって正規化された推定値とその標準誤差を示す．まずは重み付けのない／単位標準化された解を求める．</span></span>
<span id="cb298-356"><a href="#cb298-356" aria-hidden="true" tabindex="-1"></a>mu_unit <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb298-357"><a href="#cb298-357" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb298-358"><a href="#cb298-358" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]SES"</span>),</span>
<span id="cb298-359"><a href="#cb298-359" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb298-360"><a href="#cb298-360" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb298-361"><a href="#cb298-361" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> <span class="st">"unit"</span></span>
<span id="cb298-362"><a href="#cb298-362" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-363"><a href="#cb298-363" aria-hidden="true" tabindex="-1"></a>nu_unit <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb298-364"><a href="#cb298-364" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb298-365"><a href="#cb298-365" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]MHS"</span>),</span>
<span id="cb298-366"><a href="#cb298-366" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> <span class="st">"mean"</span>,</span>
<span id="cb298-367"><a href="#cb298-367" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> <span class="st">"mean"</span>,</span>
<span id="cb298-368"><a href="#cb298-368" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> <span class="st">"unit"</span></span>
<span id="cb298-369"><a href="#cb298-369" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-370"><a href="#cb298-370" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化された解を表示</span></span>
<span id="cb298-371"><a href="#cb298-371" aria-hidden="true" tabindex="-1"></a>mu_unit</span>
<span id="cb298-372"><a href="#cb298-372" aria-hidden="true" tabindex="-1"></a>nu_unit</span>
<span id="cb298-373"><a href="#cb298-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-374"><a href="#cb298-374" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化制約を確認</span></span>
<span id="cb298-375"><a href="#cb298-375" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>]), <span class="dv">0</span>)</span>
<span id="cb298-376"><a href="#cb298-376" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>]), <span class="dv">0</span>)</span>
<span id="cb298-377"><a href="#cb298-377" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span>), <span class="dv">1</span>)</span>
<span id="cb298-378"><a href="#cb298-378" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span>), <span class="dv">1</span>)</span>
<span id="cb298-379"><a href="#cb298-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-380"><a href="#cb298-380" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の制約</span></span>
<span id="cb298-381"><a href="#cb298-381" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>)], nu_unit<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)])</span>
<span id="cb298-382"><a href="#cb298-382" aria-hidden="true" tabindex="-1"></a>con</span>
<span id="cb298-383"><a href="#cb298-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-384"><a href="#cb298-384" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb298-385"><a href="#cb298-385" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb298-386"><a href="#cb298-386" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">20</span>),</span>
<span id="cb298-387"><a href="#cb298-387" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrainTo =</span> con,</span>
<span id="cb298-388"><a href="#cb298-388" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb298-389"><a href="#cb298-389" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb298-390"><a href="#cb298-390" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth</span>
<span id="cb298-391"><a href="#cb298-391" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-392"><a href="#cb298-392" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span>
<span id="cb298-393"><a href="#cb298-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-394"><a href="#cb298-394" aria-hidden="true" tabindex="-1"></a><span class="co"># intrinsic association parameter</span></span>
<span id="cb298-395"><a href="#cb298-395" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">summary</span>(RC1)<span class="sc">$</span>coefficients[<span class="st">"Mult(., SES, MHS)."</span>, <span class="dv">1</span>]</span>
<span id="cb298-396"><a href="#cb298-396" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> phi <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> phi)</span>
<span id="cb298-397"><a href="#cb298-397" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> phi) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb298-398"><a href="#cb298-398" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> eta <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> eta</span>
<span id="cb298-399"><a href="#cb298-399" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(phi, rho, eta, tau)</span>
<span id="cb298-400"><a href="#cb298-400" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(rho, tau)</span>
<span id="cb298-401"><a href="#cb298-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-402"><a href="#cb298-402" aria-hidden="true" tabindex="-1"></a><span class="do">## Marginal weighted solution</span></span>
<span id="cb298-403"><a href="#cb298-403" aria-hidden="true" tabindex="-1"></a>rowProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(mentalHealth, <span class="fu">tapply</span>(count, SES, sum) <span class="sc">/</span> <span class="fu">sum</span>(count))</span>
<span id="cb298-404"><a href="#cb298-404" aria-hidden="true" tabindex="-1"></a>colProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(mentalHealth, <span class="fu">tapply</span>(count, MHS, sum) <span class="sc">/</span> <span class="fu">sum</span>(count))</span>
<span id="cb298-405"><a href="#cb298-405" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb298-406"><a href="#cb298-406" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb298-407"><a href="#cb298-407" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]SES"</span>),</span>
<span id="cb298-408"><a href="#cb298-408" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> rowProbs,</span>
<span id="cb298-409"><a href="#cb298-409" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> rowProbs,</span>
<span id="cb298-410"><a href="#cb298-410" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> rowProbs</span>
<span id="cb298-411"><a href="#cb298-411" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-412"><a href="#cb298-412" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb298-413"><a href="#cb298-413" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> RC1,</span>
<span id="cb298-414"><a href="#cb298-414" aria-hidden="true" tabindex="-1"></a>  <span class="at">set =</span> <span class="fu">pickCoef</span>(RC1, <span class="st">"[.]MHS"</span>),</span>
<span id="cb298-415"><a href="#cb298-415" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> colProbs,</span>
<span id="cb298-416"><a href="#cb298-416" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> colProbs,</span>
<span id="cb298-417"><a href="#cb298-417" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> colProbs</span>
<span id="cb298-418"><a href="#cb298-418" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-419"><a href="#cb298-419" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>)], nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>][<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)])</span>
<span id="cb298-420"><a href="#cb298-420" aria-hidden="true" tabindex="-1"></a>mu</span>
<span id="cb298-421"><a href="#cb298-421" aria-hidden="true" tabindex="-1"></a>nu</span>
<span id="cb298-422"><a href="#cb298-422" aria-hidden="true" tabindex="-1"></a>con</span>
<span id="cb298-423"><a href="#cb298-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-424"><a href="#cb298-424" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化制約を確認</span></span>
<span id="cb298-425"><a href="#cb298-425" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">*</span> rowProbs), <span class="dv">0</span>)</span>
<span id="cb298-426"><a href="#cb298-426" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">*</span> colProbs), <span class="dv">0</span>)</span>
<span id="cb298-427"><a href="#cb298-427" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> rowProbs), <span class="dv">1</span>)</span>
<span id="cb298-428"><a href="#cb298-428" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sum</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>] <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> colProbs), <span class="dv">1</span>)</span>
<span id="cb298-429"><a href="#cb298-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-430"><a href="#cb298-430" aria-hidden="true" tabindex="-1"></a>RC1 <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb298-431"><a href="#cb298-431" aria-hidden="true" tabindex="-1"></a>  count <span class="sc">~</span> SES <span class="sc">+</span> MHS <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, SES, MHS),</span>
<span id="cb298-432"><a href="#cb298-432" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">20</span>),</span>
<span id="cb298-433"><a href="#cb298-433" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrainTo =</span> con,</span>
<span id="cb298-434"><a href="#cb298-434" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb298-435"><a href="#cb298-435" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb298-436"><a href="#cb298-436" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mentalHealth,</span>
<span id="cb298-437"><a href="#cb298-437" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb298-438"><a href="#cb298-438" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-439"><a href="#cb298-439" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC1)</span>
<span id="cb298-440"><a href="#cb298-440" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(RC1)</span>
<span id="cb298-441"><a href="#cb298-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-442"><a href="#cb298-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-443"><a href="#cb298-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-444"><a href="#cb298-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-445"><a href="#cb298-445" aria-hidden="true" tabindex="-1"></a><span class="fu">## 初期値</span></span>
<span id="cb298-446"><a href="#cb298-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-449"><a href="#cb298-449" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-450"><a href="#cb298-450" aria-hidden="true" tabindex="-1"></a><span class="co"># データの準備</span></span>
<span id="cb298-451"><a href="#cb298-451" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">39</span>, <span class="dv">50</span>, <span class="dv">18</span>,  <span class="dv">4</span>,</span>
<span id="cb298-452"><a href="#cb298-452" aria-hidden="true" tabindex="-1"></a>          <span class="dv">140</span>,<span class="dv">178</span>, <span class="dv">85</span>, <span class="dv">23</span>,</span>
<span id="cb298-453"><a href="#cb298-453" aria-hidden="true" tabindex="-1"></a>          <span class="dv">108</span>,<span class="dv">195</span>, <span class="dv">97</span>, <span class="dv">23</span>,</span>
<span id="cb298-454"><a href="#cb298-454" aria-hidden="true" tabindex="-1"></a>          <span class="dv">238</span>,<span class="dv">598</span>,<span class="dv">363</span>,<span class="dv">111</span>,</span>
<span id="cb298-455"><a href="#cb298-455" aria-hidden="true" tabindex="-1"></a>           <span class="dv">78</span>,<span class="dv">250</span>,<span class="dv">150</span>, <span class="dv">55</span>,</span>
<span id="cb298-456"><a href="#cb298-456" aria-hidden="true" tabindex="-1"></a>           <span class="dv">50</span>,<span class="dv">200</span>,<span class="dv">208</span>, <span class="dv">74</span>,</span>
<span id="cb298-457"><a href="#cb298-457" aria-hidden="true" tabindex="-1"></a>            <span class="dv">8</span>, <span class="dv">29</span>, <span class="dv">46</span>, <span class="dv">21</span>)</span>
<span id="cb298-458"><a href="#cb298-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-459"><a href="#cb298-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-460"><a href="#cb298-460" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span></span>
<span id="cb298-461"><a href="#cb298-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(Freq,</span>
<span id="cb298-462"><a href="#cb298-462" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">7</span>,</span>
<span id="cb298-463"><a href="#cb298-463" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb298-464"><a href="#cb298-464" aria-hidden="true" tabindex="-1"></a>         <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb298-465"><a href="#cb298-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-466"><a href="#cb298-466" aria-hidden="true" tabindex="-1"></a>polviews <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb298-467"><a href="#cb298-467" aria-hidden="true" tabindex="-1"></a>fefam <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">28</span>)</span>
<span id="cb298-468"><a href="#cb298-468" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, polviews, fefam)</span>
<span id="cb298-469"><a href="#cb298-469" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>A</span>
<span id="cb298-470"><a href="#cb298-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-471"><a href="#cb298-471" aria-hidden="true" tabindex="-1"></a><span class="co"># 独立モデル</span></span>
<span id="cb298-472"><a href="#cb298-472" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span> <span class="fu">gnm</span>(</span>
<span id="cb298-473"><a href="#cb298-473" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam,</span>
<span id="cb298-474"><a href="#cb298-474" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb298-475"><a href="#cb298-475" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> _,</span>
<span id="cb298-476"><a href="#cb298-476" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb298-477"><a href="#cb298-477" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-478"><a href="#cb298-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-479"><a href="#cb298-479" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(O)</span>
<span id="cb298-480"><a href="#cb298-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-481"><a href="#cb298-481" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb298-482"><a href="#cb298-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-483"><a href="#cb298-483" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span></span>
<span id="cb298-484"><a href="#cb298-484" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam),</span>
<span id="cb298-485"><a href="#cb298-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-486"><a href="#cb298-486" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb298-487"><a href="#cb298-487" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb298-488"><a href="#cb298-488" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-489"><a href="#cb298-489" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC)</span>
<span id="cb298-490"><a href="#cb298-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-491"><a href="#cb298-491" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam)</span>
<span id="cb298-492"><a href="#cb298-492" aria-hidden="true" tabindex="-1"></a>mult2 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam, <span class="at">d =</span> <span class="dv">2</span>)</span>
<span id="cb298-493"><a href="#cb298-493" aria-hidden="true" tabindex="-1"></a>mult3 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, polviews, fefam, <span class="at">d =</span> <span class="dv">3</span>)</span>
<span id="cb298-494"><a href="#cb298-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-495"><a href="#cb298-495" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb298-496"><a href="#cb298-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-497"><a href="#cb298-497" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam),</span>
<span id="cb298-498"><a href="#cb298-498" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult1),</span>
<span id="cb298-499"><a href="#cb298-499" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-500"><a href="#cb298-500" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb298-501"><a href="#cb298-501" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb298-502"><a href="#cb298-502" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-503"><a href="#cb298-503" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC)</span>
<span id="cb298-504"><a href="#cb298-504" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(RC)</span>
<span id="cb298-505"><a href="#cb298-505" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(RC)</span>
<span id="cb298-506"><a href="#cb298-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-507"><a href="#cb298-507" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb298-508"><a href="#cb298-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-509"><a href="#cb298-509" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span></span>
<span id="cb298-510"><a href="#cb298-510" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb298-511"><a href="#cb298-511" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">2</span>),</span>
<span id="cb298-512"><a href="#cb298-512" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult2[, <span class="dv">1</span>], <span class="cn">NA</span>, mult2[, <span class="dv">2</span>]),</span>
<span id="cb298-513"><a href="#cb298-513" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-514"><a href="#cb298-514" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb298-515"><a href="#cb298-515" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb298-516"><a href="#cb298-516" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-517"><a href="#cb298-517" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC2)</span>
<span id="cb298-518"><a href="#cb298-518" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(RC2)</span>
<span id="cb298-519"><a href="#cb298-519" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(RC2)</span>
<span id="cb298-520"><a href="#cb298-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-521"><a href="#cb298-521" aria-hidden="true" tabindex="-1"></a>RC3 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>A <span class="sc">|&gt;</span></span>
<span id="cb298-522"><a href="#cb298-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-523"><a href="#cb298-523" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> polviews <span class="sc">+</span> fefam <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb298-524"><a href="#cb298-524" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb298-525"><a href="#cb298-525" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Mult</span>(<span class="dv">1</span>, polviews, fefam, <span class="at">inst =</span> <span class="dv">3</span>),</span>
<span id="cb298-526"><a href="#cb298-526" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult3[, <span class="dv">1</span>], <span class="cn">NA</span>, mult3[, <span class="dv">2</span>], <span class="cn">NA</span>, mult3[, <span class="dv">3</span>]),</span>
<span id="cb298-527"><a href="#cb298-527" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-528"><a href="#cb298-528" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb298-529"><a href="#cb298-529" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb298-530"><a href="#cb298-530" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-531"><a href="#cb298-531" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RC3)</span>
<span id="cb298-532"><a href="#cb298-532" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(RC3)</span>
<span id="cb298-533"><a href="#cb298-533" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(RC3)</span>
<span id="cb298-534"><a href="#cb298-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-535"><a href="#cb298-535" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span>
<span id="cb298-536"><a href="#cb298-536" aria-hidden="true" tabindex="-1"></a>anoas_model <span class="ot">&lt;-</span> <span class="fu">anoas</span>(tab_2<span class="fl">.3</span>A, <span class="at">nd =</span> <span class="dv">3</span>)</span>
<span id="cb298-537"><a href="#cb298-537" aria-hidden="true" tabindex="-1"></a>anoas_model</span>
<span id="cb298-538"><a href="#cb298-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-539"><a href="#cb298-539" aria-hidden="true" tabindex="-1"></a><span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, <span class="at">nd =</span> <span class="dv">1</span>)</span>
<span id="cb298-540"><a href="#cb298-540" aria-hidden="true" tabindex="-1"></a><span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, <span class="at">nd =</span> <span class="dv">2</span>)</span>
<span id="cb298-541"><a href="#cb298-541" aria-hidden="true" tabindex="-1"></a><span class="fu">rc</span>(tab_2<span class="fl">.3</span>A, <span class="at">nd =</span> <span class="dv">3</span>)</span>
<span id="cb298-542"><a href="#cb298-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-543"><a href="#cb298-543" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model.summary</span>(O),</span>
<span id="cb298-544"><a href="#cb298-544" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC),</span>
<span id="cb298-545"><a href="#cb298-545" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC2),</span>
<span id="cb298-546"><a href="#cb298-546" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC3))</span>
<span id="cb298-547"><a href="#cb298-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-548"><a href="#cb298-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-549"><a href="#cb298-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-550"><a href="#cb298-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-551"><a href="#cb298-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-552"><a href="#cb298-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-553"><a href="#cb298-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-556"><a href="#cb298-556" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-557"><a href="#cb298-557" aria-hidden="true" tabindex="-1"></a><span class="do">## 表2.3B</span></span>
<span id="cb298-558"><a href="#cb298-558" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">518</span>,  <span class="dv">95</span>, <span class="dv">6</span>, <span class="dv">35</span>, <span class="dv">5</span>,</span>
<span id="cb298-559"><a href="#cb298-559" aria-hidden="true" tabindex="-1"></a>         　 <span class="dv">81</span>,  <span class="dv">67</span>, <span class="dv">4</span>, <span class="dv">49</span>, <span class="dv">2</span>,</span>
<span id="cb298-560"><a href="#cb298-560" aria-hidden="true" tabindex="-1"></a>          <span class="dv">452</span>,<span class="dv">1003</span>,<span class="dv">67</span>,<span class="dv">630</span>, <span class="dv">5</span>,</span>
<span id="cb298-561"><a href="#cb298-561" aria-hidden="true" tabindex="-1"></a>           <span class="dv">71</span>, <span class="dv">157</span>,<span class="dv">37</span>,<span class="dv">562</span>,<span class="dv">12</span>)</span>
<span id="cb298-562"><a href="#cb298-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-563"><a href="#cb298-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-564"><a href="#cb298-564" aria-hidden="true" tabindex="-1"></a><span class="co"># データを表形式に変換</span></span>
<span id="cb298-565"><a href="#cb298-565" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span></span>
<span id="cb298-566"><a href="#cb298-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(Freq,</span>
<span id="cb298-567"><a href="#cb298-567" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb298-568"><a href="#cb298-568" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">5</span>,</span>
<span id="cb298-569"><a href="#cb298-569" aria-hidden="true" tabindex="-1"></a>         <span class="at">byrow =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">as.table</span>()</span>
<span id="cb298-570"><a href="#cb298-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-571"><a href="#cb298-571" aria-hidden="true" tabindex="-1"></a>tab_2<span class="fl">.3</span>B</span>
<span id="cb298-572"><a href="#cb298-572" aria-hidden="true" tabindex="-1"></a><span class="co"># 度数，行変数，列変数からなる集計データを作成</span></span>
<span id="cb298-573"><a href="#cb298-573" aria-hidden="true" tabindex="-1"></a>Educ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb298-574"><a href="#cb298-574" aria-hidden="true" tabindex="-1"></a>Occ <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">20</span>)</span>
<span id="cb298-575"><a href="#cb298-575" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Educ, Occ)</span>
<span id="cb298-576"><a href="#cb298-576" aria-hidden="true" tabindex="-1"></a>freq_tab_2<span class="fl">.3</span>B</span>
<span id="cb298-577"><a href="#cb298-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-578"><a href="#cb298-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-579"><a href="#cb298-579" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span> </span>
<span id="cb298-580"><a href="#cb298-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ,</span>
<span id="cb298-581"><a href="#cb298-581" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> poisson,</span>
<span id="cb298-582"><a href="#cb298-582" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> _,</span>
<span id="cb298-583"><a href="#cb298-583" aria-hidden="true" tabindex="-1"></a>         <span class="at">tolerance =</span> <span class="fl">1e-12</span>)</span>
<span id="cb298-584"><a href="#cb298-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-585"><a href="#cb298-585" aria-hidden="true" tabindex="-1"></a>mult1 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ)</span>
<span id="cb298-586"><a href="#cb298-586" aria-hidden="true" tabindex="-1"></a>mult2 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ, <span class="at">d =</span> <span class="dv">2</span>)</span>
<span id="cb298-587"><a href="#cb298-587" aria-hidden="true" tabindex="-1"></a>mult3 <span class="ot">&lt;-</span> <span class="fu">residSVD</span>(O, Educ, Occ, <span class="at">d =</span> <span class="dv">3</span>)</span>
<span id="cb298-588"><a href="#cb298-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-589"><a href="#cb298-589" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb298-590"><a href="#cb298-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-591"><a href="#cb298-591" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb298-592"><a href="#cb298-592" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-593"><a href="#cb298-593" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb298-594"><a href="#cb298-594" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb298-595"><a href="#cb298-595" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-596"><a href="#cb298-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-597"><a href="#cb298-597" aria-hidden="true" tabindex="-1"></a><span class="fu">var_num</span>(RC)</span>
<span id="cb298-598"><a href="#cb298-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-599"><a href="#cb298-599" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb298-600"><a href="#cb298-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-601"><a href="#cb298-601" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ),</span>
<span id="cb298-602"><a href="#cb298-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="dv">10</span>, mult1),</span>
<span id="cb298-603"><a href="#cb298-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-604"><a href="#cb298-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb298-605"><a href="#cb298-605" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb298-606"><a href="#cb298-606" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-607"><a href="#cb298-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-608"><a href="#cb298-608" aria-hidden="true" tabindex="-1"></a>RC2 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb298-609"><a href="#cb298-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-610"><a href="#cb298-610" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ), <span class="dv">2</span>),</span>
<span id="cb298-611"><a href="#cb298-611" aria-hidden="true" tabindex="-1"></a>    <span class="co">#      start = c(coef(O), NA, mult2[,1], NA, mult2[,2]),</span></span>
<span id="cb298-612"><a href="#cb298-612" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-613"><a href="#cb298-613" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb298-614"><a href="#cb298-614" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb298-615"><a href="#cb298-615" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-616"><a href="#cb298-616" aria-hidden="true" tabindex="-1"></a>RC2</span>
<span id="cb298-617"><a href="#cb298-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-618"><a href="#cb298-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-619"><a href="#cb298-619" aria-hidden="true" tabindex="-1"></a>RC3 <span class="ot">&lt;-</span> freq_tab_2<span class="fl">.3</span>B <span class="sc">|&gt;</span></span>
<span id="cb298-620"><a href="#cb298-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-621"><a href="#cb298-621" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Educ <span class="sc">+</span> Occ <span class="sc">+</span> <span class="fu">instances</span>(<span class="fu">Mult</span>(<span class="dv">1</span>, Educ, Occ), <span class="dv">3</span>),</span>
<span id="cb298-622"><a href="#cb298-622" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="fu">coef</span>(O), <span class="cn">NA</span>, mult3[, <span class="dv">1</span>], <span class="cn">NA</span>, mult3[, <span class="dv">2</span>], <span class="cn">NA</span>, mult3[, <span class="dv">3</span>]),</span>
<span id="cb298-623"><a href="#cb298-623" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-624"><a href="#cb298-624" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb298-625"><a href="#cb298-625" aria-hidden="true" tabindex="-1"></a>    <span class="at">tolerance =</span> <span class="fl">1e-12</span></span>
<span id="cb298-626"><a href="#cb298-626" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-627"><a href="#cb298-627" aria-hidden="true" tabindex="-1"></a>RC3</span>
<span id="cb298-628"><a href="#cb298-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-629"><a href="#cb298-629" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">model.summary</span>(O),</span>
<span id="cb298-630"><a href="#cb298-630" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC),</span>
<span id="cb298-631"><a href="#cb298-631" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC2),</span>
<span id="cb298-632"><a href="#cb298-632" aria-hidden="true" tabindex="-1"></a>          <span class="fu">model.summary</span>(RC3))</span>
<span id="cb298-633"><a href="#cb298-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-634"><a href="#cb298-634" aria-hidden="true" tabindex="-1"></a>anoas_model <span class="ot">&lt;-</span> <span class="fu">anoas</span>(tab_2<span class="fl">.3</span>B, <span class="at">nd =</span> <span class="dv">3</span>)</span>
<span id="cb298-635"><a href="#cb298-635" aria-hidden="true" tabindex="-1"></a>anoas_model</span>
<span id="cb298-636"><a href="#cb298-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-637"><a href="#cb298-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-638"><a href="#cb298-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-639"><a href="#cb298-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-640"><a href="#cb298-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-641"><a href="#cb298-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-642"><a href="#cb298-642" aria-hidden="true" tabindex="-1"></a><span class="fu">## 位相モデル</span></span>
<span id="cb298-643"><a href="#cb298-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-644"><a href="#cb298-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-647"><a href="#cb298-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-648"><a href="#cb298-648" aria-hidden="true" tabindex="-1"></a>occupationalStatus</span>
<span id="cb298-649"><a href="#cb298-649" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(occupationalStatus)</span>
<span id="cb298-650"><a href="#cb298-650" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="ot">&lt;-</span> freq_occupationalStatus <span class="sc">|&gt;</span> </span>
<span id="cb298-651"><a href="#cb298-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb298-652"><a href="#cb298-652" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> destination, origin, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb298-653"><a href="#cb298-653" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rscore =</span> <span class="fu">scale</span>(<span class="fu">as.numeric</span>(origin), <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb298-654"><a href="#cb298-654" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cscore =</span> <span class="fu">scale</span>(<span class="fu">as.numeric</span>(destination), <span class="at">scale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb298-655"><a href="#cb298-655" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-656"><a href="#cb298-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-657"><a href="#cb298-657" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span></span>
<span id="cb298-658"><a href="#cb298-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination, <span class="at">family =</span> poisson, <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb298-659"><a href="#cb298-659" aria-hidden="true" tabindex="-1"></a>fit_QI <span class="ot">&lt;-</span></span>
<span id="cb298-660"><a href="#cb298-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag,</span>
<span id="cb298-661"><a href="#cb298-661" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-662"><a href="#cb298-662" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb298-663"><a href="#cb298-663" aria-hidden="true" tabindex="-1"></a>fit_U <span class="ot">&lt;-</span></span>
<span id="cb298-664"><a href="#cb298-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb298-665"><a href="#cb298-665" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-666"><a href="#cb298-666" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb298-667"><a href="#cb298-667" aria-hidden="true" tabindex="-1"></a>fit_QI_U <span class="ot">&lt;-</span></span>
<span id="cb298-668"><a href="#cb298-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag <span class="sc">+</span> Rscore<span class="sc">:</span>Cscore,</span>
<span id="cb298-669"><a href="#cb298-669" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-670"><a href="#cb298-670" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb298-671"><a href="#cb298-671" aria-hidden="true" tabindex="-1"></a>fit_S <span class="ot">&lt;-</span></span>
<span id="cb298-672"><a href="#cb298-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> origin<span class="sc">:</span>destination,</span>
<span id="cb298-673"><a href="#cb298-673" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-674"><a href="#cb298-674" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> freq_occupationalStatus)</span>
<span id="cb298-675"><a href="#cb298-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-676"><a href="#cb298-676" aria-hidden="true" tabindex="-1"></a>freq_occupationalStatus <span class="ot">&lt;-</span> freq_occupationalStatus <span class="sc">|&gt;</span> </span>
<span id="cb298-677"><a href="#cb298-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb298-678"><a href="#cb298-678" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag1 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb298-679"><a href="#cb298-679" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb298-680"><a href="#cb298-680" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag2 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span></span>
<span id="cb298-681"><a href="#cb298-681" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb298-682"><a href="#cb298-682" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag3 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span></span>
<span id="cb298-683"><a href="#cb298-683" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb298-684"><a href="#cb298-684" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag4 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span></span>
<span id="cb298-685"><a href="#cb298-685" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb298-686"><a href="#cb298-686" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag5 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span></span>
<span id="cb298-687"><a href="#cb298-687" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb298-688"><a href="#cb298-688" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag6 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span></span>
<span id="cb298-689"><a href="#cb298-689" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb298-690"><a href="#cb298-690" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag7 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">7</span> <span class="sc">&amp;</span></span>
<span id="cb298-691"><a href="#cb298-691" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>(),</span>
<span id="cb298-692"><a href="#cb298-692" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag8 =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="dv">8</span> <span class="sc">&amp;</span></span>
<span id="cb298-693"><a href="#cb298-693" aria-hidden="true" tabindex="-1"></a>                     origin <span class="sc">==</span> destination, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>()</span>
<span id="cb298-694"><a href="#cb298-694" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-695"><a href="#cb298-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-696"><a href="#cb298-696" aria-hidden="true" tabindex="-1"></a>fit_QI2 <span class="ot">&lt;-</span></span>
<span id="cb298-697"><a href="#cb298-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-698"><a href="#cb298-698" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> diag1 <span class="sc">+</span> diag2 <span class="sc">+</span> diag3 <span class="sc">+</span> diag4 <span class="sc">+</span> diag5 <span class="sc">+</span> diag6 <span class="sc">+</span> diag7 <span class="sc">+</span> diag8,</span>
<span id="cb298-699"><a href="#cb298-699" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-700"><a href="#cb298-700" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> freq_occupationalStatus</span>
<span id="cb298-701"><a href="#cb298-701" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-702"><a href="#cb298-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-703"><a href="#cb298-703" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_QI)</span>
<span id="cb298-704"><a href="#cb298-704" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_QI2)</span>
<span id="cb298-705"><a href="#cb298-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-706"><a href="#cb298-706" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_QI, fit_U, fit_QI_U, fit_S)</span>
<span id="cb298-707"><a href="#cb298-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-708"><a href="#cb298-708" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb298-709"><a href="#cb298-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_O),</span>
<span id="cb298-710"><a href="#cb298-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_QI),</span>
<span id="cb298-711"><a href="#cb298-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_U),</span>
<span id="cb298-712"><a href="#cb298-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_QI_U),</span>
<span id="cb298-713"><a href="#cb298-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model.summary</span>(fit_S)</span>
<span id="cb298-714"><a href="#cb298-714" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-715"><a href="#cb298-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-716"><a href="#cb298-716" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-717"><a href="#cb298-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-718"><a href="#cb298-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-721"><a href="#cb298-721" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-722"><a href="#cb298-722" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(erikson)</span>
<span id="cb298-723"><a href="#cb298-723" aria-hidden="true" tabindex="-1"></a>erikson</span>
<span id="cb298-724"><a href="#cb298-724" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)</span>
<span id="cb298-725"><a href="#cb298-725" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)<span class="sc">$</span>origin <span class="ot">&lt;-</span></span>
<span id="cb298-726"><a href="#cb298-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"I+II"</span>,<span class="st">"I+II"</span>,<span class="st">"III"</span>,<span class="st">"IVab"</span>,<span class="st">"IVab"</span>,<span class="st">"IVc"</span>,<span class="st">"V/VI"</span>,<span class="st">"VIIa"</span>,<span class="st">"VIIb"</span>)</span>
<span id="cb298-727"><a href="#cb298-727" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(erikson)<span class="sc">$</span>destination <span class="ot">&lt;-</span></span>
<span id="cb298-728"><a href="#cb298-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"I+II"</span>,<span class="st">"I+II"</span>,<span class="st">"III"</span>,<span class="st">"IVab"</span>,<span class="st">"IVab"</span>,<span class="st">"IVc"</span>,<span class="st">"V/VI"</span>,<span class="st">"VIIa"</span>,<span class="st">"VIIb"</span>)</span>
<span id="cb298-729"><a href="#cb298-729" aria-hidden="true" tabindex="-1"></a>freq_erikson <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(erikson)</span>
<span id="cb298-730"><a href="#cb298-730" aria-hidden="true" tabindex="-1"></a>erikson2 <span class="ot">&lt;-</span></span>
<span id="cb298-731"><a href="#cb298-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xtabs</span>(Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country, <span class="at">data =</span> freq_erikson)</span>
<span id="cb298-732"><a href="#cb298-732" aria-hidden="true" tabindex="-1"></a>freq_erikson <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(erikson2)</span>
<span id="cb298-733"><a href="#cb298-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-734"><a href="#cb298-734" aria-hidden="true" tabindex="-1"></a>levelMatrix <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">6</span>,</span>
<span id="cb298-735"><a href="#cb298-735" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>,</span>
<span id="cb298-736"><a href="#cb298-736" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>,</span>
<span id="cb298-737"><a href="#cb298-737" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">2</span>,</span>
<span id="cb298-738"><a href="#cb298-738" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,</span>
<span id="cb298-739"><a href="#cb298-739" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">5</span>,</span>
<span id="cb298-740"><a href="#cb298-740" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">as.factor</span>()</span>
<span id="cb298-741"><a href="#cb298-741" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(freq_erikson, <span class="at">levelMatrix =</span> levelMatrix)</span>
<span id="cb298-742"><a href="#cb298-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-743"><a href="#cb298-743" aria-hidden="true" tabindex="-1"></a>fit_O <span class="ot">&lt;-</span></span>
<span id="cb298-744"><a href="#cb298-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-745"><a href="#cb298-745" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span> origin <span class="sc">*</span> country <span class="sc">+</span></span>
<span id="cb298-746"><a href="#cb298-746" aria-hidden="true" tabindex="-1"></a>      destination <span class="sc">*</span> country,</span>
<span id="cb298-747"><a href="#cb298-747" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-748"><a href="#cb298-748" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d</span>
<span id="cb298-749"><a href="#cb298-749" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-750"><a href="#cb298-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-751"><a href="#cb298-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-752"><a href="#cb298-752" aria-hidden="true" tabindex="-1"></a>fit_Common <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb298-753"><a href="#cb298-753" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span></span>
<span id="cb298-754"><a href="#cb298-754" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> country <span class="sc">+</span> destination <span class="sc">*</span> country <span class="sc">+</span></span>
<span id="cb298-755"><a href="#cb298-755" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> destination,</span>
<span id="cb298-756"><a href="#cb298-756" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb298-757"><a href="#cb298-757" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb298-758"><a href="#cb298-758" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-759"><a href="#cb298-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-760"><a href="#cb298-760" aria-hidden="true" tabindex="-1"></a>fit_Common_Pattern <span class="ot">&lt;-</span> <span class="fu">gnm</span>(</span>
<span id="cb298-761"><a href="#cb298-761" aria-hidden="true" tabindex="-1"></a>  Freq <span class="sc">~</span> origin <span class="sc">+</span> destination <span class="sc">+</span> country <span class="sc">+</span></span>
<span id="cb298-762"><a href="#cb298-762" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">*</span> country <span class="sc">+</span> destination <span class="sc">*</span> country <span class="sc">+</span> levelMatrix,</span>
<span id="cb298-763"><a href="#cb298-763" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb298-764"><a href="#cb298-764" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb298-765"><a href="#cb298-765" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-766"><a href="#cb298-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-767"><a href="#cb298-767" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-768"><a href="#cb298-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb298-769"><a href="#cb298-769" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred1 =</span> fit_O<span class="sc">$</span>fitted.values,</span>
<span id="cb298-770"><a href="#cb298-770" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred2 =</span> fit_Common<span class="sc">$</span>fitted.values,</span>
<span id="cb298-771"><a href="#cb298-771" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred3 =</span> fit_Common_Pattern<span class="sc">$</span>fitted.values</span>
<span id="cb298-772"><a href="#cb298-772" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-773"><a href="#cb298-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-774"><a href="#cb298-774" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_O)</span>
<span id="cb298-775"><a href="#cb298-775" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fit_Common)</span>
<span id="cb298-776"><a href="#cb298-776" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">summary</span>(fit_Common))</span>
<span id="cb298-777"><a href="#cb298-777" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_Common)</span>
<span id="cb298-778"><a href="#cb298-778" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_O, fit_Common_Pattern, fit_Common)</span>
<span id="cb298-779"><a href="#cb298-779" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-780"><a href="#cb298-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-781"><a href="#cb298-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-782"><a href="#cb298-782" aria-hidden="true" tabindex="-1"></a><span class="fu">## 連関モデルと正準相関分析</span></span>
<span id="cb298-783"><a href="#cb298-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-784"><a href="#cb298-784" aria-hidden="true" tabindex="-1"></a>@goodman1981 のTable 1のaより．</span>
<span id="cb298-785"><a href="#cb298-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-788"><a href="#cb298-788" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-789"><a href="#cb298-789" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb298-790"><a href="#cb298-790" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gnm)</span>
<span id="cb298-791"><a href="#cb298-791" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">6</span>, <span class="dv">26</span>, <span class="dv">11</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">23</span>, <span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb298-792"><a href="#cb298-792" aria-hidden="true" tabindex="-1"></a>Row <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb298-793"><a href="#cb298-793" aria-hidden="true" tabindex="-1"></a>Col <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">16</span>)</span>
<span id="cb298-794"><a href="#cb298-794" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Freq, Row, Col) <span class="sc">|&gt;</span> </span>
<span id="cb298-795"><a href="#cb298-795" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">U =</span> <span class="fu">as.numeric</span>(Row),</span>
<span id="cb298-796"><a href="#cb298-796" aria-hidden="true" tabindex="-1"></a>         <span class="at">V =</span> <span class="fu">as.numeric</span>(Col))</span>
<span id="cb298-797"><a href="#cb298-797" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col, <span class="at">data =</span> d)</span>
<span id="cb298-798"><a href="#cb298-798" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-799"><a href="#cb298-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-800"><a href="#cb298-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-803"><a href="#cb298-803" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-804"><a href="#cb298-804" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) O</span></span>
<span id="cb298-805"><a href="#cb298-805" aria-hidden="true" tabindex="-1"></a>O <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-806"><a href="#cb298-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col,</span>
<span id="cb298-807"><a href="#cb298-807" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-808"><a href="#cb298-808" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb298-809"><a href="#cb298-809" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) U</span></span>
<span id="cb298-810"><a href="#cb298-810" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-811"><a href="#cb298-811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> U<span class="sc">:</span>V,</span>
<span id="cb298-812"><a href="#cb298-812" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-813"><a href="#cb298-813" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb298-814"><a href="#cb298-814" aria-hidden="true" tabindex="-1"></a><span class="co"># (3) R</span></span>
<span id="cb298-815"><a href="#cb298-815" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-816"><a href="#cb298-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>V,</span>
<span id="cb298-817"><a href="#cb298-817" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-818"><a href="#cb298-818" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb298-819"><a href="#cb298-819" aria-hidden="true" tabindex="-1"></a><span class="co"># (4) C</span></span>
<span id="cb298-820"><a href="#cb298-820" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-821"><a href="#cb298-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Col<span class="sc">:</span>U,</span>
<span id="cb298-822"><a href="#cb298-822" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-823"><a href="#cb298-823" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb298-824"><a href="#cb298-824" aria-hidden="true" tabindex="-1"></a><span class="co"># (5) RC</span></span>
<span id="cb298-825"><a href="#cb298-825" aria-hidden="true" tabindex="-1"></a>RC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-826"><a href="#cb298-826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb298-827"><a href="#cb298-827" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-828"><a href="#cb298-828" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb298-829"><a href="#cb298-829" aria-hidden="true" tabindex="-1"></a><span class="co"># (6) U + RC</span></span>
<span id="cb298-830"><a href="#cb298-830" aria-hidden="true" tabindex="-1"></a>UplusRC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-831"><a href="#cb298-831" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> U<span class="sc">:</span>V <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb298-832"><a href="#cb298-832" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-833"><a href="#cb298-833" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb298-834"><a href="#cb298-834" aria-hidden="true" tabindex="-1"></a><span class="co"># (7) R + RC</span></span>
<span id="cb298-835"><a href="#cb298-835" aria-hidden="true" tabindex="-1"></a>RplusRC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-836"><a href="#cb298-836" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>V <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb298-837"><a href="#cb298-837" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-838"><a href="#cb298-838" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb298-839"><a href="#cb298-839" aria-hidden="true" tabindex="-1"></a><span class="co"># (8) C + RC</span></span>
<span id="cb298-840"><a href="#cb298-840" aria-hidden="true" tabindex="-1"></a>CplusRC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-841"><a href="#cb298-841" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Col<span class="sc">:</span>U <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb298-842"><a href="#cb298-842" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-843"><a href="#cb298-843" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb298-844"><a href="#cb298-844" aria-hidden="true" tabindex="-1"></a><span class="co"># (9) R + C + RC</span></span>
<span id="cb298-845"><a href="#cb298-845" aria-hidden="true" tabindex="-1"></a>RplusCplusRC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-846"><a href="#cb298-846" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>V <span class="sc">+</span> Col<span class="sc">:</span>U <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb298-847"><a href="#cb298-847" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-848"><a href="#cb298-848" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb298-849"><a href="#cb298-849" aria-hidden="true" tabindex="-1"></a><span class="co"># (10) R + C</span></span>
<span id="cb298-850"><a href="#cb298-850" aria-hidden="true" tabindex="-1"></a>RplusC <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb298-851"><a href="#cb298-851" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> Row<span class="sc">:</span>V <span class="sc">+</span> Col<span class="sc">:</span>U,</span>
<span id="cb298-852"><a href="#cb298-852" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-853"><a href="#cb298-853" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> _)</span>
<span id="cb298-854"><a href="#cb298-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-855"><a href="#cb298-855" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(O, U, R, C, RC, UplusRC, RplusRC, CplusRC, RplusCplusRC, RplusC) <span class="sc">|&gt;</span> </span>
<span id="cb298-856"><a href="#cb298-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(glance, <span class="at">id =</span> <span class="st">"Model"</span>)</span>
<span id="cb298-857"><a href="#cb298-857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb298-858"><a href="#cb298-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-859"><a href="#cb298-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-860"><a href="#cb298-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-861"><a href="#cb298-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-864"><a href="#cb298-864" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb298-865"><a href="#cb298-865" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span></span>
<span id="cb298-866"><a href="#cb298-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb298-867"><a href="#cb298-867" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb298-868"><a href="#cb298-868" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> d)</span>
<span id="cb298-869"><a href="#cb298-869" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb298-870"><a href="#cb298-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-871"><a href="#cb298-871" aria-hidden="true" tabindex="-1"></a>rowProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(d, <span class="fu">tapply</span>(Freq, Row, sum) <span class="sc">/</span> <span class="fu">sum</span>(Freq))</span>
<span id="cb298-872"><a href="#cb298-872" aria-hidden="true" tabindex="-1"></a>colProbs <span class="ot">&lt;-</span> <span class="fu">with</span>(d, <span class="fu">tapply</span>(Freq, Col, sum) <span class="sc">/</span> <span class="fu">sum</span>(Freq))</span>
<span id="cb298-873"><a href="#cb298-873" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb298-874"><a href="#cb298-874" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb298-875"><a href="#cb298-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pickCoef</span>(fit, <span class="st">"[.]Row"</span>),</span>
<span id="cb298-876"><a href="#cb298-876" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> rowProbs,</span>
<span id="cb298-877"><a href="#cb298-877" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> rowProbs,</span>
<span id="cb298-878"><a href="#cb298-878" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> rowProbs</span>
<span id="cb298-879"><a href="#cb298-879" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-880"><a href="#cb298-880" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="fu">getContrasts</span>(</span>
<span id="cb298-881"><a href="#cb298-881" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb298-882"><a href="#cb298-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pickCoef</span>(fit, <span class="st">"[.]Col"</span>),</span>
<span id="cb298-883"><a href="#cb298-883" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> colProbs,</span>
<span id="cb298-884"><a href="#cb298-884" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleRef =</span> colProbs,</span>
<span id="cb298-885"><a href="#cb298-885" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaleWeights =</span> colProbs</span>
<span id="cb298-886"><a href="#cb298-886" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-887"><a href="#cb298-887" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span></span>
<span id="cb298-888"><a href="#cb298-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gnm</span>(</span>
<span id="cb298-889"><a href="#cb298-889" aria-hidden="true" tabindex="-1"></a>    Freq <span class="sc">~</span> Row <span class="sc">+</span> Col <span class="sc">+</span> <span class="fu">Mult</span>(<span class="dv">1</span>, Row, Col),</span>
<span id="cb298-890"><a href="#cb298-890" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> poisson,</span>
<span id="cb298-891"><a href="#cb298-891" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d,</span>
<span id="cb298-892"><a href="#cb298-892" aria-hidden="true" tabindex="-1"></a>    <span class="at">constrain =</span> <span class="dv">9</span><span class="sc">:</span><span class="dv">16</span>,</span>
<span id="cb298-893"><a href="#cb298-893" aria-hidden="true" tabindex="-1"></a>    <span class="at">constrainTo =</span> <span class="fu">c</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>])</span>
<span id="cb298-894"><a href="#cb298-894" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb298-895"><a href="#cb298-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-896"><a href="#cb298-896" aria-hidden="true" tabindex="-1"></a>mu_score <span class="ot">&lt;-</span> <span class="fu">rep</span>(mu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="at">each =</span> <span class="dv">4</span>)</span>
<span id="cb298-897"><a href="#cb298-897" aria-hidden="true" tabindex="-1"></a>nu_score <span class="ot">&lt;-</span> <span class="fu">rep</span>(nu<span class="sc">$</span>qvframe[, <span class="dv">1</span>], <span class="dv">4</span>)</span>
<span id="cb298-898"><a href="#cb298-898" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">mu =</span> mu_score,</span>
<span id="cb298-899"><a href="#cb298-899" aria-hidden="true" tabindex="-1"></a>              <span class="at">nu =</span> nu_score)</span>
<span id="cb298-900"><a href="#cb298-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-901"><a href="#cb298-901" aria-hidden="true" tabindex="-1"></a><span class="co"># Canonical correlation</span></span>
<span id="cb298-902"><a href="#cb298-902" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wCorr)</span>
<span id="cb298-903"><a href="#cb298-903" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(d, <span class="fu">weightedCorr</span>(mu, <span class="at">x =</span> nu, <span class="at">weights =</span> Freq, <span class="at">method =</span> <span class="st">"Pearson"</span>))</span>
<span id="cb298-904"><a href="#cb298-904" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(d, <span class="fu">weightedCorr</span>(U, <span class="at">x =</span> V, <span class="at">weights =</span> Freq, <span class="at">method =</span> <span class="st">"Polychoric"</span>))</span>
<span id="cb298-905"><a href="#cb298-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-906"><a href="#cb298-906" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(polycor)</span>
<span id="cb298-907"><a href="#cb298-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-908"><a href="#cb298-908" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb298-909"><a href="#cb298-909" aria-hidden="true" tabindex="-1"></a>d_ind <span class="ot">&lt;-</span> <span class="fu">expand.dft</span>(d, <span class="at">dreq =</span> <span class="st">"Freq"</span>)</span>
<span id="cb298-910"><a href="#cb298-910" aria-hidden="true" tabindex="-1"></a>d_ind</span>
<span id="cb298-911"><a href="#cb298-911" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb298-912"><a href="#cb298-912" aria-hidden="true" tabindex="-1"></a><span class="fu">CorPolychor</span>(d_ind<span class="sc">$</span>U, d_ind<span class="sc">$</span>V, <span class="at">ML =</span> <span class="cn">TRUE</span>)</span>
<span id="cb298-913"><a href="#cb298-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-914"><a href="#cb298-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-915"><a href="#cb298-915" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb298-916"><a href="#cb298-916" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb298-917"><a href="#cb298-917" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> fit<span class="sc">$</span>coefficients[<span class="st">"Mult(., Row, Col)."</span>] <span class="sc">|&gt;</span> <span class="fu">abs</span>()</span>
<span id="cb298-918"><a href="#cb298-918" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> phi <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> phi)</span>
<span id="cb298-919"><a href="#cb298-919" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> phi) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb298-920"><a href="#cb298-920" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> eta <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">^</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> eta</span>
<span id="cb298-921"><a href="#cb298-921" aria-hidden="true" tabindex="-1"></a>mu</span>
<span id="cb298-922"><a href="#cb298-922" aria-hidden="true" tabindex="-1"></a>nu</span>
<span id="cb298-923"><a href="#cb298-923" aria-hidden="true" tabindex="-1"></a>phi</span>
<span id="cb298-924"><a href="#cb298-924" aria-hidden="true" tabindex="-1"></a>rho</span>
<span id="cb298-925"><a href="#cb298-925" aria-hidden="true" tabindex="-1"></a>tau</span>
<span id="cb298-926"><a href="#cb298-926" aria-hidden="true" tabindex="-1"></a>delta_mu <span class="ot">&lt;-</span> <span class="fu">abs</span>((<span class="sc">-</span><span class="fl">1.3354658</span> <span class="sc">-</span> <span class="fl">1.1376491</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">4</span>))</span>
<span id="cb298-927"><a href="#cb298-927" aria-hidden="true" tabindex="-1"></a>delta_nu <span class="ot">&lt;-</span> <span class="fu">abs</span>((<span class="sc">-</span><span class="fl">0.8513968</span> <span class="sc">-</span> <span class="fl">1.0822644</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">4</span>))</span>
<span id="cb298-928"><a href="#cb298-928" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted</span></span>
<span id="cb298-929"><a href="#cb298-929" aria-hidden="true" tabindex="-1"></a>tau <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> delta_mu <span class="sc">/</span> <span class="dv">12</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> delta_nu <span class="sc">/</span> <span class="dv">12</span>)) <span class="sc">^</span> (<span class="sc">-</span><span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb298-930"><a href="#cb298-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-931"><a href="#cb298-931" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(logmult)</span>
<span id="cb298-932"><a href="#cb298-932" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Freq,</span>
<span id="cb298-933"><a href="#cb298-933" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb298-934"><a href="#cb298-934" aria-hidden="true" tabindex="-1"></a>              <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb298-935"><a href="#cb298-935" aria-hidden="true" tabindex="-1"></a>              <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb298-936"><a href="#cb298-936" aria-hidden="true" tabindex="-1"></a>rc2 <span class="ot">&lt;-</span> <span class="fu">rc</span>(tab,</span>
<span id="cb298-937"><a href="#cb298-937" aria-hidden="true" tabindex="-1"></a>          <span class="at">nd =</span> <span class="dv">1</span>,</span>
<span id="cb298-938"><a href="#cb298-938" aria-hidden="true" tabindex="-1"></a>          <span class="at">weighting =</span> <span class="st">"marginal"</span>,</span>
<span id="cb298-939"><a href="#cb298-939" aria-hidden="true" tabindex="-1"></a>          <span class="at">se =</span> <span class="st">"bootstrap"</span>)</span>
<span id="cb298-940"><a href="#cb298-940" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rc2)</span>
<span id="cb298-941"><a href="#cb298-941" aria-hidden="true" tabindex="-1"></a><span class="fu">assoc</span>(rc2)</span>
<span id="cb298-942"><a href="#cb298-942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>